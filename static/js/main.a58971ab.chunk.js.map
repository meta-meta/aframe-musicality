{"version":3,"sources":["cell.js","fretMarkers.js","util.js","pc.js","banjo.js","frettedInstrument.js","guitar.js","intro.js","multTableMod12.js","numpadMod12.js","useMidi.js","useMidiClock.js","useP5.js","color.js","mandelbrotP5.js","mandelbrot.js","mandolin.js","useMic.js","mic.js","midi.js","ratioLightshipP5.js","ratioLightship.js","staff.js","tonnetz.js","ukulele.js","camera.js","pitchClass.js","coltraneCircle.js","dod.js","pitchClassCollections.js","pcSpiralWindController.js","usePrevious.js","pitchClassSpiral.js","vr.js","fns.js","index.js"],"names":["Cell","withStyles","root","fontSize","fontFamily","display","height","width","alignItems","justifyContent","odd","left","cellSize","position","_ref","children","classes","_ref$className","className","isOdd","style","react_default","a","createElement","concat","FretMarkers","fretMarker","color","frets","_","range","last","map","f","includes","fret","ix","cell","key","toSymbol","n","10","11","PC","Banjo","flexShrink","src_fretMarkers","pc0","pc0ix","Fragment","i","pc","src_pc","FrettedInstrument","fretCount","fretMarkers","tuning","Object","toConsumableArray","reverse","ixPc0","Guitar","frettedInstrument","Intro","overflowY","padding","MultTableMod12","margin","y","x","NumpadMod12","state","text","handleKeyPress","evt","char","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadDivide","NumpadMultiply","NumpadDecimal","NumpadEnter","Enter","Space","code","preventDefault","_this","setState","handleChange","value","target","window","addEventListener","this","removeEventListener","cols","rows","onChange","background","Component","initialState","input","undefined","inputDevices","isMidiClockInSelectorOpen","isMidiInSelectorOpen","midiClockInDevice","midiInDevice","midiIn","zipObject","fill","Array","actions","setInputDevices","store","setMidiEvent","midiEvt","merge","setMidiClockInDevice","setMidiInDevice","toggleMidiInSelector","toggleMidiClockInSelector","globalHook","React","useMidiClock","onClock","_useMidi","useMidi","_useMidi2","slicedToArray","tick","useEffect","handleMidiClock","addListener","removeListener","reset","useP5","sketch","_useState","useState","_useState2","sketchState","setSketchState","_useState3","_useState4","sketchInstance","setSketchInstance","_useState5","_useState6","resizeObserver","setResizeObserver","ref","useCallback","el","instance","P5","_height","clientHeight","_width","clientWidth","ro","ResizeObserver","_ref2$0$contentRect","contentRect","resizeCanvas","prevState","objectSpread","isRegenNeeded","observe","disconnect","HSVtoHex","h","s","v","r","g","b","p","q","t","arguments","length","Math","floor","componentToHex","c","hex","toString","rgbToHex","round","timeouts","messageName","event","source","data","stopPropagation","shift","fn","setZeroTimeout","push","postMessage","decayDuration","exciteEnergy","exciteDuration","fundamentalFreq","hilbertN","hilbMand","isControlPanelOpen","isPlaying","maxIters","midiClock","midiClocksPerTick","panX","panY","partials","partialsCountMax","isSmooth","tickDuration","tickLastMillis","zoom","audioCtx","AudioContext","oscs","masterGain","createGain","gain","connect","destination","p5","font","hilbGetRotatedVec","rx","ry","temp","dot","v1","v2","reduce","acc","val","idx","mandGetValFromNormalizedCoords","xN","yN","maxIterations","_mandGetDenormalizedC","mandGetDenormalizedCoords","cx","cy","z","log2","mandGetValSmooth","scaledX","scaledY","iter","xTemp","mandGetVal","genHilbertCoords","memoize","d","dist","hilbDistanceToCoords","getStrokeWeight","w","sideLength","min","getPartialOfOctaveStart","pow","dropWhile","first","getColorForMandelbrotVal","_ref3","m","isCursor","_p5$state2","octMax","oct","setFillColorForMandelbrotVal","coordsWithVal","drawHilbertCoord","hilbertCoord","scaleX","scaleY","rect","drawHilbertMandelbrot","strokeWeight","stroke","getSideLengthForLinearizedMap","forEach","coordWithVal","translate","pop","drawLinearizedMandelbrotCoord","dMax","maxA","largestPossibleSide","sqrt","sqPerRow","valsPerRow","genAndDrawHilbertMandelbrot","_ref4","cancelScheduledValues","currentTime","linearRampToValueAtTime","_p5$state3","osc","stop","createOscillator","start","_p5$state","_ref2","genHilbertMandelbrot","_ref5","filter","identity","uniq","sort","take","partial","amp","oscIdx","fromPairs","each","_ref6","decayTimerId","zeroGainTimerId","clearTimeout","frequency","nextState","prevD","cursorDraw","id","coordAndVal","maxD","prevCoordAndVal","cursorErasePrev","partialsDraw","noStroke","_p5$state5","_ref7","targetAmp","barH","barW","hue","wasPaused","preload","loadFont","setup","createCanvas","colorMode","HSB","textFont","incrementTick","isExternal","now","millis","_p5$state6","_p5$state4","currGain","isNumber","targetGain","setTimeout","exponentialRampToValueAtTime","cursorExcite","prevTick","draw","_p5$state7","every","noFill","textSize","textAlign","CENTER","toggleAudio","resume","suspend","useStyles","makeStyles","paper","paddingBottom","FreqSlider","_ref2$initialVal","initialVal","_ref2$isInt","isInt","_ref2$isRegenRequired","isRegenRequired","_ref2$label","label","_ref2$max","max","Number","MAX_VALUE","_ref2$min","MIN_VALUE","_ref2$precision","precision","_ref2$size","size","stateKey","constrainVal","valToState","freq","logFreq","exp","deg","numberInputVal","defer","flex","marginBottom","paddingTop","onPointerUp","react_circular_slider_default","dataIndex","degPerExp","knobColor","knobSize","renderLabelValue","type","border","marginLeft","marginTop","top","zIndex","toPrecision","ev","onKeyDown","_objectSpread4","defineProperty","nextExp","progressColorFrom","progressColorTo","progressLineCap","trackColor","Mandelbrot","_useP","handleAction","action","panDelta","moveLeft","moveRight","moveUp","moveDown","resDec","resInc","toggleControlPanel","zoomIn","zoomOut","isEmpty","getHandleAction","document","title","handler","shiftKey","getAction","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","handleKeyDown","alignSelf","bottom","right","Button","onClick","Tune_default","Drawer","anchor","open","onClose","variant","ButtonGroup","fullWidth","PauseCircleOutline_default","PlayCircleOutline_default","ViewModuleOutlined_default","KeyboardArrowUpOutlined_default","ViewComfyOutlined_default","ZoomInOutlined_default","KeyboardArrowLeftOutlined_default","KeyboardArrowDownOutlined_default","KeyboardArrowRightOutlined_default","ZoomOutOutlined_default","mandelbrot_FreqSlider","flexWrap","Mandolin","mediaStream","setMediaStream","Mic","_useMic","useMic","_useMic2","isMicOn","IconButton","edge","getTracks","tr","navigator","mediaDevices","getUserMedia","audio","video","then","MicOffOutlined","esm_Mic","Midi","WebMidi","enable","err","console","error","log","inputs","handleMidi","note","number","rawVelocity","_React$useState","_React$useState2","midiMenuAnchorEl","setMidiMenuAnchorEl","handleMidiMenuButtonClick","isBeatClock","currentTarget","handleMidiInputSelect","deviceIdx","aria-label","src","WatchLater","Menu","anchorEl","handleMidiMenuClose","name","MenuItem","selected","get","TWO_PI","PI","n2","blendMode","ADD","keyTyped","obj","join","split","parseInt","_obj","_obj2","phase","x1","y1","drawWave","_ref2$phase","dt","sin","cos","line","clear","BLEND","RatioLightship","VF","Vex","Flow","Staff","_useVexFlow","context","setContext","renderer","Renderer","Backends","SVG","resize","getContext","useVexFlow","setStrokeStyle","setFillStyle","treble","Stave","addClef","addKeySignature","addTimeSignature","bass","StaveConnector","setType","BRACE","SINGLE_LEFT","Tonnetz","Ukulele","Camera","primitive","look-controls","wasd-controls","acceleration","handleOsc","components","onOsc","instrument","vel","onTick","time","timeDelta","has","setAttribute","pitchClass","_ref2$darkened","darkened","_ref2$position","_ref2$scale","scale","material","blending","opacity","radius","radius-tubular","look-at","align","negate","transparent","ColtraneCircle","is180","setIs180","toggle","midiInPitchClasses","pickBy","values","sum","animation","c1","c2","verts","Dod","_ref$rep","rep","sat","_ref$stack","stack","_ref$n","events","click","PitchClassCollections","objectDestructuringEmpty","collEl","setCollEl","collRef","object3D","set","handleKeyup","colls","coll","rotation","theta","_ref5$s","PcSpiralWindController","noteToDimensions","midiInEl","setMidiInEl","prevMidiInDevice","useRef","current","usePrevious","velocity","_noteToDimensions","controller","_noteToDimensions2","midiInRef","audioContext","PitchClassSpiral","_ref$depthMax","depthMax","_ref$isAlwaysCounterC","isAlwaysCounterClockwise","_ref$rMax","rMax","_ref$rMin","rMin","_ref$noteRange","noteRange","_ref$pcsHighlighted","pcsHighlighted","detector","setDetector","pitchDetectEl","setPitchDetectEl","step","PitchDetector","interpolateFrequency","onDebug","stats","pitchDetector","detected","rms","ftomf","isFinite","minCorrelationIncrease","normalize","stopAfterDetection","minNote","maxNote","minPeriod","maxPeriod","destroy","pitchDetectRef","pick","end","visible","pcSpiralWindController","VR","path","match","react_router","component","camera","oculus-touch-controls","toOctave","intToRation","fraction","doWhenAframeLoaded","AFRAME","oscHost","host","location","hostname","port","secure","OSC","plugin","WebsocketClientPlugin","registerComponent","init","_onOscId","on","address","_ref$args","args","remove","off","_this2","_ref2$args","routes2d","ReactDOM","render","prefersDarkMode","useMediaQuery","dark","palette","active","primary","main","light","theme","useMemo","createMuiTheme","menuAnchorEl","setMenuAnchorEl","handleMenuClose","ThemeProvider","CssBaseline","react_router_dom","basename","process","exact","AppBar","Toolbar","esm_Menu","to","disabled","divider","url","_ref8","_ref9","midi","mic","querySelector"],"mappings":"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","file":"static/js/main.a58971ab.chunk.js","sourcesContent":["import React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst cellSize = 30;\r\n\r\nconst Cell = withStyles({\r\n  root: {\r\n    fontSize: 20,\r\n    fontFamily: 'jetBrainsMono',\r\n    display: 'inline-flex',\r\n    height: cellSize,\r\n    width: cellSize,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    // border: '1px solid',\r\n  },\r\n  odd: {\r\n    left: cellSize / 2,\r\n    position: 'relative',\r\n  }\r\n})(({children, classes, className = '', isOdd, style}) => (\r\n  <div\r\n    className={`${classes.root} ${className} ${isOdd ? classes.odd : ''}`}\r\n    style={style}>\r\n    {children}\r\n  </div>\r\n));\r\n\r\nexport default Cell;\r\n","import _ from 'lodash';\r\nimport Cell from \"./cell\";\r\nimport React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst FretMarkers = withStyles({\r\n  fretMarker: {color: 'purple'}\r\n})(\r\n  ({classes: {fretMarker}, frets}) => _.range(_.last(frets) + 1)\r\n    .map(f => _.includes(frets, f) ? f : '')\r\n    .map((fret, ix) => <Cell className={fretMarker} key={ix}>{fret}</Cell>));\r\n\r\nexport default FretMarkers;\r\n","export const toSymbol = n => ({\r\n  10: '',\r\n  11: '',\r\n})[n % 12] || n % 12;\r\n\r\n// ripped from Tone/core/Conversions\r\nexport const ftomf = (frequency) => {\r\n  return 69 + 12 * Math.log2(frequency / 440);\r\n}\r\n","import Cell from './cell';\r\nimport React from \"react\";\r\nimport {toSymbol} from \"./util\";\r\n\r\nconst PC = ({classes, n, isOdd, style}) => (\r\n  <Cell\r\n    isOdd={isOdd}\r\n    style={style}\r\n  >\r\n    {toSymbol(n)}\r\n  </Cell>\r\n)\r\n\r\nexport default PC;\r\n","import _ from 'lodash';\r\nimport Cell from './cell';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [1,3,5,7,10,12,15,17,19];\r\n\r\nconst Banjo = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets} />\r\n    <br/>\r\n    {[0, 9, 5, 0, 0].map((pc0, pc0ix) => (\r\n      <React.Fragment key={pc0ix}>\r\n        {_.range(23)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) =>\r\n            pc0ix === 4 && ix < 5\r\n              ? <Cell key={ix}/>\r\n              : <PC key={ix} n={pc}/>\r\n          )}\r\n        <br/>\r\n      </React.Fragment>\r\n    ))}\r\n    <FretMarkers frets={frets} />\r\n  </div>\r\n);\r\n\r\nexport default Banjo;\r\n","import _ from 'lodash';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\n\r\nconst FrettedInstrument = ({ fretCount, fretMarkers, tuning }) => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={fretMarkers}/>\r\n    <br/>\r\n    {[...tuning]\r\n      .reverse() //mutates\r\n      .map((pc0, ixPc0) => (\r\n      <React.Fragment key={ixPc0}>\r\n        {_.range(fretCount + 1 /*for zeroth*/)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) => (\r\n            <PC key={ix} n={pc}/>\r\n          ))}\r\n        <br/>\r\n      </React.Fragment>\r\n    ))}\r\n    <FretMarkers frets={fretMarkers}/>\r\n  </div>\r\n);\r\n\r\nexport default FrettedInstrument;\r\n","import React from 'react';\r\nimport FrettedInstrument from './frettedInstrument';\r\n\r\nconst tunings = {\r\n  standard: [4, 9, 2, 7, 11, 4],\r\n  chelseaSessionsTuning: [0, 5, 0, 5, 9, 5],\r\n  octoberSongTuning: [0, 7, 0, 4, 7, 0],\r\n};\r\n\r\nconst tuning = tunings['standard'];\r\n\r\nconst Guitar = () => (\r\n  <FrettedInstrument\r\n    fretCount={24}\r\n    fretMarkers={[0, 5, 7, 12, 15, 17, 19, 24]}\r\n    tuning={tuning}\r\n  />\r\n)\r\n\r\nexport default Guitar;\r\n","import _ from 'lodash';\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst Intro = () => (\r\n  <div style={{height: '100%', overflowY: 'auto', padding: '20% 10%'}}>\r\n    <h1>What is this nonsense all about?</h1>\r\n\r\n    <p>\r\n      When I learned how to play an instrument, we started with \"Hot Cross Buns\", \"Mary Had a Little Lamb\", etc.\r\n      We started with the first 3 notes in the key of \"C\". Eventually, we'd build up to the other 4 notes. Then a new\r\n      key was introduced. This one has a \"Bb\" -- the key of \"F\". At some point we'd be introduced to an \"accidental\".\r\n    </p>\r\n\r\n    <p>\r\n      This left a lasting impression that the notes C, D, E, F, G, A, and B were the main notes. And these other things\r\n      were in another class. They were harder -- harder to think about, harder to play, harder to keep track of, harder\r\n      to say. C, D, E, F, G, A, and B are all single syllables. The other 5 notes were thought of as modifications of\r\n      these main notes. \"B flat\", \"C sharp\", \"D flat\", yada yada. Wait are there 5 or are there 10?\r\n    </p>\r\n\r\n    <p>\r\n      \"B sharp\" is one of the first little musical jokes you get to say when you're in the know, until you learn that\r\n      when you really get in deep, actually \"B sharp\" <i>is</i> a real note. There's even a \"B double sharp\"! How many\r\n      notes <i>are</i> there!? Answer: infinite, as there are infinite numbers between 0 and 1, there are infinite\r\n      pitches. Another answer, and this is the one we'll focus on in this website, is 12. There are 12 pitch-classes in\r\n      the musical system that westerners refer to as \"music theory\" and more formally 12-tone equal temperament. All the\r\n      fancy names like \"B flat\" and \"F sharp\" are just various spellings of the 12 pitch-classes in 12-TET.\r\n    </p>\r\n\r\n    <p>\r\n      This is all kind of interesting for a while and makes a young musician wonder about how deep this labyrinth gets.\r\n      But it's all a smoke screen. And it gets even worse when you start to learn about intervals. Honestly, what's the\r\n      use of a \"diminished second\" if not to sound pedantic and \"technically correct\"?\r\n    </p>\r\n\r\n    <p>\r\n      While I'll concede that it sort of makes sense when you're talking about notes <i>written on a staff</i>,\r\n      I'll maintain that it's a bullshit system to think in and it's needlessly convoluted, scares off all but the\r\n      masochistic academics and overachievers. It adds a layer of cognitive as well as verbal overhead to otherwise\r\n      simple concepts, and all so that we can pretend that music all fits into this diatonic model, with a few outliers\r\n      that we call \"accidentals\". It makes the white keys approachable and the black keys scary and hard to name. \"Is\r\n      it a C# or a Db\"? Why do we care, when we really just want to think about the one pitch we're trying to finger?\r\n    </p>\r\n\r\n    <p>\r\n      If we're going to commit to this arguably artificial model of 12 notes, which is but one of a panoply of more\r\n      naturally harmonious tunings, if we're going to compromise with this 12-TET model so that we end up with 12\r\n      equally spaced notes around the octave, let's go all in and treat it with the simple terms it asks for. Let's\r\n      treat these 12 notes equally instead of imagining this additional layer of complexity on top of them.\r\n    </p>\r\n\r\n    <br/>\r\n    <hr/>\r\n\r\n    <h2>Please consider:</h2>\r\n    <pre>{_.range(12).map(pc => <PC key={pc} n={pc}/>)}</pre>\r\n    <p> That's \"oh\" \"one\" \"two\" \"three\" \"four\" \"five\" \"six\" \"sev\" \"eight\" \"nine\" \"ten\" \"el\".</p>\r\n\r\n\r\n\r\n  </div>\r\n);\r\n\r\nexport default Intro;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport { toSymbol } from \"./util\";\r\nimport PC from \"./pc\";\r\n\r\nconst MultTableMod12 = () => (\r\n  <>\r\n    {_.range(6).map(n => (\r\n      <div style={{\r\n        display: 'block',\r\n        flexShrink: 0,\r\n        margin: '1em',\r\n      }}>\r\n        {_.range(13).map(y => (\r\n          <>\r\n            {_.range(13).map(x => (\r\n              <PC key={x} n={n + x * y} />\r\n            ))}\r\n            <br />\r\n          </>\r\n        ))}\r\n\r\n      </div>\r\n    ))}\r\n  </>);\r\n\r\nexport default MultTableMod12;\r\n","import _ from 'lodash';\r\nimport React, { Component } from 'react';\r\nimport { toSymbol } from \"./util\";\r\n\r\nclass NumpadMod12 extends Component {\r\n  state = {\r\n    text: '',\r\n  };\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  handleKeyPress = (evt) => {\r\n    // console.log(evt.code)\r\n    const char = {\r\n      Backquote: '0',\r\n      Digit1: '1',\r\n      Digit2: '2',\r\n      Digit3: '3',\r\n      Digit4: '4',\r\n      Digit5: '5',\r\n      Digit6: '6',\r\n      Digit7: '7',\r\n      Digit8: '8',\r\n      Digit9: '9',\r\n      Digit0: '',\r\n      Minus: '',\r\n      Equal: '0',\r\n      Numpad0: '0',\r\n      Numpad1: '1',\r\n      Numpad2: '2',\r\n      Numpad3: '3',\r\n      Numpad4: '4',\r\n      Numpad5: '5',\r\n      Numpad6: '6',\r\n      Numpad7: '7',\r\n      Numpad8: '8',\r\n      Numpad9: '9',\r\n      NumpadDivide: '',\r\n      NumpadMultiply: '',\r\n      NumpadDecimal: ' ',\r\n      NumpadEnter: '\\n',\r\n      Enter: '\\n',\r\n      Space: ' ',\r\n    }[evt.code];\r\n\r\n    if (char) {\r\n      evt.preventDefault();\r\n      this.setState({ text: this.state.text + char });\r\n    }\r\n  };\r\n\r\n  handleChange = ({ target: { value }}) => this.setState({ text: value });\r\n\r\n  render() {\r\n    return <div>\r\n      <h3>Use the numpad to enter pitch classes</h3>\r\n      <textarea\r\n        cols={24}\r\n        rows={20}\r\n        onChange={this.handleChange}\r\n        style={{\r\n          background: 'black',\r\n          color: 'darkgray',\r\n          fontSize: 20,\r\n        }}\r\n        value={this.state.text}\r\n      />\r\n    </div>\r\n  }\r\n}\r\n\r\nexport default NumpadMod12;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport globalHook from 'use-global-hook';\r\n\r\nconst initialState = {\r\n  input: undefined,\r\n  inputDevices: [],\r\n  isMidiClockInSelectorOpen: false,\r\n  isMidiInSelectorOpen: false,\r\n  midiClockInDevice: undefined,\r\n  midiInDevice: undefined,\r\n  midiIn: _.zipObject(\r\n    _.range(128),\r\n    _.fill(new Array(128), 0)),\r\n};\r\n\r\nconst actions = {\r\n  setInputDevices: (store, inputDevices) =>\r\n    store.setState({inputDevices}),\r\n\r\n  setMidiEvent: (store, midiEvt) =>\r\n    store.setState({midiIn: _.merge(store.state.midiIn, midiEvt)}),\r\n\r\n  setMidiClockInDevice: (store, midiClockInDevice) => store.setState({midiClockInDevice}),\r\n\r\n  setMidiInDevice: (store, midiInDevice) => store.setState({midiInDevice}),\r\n\r\n  toggleMidiInSelector: (store) =>\r\n    store.setState({isMidiInSelectorOpen: !store.state.isMidiInSelectorOpen}),\r\n\r\n  // todo: only 1 selector\r\n  toggleMidiClockInSelector: (store) =>\r\n    store.setState({isMidiClockInSelectorOpen: !store.state.isMidiClockInSelectorOpen}),\r\n\r\n\r\n};\r\n\r\nexport default globalHook(React, initialState, actions);\r\n","import useMidi from \"./useMidi\";\r\nimport {useEffect} from \"react\";\r\n\r\nconst useMidiClock = (onClock) => {\r\n  const [{midiClockInDevice}, actions] = useMidi( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({midiClockInDevice}) => ({midiClockInDevice}),\r\n    actions => actions,\r\n  );\r\n\r\n  let tick = 0;\r\n\r\n  useEffect(() => {\r\n\r\n    const handleMidiClock = (evt) => {\r\n      tick++;\r\n      if (onClock) onClock({ tick });\r\n    };\r\n\r\n    if (midiClockInDevice) {\r\n      midiClockInDevice.addListener('clock', 'all', handleMidiClock);\r\n    }\r\n\r\n    return () => {\r\n      if (midiClockInDevice) {\r\n        midiClockInDevice.removeListener('clock', 'all', handleMidiClock);\r\n      }\r\n    }\r\n  }, [midiClockInDevice]);\r\n\r\n  return {\r\n    midiClockInDevice,\r\n    reset: () => {\r\n      tick = 0;\r\n    },\r\n  };\r\n};\r\n\r\nexport default useMidiClock;\r\n","import P5 from 'p5';\r\nimport {useCallback, useState} from \"react\";\r\n\r\nexport default (sketch, initialState) => {\r\n  const [sketchState, setSketchState] = useState(initialState);\r\n  const [sketchInstance, setSketchInstance] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  if (sketchInstance) {\r\n    sketchInstance.setState = setSketchState;\r\n    sketchInstance.state = sketchState;\r\n  }\r\n\r\n  const ref = useCallback((el) => {\r\n    if (el) {\r\n      const instance = new P5(sketch, el);\r\n      setSketchInstance(instance);\r\n\r\n      instance._height = el.clientHeight;\r\n      instance._width = el.clientWidth;\r\n\r\n      const ro = new ResizeObserver(([{contentRect: {height, width}}]) => {\r\n        instance.resizeCanvas(width, height);\r\n        if (width + height > 0) setSketchState((prevState) => ({...prevState, isRegenNeeded: true}));\r\n      });\r\n\r\n      setResizeObserver(ro);\r\n      ro.observe(el);\r\n    } else {\r\n      if (resizeObserver) resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n    ref,\r\n  };\r\n};\r\n","export function HSVtoHex(h, s, v) {\r\n  function rgbToHex({ r, g, b }) {\r\n    function componentToHex(c) {\r\n      var hex = c.toString(16);\r\n      return hex.length == 1 ? \"0\" + hex : hex;\r\n    }\r\n\r\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\r\n  }\r\n\r\n  var r, g, b, i, f, p, q, t;\r\n  if (arguments.length === 1) {\r\n    s = h.s;\r\n    v = h.v;\r\n    h = h.h;\r\n  }\r\n  i = Math.floor(h * 6);\r\n  f = h * 6 - i;\r\n  p = v * (1 - s);\r\n  q = v * (1 - f * s);\r\n  t = v * (1 - (1 - f) * s);\r\n  switch (i % 6) {\r\n    case 0: {\r\n      r = v;\r\n      g = t;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 1: {\r\n      r = q;\r\n      g = v;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 2: {\r\n      r = p;\r\n      g = v;\r\n      b = t;\r\n      break;\r\n    }\r\n    case 3: {\r\n      r = p;\r\n      g = q;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 4: {\r\n      r = t;\r\n      g = p;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 5: {\r\n      r = v;\r\n      g = p;\r\n      b = q;\r\n      break;\r\n    }\r\n  }\r\n  return rgbToHex({\r\n    r: Math.round(r * 255),\r\n    g: Math.round(g * 255),\r\n    b: Math.round(b * 255)\r\n  });\r\n}","import _ from 'lodash';\r\n\r\n\r\n/* TODO\r\n* high prio\r\n  * fine-tune freq\r\n  * don't require redraw on freq change\r\n  * params bound to urlParams\r\n  * option to auto-choose fundamentalFreq\r\n    based on which partials are present\r\n    to center around 500 - 1000hz\r\n  * MIDI beat clock\r\n  * spiral of any length instead of hilbert\r\n\r\n* med prio\r\n  * for hilbertN of 256 or 512, use the vals to fill an audio buffer and play the ~1 or ~5s of audio\r\n  * utonal partials\r\n\r\n* low prio\r\n  * option to add a second cursor for stereo effects\r\n  * alternate space-filling curves\r\n  * keep cursor in same location when switching resolutions\r\n  * manual cursor\r\n* */\r\n\r\n// Only add setZeroTimeout to the window object, and hide everything\r\n// else in a closure.\r\n(function() {\r\n  var timeouts = [];\r\n  var messageName = \"zero-timeout-message\";\r\n\r\n  // Like setTimeout, but only takes a function argument.  There's\r\n  // no time argument (always zero) and no arguments (you have to\r\n  // use a closure).\r\n  function setZeroTimeout(fn) {\r\n    timeouts.push(fn);\r\n    window.postMessage(messageName, \"*\");\r\n  }\r\n\r\n  function handleMessage(event) {\r\n    if (event.source == window && event.data == messageName) {\r\n      event.stopPropagation();\r\n      if (timeouts.length > 0) {\r\n        var fn = timeouts.shift();\r\n        fn();\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"message\", handleMessage, true);\r\n\r\n  // Add the one thing we want added to the window object.\r\n  window.setZeroTimeout = setZeroTimeout;\r\n})();\r\n\r\n\r\nexport const initialState = {\r\n  decayDuration: 1000,\r\n  exciteEnergy: 0.05,\r\n  exciteDuration: 50,\r\n  fundamentalFreq: 200,\r\n  hilbertN: 64, // hilbertN must be power of 2 in order to be square\r\n  hilbMand: [/*{ x, y, m }*/], // coordinates and associated mandelbrot val in hilbert traversal order\r\n  isControlPanelOpen: true,\r\n  isPlaying: false,\r\n  isRegenNeeded: true,\r\n  maxIters: 4096, // max number of steps to recurse the mandelbrot fn\r\n  midiClock: 0,\r\n  midiClocksPerTick: 24,\r\n  panX: -0.05,\r\n  panY: 0,\r\n  partials: {/* partial: { amp, oscIdx } */}, // the collection is updated in setState but values within are changed in drawLoop directly\r\n  partialsCountMax: 16,\r\n  isSmooth: false, // smooth technique https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n  tick: 0, // updated in draw() bypasses setState\r\n  tickDuration: 100,\r\n  tickLastMillis: 0, // updated in draw() bypasses setState\r\n  zoom: 1.2,\r\n\r\n  // zoom: 3603.7157567397, panX: 0.18580280974577668, panY: 0.00036930706052212803,\r\n\r\n  // floating point errors here\r\n  // zoom: 279919582741326.66, panX: -0.014853203736137617, panY: 0.13451319076043783,\r\n\r\n  // panX: 0.0011548427778035686,\r\n  // panY: 0.025033026937542575,\r\n  // zoom: 319852972190.0951,\r\n  //\r\n  // panX: -0.18498767183730766,\r\n  // panY: 0.4722205531430409,\r\n  // zoom: 419013953.31772846,\r\n  //\r\n  //\r\n  // decay: 0.000075,\r\n  // exciteEnergy: 0.006,\r\n  // fundamentalFreq: 10,\r\n  // hilbertN: 256,\r\n  // maxIters: 4096,\r\n  // panX: 0.0011503007796323155,\r\n  // panY: 0.025033026938902938,\r\n  // tickDuration: 10,\r\n  // zoom: 836635.9887997985,\r\n  //\r\n  //\r\n  //\r\n  // panX: 0.08871194014553094,\r\n  // panY: -0.12829271146701177,\r\n  // zoom: 19736096.460687958,\r\n\r\n  // ...{zoom: 39422433.84662852, panX: 0.04670942760989286, panY: 0.13656218122372943},\r\n\r\n  // demo for 10 partials\r\n  // ...{zoom: 12371177.464729108, panX: 0.04671008941233588, panY: 0.13656133340058238},\r\n};\r\n\r\nlet audioCtx = new AudioContext();\r\nlet oscs = [];\r\n\r\nconst masterGain = audioCtx.createGain();\r\nwindow.masterGain = masterGain;\r\nmasterGain.gain.value = 1;\r\nmasterGain.connect(audioCtx.destination);\r\n\r\n\r\nexport const sketch = (p5) => {\r\n  p5.state = initialState;\r\n\r\n  /* Border size and color */\r\n  const CURSOR_STROKE_COLOR_SEPARATION = 20;\r\n  const CURSOR_ALPHA = 0.7;\r\n  const STROKE_WEIGHT_COEF = 1;\r\n  const STROKE_COLOR = 0;\r\n\r\n  const setupOscillators = () => {\r\n    oscs.forEach(({osc, gain}) =>\r\n    {\r\n      osc.stop();\r\n    }); // TODO: gain.disconnect? delete osc and gain?\r\n\r\n    oscs = _.range(p5.state.partialsCountMax).map(() => {\r\n      const osc = audioCtx.createOscillator();\r\n      const gain = audioCtx.createGain();\r\n      gain.gain.value = 0;\r\n      osc.connect(gain);\r\n      gain.connect(masterGain);\r\n      osc.start();\r\n      return {osc, gain};\r\n    });\r\n\r\n    window.oscs = oscs;\r\n  }\r\n\r\n  //rotate/flip a quadrant appropriately\r\n  const hilbGetRotatedVec = (n, v, rx, ry) => {\r\n    if (ry === 0) {\r\n      if (rx === 1) {\r\n        v.x = n - 1 - v.x;\r\n        v.y = n - 1 - v.y;\r\n      }\r\n\r\n      //Swap x and y\r\n      let temp = v.x;\r\n      v.x = v.y;\r\n      v.y = temp;\r\n    }\r\n  }\r\n\r\n  const hilbDistanceToCoords = (hilbertN, dist) => {\r\n    //    TODO: get distanceToVector based on percentage of maxD so that the Hilbert cursor stays in the same place when changing Hilbert resolutions\r\n    //    TODO: also click the screen to set the cursor so need amp function to convert x,y to hilbert distance\r\n\r\n    const v = {x: 0, y: 0};\r\n    // _(size)\r\n    //   .range()\r\n    //   .map(v => Math.pow(2, v))\r\n    //   .takeWhile(v => v < size)\r\n    //   .value()\r\n\r\n    for (let s = 1; s < hilbertN; s *= 2) {\r\n      let rx = 1 & (dist / 2);\r\n      let ry = 1 & (dist ^ rx);\r\n      hilbGetRotatedVec(s, v, rx, ry);\r\n      v.x += s * rx;\r\n      v.y += s * ry;\r\n      dist /= 4;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  /**\r\n   * Returns amp {@code Vec} representing the Euclidian coordinates of the given normalized \"Mandelbrot coordinates\"\r\n   * <br>Mandelbrot X scale: -2.5 to 1\r\n   * <br>Mandelbrot Y scale: -1 to 1\r\n   * @param x normalized x coordinate 0 to 1.0\r\n   * @param y normalized y coordinate 0 to 1.0\r\n   * @return\r\n   */\r\n  const mandGetDenormalizedCoords = (x, y) => ({\r\n    x: -2.5 + x * 3.5,\r\n    y: -1 + y * 2,\r\n  })\r\n\r\n\r\n  /**\r\n   * Returns the number of iterations to escape the Mandelbrot set at the given coordinates\r\n   * @param scaledX\r\n   * @param scaledY\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetVal = (scaledX, scaledY, maxIterations) => {\r\n    let x = 0, y = 0;\r\n    let iter = 0;\r\n\r\n    while (x * x + y * y < 4 && iter < maxIterations) {\r\n      let xTemp = x * x - y * y + scaledX;\r\n      y = 2 * x * y + scaledY;\r\n      x = xTemp;\r\n      iter++;\r\n    }\r\n    return iter;\r\n  }\r\n\r\n\r\n  const dot = (v1, v2) => _.reduce(v1, (acc, val, idx) => acc + val * v2[idx], 0);\r\n\r\n  /**\r\n   * https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n   * @param cx\r\n   * @param cy\r\n   * @param maxIterations\r\n   * @returns {*|number}\r\n   */\r\n  const mandGetValSmooth = (cx, cy, maxIterations) => {\r\n    const Bsq = 256 * 256;\r\n    const z = [0,0];\r\n    let n = 0;\r\n    let x, y;\r\n\r\n    for (let i = 0; i < maxIterations; i++) {\r\n      [x, y] = z;\r\n      z[0] = x * x - y * y + cx;\r\n      z[1] = 2 * x * y + cy;\r\n      if (dot(z, z) > Bsq) break;\r\n      n++;\r\n    }\r\n\r\n    // return n - Math.log(Math.log(Math.sqrt(z[0] * z[0] + z[1] * z[1]) / Math.log(B) / Math.log(2)))\r\n    return n >= maxIterations\r\n      ? maxIterations\r\n      : n - Math.log2(Math.log2(dot(z,z))) + 4;\r\n  }\r\n\r\n  /**\r\n   * Returns the number of iterations required to escape the Mandelbrot set at the given coordinates\r\n   * @param xN normalized x coordinate 0 to 1.0\r\n   * @param yN normalized y coordinate 0 to 1.0\r\n   * @param panX < 0 pans left. > 0 pans right\r\n   * @param panY < 0 pans up. > 0 pans down\r\n   * @param zoom 1.0 is unzoomed\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetValFromNormalizedCoords = (xN, yN, panX, panY, zoom, maxIterations) => {\r\n    let x1 = 0.5 - panX + (xN - 0.5) / zoom;\r\n    let y1 = 0.5 - panY + (yN - 0.5) / zoom;\r\n    const {x, y} = mandGetDenormalizedCoords(x1, y1);\r\n    return p5.state.isSmooth\r\n      ? mandGetValSmooth(x, y, maxIterations)\r\n      : mandGetVal(x, y, maxIterations);\r\n  }\r\n\r\n  const genHilbertCoords = _.memoize((hilbertN) =>\r\n    _.range(hilbertN * hilbertN)\r\n      .map(d => hilbDistanceToCoords(hilbertN, d)));\r\n\r\n\r\n  const genHilbertMandelbrot = () => {\r\n    const {\r\n      hilbertN,\r\n      maxIters,\r\n      panX,\r\n      panY,\r\n      partialsCountMax,\r\n      zoom,\r\n    } = p5.state;\r\n\r\n\r\n    return genHilbertCoords(hilbertN).map(({ x, y }) => {\r\n      const m = mandGetValFromNormalizedCoords(x / hilbertN, y / hilbertN, panX, panY, zoom, maxIters);\r\n      return {\r\n        x,\r\n        y,\r\n        m,\r\n        p: m === maxIters\r\n          ? 0 // to be filtered out\r\n          : Math.floor(((m - 1) % partialsCountMax) + 1),\r\n      };\r\n    })\r\n  };\r\n\r\n  const getStrokeWeight = (w) => {\r\n    const sideLength = w / p5.state.hilbertN;\r\n    return STROKE_WEIGHT_COEF * Math.min(10, sideLength / 20);\r\n  };\r\n\r\n  const getPartialOfOctaveStart = _.memoize((f) =>\r\n    _(100)\r\n      .range()\r\n      .map(n => Math.pow(2, n))\r\n      .dropWhile(n => f / n >= 2)\r\n      .first());\r\n\r\n  const getColorForMandelbrotVal = ({m, p}, isCursor = false) => {\r\n    const {\r\n      maxIters,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    const octMax = getPartialOfOctaveStart(partialsCountMax);\r\n    const oct = getPartialOfOctaveStart(p);\r\n\r\n    // good looks with smooth but not relevant to partials\r\n    // const h = (m * 10) % 255;\r\n    // const s = isCursor ? 0 : 255 - (m / maxIters) * 225  //(p / partialsCountMax) * 225;\r\n\r\n    const h = 255 * Math.log2(p / oct);\r\n    const s = isCursor ? 0 : 255 - Math.pow(oct / octMax, 2) * 225  //(p / partialsCountMax) * 225;\r\n    const b = isCursor\r\n      ? 255\r\n      : m === maxIters ? 0\r\n        : 30 + Math.pow(oct / octMax, 2) * 225;\r\n\r\n    return p5.color(h, s, b, isCursor ? CURSOR_ALPHA : 255);\r\n  };\r\n\r\n  const setFillColorForMandelbrotVal = (coordsWithVal, isCursor = false) => {\r\n    p5.fill(getColorForMandelbrotVal(coordsWithVal, isCursor));\r\n  }\r\n\r\n  const drawHilbertCoord = (w, h, hilbertCoord, hilbertN) => {\r\n    const scaleX = w / hilbertN;\r\n    const scaleY = h / hilbertN;\r\n    p5.rect(hilbertCoord.x * scaleX, hilbertCoord.y * scaleY, scaleX, scaleY);\r\n    // p5.circle(hilbertCoord.x * scaleX + scaleX / 2, hilbertCoord.y * scaleY + scaleY / 2, scaleX);\r\n  }\r\n\r\n  const drawHilbertMandelbrot = (w, h, state) => {\r\n    const {\r\n      hilbertN,\r\n      hilbMand,\r\n    } = state;\r\n\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n    p5.strokeWeight(strokeWeight);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    const s = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n\r\n    hilbMand.forEach((coordWithVal, d) => {\r\n      setFillColorForMandelbrotVal(coordWithVal);\r\n\r\n      p5.push();\r\n      {\r\n        p5.translate(p5.width / 4, 0);\r\n        drawHilbertCoord(w, h, coordWithVal, hilbertN);\r\n      }\r\n      p5.pop();\r\n\r\n      p5.push(); // TODO: is it more expensive to push/pop 1000 times or iterate over hilbMand twice?\r\n      {\r\n        p5.translate((p5.width / 4) * 3, 0);\r\n        drawLinearizedMandelbrotCoord(p5.width / 4, s, d);\r\n      }\r\n      p5.pop();\r\n    })\r\n  };\r\n\r\n  const getSideLengthForLinearizedMap = (dMax, w, h) => {\r\n    const maxA = w * h;\r\n    const largestPossibleSide = Math.sqrt(maxA / dMax);\r\n\r\n    let s = 0;\r\n    for (let i = 1; i < w; i++) {\r\n      s = w / i;\r\n      if (s > largestPossibleSide) {\r\n        continue;\r\n      }\r\n\r\n      const sqPerRow = w / s;\r\n      const rows = dMax / sqPerRow;\r\n      const leftover = dMax % sqPerRow;\r\n\r\n      if (rows * s + (leftover > 0 ? s : 0) <= h) {\r\n        break;\r\n      }\r\n    }\r\n    return s;\r\n  }\r\n\r\n  const drawLinearizedMandelbrotCoord = (w, s, d) => {\r\n    const valsPerRow = w / s;\r\n\r\n    let x = d % valsPerRow;\r\n    const y = Math.floor(d / valsPerRow);\r\n\r\n    // snake around instead of starting from the left for each row\r\n    if (y % 2 === 1) {\r\n      x = valsPerRow - (x + 1);\r\n    }\r\n\r\n    p5.rect(x * s, y * s, s, s);\r\n  }\r\n\r\n  const genAndDrawHilbertMandelbrot = () => {\r\n    p5.background(32);\r\n\r\n    // fade out. this can probably move to partials _.each\r\n    oscs.forEach(({gain}) => {\r\n      gain.gain.cancelScheduledValues(audioCtx.currentTime);\r\n      gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);\r\n    })\r\n\r\n    const {\r\n      fundamentalFreq,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    if (oscs.length !== partialsCountMax) {\r\n      setupOscillators(); // TODO: fade out first\r\n    }\r\n\r\n    const hilbMand = genHilbertMandelbrot();\r\n\r\n    const partials = _(hilbMand)\r\n      .map(({p}) => p)\r\n      .filter(_.identity) // maxIters (black) are set as p: 0\r\n      .uniq()\r\n      .sort()\r\n      .take(partialsCountMax)\r\n      .map((partial, i) => [partial, {amp: 0, oscIdx: i}])\r\n      .fromPairs()\r\n      .value();\r\n\r\n    // slide to new freqs if partials change\r\n    _.each(partials, ({decayTimerId, oscIdx, zeroGainTimerId}, partial) => {\r\n      clearTimeout(decayTimerId);\r\n      clearTimeout(zeroGainTimerId);\r\n      oscs[oscIdx].osc.frequency.cancelScheduledValues(audioCtx.currentTime);\r\n      oscs[oscIdx].osc.frequency.linearRampToValueAtTime(partial * fundamentalFreq, audioCtx.currentTime + 1);\r\n    });\r\n\r\n    p5.setState(prevState => {\r\n      const nextState = {\r\n        ...prevState,\r\n        hilbMand,\r\n        isRegenNeeded: false,\r\n        partials,\r\n      };\r\n      drawHilbertMandelbrot( p5.width / 2, p5.height, nextState);\r\n      return nextState;\r\n    });\r\n  }\r\n\r\n\r\n  const cursorErasePrev = (maxD, s, prevD) => {\r\n    const {hilbMand} = p5.state;\r\n    const prevCoordAndVal = hilbMand[prevD % maxD];\r\n\r\n    setFillColorForMandelbrotVal(prevCoordAndVal);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, prevCoordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, s, prevD);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  let prevD = 0;\r\n  const cursorDraw = (id) => {\r\n    const {hilbMand} = p5.state;\r\n    const d = p5.state.tick % hilbMand.length;\r\n    const coordAndVal = hilbMand[d];\r\n    const sideLength = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n\r\n    p5.strokeWeight(strokeWeight);\r\n    cursorErasePrev(hilbMand.length, sideLength, prevD);\r\n    prevD = d; // maybe multiple ticks per frame when external time sync\r\n    p5.stroke((CURSOR_STROKE_COLOR_SEPARATION * id) % 255, 0, 255);\r\n    setFillColorForMandelbrotVal(coordAndVal, true);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, coordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, sideLength, d);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  const cursorExcite = (id) => {\r\n    const {\r\n      decayDuration,\r\n      exciteEnergy,\r\n      exciteDuration,\r\n      hilbMand,\r\n      partials,\r\n      tick,\r\n    } = p5.state;\r\n\r\n    const d = tick % hilbMand.length;\r\n    const {p} = hilbMand[d];\r\n\r\n    if (p > 0) {\r\n      const partial = partials[p];\r\n      const {\r\n        amp,\r\n        decayTimerId,\r\n        oscIdx,\r\n        zeroGainTimerId,\r\n      } = partial;\r\n      const {gain} = oscs[oscIdx];\r\n\r\n      const isExcited = _.isNumber(decayTimerId);\r\n      const currGain = isExcited ? amp : gain.gain.value;\r\n\r\n      // console.log(p, currGain);\r\n\r\n      const targetGain = 0.8 * Math.min(1, currGain + exciteEnergy * (1 - currGain));\r\n      partial.amp = targetGain;\r\n\r\n      clearTimeout(decayTimerId); // further delay the decay\r\n      clearTimeout(zeroGainTimerId); // don't reset amp to zero\r\n      gain.gain.cancelScheduledValues(0);\r\n      gain.gain.linearRampToValueAtTime(targetGain, audioCtx.currentTime + exciteDuration / 1000);\r\n\r\n      partial.decayTimerId = setTimeout(() => {\r\n        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + decayDuration / 1000);\r\n        partial.decayTimerId = null;\r\n\r\n        partial.zeroGainTimerId = setTimeout(() => {\r\n          partial.amp = 0;\r\n        }, decayDuration)\r\n      }, exciteDuration);\r\n    }\r\n  }\r\n\r\n  const partialsDraw = () => {\r\n    const h = p5.height;\r\n    const w = p5.width / 4;\r\n\r\n    p5.noStroke();\r\n\r\n    const { partials, partialsCountMax } = p5.state;\r\n\r\n    _.each(partials, ({ amp: targetAmp, oscIdx }, p) => {\r\n      const barH = h / partialsCountMax;\r\n      const y = h * ((p - 1) / partialsCountMax);\r\n      const barW = oscs[oscIdx].gain.gain.value * w;\r\n\r\n      const c = getColorForMandelbrotVal({ m: 1, p})\r\n      p5.fill(p5.color(p5.hue(c), 255, 8));\r\n      p5.rect(0, y, w, barH);\r\n\r\n      p5.fill(c);\r\n      p5.rect(0, y, barW, barH);\r\n      p5.fill(255);\r\n      p5.rect(targetAmp * w, y, 1, barH);\r\n    })\r\n\r\n  }\r\n\r\n  let wasPaused = true;\r\n  const pauseScreenDraw = () => {\r\n    if (!p5.state.isPlaying && !p5.state.isControlPanelOpen) {\r\n      wasPaused = true;\r\n      p5.background(0, 0.1);\r\n      p5.noFill();\r\n      p5.stroke(192, 127, 90);\r\n      p5.textSize(10);\r\n      p5.text('arrow keys to move', 0, p5.height / 2 - 50, p5.width, p5.height);\r\n      p5.text('shift+arrow for zoom/resolution', 0, p5.height / 2 - 35, p5.width, p5.height);\r\n      p5.text('shift+spacebar toggle controls', 0, p5.height / 2 - 20, p5.width, p5.height);\r\n      p5.textSize(20);\r\n      p5.textAlign(p5.CENTER);\r\n      p5.text('spacebar to start', 0, p5.height / 2, p5.width, p5.height);\r\n    } else {\r\n      if (wasPaused) {\r\n        partialsDraw();\r\n        drawHilbertMandelbrot(p5.width / 2, p5.height, p5.state);\r\n        wasPaused = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  let font;\r\n  p5.preload = () => {\r\n    font = p5.loadFont('JetBrainsMono-Regular.ttf');\r\n  }\r\n\r\n  p5.setup = () => {\r\n    p5.createCanvas(p5._width, p5._height);\r\n    p5.colorMode(p5.HSB);\r\n    p5.textFont(font);\r\n    p5.incrementTick();\r\n  }\r\n\r\n  p5.incrementTick = (isExternal = false) => {\r\n    const now = p5.millis();\r\n    const {\r\n      isPlaying,\r\n      isRegenNeeded,\r\n      midiClocksPerTick,\r\n      tickDuration,\r\n      tickLastMillis,\r\n    } = p5.state;\r\n\r\n    if (isExternal) {\r\n      p5.state.midiClock++;\r\n    }\r\n\r\n    const isReady = isPlaying && !isRegenNeeded && (isExternal\r\n      ? p5.state.midiClock % midiClocksPerTick === 0\r\n      : now > tickLastMillis + tickDuration);\r\n\r\n    if (isReady) {\r\n      p5.state.tick++;\r\n      p5.state.tickLastMillis = now;\r\n      cursorExcite(0);\r\n    }\r\n\r\n    if (!isExternal) window.setZeroTimeout(p5.incrementTick)\r\n  }\r\n\r\n  let prevTick = 0;\r\n  p5.draw = () => {\r\n    const {\r\n      isPlaying,\r\n      isRegenNeeded,\r\n      midiClock,\r\n    } = p5.state;\r\n\r\n    if (isRegenNeeded) {\r\n      genAndDrawHilbertMandelbrot();\r\n    }\r\n\r\n    // if (midiClock === 0) p5.incrementTick();\r\n\r\n    if (_.every([\r\n      !isRegenNeeded,\r\n      p5.state.tick !== prevTick,\r\n    ])) {\r\n      cursorDraw(0);\r\n      prevTick = p5.state.tick;\r\n    }\r\n\r\n    if (isPlaying) partialsDraw();\r\n\r\n    pauseScreenDraw();\r\n  }\r\n\r\n  /**\r\n   * This needs to be called by a user event handler.\r\n   * @param isPlaying\r\n   */\r\n  p5.toggleAudio = () => {\r\n    p5.setState(prevState => {\r\n      const { isPlaying } = prevState;\r\n      if (!isPlaying && audioCtx.state !== 'running') {\r\n        audioCtx.resume();\r\n      }\r\n\r\n      if (isPlaying && audioCtx.state === 'running') {\r\n        audioCtx.suspend();\r\n      }\r\n\r\n      return { ...prevState, isPlaying: !prevState.isPlaying };\r\n    });\r\n\r\n  }\r\n}\r\n","import CircularSlider from '@fseehawer/react-circular-slider';\r\nimport KeyboardArrowDownOutlinedIcon from '@material-ui/icons/KeyboardArrowDownOutlined';\r\nimport KeyboardArrowLeftOutlinedIcon from '@material-ui/icons/KeyboardArrowLeftOutlined';\r\nimport KeyboardArrowRightOutlinedIcon from '@material-ui/icons/KeyboardArrowRightOutlined';\r\nimport KeyboardArrowUpOutlinedIcon from '@material-ui/icons/KeyboardArrowUpOutlined';\r\nimport PauseCircleOutlineIcon from '@material-ui/icons/PauseCircleOutline';\r\nimport PlayCircleOutlineIcon from '@material-ui/icons/PlayCircleOutline';\r\nimport React, {useEffect, useState} from 'react';\r\nimport TuneIcon from '@material-ui/icons/Tune';\r\nimport ViewComfyOutlinedIcon from '@material-ui/icons/ViewComfyOutlined';\r\nimport ViewModuleOutlinedIcon from '@material-ui/icons/ViewModuleOutlined';\r\nimport ZoomInOutlinedIcon from '@material-ui/icons/ZoomInOutlined';\r\nimport ZoomOutOutlinedIcon from '@material-ui/icons/ZoomOutOutlined';\r\nimport _ from 'lodash';\r\nimport useMidiClock from \"./useMidiClock\";\r\nimport useP5 from './useP5';\r\nimport { HSVtoHex } from './color';\r\nimport { initialState, sketch } from \"./mandelbrotP5\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport {Button, ButtonGroup, Drawer} from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles({\r\n  paper: {\r\n    background: \"rgba(0,0,0,0.7)\",\r\n    paddingBottom: 65,\r\n  }\r\n});\r\n\r\nconst getHandleAction = (sketchInstance) => (action) => () => {\r\n  if (action === 'toggleAudio') {\r\n    sketchInstance.toggleAudio();\r\n    return;\r\n  }\r\n\r\n  sketchInstance.setState(prevState => {\r\n    const {\r\n      hilbertN,\r\n      isControlPanelOpen,\r\n      isRegenNeeded,\r\n      panX,\r\n      panY,\r\n      zoom,\r\n    } = prevState;\r\n    const panDelta = 0.1 / zoom;\r\n\r\n    const nextState = {\r\n      moveLeft: {panX: panX + panDelta},\r\n      moveRight: {panX: panX - panDelta},\r\n      moveUp: {panY: panY + panDelta},\r\n      moveDown: {panY: panY - panDelta},\r\n      resDec: {hilbertN: Math.pow(2, Math.log2(hilbertN) - 1)},\r\n      resInc: {hilbertN: Math.min(256, Math.pow(2, Math.log2(hilbertN) + 1))},\r\n      toggleControlPanel: {isControlPanelOpen: !isControlPanelOpen, isRegenNeeded},\r\n      zoomIn: {zoom: zoom * (10 / 9)},\r\n      zoomOut: {zoom: zoom * (9 / 10)},\r\n    }[action];\r\n\r\n    return {\r\n      ...prevState,\r\n      isRegenNeeded: !_.isEmpty(nextState),\r\n      ...nextState,\r\n    };\r\n  })\r\n};\r\n\r\nconst handleKeyDown = (handleAction) => (evt) => {\r\n  // console.log(evt);\r\n  const {code, shiftKey, key} = evt;\r\n\r\n  if (code === 'Space') {\r\n    handleAction(shiftKey ? 'toggleControlPanel' : 'toggleAudio')();\r\n    return;\r\n  }\r\n\r\n  const getAction = {\r\n    'ArrowDown': () => shiftKey ? 'zoomOut' : 'moveDown',\r\n    'ArrowLeft': () => shiftKey ? 'resDec' : 'moveLeft',\r\n    'ArrowRight': () => shiftKey ? 'resInc' : 'moveRight',\r\n    'ArrowUp': () => shiftKey ? 'zoomIn' : 'moveUp',\r\n  }[key];\r\n\r\n  if (getAction) handleAction(getAction())();\r\n};\r\n\r\nconst Mandelbrot = () => {\r\n  const {\r\n    ref,\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n  } = useP5(sketch, initialState);\r\n\r\n  window.sketchInstance = sketchInstance;\r\n\r\n  const handleAction = getHandleAction(sketchInstance);\r\n\r\n  useEffect(() => {\r\n    document.title = 'Mandelbrot Muse';\r\n    if (sketchInstance) {\r\n      const handler = handleKeyDown(handleAction);\r\n      window.addEventListener('keydown', handler)\r\n      return () => { // cleanup\r\n        window.removeEventListener('keydown', handler);\r\n      };\r\n    }\r\n  }, [sketchInstance]);\r\n\r\n  const {midiClockInDevice} = useMidiClock(() => {\r\n    if (sketchInstance) {\r\n      sketchInstance.incrementTick(true);\r\n    }\r\n  });\r\n\r\n  return (<>\r\n    <div\r\n      ref={ref}\r\n      style={{\r\n        alignSelf: 'start',\r\n        background: 'radial-gradient(circle, rgba(74,153,117,1) 0%, rgba(188,148,233,0.6943726953672094) 100%)',\r\n        height: '50vw',\r\n        width: '100vw',\r\n      }}\r\n    />\r\n\r\n    <div style={{\r\n      bottom: 10,\r\n      right: 10,\r\n      padding: 0,\r\n      position: 'absolute',\r\n      textAlign: 'center',\r\n      zIndex: 1000000,\r\n    }}>\r\n      {!sketchState.isControlPanelOpen && (\r\n        <Button onClick={handleAction('toggleControlPanel')}>\r\n          show\r\n          <TuneIcon/>\r\n          controls\r\n        </Button>\r\n      )}\r\n\r\n      <Drawer\r\n        anchor=\"bottom\"\r\n        classes={useStyles()}\r\n        color=\"transparent\"\r\n        open={sketchState.isControlPanelOpen}\r\n        onClose={handleAction('toggleControlPanel')}\r\n        variant=\"persistent\"\r\n\r\n        // onMouseEnter={ev => { ev.currentTarget.style.opacity = 1 }}\r\n        // onMouseLeave={ev => { ev.currentTarget.style.opacity = 0.5 }}\r\n      >\r\n        <ButtonGroup fullWidth size=\"large\">\r\n          <Button onClick={handleAction('toggleAudio')}>\r\n            {!sketchState.isPlaying ? <PlayCircleOutlineIcon /> : <PauseCircleOutlineIcon />}\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('toggleControlPanel')}>\r\n            hide controls\r\n          </Button>\r\n        </ButtonGroup>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n\r\n          <Button onClick={handleAction('resDec')}>\r\n            <ViewModuleOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveUp')}>\r\n            <KeyboardArrowUpOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('resInc')}>\r\n            <ViewComfyOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('zoomIn')}>\r\n            <ZoomInOutlinedIcon/>\r\n          </Button>\r\n\r\n        </ButtonGroup>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n\r\n          <Button onClick={handleAction('moveLeft')}>\r\n            <KeyboardArrowLeftOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveDown')}>\r\n            <KeyboardArrowDownOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveRight')}>\r\n            <KeyboardArrowRightOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('zoomOut')}>\r\n            <ZoomOutOutlinedIcon/>\r\n          </Button>\r\n\r\n        </ButtonGroup>\r\n\r\n        <br/>\r\n\r\n        <FreqSlider\r\n          initialVal={60}\r\n          isRegenRequired\r\n          label=\"Fundamental frequency (Hz)\"\r\n          stateKey={\"fundamentalFreq\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n\r\n\r\n        <div style={{\r\n          display: 'flex',\r\n          flexWrap: 'wrap',\r\n          justifyContent: 'space-around',\r\n        }}>\r\n\r\n          <FreqSlider\r\n            initialVal={16}\r\n            isInt\r\n            isRegenRequired\r\n            label=\"Number of partials\"\r\n            max={1024}\r\n            min={1}\r\n            precision={1}\r\n            setSketchState={setSketchState}\r\n            size={120}\r\n            sketchState={sketchState}\r\n            stateKey={\"partialsCountMax\"}\r\n          />\r\n\r\n          <FreqSlider\r\n            initialVal={4096}\r\n            isInt\r\n            isRegenRequired\r\n            label=\"Mandelbrot iterations\"\r\n            max={8192}\r\n            min={64}\r\n            setSketchState={setSketchState}\r\n            size={120}\r\n            sketchState={sketchState}\r\n            stateKey={\"maxIters\"}\r\n          />\r\n\r\n          {midiClockInDevice ? (\r\n            <FreqSlider // TODO: integers\r\n              min={1}\r\n              max={1024}\r\n              initialVal={24}\r\n              label=\"MIDI clocks per tick\"\r\n              size={120}\r\n              stateKey={\"midiClocksPerTick\"}\r\n              sketchState={sketchState}\r\n              setSketchState={setSketchState}\r\n            />\r\n          ) : (\r\n            <FreqSlider\r\n              initialVal={100}\r\n              label=\"Tick duration (ms)\"\r\n              size={120}\r\n              stateKey={\"tickDuration\"}\r\n              sketchState={sketchState}\r\n              setSketchState={setSketchState}\r\n            />\r\n          )}\r\n\r\n          <FreqSlider\r\n            initialVal={50}\r\n            label=\"Excite duration (ms)\"\r\n            size={120}\r\n            stateKey={\"exciteDuration\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n          <FreqSlider\r\n            initialVal={1000}\r\n            label=\"Decay duration (ms)\"\r\n            size={120}\r\n            stateKey={\"decayDuration\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n\r\n          <FreqSlider\r\n            initialVal={0.05}\r\n            label=\"Excite energy\"\r\n            precision={4}\r\n            size={120}\r\n            stateKey={\"exciteEnergy\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n        </div>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n          <Button onClick={handleAction('toggleAudio')}>\r\n            {!sketchState.isPlaying ? <PlayCircleOutlineIcon /> : <PauseCircleOutlineIcon />}\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('toggleControlPanel')}>\r\n            hide controls\r\n          </Button>\r\n        </ButtonGroup>\r\n      </Drawer>\r\n\r\n\r\n    </div>\r\n   </>);\r\n};\r\n\r\nconst Slider = ({ sketchState, setSketchState, stateKey, ...props }) => (\r\n    <div>\r\n      {stateKey}: {sketchState[stateKey]}\r\n      <br />\r\n      <input\r\n        type=\"range\"\r\n        style={{width: 400}}\r\n        value={sketchState[stateKey]}\r\n        onChange={ev => {\r\n          const value = Number(ev.target.value);\r\n          setSketchState(state => ({\r\n            ...state,\r\n            [stateKey]: value\r\n          }))\r\n        }}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n\r\n\r\nconst FreqSlider = ({\r\n  initialVal = 1,\r\n  isInt = false,\r\n  isRegenRequired = false,\r\n  label = '',\r\n  max = Number.MAX_VALUE,\r\n  min = Number.MIN_VALUE,\r\n  precision = 6,\r\n  setSketchState,\r\n  size = 240,\r\n  sketchState,\r\n  stateKey,\r\n}) => {\r\n  const degPerExp = 2048;\r\n  const errMargin = degPerExp / 3;\r\n\r\n  const constrainVal = val => {\r\n    const v = Math.min(Math.max(val, min), max);\r\n    return isInt ? Math.round(v) : v;\r\n  }\r\n\r\n  const valToState = val => {\r\n    const freq = constrainVal(val);\r\n    const logFreq = Math.log2(freq);\r\n    const exp = Math.floor(logFreq);\r\n\r\n    return {\r\n      deg: Math.floor(degPerExp * (logFreq - exp)),\r\n      exp,\r\n      numberInputVal: freq,\r\n    };\r\n  }\r\n\r\n  const [state, setState] = useState(() => valToState(initialVal));\r\n\r\n  useEffect(() => {  // hack because react-circle-slider invokes the onChange callback when its knob position changes even via props\r\n    _.defer(() => setState(valToState(initialVal)));\r\n  }, []);\r\n\r\n  const handleChange = v => {\r\n    const {deg, exp} = state;\r\n    const didCrossUp = v >= 0 && v < errMargin && deg > degPerExp - errMargin;\r\n    const didCrossDn = deg >= 0 && deg < errMargin && v > degPerExp - errMargin;\r\n    const nextExp = didCrossUp\r\n      ? exp + 1\r\n      : didCrossDn\r\n        ? exp - 1\r\n        : exp;\r\n\r\n    const freq = constrainVal(Math.pow(2, nextExp + v / degPerExp));\r\n    const nextState = {\r\n      deg: v,\r\n      exp: nextExp,\r\n      numberInputVal: freq\r\n    };\r\n    setState(nextState);\r\n    setSketchState(state => ({\r\n      ...state,\r\n      [stateKey]: freq,\r\n    }));\r\n  }\r\n\r\n  return (\r\n    <div style={{\r\n      flex: `0 ${size + 40}px`,\r\n      height: size + 40,\r\n      marginBottom: 40,\r\n    }}>\r\n      <div style={{\r\n        height: '3em',\r\n      }}>\r\n      {label || `${stateKey}: ${sketchState[stateKey]}`}\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          paddingTop: 10,\r\n          position: 'relative',\r\n        }}\r\n        onPointerUp={() => {\r\n          sketchState.isRegenNeeded = isRegenRequired // TODO: isFreqChanged instead of full regen\r\n        }}\r\n      >\r\n        <CircularSlider\r\n          dataIndex={state.deg}\r\n          min={0}\r\n          max={degPerExp - 1}\r\n          knobColor=\"#AAA\"\r\n          knobSize={60}\r\n          label=\"Fundamental Frequency\"\r\n          renderLabelValue={\r\n            <input\r\n              type=\"number\"\r\n              style={{\r\n                background: 'none',\r\n                border: 'none',\r\n                color: 'white',\r\n                fontSize: `${size / 100}em`,\r\n                left: '50%',\r\n                marginLeft: '-40%',\r\n                marginTop: '-0.5em',\r\n                position: 'absolute',\r\n                textAlign: 'center',\r\n                top: '50%',\r\n                width: '80%',\r\n                zIndex: 3,\r\n              }}\r\n              value={isInt ? state.numberInputVal : state.numberInputVal.toPrecision(precision)}\r\n              onChange={ev => {\r\n                setState({\r\n                  ...state,\r\n                  numberInputVal: Number(ev.target.value),\r\n                });\r\n              }}\r\n              onKeyDown={({ key }) => {\r\n                if (key === 'Enter') {\r\n                  const nextState = valToState(state.numberInputVal);\r\n                  setState(nextState);\r\n                  _.defer(() => { // hack because react-circle-slider invokes the onChange callback when its knob position changes even via props\r\n                    setState(nextState);\r\n\r\n                    setSketchState(state => ({\r\n                      ...state,\r\n                      [stateKey]: nextState.numberInputVal,\r\n                      isRegenNeeded: isRegenRequired,\r\n                    }));\r\n                  })\r\n\r\n                }\r\n              }}\r\n            />\r\n          }\r\n          onChange={handleChange}\r\n          progressColorFrom={HSVtoHex(state.exp / 15, 1, 1)}\r\n          progressColorTo={HSVtoHex((state.exp + 1) / 15, 1, 1)}\r\n          progressLineCap=\"flat\"\r\n          trackColor=\"#666\"\r\n          height={size}\r\n          width={size}\r\n        />\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\nexport default Mandelbrot;\r\n","import FrettedInstrument from './frettedInstrument';\r\nimport React from 'react';\r\n\r\nconst Mandolin = () => (\r\n  <FrettedInstrument\r\n    fretCount={20}\r\n    fretMarkers={[0, 3, 5, 7, 10, 12, 15]}\r\n    tuning={[7, 2, 9, 4]}\r\n  />\r\n);\r\n\r\nexport default Mandolin;\r\n","import React from 'react';\r\nimport globalHook from 'use-global-hook';\r\n\r\nconst initialState = {\r\n  mediaStream: undefined,\r\n};\r\n\r\nconst actions = {\r\n  setMediaStream: (store, mediaStream) =>\r\n    store.setState({mediaStream}),\r\n};\r\n\r\nexport default globalHook(React, initialState, actions);\r\n","import React from 'react';\r\nimport useMic from './useMic';\r\nimport {IconButton} from \"@material-ui/core\";\r\nimport {MicOffOutlined, Mic as MicIcon} from '@material-ui/icons';\r\n\r\nconst Mic = () => {\r\n\r\n  const [state, actions] = useMic( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({mediaStream}) => ({mediaStream}),\r\n    actions => actions,\r\n  );\r\n\r\n  const handleMicOnClick = () => {\r\n    navigator.mediaDevices.getUserMedia({\r\n      audio: true,\r\n      video: false\r\n    }).then(mediaStream => {\r\n      actions.setMediaStream(mediaStream)\r\n    });\r\n  }\r\n\r\n  const handleMicOffClick = () => {\r\n    state.mediaStream.getTracks().forEach(tr => tr.stop());\r\n    actions.setMediaStream(undefined);\r\n  }\r\n\r\n  const isMicOn = !!state.mediaStream;\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        // aria-label=\"open drawer\"\r\n        onClick={isMicOn ? handleMicOffClick : handleMicOnClick}\r\n      >\r\n        {isMicOn ? <MicOffOutlined/> : <MicIcon/>}\r\n      </IconButton>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Mic;\r\n","import _ from 'lodash';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport React, {useEffect} from 'react';\r\nimport useMidi from './useMidi';\r\nimport WebMidi from 'webmidi';\r\nimport {IconButton, Toolbar} from \"@material-ui/core\";\r\nimport {WatchLater as MidiClockIcon} from '@material-ui/icons';\r\n\r\nconst Midi = () => {\r\n\r\n  const [state, actions] = useMidi( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({\r\n      inputDevices,\r\n      isMidiClockInSelectorOpen,\r\n      isMidiInSelectorOpen,\r\n      midiInDevice,\r\n    }) => ({inputDevices, isMidiClockInSelectorOpen, isMidiInSelectorOpen, midiInDevice}),\r\n    actions => actions,\r\n  );\r\n\r\n  const {\r\n    inputDevices,\r\n    isMidiClockInSelectorOpen,\r\n    isMidiInSelectorOpen,\r\n    midiInDevice,\r\n  } = state;\r\n\r\n  useEffect(() => {\r\n    WebMidi.enable((err) => {\r\n      if (err) console.error(err);\r\n      else {\r\n        console.log('WebMidi enabled.');\r\n        actions.setInputDevices(WebMidi.inputs);\r\n      }\r\n    }, true);\r\n  }, []);\r\n\r\n\r\n  const handleMidi = (evt) => {\r\n    const {note: {number: n}, rawVelocity: vel, type} = evt;\r\n    // console.log(evt)\r\n    // actions.setMidiEvent({\r\n    //   [n]: type === 'noteon' ? vel : 0\r\n    // });\r\n  }\r\n\r\n  const handleMidiClock = (evt) => {\r\n\r\n    // console.log(evt)\r\n    // actions.setMidiEvent({\r\n    //   [n]: type === 'noteon' ? vel : 0\r\n    // });\r\n  }\r\n\r\n\r\n  const [midiMenuAnchorEl, setMidiMenuAnchorEl] = React.useState(null);\r\n\r\n  const handleMidiMenuButtonClick = (isBeatClock = false) => ({ currentTarget }) => {\r\n    setMidiMenuAnchorEl(currentTarget);\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n  }\r\n\r\n  const handleMidiMenuClose = (isBeatClock = false) => () => {\r\n    console.log('close', isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector')\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n    setMidiMenuAnchorEl(null);\r\n  }\r\n\r\n  const handleMidiInputSelect = (deviceIdx, isBeatClock = false) => ({ currentTarget }) => { // todo: remove prev listener\r\n    setMidiMenuAnchorEl(currentTarget);\r\n\r\n    const midiInDevice = inputDevices[deviceIdx];\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n    if (isBeatClock) {\r\n      midiInDevice.addListener('clock', 'all', handleMidiClock);\r\n      actions.setMidiClockInDevice(midiInDevice);\r\n    } else {\r\n      actions.setMidiInDevice(midiInDevice);\r\n      midiInDevice.addListener('noteon', 'all', handleMidi);\r\n      midiInDevice.addListener('noteoff', 'all', handleMidi);\r\n    }\r\n\r\n  };\r\n\r\n  return ( // TODO: only show if MIDI devices present; use looser permission to query\r\n    <>\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        aria-label=\"open drawer\"\r\n        onClick={handleMidiMenuButtonClick(false)}\r\n      >\r\n        <img src=\"noun_MIDI_385872.svg\" style={{ width: '1.5em', height: '1.5em'}} />\r\n      </IconButton>\r\n\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        aria-label=\"open drawer\"\r\n        onClick={handleMidiMenuButtonClick(true)}\r\n      >\r\n        <MidiClockIcon/>\r\n      </IconButton>\r\n\r\n      <Menu\r\n        id=\"simple-menu\"\r\n        anchorEl={midiMenuAnchorEl}\r\n        open={isMidiInSelectorOpen || isMidiClockInSelectorOpen}\r\n        onClose={handleMidiMenuClose(isMidiClockInSelectorOpen)}\r\n      >\r\n        {inputDevices.map(({name}, idx) => (\r\n          <MenuItem\r\n            key={name}\r\n            onClick={handleMidiInputSelect(idx, isMidiClockInSelectorOpen)}\r\n            selected={isMidiInSelectorOpen && name === _.get(midiInDevice, 'name')}\r\n          >\r\n            {name}\r\n          </MenuItem>\r\n        ))}\r\n      </Menu>\r\n    </>\r\n\r\n  );\r\n};\r\n\r\nexport default Midi;\r\n","import _ from 'lodash';\r\n\r\n\r\n\r\nexport const initialState = {\r\n  decayDuration: 5000,\r\n  exciteEnergy: 0.05,\r\n  exciteDuration: 1000,\r\n  fundamentalFreq: 200,\r\n  hilbertN: 64, // hilbertN must be power of 2 in order to be square\r\n  hilbMand: [/*{ x, y, m }*/], // coordinates and associated mandelbrot val in hilbert traversal order\r\n  isControlPanelOpen: true,\r\n  isPlaying: false,\r\n  isRegenNeeded: true,\r\n  maxIters: 4096, // max number of steps to recurse the mandelbrot fn\r\n  midiClock: 0,\r\n  midiClocksPerTick: 24,\r\n  panX: -0.05,\r\n  panY: 0,\r\n  partials: {/* partial: { amp, oscIdx } */}, // the collection is updated in setState but values within are changed in drawLoop directly\r\n  partialsCountMax: 16,\r\n  isSmooth: false, // smooth technique https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n  tick: 0, // updated in draw() bypasses setState\r\n  tickDuration: 100,\r\n  tickLastMillis: 0, // updated in draw() bypasses setState\r\n  zoom: 1.2,\r\n\r\n  // zoom: 3603.7157567397, panX: 0.18580280974577668, panY: 0.00036930706052212803,\r\n\r\n  // floating point errors here\r\n  // zoom: 279919582741326.66, panX: -0.014853203736137617, panY: 0.13451319076043783,\r\n\r\n  // panX: 0.0011548427778035686,\r\n  // panY: 0.025033026937542575,\r\n  // zoom: 319852972190.0951,\r\n  //\r\n  // panX: -0.18498767183730766,\r\n  // panY: 0.4722205531430409,\r\n  // zoom: 419013953.31772846,\r\n  //\r\n  //\r\n  // decay: 0.000075,\r\n  // exciteEnergy: 0.006,\r\n  // fundamentalFreq: 10,\r\n  // hilbertN: 256,\r\n  // maxIters: 4096,\r\n  // panX: 0.0011503007796323155,\r\n  // panY: 0.025033026938902938,\r\n  // tickDuration: 10,\r\n  // zoom: 836635.9887997985,\r\n  //\r\n  //\r\n  //\r\n  // panX: 0.08871194014553094,\r\n  // panY: -0.12829271146701177,\r\n  // zoom: 19736096.460687958,\r\n\r\n  // ...{zoom: 39422433.84662852, panX: 0.04670942760989286, panY: 0.13656218122372943},\r\n\r\n  // demo for 10 partials\r\n  // ...{zoom: 12371177.464729108, panX: 0.04671008941233588, panY: 0.13656133340058238},\r\n};\r\n\r\nlet audioCtx = new AudioContext();\r\nlet oscs = [];\r\n\r\nconst masterGain = audioCtx.createGain();\r\nwindow.masterGain = masterGain;\r\nmasterGain.gain.value = 1;\r\nmasterGain.connect(audioCtx.destination);\r\n\r\n\r\nexport const sketch = (p5) => {\r\n  p5.state = initialState;\r\n\r\n  const setupOscillators = () => {\r\n    oscs.forEach(({osc, gain}) =>\r\n    {\r\n      osc.stop();\r\n    }); // TODO: gain.disconnect?\r\n\r\n    oscs = _.range(p5.state.partialsCountMax).map(() => {\r\n      const osc = audioCtx.createOscillator();\r\n      const gain = audioCtx.createGain();\r\n      gain.gain.value = 0;\r\n      osc.connect(gain);\r\n      gain.connect(masterGain);\r\n      osc.start();\r\n      return {osc, gain};\r\n    });\r\n\r\n    window.oscs = oscs;\r\n  }\r\n\r\n  let font;\r\n  p5.preload = () => {\r\n    font = p5.loadFont('JetBrainsMono-Regular.ttf');\r\n  }\r\n\r\n\r\n  const TWO_PI = Math.PI * 2;\r\n\r\n  let h, w;\r\n\r\n  let d, n, n2 = 0;\r\n\r\n  [n, d] = [2, 1];\r\n\r\n  p5.setup = () => {\r\n    p5.createCanvas(p5._width, p5._height);\r\n    p5.blendMode(p5.ADD);\r\n    p5.colorMode(p5.HSB, 255);\r\n    p5.textFont(font);\r\n  }\r\n\r\n  let input = [];\r\n  p5.keyTyped = () => {\r\n    console.log(p5.key)\r\n    // if (key === ':') {\r\n    //   value = 255;\r\n    // } else if (key === 'b') {\r\n    //   value = 0;\r\n    // }\r\n    // uncomment to prevent any default behavior\r\n    if (p5.key === 'Enter') {\r\n\r\n      const obj = input.join('').split(':').map(s => parseInt(s, 10));\r\n\r\n      n2 = 0;\r\n      [d, n, n2] = obj;\r\n      if (!n2) {\r\n        [n, d] = obj;\r\n        n2 = 0;\r\n      }\r\n      console.log(d, n, n2)\r\n      console.log(w, h)\r\n\r\n      input = [];\r\n    } else {\r\n      input.push(p5.key);\r\n    }\r\n\r\n\r\n\r\n    return false;\r\n  }\r\n\r\n  let phase = 0;\r\n  let x1 = 0;\r\n  let y1 = 0;\r\n  let r;\r\n  const rayCount = 500;\r\n\r\n  const drawWave = ({ freq, phase = 0, hue }) => {\r\n    const dt = TWO_PI / rayCount;\r\n    p5.push();\r\n    p5.translate(w/2, h/2);\r\n    for(let t = 0; t < TWO_PI - dt; t += dt) {\r\n      p5.stroke(\r\n        hue,\r\n        255,\r\n        freq && (50 + 50 * Math.sin(t * freq)),\r\n        100,\r\n      );\r\n\r\n      r = w + h;\r\n      x1 = r * Math.sin(t + phase);\r\n      y1 = r * Math.cos(t + phase);\r\n\r\n      p5.line(0, 0, x1, y1);\r\n    }\r\n    p5.pop();\r\n  };\r\n\r\n\r\n  p5.draw = () => {\r\n    p5.clear();\r\n    p5.background(0, 0, 0);\r\n    h = p5.height;\r\n    w = p5.width;\r\n\r\n\r\n    phase = p5.millis() * (0.001/d);\r\n\r\n    drawWave({\r\n      freq: d,\r\n      hue: 0,\r\n      phase,\r\n    });\r\n\r\n    drawWave({\r\n      freq: d * n / d,\r\n      hue: 90,\r\n      phase: phase * 2,\r\n    });\r\n\r\n    drawWave({\r\n      freq: d * n2 / n,\r\n      hue: 180,\r\n      phase: phase * 3,\r\n    });\r\n\r\n\r\n\r\n\r\n\r\n    p5.blendMode(p5.BLEND);\r\n    p5.fill(255);\r\n    p5.stroke(0);\r\n    p5.strokeWeight(4);\r\n    p5.textAlign(p5.CENTER, p5.CENTER);\r\n    p5.textSize(h/15)\r\n    p5.text(n2 ? `${d}:${n}:${n2}` : `${n}:${d}`, w/2, h/2)\r\n    p5.blendMode(p5.ADD);\r\n  }\r\n\r\n  /**\r\n   * This needs to be called by a user event handler.\r\n   * @param isPlaying\r\n   */\r\n  p5.toggleAudio = () => {\r\n    p5.setState(prevState => {\r\n      const { isPlaying } = prevState;\r\n      if (!isPlaying && audioCtx.state !== 'running') {\r\n        audioCtx.resume();\r\n      }\r\n\r\n      if (isPlaying && audioCtx.state === 'running') {\r\n        audioCtx.suspend();\r\n      }\r\n\r\n      return { ...prevState, isPlaying: !prevState.isPlaying };\r\n    });\r\n\r\n  }\r\n}\r\n","import React, {useEffect} from 'react';\r\nimport useP5 from './useP5';\r\nimport {initialState, sketch} from \"./ratioLightshipP5\";\r\n\r\nconst RatioLightship = () => {\r\n  const {\r\n    ref,\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n  } = useP5(sketch, initialState);\r\n\r\n  window.sketchInstance = sketchInstance;\r\n\r\n  useEffect(() => {\r\n    document.title = 'Ratio Lightship';\r\n  }, [sketchInstance]);\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      style={{\r\n        alignSelf: 'start',\r\n        background: 'radial-gradient(circle, rgba(74,153,117,1) 0%, rgba(188,148,233,0.6943726953672094) 100%)',\r\n        height: '100vh',\r\n        width: '100vw',\r\n      }}\r\n    />);\r\n};\r\n\r\n\r\nexport default RatioLightship;\r\n","import _ from 'lodash';\r\nimport Vex from 'vexflow';\r\nimport React, {useCallback, useState} from 'react';\r\n\r\nconst VF = Vex.Flow;\r\n\r\nconst useVexFlow = () => {\r\n  const [context, setContext] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  const ref = useCallback((el) => {\r\n    if (el) {\r\n      const renderer = new VF.Renderer(el, VF.Renderer.Backends.SVG);\r\n      renderer.resize(el.clientWidth, el.clientHeight);\r\n      setContext(renderer.getContext());\r\n\r\n      const resizeObserver = new ResizeObserver(([{ contentRect: { height, width } }]) => {\r\n        renderer.resize(width, height);\r\n      });\r\n      setResizeObserver(resizeObserver);\r\n      resizeObserver.observe(el);\r\n    } else {\r\n      resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    context,\r\n    ref,\r\n  };\r\n}\r\n\r\nconst Staff = () => {\r\n  const {\r\n    context,\r\n    ref,\r\n  } = useVexFlow();\r\n\r\n  if (context) {\r\n    context.setStrokeStyle('white');\r\n    context.setFillStyle('white');\r\n\r\n    const treble = new VF.Stave(50, 0, 10000)\r\n      .addClef('treble')\r\n      .addKeySignature('Db')\r\n      .addTimeSignature('4/4')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    window.VF= VF;\r\n    window.context = context\r\n    window.treble = treble\r\n\r\n    const bass = new VF.Stave(50, 60, 10000)\r\n      .addClef('bass')\r\n      .addTimeSignature('4/4')\r\n      .addKeySignature('Db')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    const brace = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.BRACE)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n\r\n    const leftLine = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.SINGLE_LEFT)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n  }\r\n\r\n\r\n  return (\r\n    <div style={{\r\n      display: 'block',\r\n      width: '100%',\r\n    }}>\r\n      <div\r\n        ref={ref}\r\n        style={{\r\n          // background: 'darkcyan',\r\n          fill: 'white',\r\n          height: 500,\r\n          stroke: 'white',\r\n        }}/>\r\n    </div>\r\n  )\r\n};\r\n\r\nexport default Staff;\r\n","import _ from 'lodash';\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst Tonnetz = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    {_.range(30)\r\n      .map(y => (\r\n        <>\r\n          {_.range(50).map(x => {\r\n            const n = ((y % 2 > 0\r\n              ? ((y - 1) / 2) * 11 + 3\r\n              : (y / 2) * 11) + x * 7) % 12;\r\n\r\n            return (\r\n              <PC key={x} n={n} isOdd={y % 2 === 1}/>\r\n            )\r\n          })}\r\n          <br/>\r\n        </>\r\n      ))}\r\n  </div>\r\n);\r\n\r\nexport default Tonnetz;\r\n","import FrettedInstrument from './frettedInstrument';\r\nimport React from 'react';\r\n\r\nconst Ukulele = () => (\r\n  <FrettedInstrument\r\n    fretCount={18}\r\n    fretMarkers={[0,5,7,10,12]}\r\n    tuning={[7, 4, 0, 9]}\r\n  />\r\n);\r\n\r\nexport default Ukulele;\r\n","import {Entity} from \"aframe-react\";\r\nimport React from \"react\";\r\n\r\nconst Camera = () => (\r\n  <Entity\r\n    primitive=\"a-camera\"\r\n    id=\"camera\"\r\n    position={{ x: 0, y: 0, z: 0 }}\r\n    look-controls\r\n    // touch-look-controls={{\r\n    //   enabled: true,\r\n    // }}\r\n    wasd-controls={{\r\n      acceleration: 25,\r\n    }}\r\n  >\r\n    {/*<Entity*/}\r\n    {/*  primitive=\"a-cursor\"*/}\r\n    {/*  animation__click={{*/}\r\n    {/*    property: 'scale',*/}\r\n    {/*    startEvents: 'click',*/}\r\n    {/*    from: '0.1 0.1 0.1',*/}\r\n    {/*    to: '1 1 1',*/}\r\n    {/*    dur: 150,*/}\r\n    {/*  }}/>*/}\r\n  </Entity>\r\n);\r\n\r\nexport default Camera;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport {Entity} from 'aframe-react';\r\nimport {HSVtoHex} from './color';\r\nimport {toSymbol} from \"./util\";\r\n\r\nconst handleOsc = n => (el) => {\r\n  if (el) {\r\n    const { components: { osc } } = el;\r\n    osc.onOsc = ({ instrument, note, vel }) => {\r\n      if (note === n) {\r\n        osc.vel = vel;\r\n      }\r\n    }\r\n\r\n    osc.onTick = (time, timeDelta) => {\r\n      if (osc.vel === 0) {\r\n\r\n      }\r\n\r\n      if (_.has(osc, 'vel')) {\r\n        el.setAttribute('material', 'opacity', 0.05 + 0.75 * osc.vel / 128);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport default ({\r\n  darkened = true,\r\n  n,\r\n  position = {x: 0, y: 0, z: 0},\r\n  scale = {x: 1, y: 1, z: 1}\r\n}) =>\r\n  <Entity\r\n    _ref={handleOsc(n)}\r\n    // animation={{\r\n    //   dur: 500,\r\n    //   property: 'position',\r\n    //   to: position,\r\n    // }}\r\n    material={{\r\n      blending: darkened ? 'normal' : 'additive',\r\n      color: HSVtoHex(n / 12, 0.7, darkened ? 0 : 1),\r\n      opacity: darkened ? 0.5 : 0.1,\r\n    }}\r\n    osc={{\r\n\r\n    }}\r\n    position={position}\r\n    primitive='a-torus'\r\n    radius={0.1}\r\n    radius-tubular={0.003}\r\n    scale={scale}\r\n  >\r\n    <Entity\r\n      look-at=\"#camera\"\r\n      position={{x: 0, y: 0, z: 0}}\r\n      scale={{x: 2, y: 2, z: 2}}\r\n      text={{\r\n        align: 'center',\r\n        color: HSVtoHex(n / 12, 0.75, 0.5),\r\n        font: `../JetBrainsMono-Regular-msdf.json`,\r\n        negate: false,\r\n        transparent: true,\r\n        value: toSymbol(n),\r\n      }}\r\n    />\r\n  </Entity>\r\n","import _ from 'lodash';\r\nimport PitchClass from './pitchClass';\r\nimport React, {useEffect, useState} from 'react';\r\nimport useMidi from \"./useMidi\";\r\nimport {Entity} from 'aframe-react';\r\n\r\nconst ColtraneCircle = () => {\r\n  const [is180, setIs180] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const toggle = ({key}) => {\r\n      if (key === 'r') setIs180(is180 => !is180);\r\n    };\r\n\r\n    window.addEventListener('keyup', toggle);\r\n    return () => window.removeEventListener('keyup', toggle);\r\n  }, []);\r\n\r\n  const [{midiIn}] = useMidi();\r\n\r\n  const midiInPitchClasses = _(12)\r\n    .range()\r\n    .map(n => _(midiIn)\r\n      .pickBy((v, i) => i % 12 === n)\r\n      .values()\r\n      .sum())\r\n    .value();\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      animation={`property: rotation; to: 0 ${is180 ? 180 : 0} 0; dur: 500;`}\r\n      position={`0 0 -3`}\r\n    >\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 == 0)\r\n        .map(n => ({\r\n          n,\r\n          r: 1.5,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([6, 7, 0, 1], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          n: ((i + 1) * 2 + Math.floor(i / 4) * 2) % 12,\r\n          // n: (n * 2) % 12,\r\n          r: 1.5,\r\n          x: Math.sin((n + 0.5) * Math.PI / 24),\r\n          y: Math.cos((n + 0.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 != 0)\r\n        .map(n => ({\r\n          n: (n + 6) % 12,\r\n          r: 1.2,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([4, 5, 6, 7], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          // n: i,\r\n          n: (i * 2 + 9 + Math.floor(i / 4) * 2) % 12,\r\n          // n: i,\r\n          r: 1.2,\r\n          x: Math.sin((n - 1.5) * Math.PI / 24),\r\n          y: Math.cos((n - 1.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default ColtraneCircle;\r\n","import {Entity} from 'aframe-react';\r\nimport React from 'react';\r\nimport {HSVtoHex} from './color';\r\n\r\n// http://dmccooey.com/polyhedra/PentakisDodecahedron.txt\r\nconst c1 = 1.33058699733550141141687582919;\r\nconst c2 = 2.15293498667750705708437914596;\r\n\r\n// in ordered, opposite pairs\r\nconst verts = [\r\n  [0.0,  -c2,   c1],\r\n  [0.0,   c2,  -c1],\r\n  [ c2,  -c1,  0.0],\r\n  [-c2,   c1,  0.0],\r\n  [0.0,  -c2,  -c1],\r\n  [0.0,   c2,   c1],\r\n  [-c2,  -c1,  0.0],\r\n  [ c2,   c1,  0.0],\r\n  [-c1,  0.0,   c2],\r\n  [ c1,  0.0,  -c2],\r\n  [ c1,  0.0,   c2],\r\n  [-c1,  0.0,  -c2],\r\n];\r\n\r\nconst Dod = ({ rep = 1, sat, stack = [], n = 0 }) =>\r\n  <Entity position=\"0 0 0\">\r\n    {verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        color={HSVtoHex(i * (1 / 12), sat || 1, 1)}\r\n        events={{ click: () => console.log(i) }}\r\n        primitive=\"a-sphere\"\r\n        position={v.join(' ')}\r\n        scale={[1, 1, 1].map(n => 0.3 * n/ (rep * rep)).join(' ')}\r\n      />)}\r\n\r\n    {rep < 3 && verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        position={v.map(n => n * 2).join(' ')}\r\n        text={`color: ${HSVtoHex((stack.length ? stack[stack.length - 1] : i) * (1 / 12), 1, 1)}; align: center; value: ${[...stack, i].join(',')} - ${(n + i) % 12}; width: 5; zOffset: 0`}\r\n      >\r\n        <Dod rep={rep+1} sat={0.3} stack={[...stack, i]} n={(n + i) % 12} />\r\n      </Entity>)\r\n      // .filter((n, i) => i % 2)\r\n    }\r\n  </Entity>;\r\n\r\nexport default Dod;","// import * as Tone from 'tone'\r\nimport _ from 'lodash';\r\nimport PitchClass from './pitchClass';\r\nimport PitchDetector from 'pitchdetect';\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport useMidiClock from \"./useMidiClock\";\r\nimport {Entity} from 'aframe-react';\r\nimport {HSVtoHex} from \"./color\";\r\n\r\nconst PitchClassCollections = ({}) => {\r\n\r\n  const spacing = 0.75;\r\n\r\n  const [collEl, setCollEl] = useState();\r\n  const collRef = useCallback(setCollEl, []);\r\n\r\n\r\n  const { reset } = useMidiClock(({ tick }) => {\r\n    if (tick % 24 === 0) console.log(tick);\r\n\r\n    if (collEl) {\r\n      collEl.object3D.position.set(0, 0, (tick / 96) * spacing);\r\n    }\r\n  });\r\n\r\n  window.reset = reset;\r\n\r\n  useEffect(() => {\r\n    const handleKeyup = ({code, key}) => {\r\n      // if (key === 'r') setIs180(is180 => !is180);\r\n      // if (code === 'Space') audioContext.resume();\r\n    };\r\n\r\n    window.addEventListener('keyup', handleKeyup);\r\n    return () => window.removeEventListener('keyup', handleKeyup);\r\n  }, []);\r\n\r\n  const colls = [[2, 5, 9], [7, 11, 2], [0, 4, 7]];\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      _ref={collRef}\r\n      position={{x: 0, y: 0, z: -2}}\r\n      scale={{x: 4, y: 4, z: 4}}\r\n    >\r\n      {\r\n        _.range(50)\r\n          .map(i => 50 - i)// draw order\r\n          .map(i => ({ coll: colls[i % colls.length], z: i * -spacing}))\r\n          .map(({coll, z}) => (\r\n            <React.Fragment key={z}>\r\n              <Entity\r\n                material={{\r\n                  // blending: 'subtractive',\r\n                  color: '#040404',\r\n                  opacity: 0.45,\r\n                }}\r\n                position={{ x: 0, y: 0, z: z - 0.01}}\r\n                rotation={{x: 90, y: 0, z: 0}}\r\n                primitive='a-cylinder'\r\n                scale={{ x: 1, y: 0.001, z: 1}}\r\n              />\r\n              {_.range(12)\r\n                .map(n => {\r\n                  const r = 0.25;\r\n                  const theta = n * (Math.PI * 2) / 12;\r\n\r\n                  return {\r\n                    n,\r\n                    x: r * Math.sin(theta),\r\n                    y: r * Math.cos(theta),\r\n                  };\r\n                })\r\n                .map(({n, s = 0.5, x, y}) => (\r\n                  <PitchClass\r\n                    darkened={!_.includes(coll, n)}\r\n                    key={n}\r\n                    n={n}\r\n                    position={{x, y, z}}\r\n                    scale={{x: s, y: s, z: s}}\r\n                  />))}\r\n            </React.Fragment>\r\n          ))\r\n      }\r\n\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default PitchClassCollections;\r\n","import _ from \"lodash\";\r\nimport React, {useCallback, useEffect, useState} from \"react\";\r\nimport useMidi from \"./useMidi\";\r\nimport usePrevious from \"./usePrevious\";\r\nimport {Entity} from \"aframe-react\";\r\nimport {HSVtoHex} from \"./color\";\r\n\r\nconst PcSpiralWindController = ({noteToDimensions}) => {\r\n  const [midiInEl, setMidiInEl] = useState();\r\n  const [{midiInDevice}] = useMidi();\r\n  const prevMidiInDevice = usePrevious(midiInDevice);\r\n\r\n  useEffect(() => {\r\n    const handleMidi = (evt) => {\r\n      // console.log(evt)\r\n      const {note: {number: n}, velocity: vel, type} = evt;\r\n      const opacity = vel / (0.1 + vel);\r\n      const {s, x, y, z} = noteToDimensions(n);\r\n      midiInEl.setAttribute('material', 'opacity', opacity);\r\n      if (type === 'noteon') {\r\n        midiInEl.note = n; // FIXME Hack\r\n        midiInEl.object3D.position.set(x, y, z + 0.01);\r\n        midiInEl.object3D.scale.set(s * 1.1, s * 1.1, s * 1.1);\r\n        midiInEl.setAttribute('material', 'color', HSVtoHex(n / 12, 0.75, 0.5));\r\n      }\r\n    };\r\n\r\n    const handleCC = ({ controller: { number }, value }) => {\r\n      if (number === 2) { // breath control\r\n        const vel = value / 128;\r\n        const opacity = vel / (0.1 + vel);\r\n        midiInEl.setAttribute('material', 'opacity', opacity);\r\n      }\r\n    };\r\n\r\n    const handlePitchbend = ({ value }) => {\r\n      // console.log(value)\r\n      const n = midiInEl.note || 0;\r\n      const bendAmount = value * 2;\r\n      const {s, x, y, z} = noteToDimensions(n + bendAmount);\r\n      midiInEl.object3D.position.set(x, y, z + 0.01);\r\n      midiInEl.object3D.scale.set(s * 1.1, s * 1.1, s * 1.1);\r\n    };\r\n\r\n    if (midiInEl) {\r\n      if (midiInDevice) {\r\n        console.log('new midiInDevice: ', _.get(midiInDevice,'name'), 'prev: ', _.get(prevMidiInDevice, 'name'));\r\n        midiInDevice.addListener('noteon', 'all', handleMidi);\r\n        midiInDevice.addListener('noteoff', 'all', handleMidi);\r\n        midiInDevice.addListener('controlchange', 'all', handleCC);\r\n        midiInDevice.addListener('pitchbend', 'all', handlePitchbend);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (midiInDevice) {\r\n        console.log('removing listeners for', _.get(midiInDevice, 'name'));\r\n        midiInDevice.removeListener('noteon');\r\n        midiInDevice.removeListener('noteoff');\r\n        midiInDevice.removeListener('controlchange');\r\n        midiInDevice.removeListener('pitchbend');\r\n      }\r\n    }\r\n  }, [midiInEl, midiInDevice, noteToDimensions, prevMidiInDevice]);\r\n\r\n  const midiInRef = useCallback(setMidiInEl, []);\r\n\r\n  return (\r\n    <Entity\r\n      _ref={midiInRef}\r\n      primitive='a-sphere'\r\n      material={{\r\n        blending: 'additive',\r\n        color: HSVtoHex(1, 0, 1),\r\n        opacity: 0,\r\n        transparent: true,\r\n      }}\r\n      radius={0.07}\r\n    />\r\n  )\r\n}\r\n\r\nexport default PcSpiralWindController;\r\n","import {useEffect, useRef} from \"react\";\r\n\r\nexport default (value) => {\r\n  const ref = useRef();\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  });\r\n  return ref.current;\r\n}\r\n","import _ from 'lodash';\r\nimport PcSpiralWindController from './pcSpiralWindController';\r\nimport PitchClass from './pitchClass';\r\nimport PitchDetector from 'pitchdetect';\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport useMidi from \"./useMidi\";\r\nimport {Entity} from 'aframe-react';\r\nimport {ftomf} from \"./util\";\r\nimport {HSVtoHex} from \"./color\";\r\n\r\nconst audioContext = new AudioContext();\r\n\r\n// FIXME HACK\r\nwindow.audioContext = audioContext;\r\n\r\n\r\nconst PitchClassSpiral = ({\r\n  depthMax = 1,\r\n  isAlwaysCounterClockwise = false,\r\n  rMax = 0.75,\r\n  rMin = 0,\r\n  noteRange = [34, 99],\r\n  // notesHighlighted = [0, 2, 4, 5, 7, 9, 11],\r\n  pcsHighlighted= [0, 2, 4, 5, 7, 9, 11],\r\n}) => {\r\n  const [is180, setIs180] = useState(true);\r\n  const [detector, setDetector] = useState();\r\n  const [pitchDetectEl, setPitchDetectEl] = useState();\r\n\r\n\r\n\r\n  const noteToDimensions = n => {\r\n    const step = n / 128;\r\n    const r = (is180 ? 1 : 1.5) * rMax - ((is180 ? 1 : 1.5) * rMax - rMin) * step;\r\n\r\n    return {\r\n      n,\r\n      s:  0.75 - n / 192,\r\n      x: r * (is180 && isAlwaysCounterClockwise ? -1 : 1) * Math.sin(n * Math.PI / 6 + 0.01), // +0.01 to fix floating point error in animation library\r\n      y: r * Math.cos(n * Math.PI / 6 + 0.01),\r\n      z: is180\r\n        ? depthMax - depthMax * step\r\n        : depthMax * step,\r\n    };\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyup = ({code, key}) => {\r\n      if (key === 'r') setIs180(is180 => !is180);\r\n      if (code === 'Space') audioContext.resume();\r\n    };\r\n\r\n    window.addEventListener('keyup', handleKeyup);\r\n    return () => window.removeEventListener('keyup', handleKeyup);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    console.log('el', pitchDetectEl, 'detector', detector);\r\n\r\n    const handlePitch = (stats, pitchDetector) => {\r\n      const {frequency, detected, rms} = stats;\r\n\r\n      // https://math.stackexchange.com/q/57429/398343\r\n      // const opacity = 1 - Math.exp(-2 * rms);\r\n      const opacity = rms / (0.1 + rms);\r\n      const n = ftomf(frequency);\r\n      const {s, x, y, z} = noteToDimensions(n);\r\n      pitchDetectEl.setAttribute('material', 'opacity', detected ? opacity : 0);\r\n      pitchDetectEl.object3D.position.set(x, y, z + 0.01);\r\n      pitchDetectEl.object3D.scale.set(s, s, s);\r\n\r\n      if (_.isFinite(n)) {\r\n        pitchDetectEl.setAttribute('material', 'color', HSVtoHex(n / 12, 0.5, 1));\r\n      }\r\n    };\r\n\r\n    if (audioContext && !detector && pitchDetectEl) {\r\n      setDetector(new PitchDetector({\r\n        context: audioContext,\r\n\r\n        // input: audioBufferNode, // default: Microphone input\r\n\r\n        interpolateFrequency: true, // default: true\r\n\r\n        onDebug: handlePitch,\r\n\r\n        // Minimal signal strength (RMS, Optional)\r\n        // minRms: 0.1,\r\n\r\n        // Detect pitch only with minimal correlation of: (Optional)\r\n        // minCorrelation: 0.9,\r\n\r\n        // Detect pitch only if correlation increases with at least: (Optional)\r\n        minCorrelationIncrease: 0.5,\r\n\r\n        // Note: you cannot use minCorrelation and minCorreationIncrease\r\n        // at the same time!\r\n\r\n        // Signal Normalization (Optional)\r\n        normalize: \"rms\", // or \"peak\". default: undefined\r\n\r\n        // Only detect pitch once: (Optional)\r\n        stopAfterDetection: false,\r\n\r\n        // Buffer length (Optional)\r\n        length: 1024, // default 1024\r\n\r\n        // Limit range (Optional):\r\n        minNote: 32, // by MIDI note number\r\n        maxNote: 128,\r\n\r\n        // minFrequency: 440,    // by Frequency in Hz\r\n        // maxFrequency: 20000,\r\n\r\n        minPeriod: 2,  // by period (i.e. actual distance of calculation in audio buffer)\r\n        maxPeriod: 512, // --> convert to frequency: frequency = sampleRate / period\r\n\r\n        // Start right away\r\n        start: true, // default: false\r\n      }));\r\n      // window.detector = detector;\r\n    } else if (detector && !pitchDetectEl) {\r\n      detector.stop();\r\n      detector.destroy();\r\n    }\r\n  }, [audioContext, detector, is180, pitchDetectEl]);\r\n\r\n\r\n\r\n  const pitchDetectRef = useCallback(setPitchDetectEl, []);\r\n\r\n\r\n  // const midiInPitchClasses = _(12)\r\n  //   .range()\r\n  //   .map(n => _(midiIn)\r\n  //     .pickBy((v, i) => i % 12 === n)\r\n  //     .values()\r\n  //     .sum())\r\n  //   .value();\r\n\r\n  // TODO: position by freq, not 12TET pitch\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      events={{\r\n        click: () => {\r\n          audioContext.resume()\r\n        },\r\n      }}\r\n      position={{x: 0, y: 0, z: -6}}\r\n      scale={{x: 4, y: 4, z: 4}}\r\n    >\r\n      {_.range(noteRange[0], noteRange[1] + 1)\r\n        .map(noteToDimensions)\r\n        .map(({n, s, x, y, z}) => (\r\n          <React.Fragment key={n}>\r\n            <Entity\r\n              line={{\r\n                color: 'black',\r\n                opacity: 0.3,\r\n                start: _.pick(noteToDimensions(n + 0.25), ['x', 'y', 'z']),\r\n                end: _.pick(noteToDimensions(n + 0.75), ['x', 'y', 'z']),\r\n                visible: n < noteRange[1],\r\n              }}\r\n            />\r\n\r\n            <PitchClass\r\n              darkened={!_.includes(pcsHighlighted, n%12)}\r\n              n={n}\r\n              position={{x, y, z}}\r\n              scale={{x: s, y: s, z: s}}\r\n            />\r\n          </React.Fragment>\r\n          ))\r\n      }\r\n\r\n      <PcSpiralWindController\r\n        noteToDimensions={noteToDimensions}\r\n      />\r\n\r\n      {/* TODO intervals   */}\r\n      {/*<Entity*/}\r\n      {/*  line={{*/}\r\n      {/*    color: 'white',*/}\r\n      {/*    opacity: 0.3,*/}\r\n      {/*    start: _.pick(noteToDimensions(60), ['x', 'y', 'z']),*/}\r\n      {/*    end: _.pick(noteToDimensions(65), ['x', 'y', 'z']),*/}\r\n      {/*  }}*/}\r\n      {/*/>*/}\r\n\r\n\r\n      <Entity\r\n        _ref={pitchDetectRef}\r\n        primitive='a-sphere'\r\n        material={{\r\n          blending: 'additive',\r\n          color: HSVtoHex(1, 0, 1),\r\n          opacity: 0,\r\n          transparent: true,\r\n        }}\r\n        radius={0.1}\r\n      />\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default PitchClassSpiral;\r\n","import 'aframe-touch-look-controls';\r\nimport Camera from './camera';\r\nimport ColtraneCircle from \"./coltraneCircle\";\r\nimport Dod from './dod';\r\nimport PitchClassCollections from \"./pitchClassCollections\";\r\nimport PitchClassSpiral from \"./pitchClassSpiral\";\r\nimport React from 'react';\r\nimport {Entity, Scene} from 'aframe-react';\r\nimport {Route, Switch} from 'react-router-dom';\r\n\r\n// Note: needs https to enter VR\r\n\r\nconst VR = ({match: {path}}) => (\r\n  <Scene\r\n    // fog={{type: 'linear', color: '#000', near: 1, far: 10}}\r\n  >\r\n    <a-assets>\r\n      {/*<img id=\"groundTexture\" src=\"https://cdn.aframe.io/a-painter/images/floor.jpg\"/>*/}\r\n      {/*<img id=\"skyTexture\" src=\"https://cdn.aframe.io/a-painter/images/sky.jpg\"/>*/}\r\n    </a-assets>\r\n\r\n    <Switch>\r\n      <Route path={`${path}/coltrane`} component={ColtraneCircle}/>\r\n      <Route path={`${path}/dod`} component={Dod}/>\r\n      <Route path={`${path}/pitchClassCollections`} component={PitchClassCollections}/>\r\n      <Route path={`${path}/pitchClassSpiral`} component={PitchClassSpiral}/>\r\n    </Switch>\r\n\r\n\r\n    {/*<Entity primitive=\"a-plane\" src=\"#groundTexture\" rotation=\"-90 0 0\" height=\"100\" width=\"100\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"ambient\" color=\"#445451\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"point\" intensity=\"2\" position=\"2 4 4\"/>*/}\r\n\r\n    {/*<Entity*/}\r\n    {/*  height=\"2048\"*/}\r\n    {/*  primitive=\"a-sky\"*/}\r\n    {/*  radius=\"30\"*/}\r\n    {/*  rotation=\"90 0 0\"*/}\r\n    {/*  src=\"#skyTexture\"*/}\r\n    {/*  theta-length=\"90\"*/}\r\n    {/*  width=\"2048\"*/}\r\n    {/*/>*/}\r\n    {/*<Entity*/}\r\n    {/*  height=\"2048\"*/}\r\n    {/*  primitive=\"a-sky\"*/}\r\n    {/*  radius=\"30\"*/}\r\n    {/*  rotation=\"90 0 180\"*/}\r\n    {/*  src=\"#skyTexture\"*/}\r\n    {/*  theta-length=\"90\"*/}\r\n    {/*  width=\"2048\"*/}\r\n    {/*/>*/}\r\n\r\n    <Camera />\r\n\r\n    <Entity\r\n      // events={{}}\r\n      id=\"leftHand\"\r\n      oculus-touch-controls=\"hand: left\"\r\n    />\r\n    <Entity\r\n      id=\"rightHand\"\r\n      oculus-touch-controls=\"hand: right\"\r\n    />\r\n\r\n  </Scene>\r\n);\r\n\r\nexport default VR;\r\n","import { fraction } from 'mathjs';\r\n\r\nexport const toOctave = (r) => r > 2\r\n  ? toOctave(r / 2)\r\n  : r < 1\r\n    ? toOctave(r * 2)\r\n    : r;\r\n\r\nexport const intToRatio = (i) => fraction(toOctave(i));\r\n\r\n// TODO: n-dimensions\r\nexport const coordToRatio = (x, y) => {\r\n  const raw = Math.pow(3, x) * Math.pow(5, y);\r\n  return fraction(toOctave(raw));\r\n}\r\n\r\n// for(let threes = -5; threes <= 5; threes++) {\r\n//   for(let fives = -5; fives <= 5; fives++) {\r\n//     let f = coordToRatio(threes, fives);\r\n//     console.log(`${f.n}/${f.d}`)\r\n//   }\r\n// }\r\n","// import 'aframe-animation-component';\r\nimport 'aframe';\r\nimport 'aframe-look-at-component';\r\nimport Banjo from './banjo';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Guitar from './guitar';\r\nimport Intro from './intro';\r\nimport MultTableMod12 from './multTableMod12';\r\nimport NumpadMod12 from './numpadMod12';\r\nimport OSC from 'osc-js';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Mandelbrot from './mandelbrot';\r\nimport Mandolin from './mandolin';\r\nimport Mic from './mic';\r\nimport Midi from './midi';\r\nimport RatioLightship from './ratioLightship';\r\nimport Staff from './staff';\r\nimport Tonnetz from './tonnetz';\r\nimport Ukulele from './ukulele';\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\nimport VR from './vr';\r\nimport {\r\n  AppBar,\r\n  IconButton,\r\n  Menu,\r\n  MenuItem,\r\n  Toolbar,\r\n} from '@material-ui/core';\r\nimport {BrowserRouter as Router, Route, Link} from 'react-router-dom';\r\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport {\r\n  Menu as MenuIcon,\r\n  MenuBookIcon,\r\n  WatchLater as MidiClockIcon,\r\n} from '@material-ui/icons';\r\nimport _ from 'lodash';\r\n\r\nimport { intToRatio } from \"./fns\";\r\n\r\nwindow.intToRation = intToRatio;\r\n\r\nconst doWhenAframeLoaded = () => {\r\n  if (typeof AFRAME === 'undefined') {\r\n    setTimeout(doWhenAframeLoaded, 100);\r\n    return;\r\n  }\r\n\r\n  const oscHost = {\r\n    host: window.location.hostname,\r\n    port: '8080',\r\n    secure: true,\r\n  };\r\n  const osc = new OSC({\r\n    plugin: new OSC.WebsocketClientPlugin(oscHost),\r\n  });\r\n  osc.open();\r\n  window.osc = osc;\r\n\r\n  // window.sendOsc = (address, ...args) => osc.send(new OSC.Message(address, ...args));\r\n\r\n  // osc.on('/midiSeq/clear', () => clearSeq());\r\n\r\n  // osc.on('/midiSeq/beat', ({args: [beat]}) => setBeat(beat));\r\n\r\n  // WIP\r\n  window.AFRAME.registerComponent('midi', {\r\n    init: function() {\r\n      // this.onOsc = (i, e) => {};\r\n\r\n      this._onOscId = osc.on('/midi/*', ({address, args: [note, vel]}) => {\r\n        const instrument = _.last(address.split('/'));\r\n        if (this.onOsc) this.onOsc({ instrument, note, vel });\r\n      });\r\n\r\n    },\r\n\r\n    tick: function (time, timeDelta) {\r\n      if (this.onTick) this.onTick(time, timeDelta);\r\n    },\r\n\r\n    remove: function() {\r\n      osc.off('/midi/*', this._onOscId);\r\n    },\r\n  });\r\n\r\n  window.AFRAME.registerComponent('osc', {\r\n    init: function() {\r\n      // this.onOsc = (i, e) => {};\r\n\r\n      this._onOscId = osc.on('/midi/*', ({address, args: [note, vel]}) => {\r\n        const instrument = _.last(address.split('/'));\r\n        if (this.onOsc) this.onOsc({ instrument, note, vel });\r\n      });\r\n\r\n    },\r\n\r\n    tick: function (time, timeDelta) {\r\n      if (this.onTick) this.onTick(time, timeDelta);\r\n    },\r\n\r\n    remove: function() {\r\n      osc.off('/midi/*', this._onOscId);\r\n    },\r\n  });\r\n}\r\ndoWhenAframeLoaded();\r\n\r\nconst routes2d = [\r\n  ['Mod12 Multiplication Tables', '/multTableMod12', MultTableMod12],\r\n  ['PC-Number Notepad', '/numpadMod12', NumpadMod12],\r\n  ['OSC Dataviz', '/osc', OSC, true],\r\n  ['PC Tonnetz', '/tonnetz', Tonnetz],\r\n  ['Banjo PCs', '/banjo', Banjo],\r\n  ['Guitar PCs', '/guitar', Guitar],\r\n  ['Mandolin PCs', '/mandolin', Mandolin],\r\n  ['Ukulele PCs', '/ukulele', Ukulele],\r\n  ['Staff', '/staff', Staff],\r\n  ['Mandelbrot', '/mandelbrot', Mandelbrot],\r\n  ['Ratio Lightship', '/ratioLightship', RatioLightship],\r\n];\r\n\r\nconst App = () => {\r\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\r\n\r\n  const neutral = {\r\n    palette: { // https://material-ui.com/customization/palette/\r\n      action: {\r\n        active: '#660000',\r\n      },\r\n      primary: {\r\n        main: '#330033'\r\n      },\r\n      type: 'dark',\r\n    },\r\n  };\r\n\r\n  const dark = {\r\n    palette: { // https://material-ui.com/customization/palette/\r\n      action: {\r\n        active: '#660000',\r\n      },\r\n      primary: {\r\n        main: '#330033'\r\n      },\r\n      type: 'dark',\r\n    },\r\n  };\r\n\r\n  const light = {\r\n    palette: { // https://material-ui.com/customization/palette/\r\n      action: {\r\n        active: '#660000',\r\n      },\r\n      primary: {\r\n        main: '#330033'\r\n      },\r\n      type: 'light',\r\n    },\r\n  };\r\n\r\n  const theme = React.useMemo(\r\n    () =>\r\n      createMuiTheme(prefersDarkMode ? dark : light),\r\n    [prefersDarkMode],\r\n  );\r\n\r\n  // Menu open/close\r\n  const [menuAnchorEl, setMenuAnchorEl] = React.useState(null);\r\n  const handleMenuButtonClick = ({ currentTarget }) => setMenuAnchorEl(currentTarget);\r\n  const handleMenuClose = () => setMenuAnchorEl(null);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline/>\r\n      <Router basename={process.env.PUBLIC_URL}>\r\n        <Route path=\"/\" exact component={Intro}/>\r\n\r\n        <Route path=\"/vr\" component={VR} />\r\n\r\n        {routes2d.map(([title, path, component], key) => (\r\n          <Route {...{ component, key, path }} />\r\n        ))}\r\n\r\n        <AppBar\r\n          color=\"transparent\"\r\n          onClick={() => {\r\n            // if (window.audioContext) { // FIXME HACK\r\n            //   window.audioContext.resume();\r\n            //   window.detector.start();\r\n            // }\r\n          }}\r\n          position=\"fixed\"\r\n          style={{\r\n            top: 'auto',\r\n            bottom: 0,\r\n          }}\r\n        >\r\n          <Toolbar>\r\n            <IconButton\r\n              edge=\"start\"\r\n              color=\"inherit\"\r\n              aria-label=\"open drawer\"\r\n              onClick={handleMenuButtonClick}\r\n            >\r\n              <MenuIcon/>\r\n            </IconButton>\r\n\r\n            <Menu\r\n              anchorEl={menuAnchorEl}\r\n              open={!!menuAnchorEl}\r\n              onClose={handleMenuClose}\r\n            >\r\n              <MenuItem>\r\n                <Link style={{ color: 'lightgrey'}} onClick={handleMenuClose} to=\"/\">Introduction</Link>\r\n              </MenuItem>\r\n              <MenuItem disabled divider >2D</MenuItem>\r\n              {routes2d.map(([title, url, component, isDevOnly], idx) => !isDevOnly && (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'darkmagenta'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n              <MenuItem disabled divider>VR</MenuItem>\r\n              {[\r\n                ['Coltrane Circle', '/vr/coltrane'],\r\n                ['Dod', '/vr/dod'],\r\n                ['PitchClassCollections', '/vr/pitchClassCollections'],\r\n                ['PitchClassSpiral', '/vr/pitchClassSpiral'],\r\n              ].map(([title, url], idx) => (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'cyan'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n            </Menu>\r\n\r\n            <Midi />\r\n\r\n            <Mic />\r\n          </Toolbar>\r\n        </AppBar>\r\n      </Router>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nReactDOM.render(<App/>, document.querySelector('#sceneContainer'));\r\n"],"sourceRoot":""}