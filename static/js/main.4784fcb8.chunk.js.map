{"version":3,"sources":["cell.js","fretMarkers.js","util.js","pc.js","banjo.js","frettedInstrument.js","guitar.js","intro.js","multTableMod12.js","numpadMod12.js","useMidi.js","useMidiClock.js","useP5.js","color.js","mandelbrotP5.js","mandelbrot.js","mandolin.js","useMic.js","mic.js","midi.js","ratioLightshipP5.js","tonnetz.js","ratioLightship.js","staff.js","ukulele.js","camera.js","pitchClass.js","coltraneCircle.js","dod.js","pitchClassCollections.js","pcSpiralWindController.js","usePrevious.js","pitchClassSpiral.js","vr.js","fns.js","index.js"],"names":["Cell","withStyles","root","fontSize","fontFamily","display","height","width","alignItems","justifyContent","odd","left","cellSize","position","_ref","children","classes","_ref$className","className","isOdd","style","react_default","a","createElement","concat","FretMarkers","fretMarker","color","frets","_","range","last","map","f","includes","fret","ix","cell","key","toSymbol","note","equalDivisions","arguments","length","undefined","10","11","PC","_ref$isSolfege","isSolfege","n","_ref$style","borderStyle","borderWidth","0","1","2","3","4","5","6","7","8","9","toSolfege","Banjo","flexShrink","src_fretMarkers","pc0","pc0ix","Fragment","i","pc","src_pc","FrettedInstrument","fretCount","fretMarkers","tuning","Object","toConsumableArray","reverse","ixPc0","Guitar","frettedInstrument","Intro","overflowY","padding","MultTableMod12","margin","y","x","NumpadMod12","state","text","handleKeyPress","evt","char","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadDivide","NumpadMultiply","NumpadDecimal","NumpadEnter","Enter","Space","code","preventDefault","_this","setState","handleChange","value","target","window","addEventListener","this","removeEventListener","cols","rows","onChange","background","Component","initialState","input","inputDevices","isMidiClockInSelectorOpen","isMidiInSelectorOpen","midiClockInDevice","midiInDevice","midiIn","zipObject","fill","Array","actions","setInputDevices","store","setMidiEvent","midiEvt","merge","setMidiClockInDevice","setMidiInDevice","toggleMidiInSelector","toggleMidiClockInSelector","globalHook","React","useMidiClock","onClock","onStop","onSongPos","_useMidi","useMidi","_useMidi2","slicedToArray","tick","useEffect","handleMidiClock","handleStop","console","log","handleSpp","_ref2","_ref2$data","data","beats","addListener","removeListener","reset","useP5","sketch","_useState","useState","_useState2","sketchState","setSketchState","_useState3","_useState4","sketchInstance","setSketchInstance","_useState5","_useState6","resizeObserver","setResizeObserver","ref","useCallback","el","instance","P5","_height","clientHeight","_width","clientWidth","ro","ResizeObserver","_ref2$0$contentRect","contentRect","resizeCanvas","prevState","objectSpread","isRegenNeeded","observe","disconnect","HSVtoHex","h","s","v","r","g","b","p","q","t","Math","floor","componentToHex","c","hex","toString","rgbToHex","round","timeouts","messageName","event","source","stopPropagation","shift","fn","setZeroTimeout","push","postMessage","audioPan","decayDuration","exciteEnergy","exciteDuration","fundamentalFreq","hilbertN","hilbMand","isControlPanelOpen","isPlaying","maxIters","midiClock","midiClocksPerTick","panX","panY","partials","partialsCountMax","isSmooth","tickDuration","tickLastMillis","zoom","audioCtx","AudioContext","oscs","masterGain","createGain","audioPanner","createStereoPanner","gain","connect","destination","p5","font","hilbGetRotatedVec","rx","ry","temp","dot","v1","v2","reduce","acc","val","idx","mandGetValFromNormalizedCoords","xN","yN","maxIterations","_mandGetDenormalizedC","mandGetDenormalizedCoords","cx","cy","z","log2","mandGetValSmooth","scaledX","scaledY","iter","xTemp","mandGetVal","genHilbertCoords","memoize","d","dist","hilbDistanceToCoords","getStrokeWeight","w","sideLength","min","getPartialOfOctaveStart","pow","dropWhile","first","getColorForMandelbrotVal","_ref3","m","isCursor","_p5$state2","octMax","oct","setFillColorForMandelbrotVal","coordsWithVal","drawHilbertCoord","hilbertCoord","scaleX","scaleY","rect","drawHilbertMandelbrot","strokeWeight","stroke","getSideLengthForLinearizedMap","forEach","coordWithVal","translate","pop","drawLinearizedMandelbrotCoord","dMax","maxA","largestPossibleSide","sqrt","sqPerRow","valsPerRow","genAndDrawHilbertMandelbrot","_ref4","cancelScheduledValues","currentTime","linearRampToValueAtTime","_p5$state3","osc","stop","createOscillator","start","_p5$state","genHilbertMandelbrot","_ref5","filter","identity","uniq","sort","take","partial","amp","oscIdx","fromPairs","each","_ref6","decayTimerId","zeroGainTimerId","clearTimeout","frequency","nextState","prevD","cursorDraw","id","coordAndVal","maxD","prevCoordAndVal","cursorErasePrev","partialsDraw","noStroke","_p5$state5","_ref7","targetAmp","barH","barW","hue","wasPaused","preload","loadFont","setup","createCanvas","colorMode","HSB","textFont","incrementTick","isExternal","now","millis","_p5$state6","_p5$state4","pan","currGain","isNumber","targetGain","setTimeout","exponentialRampToValueAtTime","cursorExcite","prevTick","draw","_p5$state7","every","noFill","textSize","textAlign","CENTER","toggleAudio","resume","suspend","useStyles","makeStyles","paper","paddingBottom","FreqSlider","_ref2$initialVal","initialVal","_ref2$isInt","isInt","_ref2$isRegenRequired","isRegenRequired","_ref2$label","label","_ref2$max","max","Number","MAX_VALUE","_ref2$min","MIN_VALUE","_ref2$precision","precision","_ref2$size","size","stateKey","constrainVal","valToState","freq","logFreq","exp","deg","numberInputVal","defer","flex","marginBottom","paddingTop","onPointerUp","react_circular_slider_default","dataIndex","degPerExp","knobColor","knobSize","renderLabelValue","type","border","marginLeft","marginTop","top","zIndex","toPrecision","ev","onKeyDown","_objectSpread4","defineProperty","nextExp","progressColorFrom","progressColorTo","progressLineCap","trackColor","Mandelbrot","_useP","handleAction","action","panDelta","moveLeft","moveRight","moveUp","moveDown","resDec","resInc","toggleControlPanel","zoomIn","zoomOut","isEmpty","getHandleAction","document","title","handler","shiftKey","getAction","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","handleKeyDown","beat","alignSelf","bottom","right","Button","onClick","Tune_default","Drawer","anchor","open","onClose","variant","ButtonGroup","fullWidth","PauseCircleOutline_default","PlayCircleOutline_default","ViewModuleOutlined_default","KeyboardArrowUpOutlined_default","ViewComfyOutlined_default","ZoomInOutlined_default","KeyboardArrowLeftOutlined_default","KeyboardArrowDownOutlined_default","KeyboardArrowRightOutlined_default","ZoomOutOutlined_default","mandelbrot_FreqSlider","flexWrap","Mandolin","mediaStream","setMediaStream","Mic","_useMic","useMic","_useMic2","isMicOn","IconButton","edge","getTracks","tr","navigator","mediaDevices","getUserMedia","audio","video","then","MicOffOutlined","esm_Mic","Midi","WebMidi","enable","err","error","inputs","handleMidi","number","rawVelocity","_React$useState","_React$useState2","midiMenuAnchorEl","setMidiMenuAnchorEl","handleMidiMenuButtonClick","isBeatClock","currentTarget","handleMidiInputSelect","deviceIdx","aria-label","src","WatchLater","Menu","anchorEl","handleMidiMenuClose","name","MenuItem","selected","get","_hsluv","TWO_PI","PI","n2","blendMode","ADD","keyTyped","obj","join","split","parseInt","_obj","_obj2","phase","x1","y1","drawWave","_ref2$phase","dt","sin","cos","line","clear","BLEND","RatioLightship","VF","Vex","Flow","Staff","_useVexFlow","context","setContext","renderer","Renderer","Backends","SVG","resize","getContext","useVexFlow","setStrokeStyle","setFillStyle","treble","Stave","addClef","addKeySignature","addTimeSignature","bass","StaveConnector","setType","BRACE","SINGLE_LEFT","pcSetOpts","lumatoneRows","lumatoneRowShift","layoutOpts","Tonnetz","_ref$rows","layoutKey","setLayoutKey","layout","pcSetKey","setPcSetKey","pcSet","l","isInPcSet","borderRadius","Hsluv","hsluv_h","hsluv_s","hsluv_l","hsluvToHex","Ukulele","Camera","primitive","look-controls","wasd-controls","acceleration","handleOsc","components","onOsc","instrument","vel","onTick","time","timeDelta","has","setAttribute","pitchClass","_ref2$darkened","darkened","_ref2$position","_ref2$scale","scale","material","blending","opacity","radius","radius-tubular","look-at","align","negate","transparent","ColtraneCircle","is180","setIs180","toggle","midiInPitchClasses","pickBy","values","sum","animation","c1","c2","verts","Dod","_ref$rep","rep","sat","_ref$stack","stack","_ref$n","events","click","PitchClassCollections","objectDestructuringEmpty","collEl","setCollEl","collRef","object3D","set","handleKeyup","colls","coll","rotation","theta","_ref5$s","PcSpiralWindController","noteToDimensions","midiInEl","setMidiInEl","prevMidiInDevice","useRef","current","usePrevious","velocity","_noteToDimensions","controller","_noteToDimensions2","midiInRef","audioContext","PitchClassSpiral","_ref$depthMax","depthMax","_ref$isAlwaysCounterC","isAlwaysCounterClockwise","_ref$rMax","rMax","_ref$rMin","rMin","_ref$noteRange","noteRange","_ref$pcsHighlighted","pcsHighlighted","detector","setDetector","pitchDetectEl","setPitchDetectEl","step","PitchDetector","interpolateFrequency","onDebug","stats","pitchDetector","detected","rms","ftomf","isFinite","minCorrelationIncrease","normalize","stopAfterDetection","minNote","maxNote","minPeriod","maxPeriod","destroy","pitchDetectRef","pick","end","visible","pcSpiralWindController","VR","path","match","react_router","component","camera","oculus-touch-controls","toOctave","intToRation","fraction","doWhenAframeLoaded","AFRAME","oscHost","host","location","hostname","port","secure","OSC","plugin","WebsocketClientPlugin","registerComponent","init","_onOscId","on","address","_ref$args","args","remove","off","_this2","_ref2$args","routes2d","ReactDOM","render","prefersDarkMode","useMediaQuery","dark","palette","active","primary","main","light","theme","useMemo","createMuiTheme","menuAnchorEl","setMenuAnchorEl","handleMenuClose","ThemeProvider","CssBaseline","react_router_dom","basename","process","exact","AppBar","Toolbar","esm_Menu","to","disabled","divider","url","_ref8","_ref9","midi","mic","querySelector"],"mappings":"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","file":"static/js/main.4784fcb8.chunk.js","sourcesContent":["import React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst cellSize = 30;\r\n\r\nconst Cell = withStyles({\r\n  root: {\r\n    fontSize: 20,\r\n    fontFamily: 'jetBrainsMono',\r\n    display: 'inline-flex',\r\n    height: cellSize,\r\n    width: cellSize,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    // border: '1px solid',\r\n  },\r\n  odd: {\r\n    left: cellSize / 2,\r\n    position: 'relative',\r\n  }\r\n})(({children, classes, className = '', isOdd, style}) => (\r\n  <div\r\n    className={`${classes.root} ${className} ${isOdd ? classes.odd : ''}`}\r\n    style={style}>\r\n    {children}\r\n  </div>\r\n));\r\n\r\nexport default Cell;\r\n","import _ from 'lodash';\r\nimport Cell from \"./cell\";\r\nimport React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst FretMarkers = withStyles({\r\n  fretMarker: {color: 'purple'}\r\n})(\r\n  ({classes: {fretMarker}, frets}) => _.range(_.last(frets) + 1)\r\n    .map(f => _.includes(frets, f) ? f : '')\r\n    .map((fret, ix) => <Cell className={fretMarker} key={ix}>{fret}</Cell>));\r\n\r\nexport default FretMarkers;\r\n","/**\r\n *\r\n * Michael L. Friedmann - https://yalebooks.yale.edu/book/9780300045376/ear-training-twentieth-century-music/\r\n * (Friedmann uses \"lev\" for 11)\r\n * @param note {number} integer - MIDI note\r\n * @param equalDivisions {number} integer - note % equalDivisions\r\n * @returns {number}\r\n */\r\nexport const toSolfege = (note, equalDivisions = 12) => ({\r\n  0: 'oh',\r\n  1: 'one',\r\n  2: 'two',\r\n  3: 'three',\r\n  4: 'four',\r\n  5: 'five',\r\n  6: 'six',\r\n  7: 'sev',\r\n  8: 'eight',\r\n  9: 'nine',\r\n  10: 'ten',\r\n  11: 'el',\r\n})[note % equalDivisions] || note % equalDivisions;\r\n\r\n/**\r\n *\r\n * @param note {number} integer - MIDI note\r\n * @param equalDivisions {number} integer - note % equalDivisions\r\n * @returns {number}\r\n */\r\nexport const toSymbol = (note, equalDivisions = 12) => ({\r\n  10: '૪',\r\n  11: 'Ɛ',\r\n})[note % equalDivisions] || note % equalDivisions;\r\n\r\n// ripped from Tone/core/Conversions\r\nexport const ftomf = (frequency) => {\r\n  return 69 + 12 * Math.log2(frequency / 440);\r\n}\r\n","import Cell from './cell';\r\nimport React from \"react\";\r\nimport {toSolfege, toSymbol} from \"./util\";\r\n\r\nconst PC = ({\r\n  classes,\r\n  isOdd,\r\n  isSolfege = false,\r\n  n,\r\n  style = isSolfege ? {\r\n    borderStyle: 'solid',\r\n    borderWidth: 1,\r\n    width: 70,\r\n  } : null,\r\n}) => (\r\n  <Cell\r\n    isOdd={isOdd}\r\n    style={style}\r\n  >\r\n    {isSolfege ? toSolfege(n) : toSymbol(n)}\r\n  </Cell>\r\n)\r\n\r\nexport default PC;\r\n","import _ from 'lodash';\r\nimport Cell from './cell';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [1,3,5,7,10,12,15,17,19];\r\n\r\nconst Banjo = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets} />\r\n    <br/>\r\n    {[0, 9, 5, 0, 0].map((pc0, pc0ix) => (\r\n      <React.Fragment key={pc0ix}>\r\n        {_.range(23)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) =>\r\n            pc0ix === 4 && ix < 5\r\n              ? <Cell key={ix}/>\r\n              : <PC key={ix} n={pc}/>\r\n          )}\r\n        <br/>\r\n      </React.Fragment>\r\n    ))}\r\n    <FretMarkers frets={frets} />\r\n  </div>\r\n);\r\n\r\nexport default Banjo;\r\n","import _ from 'lodash';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\n\r\nconst FrettedInstrument = ({ fretCount, fretMarkers, tuning }) => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={fretMarkers}/>\r\n    <br/>\r\n    {[...tuning]\r\n      .reverse() //mutates\r\n      .map((pc0, ixPc0) => (\r\n      <React.Fragment key={ixPc0}>\r\n        {_.range(fretCount + 1 /*for zeroth*/)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) => (\r\n            <PC key={ix} n={pc}/>\r\n          ))}\r\n        <br/>\r\n      </React.Fragment>\r\n    ))}\r\n    <FretMarkers frets={fretMarkers}/>\r\n  </div>\r\n);\r\n\r\nexport default FrettedInstrument;\r\n","import React from 'react';\r\nimport FrettedInstrument from './frettedInstrument';\r\n\r\nconst tunings = {\r\n  standard: [4, 9, 2, 7, 11, 4],\r\n  chelseaSessionsTuning: [0, 5, 0, 5, 9, 5],\r\n  octoberSongTuning: [0, 7, 0, 4, 7, 0],\r\n};\r\n\r\nconst tuning = tunings['standard'];\r\n\r\nconst Guitar = () => (\r\n  <FrettedInstrument\r\n    fretCount={24}\r\n    fretMarkers={[0, 5, 7, 12, 15, 17, 19, 24]}\r\n    tuning={tuning}\r\n  />\r\n)\r\n\r\nexport default Guitar;\r\n","import _ from 'lodash';\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst Intro = () => (\r\n  <div style={{height: '100%', overflowY: 'auto', padding: '20% 10%'}}>\r\n    <h1>musicality.computer</h1>\r\n\r\n    <h2>12ET pitch-class symbols:</h2>\r\n    <pre>{_.range(12).map(pc => <PC key={pc} n={pc}/>)}</pre>\r\n\r\n    <h3>12ET pitch-classes as solfege syllables:</h3>\r\n    {_.range(12).map(pc => <PC key={pc} isSolfege n={pc}/>)}\r\n  </div>\r\n);\r\n\r\nexport default Intro;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport { toSymbol } from \"./util\";\r\nimport PC from \"./pc\";\r\n\r\nconst MultTableMod12 = () => (\r\n  <>\r\n    {_.range(6).map(n => (\r\n      <div style={{\r\n        display: 'block',\r\n        flexShrink: 0,\r\n        margin: '1em',\r\n      }}>\r\n        {_.range(13).map(y => (\r\n          <>\r\n            {_.range(13).map(x => (\r\n              <PC key={x} n={n + x * y} />\r\n            ))}\r\n            <br />\r\n          </>\r\n        ))}\r\n\r\n      </div>\r\n    ))}\r\n  </>);\r\n\r\nexport default MultTableMod12;\r\n","import _ from 'lodash';\r\nimport React, { Component } from 'react';\r\nimport { toSymbol } from \"./util\";\r\n\r\nclass NumpadMod12 extends Component {\r\n  state = {\r\n    text: '',\r\n  };\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  handleKeyPress = (evt) => {\r\n    // console.log(evt.code)\r\n    const char = {\r\n      Backquote: '0',\r\n      Digit1: '1',\r\n      Digit2: '2',\r\n      Digit3: '3',\r\n      Digit4: '4',\r\n      Digit5: '5',\r\n      Digit6: '6',\r\n      Digit7: '7',\r\n      Digit8: '8',\r\n      Digit9: '9',\r\n      Digit0: '૪',\r\n      Minus: 'Ɛ',\r\n      Equal: '0',\r\n      Numpad0: '0',\r\n      Numpad1: '1',\r\n      Numpad2: '2',\r\n      Numpad3: '3',\r\n      Numpad4: '4',\r\n      Numpad5: '5',\r\n      Numpad6: '6',\r\n      Numpad7: '7',\r\n      Numpad8: '8',\r\n      Numpad9: '9',\r\n      NumpadDivide: '૪',\r\n      NumpadMultiply: 'Ɛ',\r\n      NumpadDecimal: ' ',\r\n      NumpadEnter: '\\n',\r\n      Enter: '\\n',\r\n      Space: ' ',\r\n    }[evt.code];\r\n\r\n    if (char) {\r\n      evt.preventDefault();\r\n      this.setState({ text: this.state.text + char });\r\n    }\r\n  };\r\n\r\n  handleChange = ({ target: { value }}) => this.setState({ text: value });\r\n\r\n  render() {\r\n    return <div>\r\n      <h3>Use the numpad to enter pitch classes</h3>\r\n      <textarea\r\n        cols={24}\r\n        rows={20}\r\n        onChange={this.handleChange}\r\n        style={{\r\n          background: 'black',\r\n          color: 'darkgray',\r\n          fontSize: 20,\r\n        }}\r\n        value={this.state.text}\r\n      />\r\n    </div>\r\n  }\r\n}\r\n\r\nexport default NumpadMod12;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport globalHook from 'use-global-hook';\r\n\r\nconst initialState = {\r\n  input: undefined,\r\n  inputDevices: [],\r\n  isMidiClockInSelectorOpen: false,\r\n  isMidiInSelectorOpen: false,\r\n  midiClockInDevice: undefined,\r\n  midiInDevice: undefined,\r\n  midiIn: _.zipObject(\r\n    _.range(128),\r\n    _.fill(new Array(128), 0)),\r\n};\r\n\r\nconst actions = {\r\n  setInputDevices: (store, inputDevices) =>\r\n    store.setState({inputDevices}),\r\n\r\n  setMidiEvent: (store, midiEvt) =>\r\n    store.setState({midiIn: _.merge(store.state.midiIn, midiEvt)}),\r\n\r\n  setMidiClockInDevice: (store, midiClockInDevice) => store.setState({midiClockInDevice}),\r\n\r\n  setMidiInDevice: (store, midiInDevice) => store.setState({midiInDevice}),\r\n\r\n  toggleMidiInSelector: (store) =>\r\n    store.setState({isMidiInSelectorOpen: !store.state.isMidiInSelectorOpen}),\r\n\r\n  // todo: only 1 selector\r\n  toggleMidiClockInSelector: (store) =>\r\n    store.setState({isMidiClockInSelectorOpen: !store.state.isMidiClockInSelectorOpen}),\r\n\r\n\r\n};\r\n\r\nexport default globalHook(React, initialState, actions);\r\n","import useMidi from \"./useMidi\";\r\nimport {useEffect} from \"react\";\r\n\r\nconst useMidiClock = (onClock, onStop, onSongPos) => {\r\n  const [{midiClockInDevice}, actions] = useMidi( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({midiClockInDevice}) => ({midiClockInDevice}),\r\n    actions => actions,\r\n  );\r\n\r\n  let tick = 0;\r\n\r\n  useEffect(() => {\r\n\r\n    const handleMidiClock = (evt) => {\r\n      tick++;\r\n      if (onClock) onClock({ tick });\r\n    };\r\n\r\n    const handleStop = (evt) => {\r\n      if (onStop) onStop();\r\n      console.log('stop')\r\n    };\r\n\r\n    const handleSpp = ({ data: [,lsb,msb] }) => {\r\n      const beats = (lsb + msb * 128) * 6;\r\n      console.log('SPP', beats);\r\n      if (onSongPos) onSongPos(beats);\r\n    };\r\n\r\n    if (midiClockInDevice) {\r\n      midiClockInDevice.addListener('clock', 'all', handleMidiClock);\r\n      // midiClockInDevice.addListener('start', 'all', handleStart); // wasn't getting called\r\n      midiClockInDevice.addListener('stop', 'all', handleStop);\r\n      midiClockInDevice.addListener('songposition', 'all', handleSpp);\r\n    }\r\n\r\n    return () => {\r\n      if (midiClockInDevice) {\r\n        midiClockInDevice.removeListener('clock', 'all', handleMidiClock);\r\n        midiClockInDevice.removeListener('stop', 'all', handleStop);\r\n        midiClockInDevice.removeListener('songposition', 'all', handleSpp);\r\n      }\r\n    }\r\n  }, [midiClockInDevice]);\r\n\r\n  return {\r\n    midiClockInDevice,\r\n    reset: () => {\r\n      tick = 0;\r\n    },\r\n  };\r\n};\r\n\r\nexport default useMidiClock;\r\n","import P5 from 'p5';\r\nimport {useCallback, useState} from \"react\";\r\n\r\nexport default (sketch, initialState) => {\r\n  const [sketchState, setSketchState] = useState(initialState);\r\n  const [sketchInstance, setSketchInstance] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  if (sketchInstance) {\r\n    sketchInstance.setState = setSketchState;\r\n    sketchInstance.state = sketchState;\r\n  }\r\n\r\n  const ref = useCallback((el) => {\r\n    if (el) {\r\n      const instance = new P5(sketch, el);\r\n      setSketchInstance(instance);\r\n\r\n      instance._height = el.clientHeight;\r\n      instance._width = el.clientWidth;\r\n\r\n      const ro = new ResizeObserver(([{contentRect: {height, width}}]) => {\r\n        instance.resizeCanvas(width, height);\r\n        if (width + height > 0) setSketchState((prevState) => ({...prevState, isRegenNeeded: true}));\r\n      });\r\n\r\n      setResizeObserver(ro);\r\n      ro.observe(el);\r\n    } else {\r\n      if (resizeObserver) resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n    ref,\r\n  };\r\n};\r\n","export function HSVtoHex(h, s, v) {\r\n  function rgbToHex({ r, g, b }) {\r\n    function componentToHex(c) {\r\n      var hex = c.toString(16);\r\n      return hex.length == 1 ? \"0\" + hex : hex;\r\n    }\r\n\r\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\r\n  }\r\n\r\n  var r, g, b, i, f, p, q, t;\r\n  if (arguments.length === 1) {\r\n    s = h.s;\r\n    v = h.v;\r\n    h = h.h;\r\n  }\r\n  i = Math.floor(h * 6);\r\n  f = h * 6 - i;\r\n  p = v * (1 - s);\r\n  q = v * (1 - f * s);\r\n  t = v * (1 - (1 - f) * s);\r\n  switch (i % 6) {\r\n    case 0: {\r\n      r = v;\r\n      g = t;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 1: {\r\n      r = q;\r\n      g = v;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 2: {\r\n      r = p;\r\n      g = v;\r\n      b = t;\r\n      break;\r\n    }\r\n    case 3: {\r\n      r = p;\r\n      g = q;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 4: {\r\n      r = t;\r\n      g = p;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 5: {\r\n      r = v;\r\n      g = p;\r\n      b = q;\r\n      break;\r\n    }\r\n  }\r\n  return rgbToHex({\r\n    r: Math.round(r * 255),\r\n    g: Math.round(g * 255),\r\n    b: Math.round(b * 255)\r\n  });\r\n}","import _ from 'lodash';\r\n\r\n\r\n/* TODO\r\n* high prio\r\n  * fine-tune freq\r\n  * don't require redraw on freq change\r\n  * params bound to urlParams\r\n  * option to auto-choose fundamentalFreq\r\n    based on which partials are present\r\n    to center around 500 - 1000hz\r\n  * MIDI beat clock\r\n  * spiral of any length instead of hilbert\r\n\r\n* med prio\r\n  * for hilbertN of 256 or 512, use the vals to fill an audio buffer and play the ~1 or ~5s of audio\r\n  * utonal partials\r\n\r\n* low prio\r\n  * option to add a second cursor for stereo effects\r\n  * alternate space-filling curves\r\n  * keep cursor in same location when switching resolutions\r\n  * manual cursor\r\n* */\r\n\r\n// Only add setZeroTimeout to the window object, and hide everything\r\n// else in a closure.\r\n(function() {\r\n  var timeouts = [];\r\n  var messageName = \"zero-timeout-message\";\r\n\r\n  // Like setTimeout, but only takes a function argument.  There's\r\n  // no time argument (always zero) and no arguments (you have to\r\n  // use a closure).\r\n  function setZeroTimeout(fn) {\r\n    timeouts.push(fn);\r\n    window.postMessage(messageName, \"*\");\r\n  }\r\n\r\n  function handleMessage(event) {\r\n    if (event.source == window && event.data == messageName) {\r\n      event.stopPropagation();\r\n      if (timeouts.length > 0) {\r\n        var fn = timeouts.shift();\r\n        fn();\r\n      }\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"message\", handleMessage, true);\r\n\r\n  // Add the one thing we want added to the window object.\r\n  window.setZeroTimeout = setZeroTimeout;\r\n})();\r\n\r\n\r\nexport const initialState = {\r\n  audioPan: 0, // -1 - 1\r\n  decayDuration: 1000,\r\n  exciteEnergy: 0.05,\r\n  exciteDuration: 50,\r\n  fundamentalFreq: 200,\r\n  hilbertN: 64, // hilbertN must be power of 2 in order to be square\r\n  hilbMand: [/*{ x, y, m }*/], // coordinates and associated mandelbrot val in hilbert traversal order\r\n  isControlPanelOpen: true,\r\n  isPlaying: false,\r\n  isRegenNeeded: true,\r\n  maxIters: 4096, // max number of steps to recurse the mandelbrot fn\r\n  midiClock: 0,\r\n  midiClocksPerTick: 24,\r\n  panX: -0.05,\r\n  panY: 0,\r\n  partials: {/* partial: { amp, oscIdx } */}, // the collection is updated in setState but values within are changed in drawLoop directly\r\n  partialsCountMax: 16,\r\n  isSmooth: false, // smooth technique https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n  tick: 0, // updated in draw() bypasses setState\r\n  tickDuration: 100,\r\n  tickLastMillis: 0, // updated in draw() bypasses setState\r\n  zoom: 1.2,\r\n\r\n  // zoom: 3603.7157567397, panX: 0.18580280974577668, panY: 0.00036930706052212803,\r\n\r\n  // floating point errors here\r\n  // zoom: 279919582741326.66, panX: -0.014853203736137617, panY: 0.13451319076043783,\r\n\r\n  // panX: 0.0011548427778035686,\r\n  // panY: 0.025033026937542575,\r\n  // zoom: 319852972190.0951,\r\n  //\r\n  // panX: -0.18498767183730766,\r\n  // panY: 0.4722205531430409,\r\n  // zoom: 419013953.31772846,\r\n  //\r\n  //\r\n  // decay: 0.000075,\r\n  // exciteEnergy: 0.006,\r\n  // fundamentalFreq: 10,\r\n  // hilbertN: 256,\r\n  // maxIters: 4096,\r\n  // panX: 0.0011503007796323155,\r\n  // panY: 0.025033026938902938,\r\n  // tickDuration: 10,\r\n  // zoom: 836635.9887997985,\r\n  //\r\n  //\r\n  //\r\n  // panX: 0.08871194014553094,\r\n  // panY: -0.12829271146701177,\r\n  // zoom: 19736096.460687958,\r\n\r\n  // ...{zoom: 39422433.84662852, panX: 0.04670942760989286, panY: 0.13656218122372943},\r\n\r\n  // demo for 10 partials\r\n  // ...{zoom: 12371177.464729108, panX: 0.04671008941233588, panY: 0.13656133340058238},\r\n};\r\n\r\nlet audioCtx = new AudioContext();\r\nlet oscs = [];\r\n\r\nconst masterGain = audioCtx.createGain();\r\nconst audioPanner = audioCtx.createStereoPanner();\r\nwindow.masterGain = masterGain;\r\nmasterGain.gain.value = 1;\r\nmasterGain.connect(audioPanner);\r\naudioPanner.connect(audioCtx.destination);\r\n\r\n\r\nexport const sketch = (p5) => {\r\n  p5.state = initialState;\r\n\r\n  /* Border size and color */\r\n  const CURSOR_STROKE_COLOR_SEPARATION = 20;\r\n  const CURSOR_ALPHA = 0.7;\r\n  const STROKE_WEIGHT_COEF = 1;\r\n  const STROKE_COLOR = 0;\r\n\r\n  const setupOscillators = () => {\r\n    oscs.forEach(({osc, gain}) =>\r\n    {\r\n      osc.stop();\r\n    }); // TODO: gain.disconnect? delete osc and gain?\r\n\r\n    oscs = _.range(p5.state.partialsCountMax).map(() => {\r\n      const osc = audioCtx.createOscillator();\r\n      const gain = audioCtx.createGain();\r\n      gain.gain.value = 0;\r\n      osc.connect(gain);\r\n      gain.connect(masterGain);\r\n      osc.start();\r\n      return {osc, gain};\r\n    });\r\n\r\n    window.oscs = oscs;\r\n  }\r\n\r\n  //rotate/flip a quadrant appropriately\r\n  const hilbGetRotatedVec = (n, v, rx, ry) => {\r\n    if (ry === 0) {\r\n      if (rx === 1) {\r\n        v.x = n - 1 - v.x;\r\n        v.y = n - 1 - v.y;\r\n      }\r\n\r\n      //Swap x and y\r\n      let temp = v.x;\r\n      v.x = v.y;\r\n      v.y = temp;\r\n    }\r\n  }\r\n\r\n  const hilbDistanceToCoords = (hilbertN, dist) => {\r\n    //    TODO: get distanceToVector based on percentage of maxD so that the Hilbert cursor stays in the same place when changing Hilbert resolutions\r\n    //    TODO: also click the screen to set the cursor so need amp function to convert x,y to hilbert distance\r\n\r\n    const v = {x: 0, y: 0};\r\n    // _(size)\r\n    //   .range()\r\n    //   .map(v => Math.pow(2, v))\r\n    //   .takeWhile(v => v < size)\r\n    //   .value()\r\n\r\n    for (let s = 1; s < hilbertN; s *= 2) {\r\n      let rx = 1 & (dist / 2);\r\n      let ry = 1 & (dist ^ rx);\r\n      hilbGetRotatedVec(s, v, rx, ry);\r\n      v.x += s * rx;\r\n      v.y += s * ry;\r\n      dist /= 4;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  /**\r\n   * Returns amp {@code Vec} representing the Euclidian coordinates of the given normalized \"Mandelbrot coordinates\"\r\n   * <br>Mandelbrot X scale: -2.5 to 1\r\n   * <br>Mandelbrot Y scale: -1 to 1\r\n   * @param x normalized x coordinate 0 to 1.0\r\n   * @param y normalized y coordinate 0 to 1.0\r\n   * @return\r\n   */\r\n  const mandGetDenormalizedCoords = (x, y) => ({\r\n    x: -2.5 + x * 3.5,\r\n    y: -1 + y * 2,\r\n  })\r\n\r\n\r\n  /**\r\n   * Returns the number of iterations to escape the Mandelbrot set at the given coordinates\r\n   * @param scaledX\r\n   * @param scaledY\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetVal = (scaledX, scaledY, maxIterations) => {\r\n    let x = 0, y = 0;\r\n    let iter = 0;\r\n\r\n    while (x * x + y * y < 4 && iter < maxIterations) {\r\n      let xTemp = x * x - y * y + scaledX;\r\n      y = 2 * x * y + scaledY;\r\n      x = xTemp;\r\n      iter++;\r\n    }\r\n    return iter;\r\n  }\r\n\r\n\r\n  const dot = (v1, v2) => _.reduce(v1, (acc, val, idx) => acc + val * v2[idx], 0);\r\n\r\n  /**\r\n   * https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n   * @param cx\r\n   * @param cy\r\n   * @param maxIterations\r\n   * @returns {*|number}\r\n   */\r\n  const mandGetValSmooth = (cx, cy, maxIterations) => {\r\n    const Bsq = 256 * 256;\r\n    const z = [0,0];\r\n    let n = 0;\r\n    let x, y;\r\n\r\n    for (let i = 0; i < maxIterations; i++) {\r\n      [x, y] = z;\r\n      z[0] = x * x - y * y + cx;\r\n      z[1] = 2 * x * y + cy;\r\n      if (dot(z, z) > Bsq) break;\r\n      n++;\r\n    }\r\n\r\n    // return n - Math.log(Math.log(Math.sqrt(z[0] * z[0] + z[1] * z[1]) / Math.log(B) / Math.log(2)))\r\n    return n >= maxIterations\r\n      ? maxIterations\r\n      : n - Math.log2(Math.log2(dot(z,z))) + 4;\r\n  }\r\n\r\n  /**\r\n   * Returns the number of iterations required to escape the Mandelbrot set at the given coordinates\r\n   * @param xN normalized x coordinate 0 to 1.0\r\n   * @param yN normalized y coordinate 0 to 1.0\r\n   * @param panX < 0 pans left. > 0 pans right\r\n   * @param panY < 0 pans up. > 0 pans down\r\n   * @param zoom 1.0 is unzoomed\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetValFromNormalizedCoords = (xN, yN, panX, panY, zoom, maxIterations) => {\r\n    let x1 = 0.5 - panX + (xN - 0.5) / zoom;\r\n    let y1 = 0.5 - panY + (yN - 0.5) / zoom;\r\n    const {x, y} = mandGetDenormalizedCoords(x1, y1);\r\n    return p5.state.isSmooth\r\n      ? mandGetValSmooth(x, y, maxIterations)\r\n      : mandGetVal(x, y, maxIterations);\r\n  }\r\n\r\n  const genHilbertCoords = _.memoize((hilbertN) =>\r\n    _.range(hilbertN * hilbertN)\r\n      .map(d => hilbDistanceToCoords(hilbertN, d)));\r\n\r\n\r\n  const genHilbertMandelbrot = () => {\r\n    const {\r\n      hilbertN,\r\n      maxIters,\r\n      panX,\r\n      panY,\r\n      partialsCountMax,\r\n      zoom,\r\n    } = p5.state;\r\n\r\n\r\n    return genHilbertCoords(hilbertN).map(({ x, y }) => {\r\n      const m = mandGetValFromNormalizedCoords(x / hilbertN, y / hilbertN, panX, panY, zoom, maxIters);\r\n      return {\r\n        x,\r\n        y,\r\n        m,\r\n        p: m === maxIters\r\n          ? 0 // to be filtered out\r\n          : Math.floor(((m - 1) % partialsCountMax) + 1),\r\n      };\r\n    })\r\n  };\r\n\r\n  const getStrokeWeight = (w) => {\r\n    const sideLength = w / p5.state.hilbertN;\r\n    return STROKE_WEIGHT_COEF * Math.min(10, sideLength / 20);\r\n  };\r\n\r\n  const getPartialOfOctaveStart = _.memoize((f) =>\r\n    _(100)\r\n      .range()\r\n      .map(n => Math.pow(2, n))\r\n      .dropWhile(n => f / n >= 2)\r\n      .first());\r\n\r\n  const getColorForMandelbrotVal = ({m, p}, isCursor = false) => {\r\n    const {\r\n      maxIters,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    const octMax = getPartialOfOctaveStart(partialsCountMax);\r\n    const oct = getPartialOfOctaveStart(p);\r\n\r\n    // good looks with smooth but not relevant to partials\r\n    // const h = (m * 10) % 255;\r\n    // const s = isCursor ? 0 : 255 - (m / maxIters) * 225  //(p / partialsCountMax) * 225;\r\n\r\n    const h = 255 * Math.log2(p / oct);\r\n    const s = isCursor ? 0 : 255 - Math.pow(oct / octMax, 2) * 225  //(p / partialsCountMax) * 225;\r\n    const b = isCursor\r\n      ? 255\r\n      : m === maxIters ? 0\r\n        : 30 + Math.pow(oct / octMax, 2) * 225;\r\n\r\n    return p5.color(h, s, b, isCursor ? CURSOR_ALPHA : 255);\r\n  };\r\n\r\n  const setFillColorForMandelbrotVal = (coordsWithVal, isCursor = false) => {\r\n    p5.fill(getColorForMandelbrotVal(coordsWithVal, isCursor));\r\n  }\r\n\r\n  const drawHilbertCoord = (w, h, hilbertCoord, hilbertN) => {\r\n    const scaleX = w / hilbertN;\r\n    const scaleY = h / hilbertN;\r\n    p5.rect(hilbertCoord.x * scaleX, hilbertCoord.y * scaleY, scaleX, scaleY);\r\n    // p5.circle(hilbertCoord.x * scaleX + scaleX / 2, hilbertCoord.y * scaleY + scaleY / 2, scaleX);\r\n  }\r\n\r\n  const drawHilbertMandelbrot = (w, h, state) => {\r\n    const {\r\n      hilbertN,\r\n      hilbMand,\r\n    } = state;\r\n\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n    p5.strokeWeight(strokeWeight);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    const s = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n\r\n    hilbMand.forEach((coordWithVal, d) => {\r\n      setFillColorForMandelbrotVal(coordWithVal);\r\n\r\n      p5.push();\r\n      {\r\n        p5.translate(p5.width / 4, 0);\r\n        drawHilbertCoord(w, h, coordWithVal, hilbertN);\r\n      }\r\n      p5.pop();\r\n\r\n      p5.push(); // TODO: is it more expensive to push/pop 1000 times or iterate over hilbMand twice?\r\n      {\r\n        p5.translate((p5.width / 4) * 3, 0);\r\n        drawLinearizedMandelbrotCoord(p5.width / 4, s, d);\r\n      }\r\n      p5.pop();\r\n    })\r\n  };\r\n\r\n  const getSideLengthForLinearizedMap = (dMax, w, h) => {\r\n    const maxA = w * h;\r\n    const largestPossibleSide = Math.sqrt(maxA / dMax);\r\n\r\n    let s = 0;\r\n    for (let i = 1; i < w; i++) {\r\n      s = w / i;\r\n      if (s > largestPossibleSide) {\r\n        continue;\r\n      }\r\n\r\n      const sqPerRow = w / s;\r\n      const rows = dMax / sqPerRow;\r\n      const leftover = dMax % sqPerRow;\r\n\r\n      if (rows * s + (leftover > 0 ? s : 0) <= h) {\r\n        break;\r\n      }\r\n    }\r\n    return s;\r\n  }\r\n\r\n  const drawLinearizedMandelbrotCoord = (w, s, d) => {\r\n    const valsPerRow = w / s;\r\n\r\n    let x = d % valsPerRow;\r\n    const y = Math.floor(d / valsPerRow);\r\n\r\n    // snake around instead of starting from the left for each row\r\n    if (y % 2 === 1) {\r\n      x = valsPerRow - (x + 1);\r\n    }\r\n\r\n    p5.rect(x * s, y * s, s, s);\r\n  }\r\n\r\n  const genAndDrawHilbertMandelbrot = () => {\r\n    p5.background(32);\r\n\r\n    // fade out. this can probably move to partials _.each\r\n    oscs.forEach(({gain}) => {\r\n      gain.gain.cancelScheduledValues(audioCtx.currentTime);\r\n      gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);\r\n    })\r\n\r\n    const {\r\n      fundamentalFreq,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    if (oscs.length !== partialsCountMax) {\r\n      setupOscillators(); // TODO: fade out first\r\n    }\r\n\r\n    const hilbMand = genHilbertMandelbrot();\r\n\r\n    const partials = _(hilbMand)\r\n      .map(({p}) => p)\r\n      .filter(_.identity) // maxIters (black) are set as p: 0\r\n      .uniq()\r\n      .sort()\r\n      .take(partialsCountMax)\r\n      .map((partial, i) => [partial, {amp: 0, oscIdx: i}])\r\n      .fromPairs()\r\n      .value();\r\n\r\n    // slide to new freqs if partials change\r\n    _.each(partials, ({decayTimerId, oscIdx, zeroGainTimerId}, partial) => {\r\n      clearTimeout(decayTimerId);\r\n      clearTimeout(zeroGainTimerId);\r\n      oscs[oscIdx].osc.frequency.cancelScheduledValues(audioCtx.currentTime);\r\n      oscs[oscIdx].osc.frequency.linearRampToValueAtTime(partial * fundamentalFreq, audioCtx.currentTime + 1);\r\n    });\r\n\r\n    p5.setState(prevState => {\r\n      const nextState = {\r\n        ...prevState,\r\n        hilbMand,\r\n        isRegenNeeded: false,\r\n        partials,\r\n      };\r\n      drawHilbertMandelbrot( p5.width / 2, p5.height, nextState);\r\n      return nextState;\r\n    });\r\n  }\r\n\r\n\r\n  const cursorErasePrev = (maxD, s, prevD) => {\r\n    const {hilbMand} = p5.state;\r\n    const prevCoordAndVal = hilbMand[prevD % maxD];\r\n\r\n    setFillColorForMandelbrotVal(prevCoordAndVal);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, prevCoordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, s, prevD);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  let prevD = 0;\r\n  const cursorDraw = (id) => {\r\n    const {hilbMand} = p5.state;\r\n    const d = p5.state.tick % hilbMand.length;\r\n    const coordAndVal = hilbMand[d];\r\n    const sideLength = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n\r\n    p5.strokeWeight(strokeWeight);\r\n    cursorErasePrev(hilbMand.length, sideLength, prevD);\r\n    prevD = d; // maybe multiple ticks per frame when external time sync\r\n    p5.stroke((CURSOR_STROKE_COLOR_SEPARATION * id) % 255, 0, 255);\r\n    setFillColorForMandelbrotVal(coordAndVal, true);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, coordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, sideLength, d);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  const cursorExcite = (id) => {\r\n    const {\r\n      audioPan,\r\n      decayDuration,\r\n      exciteEnergy,\r\n      exciteDuration,\r\n      hilbMand,\r\n      partials,\r\n      tick,\r\n    } = p5.state;\r\n\r\n    audioPanner.pan.value = audioPan;\r\n\r\n    const d = tick % hilbMand.length;\r\n    const {p} = hilbMand[d];\r\n\r\n    if (p > 0) {\r\n      const partial = partials[p];\r\n      const {\r\n        amp,\r\n        decayTimerId,\r\n        oscIdx,\r\n        zeroGainTimerId,\r\n      } = partial;\r\n      const {gain} = oscs[oscIdx];\r\n\r\n      const isExcited = _.isNumber(decayTimerId);\r\n      const currGain = isExcited ? amp : gain.gain.value;\r\n\r\n      // console.log(p, currGain);\r\n\r\n      const targetGain = 0.8 * Math.min(1, currGain + exciteEnergy * (1 - currGain));\r\n      partial.amp = targetGain;\r\n\r\n      clearTimeout(decayTimerId); // further delay the decay\r\n      clearTimeout(zeroGainTimerId); // don't reset amp to zero\r\n      gain.gain.cancelScheduledValues(0);\r\n      gain.gain.linearRampToValueAtTime(targetGain, audioCtx.currentTime + exciteDuration / 1000);\r\n\r\n      partial.decayTimerId = setTimeout(() => {\r\n        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + decayDuration / 1000);\r\n        partial.decayTimerId = null;\r\n\r\n        partial.zeroGainTimerId = setTimeout(() => {\r\n          partial.amp = 0;\r\n        }, decayDuration)\r\n      }, exciteDuration);\r\n    }\r\n  }\r\n\r\n  const partialsDraw = () => {\r\n    const h = p5.height;\r\n    const w = p5.width / 4;\r\n\r\n    p5.noStroke();\r\n\r\n    const { partials, partialsCountMax } = p5.state;\r\n\r\n    _.each(partials, ({ amp: targetAmp, oscIdx }, p) => {\r\n      const barH = h / partialsCountMax;\r\n      const y = h * ((p - 1) / partialsCountMax);\r\n      const barW = oscs[oscIdx].gain.gain.value * w;\r\n\r\n      const c = getColorForMandelbrotVal({ m: 1, p})\r\n      p5.fill(p5.color(p5.hue(c), 255, 8));\r\n      p5.rect(0, y, w, barH);\r\n\r\n      p5.fill(c);\r\n      p5.rect(0, y, barW, barH);\r\n      p5.fill(255);\r\n      p5.rect(targetAmp * w, y, 1, barH);\r\n    })\r\n\r\n  }\r\n\r\n  let wasPaused = true;\r\n  const pauseScreenDraw = () => {\r\n    if (!p5.state.isPlaying && !p5.state.isControlPanelOpen) {\r\n      wasPaused = true;\r\n      p5.background(0, 0.1);\r\n      p5.noFill();\r\n      p5.stroke(192, 127, 90);\r\n      p5.textSize(10);\r\n      p5.text('arrow keys to move', 0, p5.height / 2 - 50, p5.width, p5.height);\r\n      p5.text('shift+arrow for zoom/resolution', 0, p5.height / 2 - 35, p5.width, p5.height);\r\n      p5.text('shift+spacebar toggle controls', 0, p5.height / 2 - 20, p5.width, p5.height);\r\n      p5.textSize(20);\r\n      p5.textAlign(p5.CENTER);\r\n      p5.text('spacebar to start', 0, p5.height / 2, p5.width, p5.height);\r\n    } else {\r\n      if (wasPaused) {\r\n        partialsDraw();\r\n        drawHilbertMandelbrot(p5.width / 2, p5.height, p5.state);\r\n        wasPaused = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  let font;\r\n  p5.preload = () => {\r\n    font = p5.loadFont('JetBrainsMono-Regular.ttf');\r\n  }\r\n\r\n  p5.setup = () => {\r\n    p5.createCanvas(p5._width, p5._height);\r\n    p5.colorMode(p5.HSB);\r\n    p5.textFont(font);\r\n    p5.incrementTick();\r\n  }\r\n\r\n  p5.incrementTick = (isExternal = false) => {\r\n    const now = p5.millis();\r\n    const {\r\n      isPlaying,\r\n      isRegenNeeded,\r\n      midiClocksPerTick,\r\n      tickDuration,\r\n      tickLastMillis,\r\n    } = p5.state;\r\n\r\n    if (isExternal) {\r\n      p5.state.midiClock++;\r\n    }\r\n\r\n    const isReady = !isRegenNeeded && (isExternal\r\n      ? p5.state.midiClock % midiClocksPerTick === 0\r\n      : isPlaying && now > tickLastMillis + tickDuration);\r\n\r\n    if (isReady) {\r\n      p5.state.tick++;\r\n      p5.state.tickLastMillis = now;\r\n      cursorExcite(0);\r\n    }\r\n\r\n    if (!isExternal && p5.state.midiClock === 0) window.setZeroTimeout(p5.incrementTick)\r\n  }\r\n\r\n  let prevTick = 0;\r\n  p5.draw = () => {\r\n    const {\r\n      isPlaying,\r\n      isRegenNeeded,\r\n      midiClock,\r\n    } = p5.state;\r\n\r\n    if (isRegenNeeded) {\r\n      genAndDrawHilbertMandelbrot();\r\n    }\r\n\r\n    // if (midiClock === 0) p5.incrementTick();\r\n\r\n    if (_.every([\r\n      !isRegenNeeded,\r\n      p5.state.tick !== prevTick,\r\n    ])) {\r\n      cursorDraw(0);\r\n      prevTick = p5.state.tick;\r\n    }\r\n\r\n    if (isPlaying) partialsDraw();\r\n\r\n    pauseScreenDraw();\r\n  }\r\n\r\n  /**\r\n   * This needs to be called by a user event handler.\r\n   * @param isPlaying\r\n   */\r\n  p5.toggleAudio = () => {\r\n    p5.setState(prevState => {\r\n      const { isPlaying } = prevState;\r\n      if (!isPlaying && audioCtx.state !== 'running') {\r\n        audioCtx.resume();\r\n      }\r\n\r\n      if (isPlaying && audioCtx.state === 'running') {\r\n        audioCtx.suspend();\r\n      }\r\n\r\n      return { ...prevState, isPlaying: !prevState.isPlaying };\r\n    });\r\n\r\n  }\r\n}\r\n","import CircularSlider from '@fseehawer/react-circular-slider';\r\nimport KeyboardArrowDownOutlinedIcon from '@material-ui/icons/KeyboardArrowDownOutlined';\r\nimport KeyboardArrowLeftOutlinedIcon from '@material-ui/icons/KeyboardArrowLeftOutlined';\r\nimport KeyboardArrowRightOutlinedIcon from '@material-ui/icons/KeyboardArrowRightOutlined';\r\nimport KeyboardArrowUpOutlinedIcon from '@material-ui/icons/KeyboardArrowUpOutlined';\r\nimport PauseCircleOutlineIcon from '@material-ui/icons/PauseCircleOutline';\r\nimport PlayCircleOutlineIcon from '@material-ui/icons/PlayCircleOutline';\r\nimport React, {useEffect, useState} from 'react';\r\nimport TuneIcon from '@material-ui/icons/Tune';\r\nimport ViewComfyOutlinedIcon from '@material-ui/icons/ViewComfyOutlined';\r\nimport ViewModuleOutlinedIcon from '@material-ui/icons/ViewModuleOutlined';\r\nimport ZoomInOutlinedIcon from '@material-ui/icons/ZoomInOutlined';\r\nimport ZoomOutOutlinedIcon from '@material-ui/icons/ZoomOutOutlined';\r\nimport _ from 'lodash';\r\nimport useMidiClock from \"./useMidiClock\";\r\nimport useP5 from './useP5';\r\nimport { HSVtoHex } from './color';\r\nimport { initialState, sketch } from \"./mandelbrotP5\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport {Button, ButtonGroup, Drawer} from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles({\r\n  paper: {\r\n    background: \"rgba(0,0,0,0.7)\",\r\n    paddingBottom: 65,\r\n  }\r\n});\r\n\r\nconst getHandleAction = (sketchInstance) => (action) => () => {\r\n  if (action === 'toggleAudio') {\r\n    sketchInstance.toggleAudio();\r\n    return;\r\n  }\r\n\r\n  sketchInstance.setState(prevState => {\r\n    const {\r\n      hilbertN,\r\n      isControlPanelOpen,\r\n      isRegenNeeded,\r\n      panX,\r\n      panY,\r\n      zoom,\r\n    } = prevState;\r\n    const panDelta = 0.1 / zoom;\r\n\r\n    const nextState = {\r\n      moveLeft: {panX: panX + panDelta},\r\n      moveRight: {panX: panX - panDelta},\r\n      moveUp: {panY: panY + panDelta},\r\n      moveDown: {panY: panY - panDelta},\r\n      resDec: {hilbertN: Math.pow(2, Math.log2(hilbertN) - 1)},\r\n      resInc: {hilbertN: Math.min(256, Math.pow(2, Math.log2(hilbertN) + 1))},\r\n      toggleControlPanel: {isControlPanelOpen: !isControlPanelOpen, isRegenNeeded},\r\n      zoomIn: {zoom: zoom * (10 / 9)},\r\n      zoomOut: {zoom: zoom * (9 / 10)},\r\n    }[action];\r\n\r\n    return {\r\n      ...prevState,\r\n      isRegenNeeded: !_.isEmpty(nextState),\r\n      ...nextState,\r\n    };\r\n  })\r\n};\r\n\r\nconst handleKeyDown = (handleAction) => (evt) => {\r\n  // console.log(evt);\r\n  const {code, shiftKey, key} = evt;\r\n\r\n  if (code === 'Space') {\r\n    handleAction(shiftKey ? 'toggleControlPanel' : 'toggleAudio')();\r\n    return;\r\n  }\r\n\r\n  const getAction = {\r\n    'ArrowDown': () => shiftKey ? 'zoomOut' : 'moveDown',\r\n    'ArrowLeft': () => shiftKey ? 'resDec' : 'moveLeft',\r\n    'ArrowRight': () => shiftKey ? 'resInc' : 'moveRight',\r\n    'ArrowUp': () => shiftKey ? 'zoomIn' : 'moveUp',\r\n  }[key];\r\n\r\n  if (getAction) handleAction(getAction())();\r\n};\r\n\r\nconst Mandelbrot = () => {\r\n  const {\r\n    ref,\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n  } = useP5(sketch, initialState);\r\n\r\n  window.sketchInstance = sketchInstance;\r\n\r\n  const handleAction = getHandleAction(sketchInstance);\r\n\r\n  useEffect(() => {\r\n    document.title = 'Mandelbrot Muse';\r\n    if (sketchInstance) {\r\n      const handler = handleKeyDown(handleAction);\r\n      window.addEventListener('keydown', handler)\r\n      return () => { // cleanup\r\n        window.removeEventListener('keydown', handler);\r\n      };\r\n    }\r\n  }, [sketchInstance]);\r\n\r\n  const {midiClockInDevice} = useMidiClock(() => {\r\n    if (sketchInstance) {\r\n      if (!sketchInstance.state.isPlaying) {\r\n        setSketchState(state => ({\r\n          ...state,\r\n          isPlaying: true,\r\n        }));\r\n      }\r\n      sketchInstance.incrementTick(true);\r\n    }\r\n  }, () => {\r\n    setSketchState(state => ({\r\n      ...state,\r\n      isPlaying: false,\r\n    }));\r\n  }, (beat) => {\r\n    if (sketchInstance) {\r\n      const { midiClocksPerTick } = sketchInstance.state;\r\n      sketchInstance.state.midiClock = beat;\r\n      sketchInstance.state.tick = Math.floor(beat / midiClocksPerTick);\r\n    }\r\n  });\r\n\r\n  return (<>\r\n    <div\r\n      ref={ref}\r\n      style={{\r\n        alignSelf: 'start',\r\n        background: 'radial-gradient(circle, rgba(74,153,117,1) 0%, rgba(188,148,233,0.6943726953672094) 100%)',\r\n        height: '50vw',\r\n        width: '100vw',\r\n      }}\r\n    />\r\n\r\n    <div style={{\r\n      bottom: 10,\r\n      right: 10,\r\n      padding: 0,\r\n      position: 'absolute',\r\n      textAlign: 'center',\r\n      zIndex: 1000000,\r\n    }}>\r\n      {!sketchState.isControlPanelOpen && (\r\n        <Button onClick={handleAction('toggleControlPanel')}>\r\n          show\r\n          <TuneIcon/>\r\n          controls\r\n        </Button>\r\n      )}\r\n\r\n      <Drawer\r\n        anchor=\"bottom\"\r\n        classes={useStyles()}\r\n        color=\"transparent\"\r\n        open={sketchState.isControlPanelOpen}\r\n        onClose={handleAction('toggleControlPanel')}\r\n        variant=\"persistent\"\r\n\r\n        // onMouseEnter={ev => { ev.currentTarget.style.opacity = 1 }}\r\n        // onMouseLeave={ev => { ev.currentTarget.style.opacity = 0.5 }}\r\n      >\r\n        <ButtonGroup fullWidth size=\"large\">\r\n          <Button onClick={handleAction('toggleAudio')}>\r\n            {!sketchState.isPlaying ? <PlayCircleOutlineIcon /> : <PauseCircleOutlineIcon />}\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('toggleControlPanel')}>\r\n            hide controls\r\n          </Button>\r\n        </ButtonGroup>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n\r\n          <Button onClick={handleAction('resDec')}>\r\n            <ViewModuleOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveUp')}>\r\n            <KeyboardArrowUpOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('resInc')}>\r\n            <ViewComfyOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('zoomIn')}>\r\n            <ZoomInOutlinedIcon/>\r\n          </Button>\r\n\r\n        </ButtonGroup>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n\r\n          <Button onClick={handleAction('moveLeft')}>\r\n            <KeyboardArrowLeftOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveDown')}>\r\n            <KeyboardArrowDownOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveRight')}>\r\n            <KeyboardArrowRightOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('zoomOut')}>\r\n            <ZoomOutOutlinedIcon/>\r\n          </Button>\r\n\r\n        </ButtonGroup>\r\n\r\n        <br/>\r\n\r\n        <FreqSlider\r\n          initialVal={60}\r\n          isRegenRequired\r\n          label=\"Fundamental frequency (Hz)\"\r\n          stateKey={\"fundamentalFreq\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n\r\n\r\n        <div style={{\r\n          display: 'flex',\r\n          flexWrap: 'wrap',\r\n          justifyContent: 'space-around',\r\n        }}>\r\n\r\n          <FreqSlider\r\n            initialVal={16}\r\n            isInt\r\n            isRegenRequired\r\n            label=\"Number of partials\"\r\n            max={1024}\r\n            min={1}\r\n            precision={1}\r\n            setSketchState={setSketchState}\r\n            size={120}\r\n            sketchState={sketchState}\r\n            stateKey={\"partialsCountMax\"}\r\n          />\r\n\r\n          <FreqSlider\r\n            initialVal={4096}\r\n            isInt\r\n            isRegenRequired\r\n            label=\"Mandelbrot iterations\"\r\n            max={8192}\r\n            min={64}\r\n            setSketchState={setSketchState}\r\n            size={120}\r\n            sketchState={sketchState}\r\n            stateKey={\"maxIters\"}\r\n          />\r\n\r\n          {midiClockInDevice ? (\r\n            <FreqSlider\r\n              key={midiClockInDevice}\r\n              isInt\r\n              min={1}\r\n              max={1024}\r\n              initialVal={24}\r\n              label=\"MIDI clocks per tick\"\r\n              size={120}\r\n              stateKey={\"midiClocksPerTick\"}\r\n              sketchState={sketchState}\r\n              setSketchState={setSketchState}\r\n            />\r\n          ) : (\r\n            <FreqSlider\r\n              key={midiClockInDevice}\r\n              initialVal={100}\r\n              label=\"Tick duration (ms)\"\r\n              size={120}\r\n              stateKey={\"tickDuration\"}\r\n              sketchState={sketchState}\r\n              setSketchState={setSketchState}\r\n            />\r\n          )}\r\n\r\n          <FreqSlider\r\n            initialVal={50}\r\n            label=\"Excite duration (ms)\"\r\n            size={120}\r\n            stateKey={\"exciteDuration\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n          <FreqSlider\r\n            initialVal={1000}\r\n            label=\"Decay duration (ms)\"\r\n            size={120}\r\n            stateKey={\"decayDuration\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n\r\n          <FreqSlider\r\n            initialVal={0.05}\r\n            label=\"Excite energy\"\r\n            precision={4}\r\n            size={120}\r\n            stateKey={\"exciteEnergy\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n        </div>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n          <Button onClick={handleAction('toggleAudio')}>\r\n            {!sketchState.isPlaying ? <PlayCircleOutlineIcon /> : <PauseCircleOutlineIcon />}\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('toggleControlPanel')}>\r\n            hide controls\r\n          </Button>\r\n        </ButtonGroup>\r\n      </Drawer>\r\n\r\n\r\n    </div>\r\n   </>);\r\n};\r\n\r\nconst Slider = ({ sketchState, setSketchState, stateKey, ...props }) => (\r\n    <div>\r\n      {stateKey}: {sketchState[stateKey]}\r\n      <br />\r\n      <input\r\n        type=\"range\"\r\n        style={{width: 400}}\r\n        value={sketchState[stateKey]}\r\n        onChange={ev => {\r\n          const value = Number(ev.target.value);\r\n          setSketchState(state => ({\r\n            ...state,\r\n            [stateKey]: value\r\n          }))\r\n        }}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n\r\n\r\nconst FreqSlider = ({\r\n  initialVal = 1,\r\n  isInt = false,\r\n  isRegenRequired = false,\r\n  label = '',\r\n  max = Number.MAX_VALUE,\r\n  min = Number.MIN_VALUE,\r\n  precision = 6,\r\n  setSketchState,\r\n  size = 240,\r\n  sketchState,\r\n  stateKey,\r\n}) => {\r\n  const degPerExp = 2048;\r\n  const errMargin = degPerExp / 3;\r\n\r\n  const constrainVal = val => Math.min(Math.max(isInt ? Math.round(val) : val, min), max);\r\n\r\n  const valToState = val => {\r\n    const freq = constrainVal(val);\r\n    const logFreq = Math.log2(freq);\r\n    const exp = Math.floor(logFreq);\r\n\r\n    return {\r\n      deg: Math.floor(degPerExp * (logFreq - exp)),\r\n      exp,\r\n      numberInputVal: freq,\r\n    };\r\n  }\r\n\r\n  const [state, setState] = useState(() => valToState(initialVal));\r\n\r\n  useEffect(() => {  // hack because react-circle-slider invokes the onChange callback when its knob position changes even via props\r\n    _.defer(() => setState(valToState(initialVal)));\r\n  }, []);\r\n\r\n  const handleChange = v => {\r\n    const {deg, exp} = state;\r\n    const didCrossUp = v >= 0 && v < errMargin && deg > degPerExp - errMargin;\r\n    const didCrossDn = deg >= 0 && deg < errMargin && v > degPerExp - errMargin;\r\n    const nextExp = didCrossUp\r\n      ? exp + 1\r\n      : didCrossDn\r\n        ? exp - 1\r\n        : exp;\r\n\r\n    const freq = constrainVal(Math.pow(2, nextExp + v / degPerExp));\r\n    const nextState = {\r\n      deg: v,\r\n      exp: nextExp,\r\n      numberInputVal: freq\r\n    };\r\n    setState(nextState);\r\n    setSketchState(state => ({\r\n      ...state,\r\n      [stateKey]: freq,\r\n    }));\r\n  }\r\n\r\n  return (\r\n    <div style={{\r\n      flex: `0 ${size + 40}px`,\r\n      height: size + 40,\r\n      marginBottom: 40,\r\n    }}>\r\n      <div style={{\r\n        height: '3em',\r\n      }}>\r\n      {label || `${stateKey}: ${sketchState[stateKey]}`}\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          paddingTop: 10,\r\n          position: 'relative',\r\n        }}\r\n        onPointerUp={() => {\r\n          sketchState.isRegenNeeded = isRegenRequired // TODO: isFreqChanged instead of full regen\r\n        }}\r\n      >\r\n        <CircularSlider\r\n          dataIndex={state.deg}\r\n          min={0}\r\n          max={degPerExp - 1}\r\n          knobColor=\"#AAA\"\r\n          knobSize={60}\r\n          label=\"Fundamental Frequency\"\r\n          renderLabelValue={\r\n            <input\r\n              type=\"number\"\r\n              style={{\r\n                background: 'none',\r\n                border: 'none',\r\n                color: 'white',\r\n                fontSize: `${size / 100}em`,\r\n                left: '50%',\r\n                marginLeft: '-40%',\r\n                marginTop: '-0.5em',\r\n                position: 'absolute',\r\n                textAlign: 'center',\r\n                top: '50%',\r\n                width: '80%',\r\n                zIndex: 3,\r\n              }}\r\n              value={isInt ? state.numberInputVal : state.numberInputVal.toPrecision(precision)}\r\n              onChange={ev => {\r\n                setState({\r\n                  ...state,\r\n                  numberInputVal: Number(ev.target.value),\r\n                });\r\n              }}\r\n              onKeyDown={({ key }) => {\r\n                if (key === 'Enter') {\r\n                  const nextState = valToState(state.numberInputVal);\r\n                  setState(nextState);\r\n                  _.defer(() => { // hack because react-circle-slider invokes the onChange callback when its knob position changes even via props\r\n                    setState(nextState);\r\n\r\n                    setSketchState(state => ({\r\n                      ...state,\r\n                      [stateKey]: nextState.numberInputVal,\r\n                      isRegenNeeded: isRegenRequired,\r\n                    }));\r\n                  })\r\n\r\n                }\r\n              }}\r\n            />\r\n          }\r\n          onChange={handleChange}\r\n          progressColorFrom={HSVtoHex(state.exp / 15, 1, 1)}\r\n          progressColorTo={HSVtoHex((state.exp + 1) / 15, 1, 1)}\r\n          progressLineCap=\"flat\"\r\n          trackColor=\"#666\"\r\n          height={size}\r\n          width={size}\r\n        />\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\nexport default Mandelbrot;\r\n","import FrettedInstrument from './frettedInstrument';\r\nimport React from 'react';\r\n\r\nconst Mandolin = () => (\r\n  <FrettedInstrument\r\n    fretCount={20}\r\n    fretMarkers={[0, 3, 5, 7, 10, 12, 15]}\r\n    tuning={[7, 2, 9, 4]}\r\n  />\r\n);\r\n\r\nexport default Mandolin;\r\n","import React from 'react';\r\nimport globalHook from 'use-global-hook';\r\n\r\nconst initialState = {\r\n  mediaStream: undefined,\r\n};\r\n\r\nconst actions = {\r\n  setMediaStream: (store, mediaStream) =>\r\n    store.setState({mediaStream}),\r\n};\r\n\r\nexport default globalHook(React, initialState, actions);\r\n","import React from 'react';\r\nimport useMic from './useMic';\r\nimport {IconButton} from \"@material-ui/core\";\r\nimport {MicOffOutlined, Mic as MicIcon} from '@material-ui/icons';\r\n\r\nconst Mic = () => {\r\n\r\n  const [state, actions] = useMic( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({mediaStream}) => ({mediaStream}),\r\n    actions => actions,\r\n  );\r\n\r\n  const handleMicOnClick = () => {\r\n    navigator.mediaDevices.getUserMedia({\r\n      audio: true,\r\n      video: false\r\n    }).then(mediaStream => {\r\n      actions.setMediaStream(mediaStream)\r\n    });\r\n  }\r\n\r\n  const handleMicOffClick = () => {\r\n    state.mediaStream.getTracks().forEach(tr => tr.stop());\r\n    actions.setMediaStream(undefined);\r\n  }\r\n\r\n  const isMicOn = !!state.mediaStream;\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        // aria-label=\"open drawer\"\r\n        onClick={isMicOn ? handleMicOffClick : handleMicOnClick}\r\n      >\r\n        {isMicOn ? <MicOffOutlined/> : <MicIcon/>}\r\n      </IconButton>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Mic;\r\n","import _ from 'lodash';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport React, {useEffect} from 'react';\r\nimport useMidi from './useMidi';\r\nimport WebMidi from 'webmidi';\r\nimport {IconButton, Toolbar} from \"@material-ui/core\";\r\nimport {WatchLater as MidiClockIcon} from '@material-ui/icons';\r\n\r\nconst Midi = () => {\r\n\r\n  const [state, actions] = useMidi( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({\r\n      inputDevices,\r\n      isMidiClockInSelectorOpen,\r\n      isMidiInSelectorOpen,\r\n      midiInDevice,\r\n    }) => ({inputDevices, isMidiClockInSelectorOpen, isMidiInSelectorOpen, midiInDevice}),\r\n    actions => actions,\r\n  );\r\n\r\n  const {\r\n    inputDevices,\r\n    isMidiClockInSelectorOpen,\r\n    isMidiInSelectorOpen,\r\n    midiInDevice,\r\n  } = state;\r\n\r\n  useEffect(() => {\r\n    WebMidi.enable((err) => {\r\n      if (err) console.error(err);\r\n      else {\r\n        console.log('WebMidi enabled.');\r\n        actions.setInputDevices(WebMidi.inputs);\r\n      }\r\n    }, true);\r\n  }, []);\r\n\r\n\r\n  const handleMidi = (evt) => {\r\n    const {note: {number: n}, rawVelocity: vel, type} = evt;\r\n    // console.log(evt)\r\n    // actions.setMidiEvent({\r\n    //   [n]: type === 'noteon' ? vel : 0\r\n    // });\r\n  }\r\n\r\n  const handleMidiClock = (evt) => {\r\n\r\n    // console.log(evt)\r\n    // actions.setMidiEvent({\r\n    //   [n]: type === 'noteon' ? vel : 0\r\n    // });\r\n  }\r\n\r\n\r\n  const [midiMenuAnchorEl, setMidiMenuAnchorEl] = React.useState(null);\r\n\r\n  const handleMidiMenuButtonClick = (isBeatClock = false) => ({ currentTarget }) => {\r\n    setMidiMenuAnchorEl(currentTarget);\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n  }\r\n\r\n  const handleMidiMenuClose = (isBeatClock = false) => () => {\r\n    console.log('close', isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector')\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n    setMidiMenuAnchorEl(null);\r\n  }\r\n\r\n  const handleMidiInputSelect = (deviceIdx, isBeatClock = false) => ({ currentTarget }) => { // todo: remove prev listener\r\n    setMidiMenuAnchorEl(currentTarget);\r\n\r\n    const midiInDevice = inputDevices[deviceIdx];\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n    if (isBeatClock) {\r\n      midiInDevice.addListener('clock', 'all', handleMidiClock);\r\n      actions.setMidiClockInDevice(midiInDevice);\r\n    } else {\r\n      actions.setMidiInDevice(midiInDevice);\r\n      midiInDevice.addListener('noteon', 'all', handleMidi);\r\n      midiInDevice.addListener('noteoff', 'all', handleMidi);\r\n    }\r\n\r\n  };\r\n\r\n  return ( // TODO: only show if MIDI devices present; use looser permission to query\r\n    <>\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        aria-label=\"open drawer\"\r\n        onClick={handleMidiMenuButtonClick(false)}\r\n      >\r\n        <img src=\"noun_MIDI_385872.svg\" style={{ width: '1.5em', height: '1.5em'}} />\r\n      </IconButton>\r\n\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        aria-label=\"open drawer\"\r\n        onClick={handleMidiMenuButtonClick(true)}\r\n      >\r\n        <MidiClockIcon/>\r\n      </IconButton>\r\n\r\n      <Menu\r\n        id=\"simple-menu\"\r\n        anchorEl={midiMenuAnchorEl}\r\n        open={isMidiInSelectorOpen || isMidiClockInSelectorOpen}\r\n        onClose={handleMidiMenuClose(isMidiClockInSelectorOpen)}\r\n      >\r\n        {inputDevices.map(({name}, idx) => (\r\n          <MenuItem\r\n            key={name}\r\n            onClick={handleMidiInputSelect(idx, isMidiClockInSelectorOpen)}\r\n            selected={isMidiInSelectorOpen && name === _.get(midiInDevice, 'name')}\r\n          >\r\n            {name}\r\n          </MenuItem>\r\n        ))}\r\n      </Menu>\r\n    </>\r\n\r\n  );\r\n};\r\n\r\nexport default Midi;\r\n","import _ from 'lodash';\r\n\r\n\r\n\r\nexport const initialState = {\r\n  decayDuration: 5000,\r\n  exciteEnergy: 0.05,\r\n  exciteDuration: 1000,\r\n  fundamentalFreq: 200,\r\n  hilbertN: 64, // hilbertN must be power of 2 in order to be square\r\n  hilbMand: [/*{ x, y, m }*/], // coordinates and associated mandelbrot val in hilbert traversal order\r\n  isControlPanelOpen: true,\r\n  isPlaying: false,\r\n  isRegenNeeded: true,\r\n  maxIters: 4096, // max number of steps to recurse the mandelbrot fn\r\n  midiClock: 0,\r\n  midiClocksPerTick: 24,\r\n  panX: -0.05,\r\n  panY: 0,\r\n  partials: {/* partial: { amp, oscIdx } */}, // the collection is updated in setState but values within are changed in drawLoop directly\r\n  partialsCountMax: 16,\r\n  isSmooth: false, // smooth technique https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n  tick: 0, // updated in draw() bypasses setState\r\n  tickDuration: 100,\r\n  tickLastMillis: 0, // updated in draw() bypasses setState\r\n  zoom: 1.2,\r\n\r\n  // zoom: 3603.7157567397, panX: 0.18580280974577668, panY: 0.00036930706052212803,\r\n\r\n  // floating point errors here\r\n  // zoom: 279919582741326.66, panX: -0.014853203736137617, panY: 0.13451319076043783,\r\n\r\n  // panX: 0.0011548427778035686,\r\n  // panY: 0.025033026937542575,\r\n  // zoom: 319852972190.0951,\r\n  //\r\n  // panX: -0.18498767183730766,\r\n  // panY: 0.4722205531430409,\r\n  // zoom: 419013953.31772846,\r\n  //\r\n  //\r\n  // decay: 0.000075,\r\n  // exciteEnergy: 0.006,\r\n  // fundamentalFreq: 10,\r\n  // hilbertN: 256,\r\n  // maxIters: 4096,\r\n  // panX: 0.0011503007796323155,\r\n  // panY: 0.025033026938902938,\r\n  // tickDuration: 10,\r\n  // zoom: 836635.9887997985,\r\n  //\r\n  //\r\n  //\r\n  // panX: 0.08871194014553094,\r\n  // panY: -0.12829271146701177,\r\n  // zoom: 19736096.460687958,\r\n\r\n  // ...{zoom: 39422433.84662852, panX: 0.04670942760989286, panY: 0.13656218122372943},\r\n\r\n  // demo for 10 partials\r\n  // ...{zoom: 12371177.464729108, panX: 0.04671008941233588, panY: 0.13656133340058238},\r\n};\r\n\r\nlet audioCtx = new AudioContext();\r\nlet oscs = [];\r\n\r\nconst masterGain = audioCtx.createGain();\r\nwindow.masterGain = masterGain;\r\nmasterGain.gain.value = 1;\r\nmasterGain.connect(audioCtx.destination);\r\n\r\n\r\nexport const sketch = (p5) => {\r\n  p5.state = initialState;\r\n\r\n  const setupOscillators = () => {\r\n    oscs.forEach(({osc, gain}) =>\r\n    {\r\n      osc.stop();\r\n    }); // TODO: gain.disconnect?\r\n\r\n    oscs = _.range(p5.state.partialsCountMax).map(() => {\r\n      const osc = audioCtx.createOscillator();\r\n      const gain = audioCtx.createGain();\r\n      gain.gain.value = 0;\r\n      osc.connect(gain);\r\n      gain.connect(masterGain);\r\n      osc.start();\r\n      return {osc, gain};\r\n    });\r\n\r\n    window.oscs = oscs;\r\n  }\r\n\r\n  let font;\r\n  p5.preload = () => {\r\n    font = p5.loadFont('JetBrainsMono-Regular.ttf');\r\n  }\r\n\r\n\r\n  const TWO_PI = Math.PI * 2;\r\n\r\n  let h, w;\r\n\r\n  let d, n, n2 = 0;\r\n\r\n  [n, d] = [2, 1];\r\n\r\n  p5.setup = () => {\r\n    p5.createCanvas(p5._width, p5._height);\r\n    p5.blendMode(p5.ADD);\r\n    p5.colorMode(p5.HSB, 255);\r\n    p5.textFont(font);\r\n  }\r\n\r\n  let input = [];\r\n  p5.keyTyped = () => {\r\n    console.log(p5.key)\r\n    // if (key === ':') {\r\n    //   value = 255;\r\n    // } else if (key === 'b') {\r\n    //   value = 0;\r\n    // }\r\n    // uncomment to prevent any default behavior\r\n    if (p5.key === 'Enter') {\r\n\r\n      const obj = input.join('').split(':').map(s => parseInt(s, 10));\r\n\r\n      n2 = 0;\r\n      [d, n, n2] = obj;\r\n      if (!n2) {\r\n        [n, d] = obj;\r\n        n2 = 0;\r\n      }\r\n      console.log(d, n, n2)\r\n      console.log(w, h)\r\n\r\n      input = [];\r\n    } else {\r\n      input.push(p5.key);\r\n    }\r\n\r\n\r\n\r\n    return false;\r\n  }\r\n\r\n  let phase = 0;\r\n  let x1 = 0;\r\n  let y1 = 0;\r\n  let r;\r\n  const rayCount = 500;\r\n\r\n  const drawWave = ({ freq, phase = 0, hue }) => {\r\n    const dt = TWO_PI / rayCount;\r\n    p5.push();\r\n    p5.translate(w/2, h/2);\r\n    for(let t = 0; t < TWO_PI - dt; t += dt) {\r\n      p5.stroke(\r\n        hue,\r\n        255,\r\n        freq && (50 + 50 * Math.sin(t * freq)),\r\n        100,\r\n      );\r\n\r\n      r = w + h;\r\n      x1 = r * Math.sin(t + phase);\r\n      y1 = r * Math.cos(t + phase);\r\n\r\n      p5.line(0, 0, x1, y1);\r\n    }\r\n    p5.pop();\r\n  };\r\n\r\n\r\n  p5.draw = () => {\r\n    p5.clear();\r\n    p5.background(0, 0, 0);\r\n    h = p5.height;\r\n    w = p5.width;\r\n\r\n\r\n    phase = p5.millis() * (0.001/d);\r\n\r\n    drawWave({\r\n      freq: d,\r\n      hue: 0,\r\n      phase,\r\n    });\r\n\r\n    drawWave({\r\n      freq: d * n / d,\r\n      hue: 90,\r\n      phase: phase * 2,\r\n    });\r\n\r\n    drawWave({\r\n      freq: d * n2 / n,\r\n      hue: 180,\r\n      phase: phase * 3,\r\n    });\r\n\r\n\r\n\r\n\r\n\r\n    p5.blendMode(p5.BLEND);\r\n    p5.fill(255);\r\n    p5.stroke(0);\r\n    p5.strokeWeight(4);\r\n    p5.textAlign(p5.CENTER, p5.CENTER);\r\n    p5.textSize(h/15)\r\n    p5.text(n2 ? `${d}:${n}:${n2}` : `${n}:${d}`, w/2, h/2)\r\n    p5.blendMode(p5.ADD);\r\n  }\r\n\r\n  /**\r\n   * This needs to be called by a user event handler.\r\n   * @param isPlaying\r\n   */\r\n  p5.toggleAudio = () => {\r\n    p5.setState(prevState => {\r\n      const { isPlaying } = prevState;\r\n      if (!isPlaying && audioCtx.state !== 'running') {\r\n        audioCtx.resume();\r\n      }\r\n\r\n      if (isPlaying && audioCtx.state === 'running') {\r\n        audioCtx.suspend();\r\n      }\r\n\r\n      return { ...prevState, isPlaying: !prevState.isPlaying };\r\n    });\r\n\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport Cell from './cell';\r\nimport PC from './pc';\r\nimport React, {useState} from 'react';\r\nimport {HSVtoHex} from './color';\r\n// import {Hsluv} from 'hsluv'; // FIXME ts loader\r\nimport {toSolfege, toSymbol} from './util';\r\n\r\nlet _hsluv;\r\nconst hslToHex = (h, s, l) => {\r\n  _hsluv = _hsluv || new window.Hsluv();\r\n  _hsluv.hsluv_h = h * 360;\r\n  _hsluv.hsluv_s = s * 100;\r\n  _hsluv.hsluv_l = l * 100;\r\n  _hsluv.hsluvToHex();\r\n  return _hsluv.hex;\r\n}\r\n\r\nconst pcSetOpts = [\r\n  {\r\n    label: 'Diatonic Scale',\r\n    val: [0, 2, 4, 5, 7, 9, 11],\r\n  },\r\n  {\r\n    label: 'Major Triad',\r\n    val: [0, 4, 7],\r\n  },\r\n  {\r\n    label: 'Major 7',\r\n    val: [0, 4, 7, 11],\r\n  },\r\n  {\r\n    label: 'Minor Triad',\r\n    val: [0, 3, 7],\r\n  },\r\n  {\r\n    label: 'Minor 7',\r\n    val: [0, 3, 7, 10],\r\n  },\r\n  {\r\n    label: 'Diminished Triad',\r\n    val: [0, 3, 6],\r\n  },\r\n  {\r\n    label: 'Diminished 7',\r\n    val: [0, 4, 7],\r\n  },\r\n  {\r\n    label: 'Augmented Triad',\r\n    val: [0, 4, 8],\r\n  },\r\n]\r\n\r\nconst fallingGrace = [\r\n  {\r\n    label: 'Ab Maj7 -- 8+47Ɛ', // implied 0 -- but how would we notate omission of 0?\r\n    val: [8, 0, 3, 7],\r\n  },\r\n  {\r\n    label: `D7/F# -- 2+47૪/4 ${''/*(redundant 4)*/} -- 2+7૪/4 ${''/*(familiar slash chord notation, no redundancy)*/}  -- 2+47૪0 ${''/*(explicit 0 allows for omitting 0)*/}`,\r\n    val: [2, 6, 9, 0],\r\n  },\r\n  {\r\n    label: 'G min7 -- 7+37૪',\r\n    val: [7, 10, 2, 5],\r\n  },\r\n  {\r\n    label: 'F min7',\r\n    val: [],\r\n  },\r\n  {\r\n    label: '',\r\n    val: [],\r\n  },\r\n  {\r\n    label: '',\r\n    val: [],\r\n  },\r\n  {\r\n    label: '',\r\n    val: [],\r\n  },\r\n  {\r\n    label: '',\r\n    val: [],\r\n  },\r\n  {\r\n    label: '',\r\n    val: [],\r\n  },\r\n]\r\n\r\n\r\n\r\n\r\nconst lumatoneRows = [\r\n  2,\r\n  5,\r\n  8,\r\n  11,\r\n  14,\r\n  17,\r\n  20,\r\n  23,\r\n  26,\r\n  28,\r\n  26,\r\n  23,\r\n  20,\r\n  17,\r\n  14,\r\n  11,\r\n  8,\r\n  5,\r\n  2,\r\n];\r\n\r\nconst lumatoneRowShift = [\r\n  0, 0, 0, 0, 0, 0, 0, 0, 0,\r\n  1,\r\n  4,\r\n  7,\r\n  10,\r\n  13,\r\n  16,\r\n  19,\r\n  22,\r\n  25,\r\n  28,\r\n];\r\n\r\n// http://www.altkeyboards.com/instruments/isomorphic-keyboards\r\nconst layoutOpts = [\r\n  {\r\n    label: 'Wicki-Hayden',\r\n    val: (x, y) => !(y % 2 === 1)\r\n      ? (x * 2) % 12\r\n      : (x * 2 + 7) % 12\r\n  },\r\n  {\r\n    label: 'Harmonic table',\r\n    val: (x, y) => ((y % 2 > 0\r\n      ? ((y - 1) / 2) * 11 + 3\r\n      : (y / 2) * 11) + x * 7) % 12\r\n  },\r\n];\r\n\r\nconst Tonnetz = ({rows = lumatoneRows}) => {\r\n\r\n  const [layoutKey, setLayoutKey] = useState(0);\r\n  const {val: layout} = layoutOpts[layoutKey];\r\n\r\n  const [pcSetKey, setPcSetKey] = useState(0);\r\n  const {val: pcSet} = pcSetOpts[pcSetKey];\r\n\r\n  return (\r\n    <div style={{\r\n      display: 'block',\r\n      flexShrink: 0,\r\n    }}>\r\n      <select value={layoutKey} onChange={evt => setLayoutKey(parseInt(evt.target.value, 10))}>\r\n        {layoutOpts.map(({label}, val) => <option key={val} value={val}>{label}</option>)}\r\n      </select>\r\n\r\n      <select value={pcSetKey} onChange={evt => setPcSetKey(parseInt(evt.target.value, 10))}>\r\n        {pcSetOpts.map(({label}, val) => <option key={val} value={val}>{label}</option>)}\r\n      </select>\r\n\r\n      <br/>\r\n      <br/>\r\n      <br/>\r\n\r\n      {_.range(rows.length)\r\n        .map(y => (\r\n          <>\r\n            {_.range(rows[y] + lumatoneRowShift[y]).map(x => {\r\n\r\n              const isOdd = y % 2 === 1;\r\n\r\n              const n = layout(x, y);\r\n\r\n              const isInPcSet = _.includes(pcSet, n);\r\n\r\n              const isBlank = lumatoneRowShift[y] > x;\r\n\r\n              return (\r\n                !isBlank\r\n                  ? (\r\n                    <PC\r\n                      key={x}\r\n                      n={n}\r\n                      isOdd={isOdd}\r\n                      style={{\r\n                        // border: `solid ${1}px`,\r\n                        border: `solid ${isInPcSet ? 2 : 1}px`,\r\n                        borderRadius: '50%',\r\n                        // color: 'grey', //TODO: printer settings as well as mediaquery stylesheet\r\n                        color: hslToHex(((n * 5) % 12) / 12, 1, isInPcSet ? 0.35 : 0.3),\r\n                        // color: isInPcSet ? 'magenta' : 'white',\r\n                      }}\r\n                    />)\r\n                  : (<\r\n                    Cell\r\n                    key={x}\r\n                    isOdd={isOdd}\r\n                  >\r\n                    &nbsp;\r\n                  </Cell>)\r\n              );\r\n            })}\r\n            <br/>\r\n          </>\r\n        ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Tonnetz;\r\n","import React, {useEffect} from 'react';\r\nimport useP5 from './useP5';\r\nimport {initialState, sketch} from \"./ratioLightshipP5\";\r\n\r\nconst RatioLightship = () => {\r\n  const {\r\n    ref,\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n  } = useP5(sketch, initialState);\r\n\r\n  window.sketchInstance = sketchInstance;\r\n\r\n  useEffect(() => {\r\n    document.title = 'Ratio Lightship';\r\n  }, [sketchInstance]);\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      style={{\r\n        alignSelf: 'start',\r\n        background: 'radial-gradient(circle, rgba(74,153,117,1) 0%, rgba(188,148,233,0.6943726953672094) 100%)',\r\n        height: '100vh',\r\n        width: '100vw',\r\n      }}\r\n    />);\r\n};\r\n\r\n\r\nexport default RatioLightship;\r\n","import _ from 'lodash';\r\nimport Vex from 'vexflow';\r\nimport React, {useCallback, useState} from 'react';\r\n\r\nconst VF = Vex.Flow;\r\n\r\nconst useVexFlow = () => {\r\n  const [context, setContext] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  const ref = useCallback((el) => {\r\n    if (el) {\r\n      const renderer = new VF.Renderer(el, VF.Renderer.Backends.SVG);\r\n      renderer.resize(el.clientWidth, el.clientHeight);\r\n      setContext(renderer.getContext());\r\n\r\n      const resizeObserver = new ResizeObserver(([{ contentRect: { height, width } }]) => {\r\n        renderer.resize(width, height);\r\n      });\r\n      setResizeObserver(resizeObserver);\r\n      resizeObserver.observe(el);\r\n    } else {\r\n      resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    context,\r\n    ref,\r\n  };\r\n}\r\n\r\nconst Staff = () => {\r\n  const {\r\n    context,\r\n    ref,\r\n  } = useVexFlow();\r\n\r\n  if (context) {\r\n    context.setStrokeStyle('white');\r\n    context.setFillStyle('white');\r\n\r\n    const treble = new VF.Stave(50, 0, 10000)\r\n      .addClef('treble')\r\n      .addKeySignature('Db')\r\n      .addTimeSignature('4/4')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    window.VF= VF;\r\n    window.context = context\r\n    window.treble = treble\r\n\r\n    const bass = new VF.Stave(50, 60, 10000)\r\n      .addClef('bass')\r\n      .addTimeSignature('4/4')\r\n      .addKeySignature('Db')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    const brace = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.BRACE)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n\r\n    const leftLine = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.SINGLE_LEFT)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n  }\r\n\r\n\r\n  return (\r\n    <div style={{\r\n      display: 'block',\r\n      width: '100%',\r\n    }}>\r\n      <div\r\n        ref={ref}\r\n        style={{\r\n          // background: 'darkcyan',\r\n          fill: 'white',\r\n          height: 500,\r\n          stroke: 'white',\r\n        }}/>\r\n    </div>\r\n  )\r\n};\r\n\r\nexport default Staff;\r\n","import FrettedInstrument from './frettedInstrument';\r\nimport React from 'react';\r\n\r\nconst Ukulele = () => (\r\n  <FrettedInstrument\r\n    fretCount={18}\r\n    fretMarkers={[0,5,7,10,12]}\r\n    tuning={[7, 4, 0, 9]}\r\n  />\r\n);\r\n\r\nexport default Ukulele;\r\n","import {Entity} from \"aframe-react\";\r\nimport React from \"react\";\r\n\r\nconst Camera = () => (\r\n  <Entity\r\n    primitive=\"a-camera\"\r\n    id=\"camera\"\r\n    position={{ x: 0, y: 0, z: 0 }}\r\n    look-controls\r\n    // touch-look-controls={{\r\n    //   enabled: true,\r\n    // }}\r\n    wasd-controls={{\r\n      acceleration: 25,\r\n    }}\r\n  >\r\n    {/*<Entity*/}\r\n    {/*  primitive=\"a-cursor\"*/}\r\n    {/*  animation__click={{*/}\r\n    {/*    property: 'scale',*/}\r\n    {/*    startEvents: 'click',*/}\r\n    {/*    from: '0.1 0.1 0.1',*/}\r\n    {/*    to: '1 1 1',*/}\r\n    {/*    dur: 150,*/}\r\n    {/*  }}/>*/}\r\n  </Entity>\r\n);\r\n\r\nexport default Camera;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport {Entity} from 'aframe-react';\r\nimport {HSVtoHex} from './color';\r\nimport {toSymbol} from \"./util\";\r\n\r\nconst handleOsc = n => (el) => {\r\n  if (el) {\r\n    const { components: { osc } } = el;\r\n    osc.onOsc = ({ instrument, note, vel }) => {\r\n      if (note === n) {\r\n        osc.vel = vel;\r\n      }\r\n    }\r\n\r\n    osc.onTick = (time, timeDelta) => {\r\n      if (osc.vel === 0) {\r\n\r\n      }\r\n\r\n      if (_.has(osc, 'vel')) {\r\n        el.setAttribute('material', 'opacity', 0.05 + 0.75 * osc.vel / 128);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport default ({\r\n  darkened = true,\r\n  n,\r\n  position = {x: 0, y: 0, z: 0},\r\n  scale = {x: 1, y: 1, z: 1}\r\n}) =>\r\n  <Entity\r\n    _ref={handleOsc(n)}\r\n    // animation={{\r\n    //   dur: 500,\r\n    //   property: 'position',\r\n    //   to: position,\r\n    // }}\r\n    material={{\r\n      blending: darkened ? 'normal' : 'additive',\r\n      color: HSVtoHex(n / 12, 0.7, darkened ? 0 : 1),\r\n      opacity: darkened ? 0.5 : 0.1,\r\n    }}\r\n    osc={{\r\n\r\n    }}\r\n    position={position}\r\n    primitive='a-torus'\r\n    radius={0.1}\r\n    radius-tubular={0.003}\r\n    scale={scale}\r\n  >\r\n    <Entity\r\n      look-at=\"#camera\"\r\n      position={{x: 0, y: 0, z: 0}}\r\n      scale={{x: 2, y: 2, z: 2}}\r\n      text={{\r\n        align: 'center',\r\n        color: HSVtoHex(n / 12, 0.75, 0.5),\r\n        font: `../JetBrainsMono-Regular-msdf.json`,\r\n        negate: false,\r\n        transparent: true,\r\n        value: toSymbol(n),\r\n      }}\r\n    />\r\n  </Entity>\r\n","import _ from 'lodash';\r\nimport PitchClass from './pitchClass';\r\nimport React, {useEffect, useState} from 'react';\r\nimport useMidi from \"./useMidi\";\r\nimport {Entity} from 'aframe-react';\r\n\r\nconst ColtraneCircle = () => {\r\n  const [is180, setIs180] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const toggle = ({key}) => {\r\n      if (key === 'r') setIs180(is180 => !is180);\r\n    };\r\n\r\n    window.addEventListener('keyup', toggle);\r\n    return () => window.removeEventListener('keyup', toggle);\r\n  }, []);\r\n\r\n  const [{midiIn}] = useMidi();\r\n\r\n  const midiInPitchClasses = _(12)\r\n    .range()\r\n    .map(n => _(midiIn)\r\n      .pickBy((v, i) => i % 12 === n)\r\n      .values()\r\n      .sum())\r\n    .value();\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      animation={`property: rotation; to: 0 ${is180 ? 180 : 0} 0; dur: 500;`}\r\n      position={`0 0 -3`}\r\n    >\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 == 0)\r\n        .map(n => ({\r\n          n,\r\n          r: 1.5,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([6, 7, 0, 1], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          n: ((i + 1) * 2 + Math.floor(i / 4) * 2) % 12,\r\n          // n: (n * 2) % 12,\r\n          r: 1.5,\r\n          x: Math.sin((n + 0.5) * Math.PI / 24),\r\n          y: Math.cos((n + 0.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 != 0)\r\n        .map(n => ({\r\n          n: (n + 6) % 12,\r\n          r: 1.2,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([4, 5, 6, 7], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          // n: i,\r\n          n: (i * 2 + 9 + Math.floor(i / 4) * 2) % 12,\r\n          // n: i,\r\n          r: 1.2,\r\n          x: Math.sin((n - 1.5) * Math.PI / 24),\r\n          y: Math.cos((n - 1.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default ColtraneCircle;\r\n","import {Entity} from 'aframe-react';\r\nimport React from 'react';\r\nimport {HSVtoHex} from './color';\r\n\r\n// http://dmccooey.com/polyhedra/PentakisDodecahedron.txt\r\nconst c1 = 1.33058699733550141141687582919;\r\nconst c2 = 2.15293498667750705708437914596;\r\n\r\n// in ordered, opposite pairs\r\nconst verts = [\r\n  [0.0,  -c2,   c1],\r\n  [0.0,   c2,  -c1],\r\n  [ c2,  -c1,  0.0],\r\n  [-c2,   c1,  0.0],\r\n  [0.0,  -c2,  -c1],\r\n  [0.0,   c2,   c1],\r\n  [-c2,  -c1,  0.0],\r\n  [ c2,   c1,  0.0],\r\n  [-c1,  0.0,   c2],\r\n  [ c1,  0.0,  -c2],\r\n  [ c1,  0.0,   c2],\r\n  [-c1,  0.0,  -c2],\r\n];\r\n\r\nconst Dod = ({ rep = 1, sat, stack = [], n = 0 }) =>\r\n  <Entity position=\"0 0 0\">\r\n    {verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        color={HSVtoHex(i * (1 / 12), sat || 1, 1)}\r\n        events={{ click: () => console.log(i) }}\r\n        primitive=\"a-sphere\"\r\n        position={v.join(' ')}\r\n        scale={[1, 1, 1].map(n => 0.3 * n/ (rep * rep)).join(' ')}\r\n      />)}\r\n\r\n    {rep < 3 && verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        position={v.map(n => n * 2).join(' ')}\r\n        text={`color: ${HSVtoHex((stack.length ? stack[stack.length - 1] : i) * (1 / 12), 1, 1)}; align: center; value: ${[...stack, i].join(',')} - ${(n + i) % 12}; width: 5; zOffset: 0`}\r\n      >\r\n        <Dod rep={rep+1} sat={0.3} stack={[...stack, i]} n={(n + i) % 12} />\r\n      </Entity>)\r\n      // .filter((n, i) => i % 2)\r\n    }\r\n  </Entity>;\r\n\r\nexport default Dod;","// import * as Tone from 'tone'\r\nimport _ from 'lodash';\r\nimport PitchClass from './pitchClass';\r\nimport PitchDetector from 'pitchdetect';\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport useMidiClock from \"./useMidiClock\";\r\nimport {Entity} from 'aframe-react';\r\nimport {HSVtoHex} from \"./color\";\r\n\r\nconst PitchClassCollections = ({}) => {\r\n\r\n  const spacing = 0.75;\r\n\r\n  const [collEl, setCollEl] = useState();\r\n  const collRef = useCallback(setCollEl, []);\r\n\r\n\r\n  const { reset } = useMidiClock(({ tick }) => {\r\n    if (tick % 24 === 0) console.log(tick);\r\n\r\n    if (collEl) {\r\n      collEl.object3D.position.set(0, 0, (tick / 96) * spacing);\r\n    }\r\n  });\r\n\r\n  window.reset = reset;\r\n\r\n  useEffect(() => {\r\n    const handleKeyup = ({code, key}) => {\r\n      // if (key === 'r') setIs180(is180 => !is180);\r\n      // if (code === 'Space') audioContext.resume();\r\n    };\r\n\r\n    window.addEventListener('keyup', handleKeyup);\r\n    return () => window.removeEventListener('keyup', handleKeyup);\r\n  }, []);\r\n\r\n  const colls = [[2, 5, 9], [7, 11, 2], [0, 4, 7]];\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      _ref={collRef}\r\n      position={{x: 0, y: 0, z: -2}}\r\n      scale={{x: 4, y: 4, z: 4}}\r\n    >\r\n      {\r\n        _.range(50)\r\n          .map(i => 50 - i)// draw order\r\n          .map(i => ({ coll: colls[i % colls.length], z: i * -spacing}))\r\n          .map(({coll, z}) => (\r\n            <React.Fragment key={z}>\r\n              <Entity\r\n                material={{\r\n                  // blending: 'subtractive',\r\n                  color: '#040404',\r\n                  opacity: 0.45,\r\n                }}\r\n                position={{ x: 0, y: 0, z: z - 0.01}}\r\n                rotation={{x: 90, y: 0, z: 0}}\r\n                primitive='a-cylinder'\r\n                scale={{ x: 1, y: 0.001, z: 1}}\r\n              />\r\n              {_.range(12)\r\n                .map(n => {\r\n                  const r = 0.25;\r\n                  const theta = n * (Math.PI * 2) / 12;\r\n\r\n                  return {\r\n                    n,\r\n                    x: r * Math.sin(theta),\r\n                    y: r * Math.cos(theta),\r\n                  };\r\n                })\r\n                .map(({n, s = 0.5, x, y}) => (\r\n                  <PitchClass\r\n                    darkened={!_.includes(coll, n)}\r\n                    key={n}\r\n                    n={n}\r\n                    position={{x, y, z}}\r\n                    scale={{x: s, y: s, z: s}}\r\n                  />))}\r\n            </React.Fragment>\r\n          ))\r\n      }\r\n\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default PitchClassCollections;\r\n","import _ from \"lodash\";\r\nimport React, {useCallback, useEffect, useState} from \"react\";\r\nimport useMidi from \"./useMidi\";\r\nimport usePrevious from \"./usePrevious\";\r\nimport {Entity} from \"aframe-react\";\r\nimport {HSVtoHex} from \"./color\";\r\n\r\nconst PcSpiralWindController = ({noteToDimensions}) => {\r\n  const [midiInEl, setMidiInEl] = useState();\r\n  const [{midiInDevice}] = useMidi();\r\n  const prevMidiInDevice = usePrevious(midiInDevice);\r\n\r\n  useEffect(() => {\r\n    const handleMidi = (evt) => {\r\n      // console.log(evt)\r\n      const {note: {number: n}, velocity: vel, type} = evt;\r\n      const opacity = vel / (0.1 + vel);\r\n      const {s, x, y, z} = noteToDimensions(n);\r\n      midiInEl.setAttribute('material', 'opacity', opacity);\r\n      if (type === 'noteon') {\r\n        midiInEl.note = n; // FIXME Hack\r\n        midiInEl.object3D.position.set(x, y, z + 0.01);\r\n        midiInEl.object3D.scale.set(s * 1.1, s * 1.1, s * 1.1);\r\n        midiInEl.setAttribute('material', 'color', HSVtoHex(n / 12, 0.75, 0.5));\r\n      }\r\n    };\r\n\r\n    const handleCC = ({ controller: { number }, value }) => {\r\n      if (number === 2) { // breath control\r\n        const vel = value / 128;\r\n        const opacity = vel / (0.1 + vel);\r\n        midiInEl.setAttribute('material', 'opacity', opacity);\r\n      }\r\n    };\r\n\r\n    const handlePitchbend = ({ value }) => {\r\n      // console.log(value)\r\n      const n = midiInEl.note || 0;\r\n      const bendAmount = value * 2;\r\n      const {s, x, y, z} = noteToDimensions(n + bendAmount);\r\n      midiInEl.object3D.position.set(x, y, z + 0.01);\r\n      midiInEl.object3D.scale.set(s * 1.1, s * 1.1, s * 1.1);\r\n    };\r\n\r\n    if (midiInEl) {\r\n      if (midiInDevice) {\r\n        console.log('new midiInDevice: ', _.get(midiInDevice,'name'), 'prev: ', _.get(prevMidiInDevice, 'name'));\r\n        midiInDevice.addListener('noteon', 'all', handleMidi);\r\n        midiInDevice.addListener('noteoff', 'all', handleMidi);\r\n        midiInDevice.addListener('controlchange', 'all', handleCC);\r\n        midiInDevice.addListener('pitchbend', 'all', handlePitchbend);\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (midiInDevice) {\r\n        console.log('removing listeners for', _.get(midiInDevice, 'name'));\r\n        midiInDevice.removeListener('noteon');\r\n        midiInDevice.removeListener('noteoff');\r\n        midiInDevice.removeListener('controlchange');\r\n        midiInDevice.removeListener('pitchbend');\r\n      }\r\n    }\r\n  }, [midiInEl, midiInDevice, noteToDimensions, prevMidiInDevice]);\r\n\r\n  const midiInRef = useCallback(setMidiInEl, []);\r\n\r\n  return (\r\n    <Entity\r\n      _ref={midiInRef}\r\n      primitive='a-sphere'\r\n      material={{\r\n        blending: 'additive',\r\n        color: HSVtoHex(1, 0, 1),\r\n        opacity: 0,\r\n        transparent: true,\r\n      }}\r\n      radius={0.07}\r\n    />\r\n  )\r\n}\r\n\r\nexport default PcSpiralWindController;\r\n","import {useEffect, useRef} from \"react\";\r\n\r\nexport default (value) => {\r\n  const ref = useRef();\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  });\r\n  return ref.current;\r\n}\r\n","import _ from 'lodash';\r\nimport PcSpiralWindController from './pcSpiralWindController';\r\nimport PitchClass from './pitchClass';\r\nimport PitchDetector from 'pitchdetect';\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport useMidi from \"./useMidi\";\r\nimport {Entity} from 'aframe-react';\r\nimport {ftomf} from \"./util\";\r\nimport {HSVtoHex} from \"./color\";\r\n\r\nconst audioContext = new AudioContext();\r\n\r\n// FIXME HACK\r\nwindow.audioContext = audioContext;\r\n\r\n\r\nconst PitchClassSpiral = ({\r\n  depthMax = 1,\r\n  isAlwaysCounterClockwise = false,\r\n  rMax = 0.75,\r\n  rMin = 0,\r\n  noteRange = [34, 99],\r\n  // notesHighlighted = [0, 2, 4, 5, 7, 9, 11],\r\n  pcsHighlighted= [0, 2, 4, 5, 7, 9, 11],\r\n}) => {\r\n  const [is180, setIs180] = useState(true);\r\n  const [detector, setDetector] = useState();\r\n  const [pitchDetectEl, setPitchDetectEl] = useState();\r\n\r\n\r\n\r\n  const noteToDimensions = n => {\r\n    const step = n / 128;\r\n    const r = (is180 ? 1 : 1.5) * rMax - ((is180 ? 1 : 1.5) * rMax - rMin) * step;\r\n\r\n    return {\r\n      n,\r\n      s:  0.75 - n / 192,\r\n      x: r * (is180 && isAlwaysCounterClockwise ? -1 : 1) * Math.sin(n * Math.PI / 6 + 0.01), // +0.01 to fix floating point error in animation library\r\n      y: r * Math.cos(n * Math.PI / 6 + 0.01),\r\n      z: is180\r\n        ? depthMax - depthMax * step\r\n        : depthMax * step,\r\n    };\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyup = ({code, key}) => {\r\n      if (key === 'r') setIs180(is180 => !is180);\r\n      if (code === 'Space') audioContext.resume();\r\n    };\r\n\r\n    window.addEventListener('keyup', handleKeyup);\r\n    return () => window.removeEventListener('keyup', handleKeyup);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    console.log('el', pitchDetectEl, 'detector', detector);\r\n\r\n    const handlePitch = (stats, pitchDetector) => {\r\n      const {frequency, detected, rms} = stats;\r\n\r\n      // https://math.stackexchange.com/q/57429/398343\r\n      // const opacity = 1 - Math.exp(-2 * rms);\r\n      const opacity = rms / (0.1 + rms);\r\n      const n = ftomf(frequency);\r\n      const {s, x, y, z} = noteToDimensions(n);\r\n      pitchDetectEl.setAttribute('material', 'opacity', detected ? opacity : 0);\r\n      pitchDetectEl.object3D.position.set(x, y, z + 0.01);\r\n      pitchDetectEl.object3D.scale.set(s, s, s);\r\n\r\n      if (_.isFinite(n)) {\r\n        pitchDetectEl.setAttribute('material', 'color', HSVtoHex(n / 12, 0.5, 1));\r\n      }\r\n    };\r\n\r\n    if (audioContext && !detector && pitchDetectEl) {\r\n      setDetector(new PitchDetector({\r\n        context: audioContext,\r\n\r\n        // input: audioBufferNode, // default: Microphone input\r\n\r\n        interpolateFrequency: true, // default: true\r\n\r\n        onDebug: handlePitch,\r\n\r\n        // Minimal signal strength (RMS, Optional)\r\n        // minRms: 0.1,\r\n\r\n        // Detect pitch only with minimal correlation of: (Optional)\r\n        // minCorrelation: 0.9,\r\n\r\n        // Detect pitch only if correlation increases with at least: (Optional)\r\n        minCorrelationIncrease: 0.5,\r\n\r\n        // Note: you cannot use minCorrelation and minCorreationIncrease\r\n        // at the same time!\r\n\r\n        // Signal Normalization (Optional)\r\n        normalize: \"rms\", // or \"peak\". default: undefined\r\n\r\n        // Only detect pitch once: (Optional)\r\n        stopAfterDetection: false,\r\n\r\n        // Buffer length (Optional)\r\n        length: 1024, // default 1024\r\n\r\n        // Limit range (Optional):\r\n        minNote: 32, // by MIDI note number\r\n        maxNote: 128,\r\n\r\n        // minFrequency: 440,    // by Frequency in Hz\r\n        // maxFrequency: 20000,\r\n\r\n        minPeriod: 2,  // by period (i.e. actual distance of calculation in audio buffer)\r\n        maxPeriod: 512, // --> convert to frequency: frequency = sampleRate / period\r\n\r\n        // Start right away\r\n        start: true, // default: false\r\n      }));\r\n      // window.detector = detector;\r\n    } else if (detector && !pitchDetectEl) {\r\n      detector.stop();\r\n      detector.destroy();\r\n    }\r\n  }, [audioContext, detector, is180, pitchDetectEl]);\r\n\r\n\r\n\r\n  const pitchDetectRef = useCallback(setPitchDetectEl, []);\r\n\r\n\r\n  // const midiInPitchClasses = _(12)\r\n  //   .range()\r\n  //   .map(n => _(midiIn)\r\n  //     .pickBy((v, i) => i % 12 === n)\r\n  //     .values()\r\n  //     .sum())\r\n  //   .value();\r\n\r\n  // TODO: position by freq, not 12TET pitch\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      events={{\r\n        click: () => {\r\n          audioContext.resume()\r\n        },\r\n      }}\r\n      position={{x: 0, y: 0, z: -6}}\r\n      scale={{x: 4, y: 4, z: 4}}\r\n    >\r\n      {_.range(noteRange[0], noteRange[1] + 1)\r\n        .map(noteToDimensions)\r\n        .map(({n, s, x, y, z}) => (\r\n          <React.Fragment key={n}>\r\n            <Entity\r\n              line={{\r\n                color: 'black',\r\n                opacity: 0.3,\r\n                start: _.pick(noteToDimensions(n + 0.25), ['x', 'y', 'z']),\r\n                end: _.pick(noteToDimensions(n + 0.75), ['x', 'y', 'z']),\r\n                visible: n < noteRange[1],\r\n              }}\r\n            />\r\n\r\n            <PitchClass\r\n              darkened={!_.includes(pcsHighlighted, n%12)}\r\n              n={n}\r\n              position={{x, y, z}}\r\n              scale={{x: s, y: s, z: s}}\r\n            />\r\n          </React.Fragment>\r\n          ))\r\n      }\r\n\r\n      <PcSpiralWindController\r\n        noteToDimensions={noteToDimensions}\r\n      />\r\n\r\n      {/* TODO intervals   */}\r\n      {/*<Entity*/}\r\n      {/*  line={{*/}\r\n      {/*    color: 'white',*/}\r\n      {/*    opacity: 0.3,*/}\r\n      {/*    start: _.pick(noteToDimensions(60), ['x', 'y', 'z']),*/}\r\n      {/*    end: _.pick(noteToDimensions(65), ['x', 'y', 'z']),*/}\r\n      {/*  }}*/}\r\n      {/*/>*/}\r\n\r\n\r\n      <Entity\r\n        _ref={pitchDetectRef}\r\n        primitive='a-sphere'\r\n        material={{\r\n          blending: 'additive',\r\n          color: HSVtoHex(1, 0, 1),\r\n          opacity: 0,\r\n          transparent: true,\r\n        }}\r\n        radius={0.1}\r\n      />\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default PitchClassSpiral;\r\n","import 'aframe-touch-look-controls';\r\nimport Camera from './camera';\r\nimport ColtraneCircle from \"./coltraneCircle\";\r\nimport Dod from './dod';\r\nimport PitchClassCollections from \"./pitchClassCollections\";\r\nimport PitchClassSpiral from \"./pitchClassSpiral\";\r\nimport React from 'react';\r\nimport {Entity, Scene} from 'aframe-react';\r\nimport {Route, Switch} from 'react-router-dom';\r\n\r\n// Note: needs https to enter VR\r\n\r\nconst VR = ({match: {path}}) => (\r\n  <Scene\r\n    // fog={{type: 'linear', color: '#000', near: 1, far: 10}}\r\n  >\r\n    <a-assets>\r\n      {/*<img id=\"groundTexture\" src=\"https://cdn.aframe.io/a-painter/images/floor.jpg\"/>*/}\r\n      {/*<img id=\"skyTexture\" src=\"https://cdn.aframe.io/a-painter/images/sky.jpg\"/>*/}\r\n    </a-assets>\r\n\r\n    <Switch>\r\n      <Route path={`${path}/coltrane`} component={ColtraneCircle}/>\r\n      <Route path={`${path}/dod`} component={Dod}/>\r\n      <Route path={`${path}/pitchClassCollections`} component={PitchClassCollections}/>\r\n      <Route path={`${path}/pitchClassSpiral`} component={PitchClassSpiral}/>\r\n    </Switch>\r\n\r\n\r\n    {/*<Entity primitive=\"a-plane\" src=\"#groundTexture\" rotation=\"-90 0 0\" height=\"100\" width=\"100\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"ambient\" color=\"#445451\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"point\" intensity=\"2\" position=\"2 4 4\"/>*/}\r\n\r\n    {/*<Entity*/}\r\n    {/*  height=\"2048\"*/}\r\n    {/*  primitive=\"a-sky\"*/}\r\n    {/*  radius=\"30\"*/}\r\n    {/*  rotation=\"90 0 0\"*/}\r\n    {/*  src=\"#skyTexture\"*/}\r\n    {/*  theta-length=\"90\"*/}\r\n    {/*  width=\"2048\"*/}\r\n    {/*/>*/}\r\n    {/*<Entity*/}\r\n    {/*  height=\"2048\"*/}\r\n    {/*  primitive=\"a-sky\"*/}\r\n    {/*  radius=\"30\"*/}\r\n    {/*  rotation=\"90 0 180\"*/}\r\n    {/*  src=\"#skyTexture\"*/}\r\n    {/*  theta-length=\"90\"*/}\r\n    {/*  width=\"2048\"*/}\r\n    {/*/>*/}\r\n\r\n    <Camera />\r\n\r\n    <Entity\r\n      // events={{}}\r\n      id=\"leftHand\"\r\n      oculus-touch-controls=\"hand: left\"\r\n    />\r\n    <Entity\r\n      id=\"rightHand\"\r\n      oculus-touch-controls=\"hand: right\"\r\n    />\r\n\r\n  </Scene>\r\n);\r\n\r\nexport default VR;\r\n","import { fraction } from 'mathjs';\r\n\r\nexport const toOctave = (r) => r > 2\r\n  ? toOctave(r / 2)\r\n  : r < 1\r\n    ? toOctave(r * 2)\r\n    : r;\r\n\r\nexport const intToRatio = (i) => fraction(toOctave(i));\r\n\r\n// TODO: n-dimensions\r\nexport const coordToRatio = (x, y) => {\r\n  const raw = Math.pow(3, x) * Math.pow(5, y);\r\n  return fraction(toOctave(raw));\r\n}\r\n\r\n// for(let threes = -5; threes <= 5; threes++) {\r\n//   for(let fives = -5; fives <= 5; fives++) {\r\n//     let f = coordToRatio(threes, fives);\r\n//     console.log(`${f.n}/${f.d}`)\r\n//   }\r\n// }\r\n","// import 'aframe-animation-component';\r\nimport 'aframe';\r\nimport 'aframe-look-at-component';\r\nimport Banjo from './banjo';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Guitar from './guitar';\r\nimport Intro from './intro';\r\nimport MultTableMod12 from './multTableMod12';\r\nimport NumpadMod12 from './numpadMod12';\r\nimport OSC from 'osc-js';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Mandelbrot from './mandelbrot';\r\nimport Mandolin from './mandolin';\r\nimport Mic from './mic';\r\nimport Midi from './midi';\r\nimport RatioLightship from './ratioLightship';\r\nimport Staff from './staff';\r\nimport Tonnetz from './tonnetz';\r\nimport Ukulele from './ukulele';\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\nimport VR from './vr';\r\nimport {\r\n  AppBar,\r\n  IconButton,\r\n  Menu,\r\n  MenuItem,\r\n  Toolbar,\r\n} from '@material-ui/core';\r\nimport {BrowserRouter as Router, Route, Link} from 'react-router-dom';\r\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport {\r\n  Menu as MenuIcon,\r\n  MenuBookIcon,\r\n  WatchLater as MidiClockIcon,\r\n} from '@material-ui/icons';\r\nimport _ from 'lodash';\r\n\r\nimport { intToRatio } from \"./fns\";\r\n\r\nwindow.intToRation = intToRatio;\r\n\r\nconst doWhenAframeLoaded = () => {\r\n  if (typeof AFRAME === 'undefined') {\r\n    setTimeout(doWhenAframeLoaded, 100);\r\n    return;\r\n  }\r\n\r\n  const oscHost = {\r\n    host: window.location.hostname,\r\n    port: '8080',\r\n    secure: true,\r\n  };\r\n  const osc = new OSC({\r\n    plugin: new OSC.WebsocketClientPlugin(oscHost),\r\n  });\r\n  osc.open();\r\n  window.osc = osc;\r\n\r\n  // window.sendOsc = (address, ...args) => osc.send(new OSC.Message(address, ...args));\r\n\r\n  // osc.on('/midiSeq/clear', () => clearSeq());\r\n\r\n  // osc.on('/midiSeq/beat', ({args: [beat]}) => setBeat(beat));\r\n\r\n  // WIP\r\n  window.AFRAME.registerComponent('midi', {\r\n    init: function() {\r\n      // this.onOsc = (i, e) => {};\r\n\r\n      this._onOscId = osc.on('/midi/*', ({address, args: [note, vel]}) => {\r\n        const instrument = _.last(address.split('/'));\r\n        if (this.onOsc) this.onOsc({ instrument, note, vel });\r\n      });\r\n\r\n    },\r\n\r\n    tick: function (time, timeDelta) {\r\n      if (this.onTick) this.onTick(time, timeDelta);\r\n    },\r\n\r\n    remove: function() {\r\n      osc.off('/midi/*', this._onOscId);\r\n    },\r\n  });\r\n\r\n  window.AFRAME.registerComponent('osc', {\r\n    init: function() {\r\n      // this.onOsc = (i, e) => {};\r\n\r\n      this._onOscId = osc.on('/midi/*', ({address, args: [note, vel]}) => {\r\n        const instrument = _.last(address.split('/'));\r\n        if (this.onOsc) this.onOsc({ instrument, note, vel });\r\n      });\r\n\r\n    },\r\n\r\n    tick: function (time, timeDelta) {\r\n      if (this.onTick) this.onTick(time, timeDelta);\r\n    },\r\n\r\n    remove: function() {\r\n      osc.off('/midi/*', this._onOscId);\r\n    },\r\n  });\r\n}\r\ndoWhenAframeLoaded();\r\n\r\nconst routes2d = [\r\n  ['Mod12 Multiplication Tables', '/multTableMod12', MultTableMod12],\r\n  ['PC-Number Notepad', '/numpadMod12', NumpadMod12],\r\n  ['OSC Dataviz', '/osc', OSC, true],\r\n  ['PC Tonnetz', '/tonnetz', Tonnetz],\r\n  ['Banjo PCs', '/banjo', Banjo],\r\n  ['Guitar PCs', '/guitar', Guitar],\r\n  ['Mandolin PCs', '/mandolin', Mandolin],\r\n  ['Ukulele PCs', '/ukulele', Ukulele],\r\n  ['Staff', '/staff', Staff],\r\n  ['Mandelbrot', '/mandelbrot', Mandelbrot],\r\n  ['Ratio Lightship', '/ratioLightship', RatioLightship],\r\n];\r\n\r\nconst App = () => {\r\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\r\n\r\n  const neutral = {\r\n    palette: { // https://material-ui.com/customization/palette/\r\n      action: {\r\n        active: '#660000',\r\n      },\r\n      primary: {\r\n        main: '#330033'\r\n      },\r\n      type: 'dark',\r\n    },\r\n  };\r\n\r\n  const dark = {\r\n    palette: { // https://material-ui.com/customization/palette/\r\n      action: {\r\n        active: '#660000',\r\n      },\r\n      primary: {\r\n        main: '#330033'\r\n      },\r\n      type: 'dark',\r\n    },\r\n  };\r\n\r\n  const light = {\r\n    palette: { // https://material-ui.com/customization/palette/\r\n      action: {\r\n        active: '#660000',\r\n      },\r\n      primary: {\r\n        main: '#330033'\r\n      },\r\n      type: 'light',\r\n    },\r\n  };\r\n\r\n  const theme = React.useMemo(\r\n    () =>\r\n      createMuiTheme(prefersDarkMode ? dark : light),\r\n    [prefersDarkMode],\r\n  );\r\n\r\n  // Menu open/close\r\n  const [menuAnchorEl, setMenuAnchorEl] = React.useState(null);\r\n  const handleMenuButtonClick = ({ currentTarget }) => setMenuAnchorEl(currentTarget);\r\n  const handleMenuClose = () => setMenuAnchorEl(null);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline/>\r\n      <Router basename={process.env.PUBLIC_URL}>\r\n        <Route path=\"/\" exact component={Intro}/>\r\n\r\n        <Route path=\"/vr\" component={VR} />\r\n\r\n        {routes2d.map(([title, path, component], key) => (\r\n          <Route {...{ component, key, path }} />\r\n        ))}\r\n\r\n        <AppBar\r\n          color=\"transparent\"\r\n          onClick={() => {\r\n            // if (window.audioContext) { // FIXME HACK\r\n            //   window.audioContext.resume();\r\n            //   window.detector.start();\r\n            // }\r\n          }}\r\n          position=\"fixed\"\r\n          style={{\r\n            top: 'auto',\r\n            bottom: 0,\r\n          }}\r\n        >\r\n          <Toolbar>\r\n            <IconButton\r\n              edge=\"start\"\r\n              color=\"inherit\"\r\n              aria-label=\"open drawer\"\r\n              onClick={handleMenuButtonClick}\r\n            >\r\n              <MenuIcon/>\r\n            </IconButton>\r\n\r\n            <Menu\r\n              anchorEl={menuAnchorEl}\r\n              open={!!menuAnchorEl}\r\n              onClose={handleMenuClose}\r\n            >\r\n              <MenuItem>\r\n                <Link style={{ color: 'lightgrey'}} onClick={handleMenuClose} to=\"/\">Introduction</Link>\r\n              </MenuItem>\r\n              <MenuItem disabled divider >2D</MenuItem>\r\n              {routes2d.map(([title, url, component, isDevOnly], idx) => !isDevOnly && (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'darkmagenta'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n              <MenuItem disabled divider>VR</MenuItem>\r\n              {[\r\n                ['Coltrane Circle', '/vr/coltrane'],\r\n                ['Dod', '/vr/dod'],\r\n                ['PitchClassCollections', '/vr/pitchClassCollections'],\r\n                ['PitchClassSpiral', '/vr/pitchClassSpiral'],\r\n              ].map(([title, url], idx) => (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'cyan'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n            </Menu>\r\n\r\n            <Midi />\r\n\r\n            <Mic />\r\n          </Toolbar>\r\n        </AppBar>\r\n      </Router>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nReactDOM.render(<App/>, document.querySelector('#sceneContainer'));\r\n"],"sourceRoot":""}