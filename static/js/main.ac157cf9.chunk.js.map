{"version":3,"sources":["cell.js","fretMarkers.js","util.js","pc.js","banjo.js","guitar.js","intro.js","multTableMod12.js","numpadMod12.js","useOsc.js","osc.js","mandelbrotP5.js","mandelbrot.js","staff.js","tonnetz.js","ukulele.js","color.js","pitchClass.js","useMidi.js","coltraneCircle.js","dod.js","vr.js","index.js"],"names":["Cell","withStyles","root","fontSize","fontFamily","display","height","width","alignItems","justifyContent","el","odd","left","cellSize","position","_ref","children","classes","_ref$className","className","isOdd","style","react_default","a","createElement","concat","FretMarkers","fretMarker","color","frets","_","range","last","map","f","includes","fret","ix","cell","key","toSymbol","n","10","11","PC","Banjo","flexShrink","fretMarkers","pc0","pc0ix","Fragment","i","pc","src_pc","Guitar","overflowY","padding","MultTableMod12","margin","y","x","NumpadMod12","state","text","handleKeyPress","evt","char","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadDivide","NumpadMultiply","NumpadDecimal","NumpadEnter","Enter","Space","code","preventDefault","_this","setState","handleChange","value","target","window","addEventListener","this","removeEventListener","cols","rows","onChange","background","Component","newEmptyMidi","zipObject","fill","Array","initialState","beat","midi","ewi","seq","oscHost","actions","clearSeq","store","setBeat","setInSeq","data","set","setMidiEvent","instrument","midiEvt","toPairs","parseInt","merge","Object","defineProperty","setOscHost","globalHook","React","Osc","_useOsc","useOsc","_useOsc2","slicedToArray","useEffect","host","location","hostname","port","osc","OSC","plugin","WebsocketClientPlugin","open","on","_ref2","args","_ref3","address","_ref3$args","note","vel","split","_ref4","takeRight","chunk","_ref5","_ref6","pcs","_ref7","_state$midi$ewi","ewiNote","ewiVel","backgroundColor","_ref8","idx","theta","Math","PI","borderRadius","sin","top","cos","decayDuration","exciteEnergy","exciteDuration","fundamentalFreq","hilbertN","hilbMand","isPlaying","isRegenNeeded","maxIters","panX","panY","partials","partialsCountMax","isSmooth","tick","tickDuration","tickLastMillis","zoom","audioCtx","AudioContext","oscs","masterGain","createGain","gain","connect","destination","sketch","p5","hilbGetRotatedVec","v","rx","ry","temp","dot","v1","v2","reduce","acc","val","mandGetValFromNormalizedCoords","xN","yN","maxIterations","_mandGetDenormalizedC","mandGetDenormalizedCoords","cx","cy","z","log2","mandGetValSmooth","scaledX","scaledY","iter","xTemp","mandGetVal","genHilbertCoords","memoize","d","dist","s","hilbDistanceToCoords","getStrokeWeight","w","sideLength","min","getPartialOfOctaveStart","pow","dropWhile","first","getColorForMandelbrotVal","m","p","isCursor","arguments","length","undefined","_p5$state2","octMax","oct","h","b","setFillColorForMandelbrotVal","coordsWithVal","drawHilbertCoord","hilbertCoord","scaleX","scaleY","rect","getSideLengthForLinearizedMap","dMax","maxA","largestPossibleSide","sqrt","sqPerRow","drawLinearizedMandelbrotCoord","valsPerRow","floor","genAndDrawHilbertMandelbrot","forEach","cancelScheduledValues","currentTime","linearRampToValueAtTime","stop","createOscillator","start","_p5$state3","_p5$state","genHilbertMandelbrot","filter","identity","uniq","sort","take","partial","amp","oscIdx","fromPairs","each","decayTimerId","zeroGainTimerId","clearTimeout","frequency","prevState","nextState","objectSpread","strokeWeight","stroke","coordWithVal","push","translate","pop","drawHilbertMandelbrot","cursorDraw","id","coordAndVal","maxD","prevD","prevCoordAndVal","cursorErasePrev","setup","createCanvas","_width","_height","colorMode","HSB","draw","_p5$state6","now","millis","every","_p5$state4","currGain","isNumber","targetGain","setTimeout","exponentialRampToValueAtTime","cursorExcite","noStroke","_p5$state5","targetAmp","barH","barW","c","hue","partialsDraw","toggleAudio","resume","suspend","useP5","_useState","useState","_useState2","sketchState","setSketchState","_useState3","_useState4","sketchInstance","setSketchInstance","_useState5","_useState6","resizeObserver","setResizeObserver","ref","useCallback","console","log","instance","P5","clientHeight","clientWidth","ResizeObserver","_ref2$0$contentRect","contentRect","resizeCanvas","resize","observe","disconnect","Slider","stateKey","props","objectWithoutProperties","assign","type","ev","Number","Mandelbrot","_useP","handler","shiftKey","panDelta","isEmpty","handleKeyDown","alignSelf","bottom","mandelbrot_Slider","max","step","onMouseUp","VF","Vex","Flow","Staff","_useVexFlow","context","setContext","renderer","Renderer","Backends","SVG","getContext","useVexFlow","setStrokeStyle","setFillStyle","treble","Stave","addClef","addKeySignature","addTimeSignature","bass","StaveConnector","setType","BRACE","SINGLE_LEFT","Tonnetz","Ukulele","HSVtoHex","r","g","q","t","componentToHex","hex","toString","rgbToHex","round","pitchClass","midiIn","_ref$position","_ref$scale","scale","opacity","radius","align","font","negate","look-at","input","inputDevices","isDeviceSelectorVisible","setInputDevice","amount","newCounterValue","counter","setInputDevices","toggleDeviceSelector","ColtraneCircle","is180","setIs180","toggle","_useMidi","useMidi","midiInPitchClasses","pickBy","values","sum","animation","c1","c2","verts","Dod","_ref$rep","rep","sat","_ref$stack","stack","_ref$n","events","click","primitive","join","toConsumableArray","VR","path","match","src","react_router","component","rotation","theta-length","animation__click","property","startEvents","from","to","dur","oculus-touch-controls","routes2d","ReactDOM","render","prefersDarkMode","useMediaQuery","theme","useMemo","createMuiTheme","palette","action","active","primary","main","_React$useState","_React$useState2","menuAnchorEl","setMenuAnchorEl","handleMenuClose","ThemeProvider","CssBaseline","react_router_dom","basename","process","exact","Intro","routerProps","vr","AppBar","Toolbar","IconButton","edge","aria-label","onClick","currentTarget","esm_Menu","Menu","anchorEl","onClose","MenuItem","disabled","divider","title","url","document","querySelector"],"mappings":"sMAgCeA,EA3BFC,YAAW,CACtBC,KAAM,CACJC,SAAU,GACVC,WAAY,gBACZC,QAAS,cACTC,OAPa,GAQbC,MARa,GASbC,WAAY,SACZC,eAAgB,UAGlBC,GAAI,CACFN,WAAY,YAEdO,IAAK,CACHC,KAAMC,GACNC,SAAU,aAhBDb,CAkBV,SAAAc,GAAA,IAAEC,EAAFD,EAAEC,SAAUC,EAAZF,EAAYE,QAAZC,EAAAH,EAAqBI,iBAArB,IAAAD,EAAiC,GAAjCA,EAAqCE,EAArCL,EAAqCK,MAAOC,EAA5CN,EAA4CM,MAA5C,OACDC,EAAAC,EAAAC,cAAA,OACEL,UAAS,GAAAM,OAAKR,EAAQf,KAAb,KAAAuB,OAAqBN,EAArB,KAAAM,OAAkCL,EAAQH,EAAQN,IAAM,IACjEU,MAAOA,GAENL,KChBUU,EAPKzB,YAAW,CAC7B0B,WAAY,CAACC,MAAO,WADF3B,CAGlB,SAAAc,GAAA,IAAYY,EAAZZ,EAAEE,QAAUU,WAAaE,EAAzBd,EAAyBc,MAAzB,OAAoCC,IAAEC,MAAMD,IAAEE,KAAKH,GAAS,GACzDI,IAAI,SAAAC,GAAC,OAAIJ,IAAEK,SAASN,EAAOK,GAAKA,EAAI,KACpCD,IAAI,SAACG,EAAMC,GAAP,OAAcf,EAAAC,EAAAC,cAACc,EAAD,CAAMnB,UAAWQ,EAAYY,IAAKF,GAAKD,OCVjDI,EAAW,SAAAC,GAAC,MAAK,CAC5BC,GAAI,SACJC,GAAI,UACHF,EAAI,KAAOA,EAAI,ICgBHG,EAdJ3C,YAAW,CACpBS,GAAI,CACFN,WAAY,aAFLH,CAIR,SAAAc,GAAA,IAAEE,EAAFF,EAAEE,QAASwB,EAAX1B,EAAW0B,EAAGrB,EAAdL,EAAcK,MAAOC,EAArBN,EAAqBM,MAArB,OACDC,EAAAC,EAAAC,cAACc,EAAD,CACEnB,UAAWsB,EAAI,KAAO,GAAKxB,EAAQP,GAAK,GACxCU,MAAOA,EACPC,MAAOA,GAENmB,EAASC,MCTRZ,EAAQ,CAAC,EAAE,EAAE,EAAE,EAAE,GAAG,GAAG,GAAG,GAAG,IAyBpBgB,EAvBD,kBACZvB,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVhB,QAAS,QACTyC,WAAY,IAEZxB,EAAAC,EAAAC,cAACuB,EAAD,CAAalB,MAAOA,IACpBP,EAAAC,EAAAC,cAAA,WACC,CAAC,EAAG,EAAG,EAAG,EAAG,GAAGS,IAAI,SAACe,EAAKC,GAAN,OACnB3B,EAAAC,EAAAC,cAAAF,EAAAC,EAAA2B,SAAA,KACGpB,IAAEC,MAAM,IACNE,IAAI,SAAAkB,GAAC,OAAKA,EAAIH,GAAO,KACrBf,IAAI,SAACmB,EAAIf,GAAL,OACO,IAAVY,GAAeZ,EAAK,EAChBf,EAAAC,EAAAC,cAACc,EAAD,CAAMC,IAAKF,IACXf,EAAAC,EAAAC,cAAC6B,EAAD,CAAId,IAAKF,EAAII,EAAGW,MAExB9B,EAAAC,EAAAC,cAAA,cAGJF,EAAAC,EAAAC,cAACuB,EAAD,CAAalB,MAAOA,eCtBlBA,EAAQ,CAAC,EAAE,EAAE,EAAE,GAAG,GAAG,GAAG,GAAI,IAuBnByB,EArBA,kBACbhC,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVhB,QAAS,QACTyC,WAAY,IAEZxB,EAAAC,EAAAC,cAACuB,EAAD,CAAalB,MAAOA,IACpBP,EAAAC,EAAAC,cAAA,WACC,CAAC,EAAG,GAAI,EAAG,EAAG,EAAG,GAAGS,IAAI,SAAAe,GAAG,OAC1B1B,EAAAC,EAAAC,cAAAF,EAAAC,EAAA2B,SAAA,KACGpB,IAAEC,MAAM,IACNE,IAAI,SAAAkB,GAAC,OAAKA,EAAIH,GAAO,KACrBf,IAAI,SAACmB,EAAIf,GAAL,OACHf,EAAAC,EAAAC,cAAC6B,EAAD,CAAId,IAAKF,EAAII,EAAGW,MAEpB9B,EAAAC,EAAAC,cAAA,cAGJF,EAAAC,EAAAC,cAACuB,EAAD,CAAalB,MAAOA,MCwCTgB,EA5DD,kBACZvB,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CAACf,OAAQ,OAAQiD,UAAW,OAAQC,QAAS,YACvDlC,EAAAC,EAAAC,cAAA,8CAEAF,EAAAC,EAAAC,cAAA,yVAMAF,EAAAC,EAAAC,cAAA,8bAOAF,EAAAC,EAAAC,cAAA,6KAEkDF,EAAAC,EAAAC,cAAA,eAFlD,kEAGQF,EAAAC,EAAAC,cAAA,gBAHR,4aASAF,EAAAC,EAAAC,cAAA,mUAMAF,EAAAC,EAAAC,cAAA,2FACiFF,EAAAC,EAAAC,cAAA,+BADjF,sjBASAF,EAAAC,EAAAC,cAAA,0bAOAF,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,WAEAF,EAAAC,EAAAC,cAAA,8BACAF,EAAAC,EAAAC,cAAA,WAAMM,IAAEC,MAAM,IAAIE,IAAI,SAAAmB,GAAE,OAAI9B,EAAAC,EAAAC,cAAC6B,EAAD,CAAId,IAAKa,EAAIX,EAAGW,OAC5C9B,EAAAC,EAAAC,cAAA,qGC/BWiC,EArBQ,kBACrBnC,EAAAC,EAAAC,cAAAF,EAAAC,EAAA2B,SAAA,KACGpB,IAAEC,MAAM,GAAGE,IAAI,SAAAQ,GAAC,OACfnB,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVhB,QAAS,QACTyC,WAAY,EACZY,OAAQ,QAEP5B,IAAEC,MAAM,IAAIE,IAAI,SAAA0B,GAAC,OAChBrC,EAAAC,EAAAC,cAAAF,EAAAC,EAAA2B,SAAA,KACGpB,IAAEC,MAAM,IAAIE,IAAI,SAAA2B,GAAC,OAChBtC,EAAAC,EAAAC,cAAC6B,EAAD,CAAId,IAAKqB,EAAGnB,EAAGA,EAAImB,EAAID,MAEzBrC,EAAAC,EAAAC,cAAA,sDC2DGqC,6MAxEbC,MAAQ,CACNC,KAAM,MAWRC,eAAiB,SAACC,GAEhB,IAAMC,EAAO,CACXC,UAAW,IACXC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,IACRC,OAAQ,SACRC,MAAO,SACPC,MAAO,IACPC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,QAAS,IACTC,aAAc,SACdC,eAAgB,SAChBC,cAAe,IACfC,YAAa,KACbC,MAAO,KACPC,MAAO,KACP9B,EAAI+B,MAEF9B,IACFD,EAAIgC,iBACJC,EAAKC,SAAS,CAAEpC,KAAMmC,EAAKpC,MAAMC,KAAOG,QAI5CkC,aAAe,SAAArF,GAAA,IAAasF,EAAbtF,EAAGuF,OAAUD,MAAb,OAA0BH,EAAKC,SAAS,CAAEpC,KAAMsC,wFA/C7DE,OAAOC,iBAAiB,WAAYC,KAAKzC,+DAIzCuC,OAAOG,oBAAoB,WAAYD,KAAKzC,iDA8C5C,OAAO1C,EAAAC,EAAAC,cAAA,WACLF,EAAAC,EAAAC,cAAA,mDACAF,EAAAC,EAAAC,cAAA,YACEmF,KAAM,GACNC,KAAM,GACNC,SAAUJ,KAAKL,aACf/E,MAAO,CACLyF,WAAY,QACZlF,MAAO,WACPzB,SAAU,IAEZkG,MAAOI,KAAK3C,MAAMC,eAnEAgD,6CCApBC,EAAe,kBAAMlF,IAAEmF,UAC3BnF,IAAEC,MAAM,KACRD,IAAEoF,KAAK,IAAIC,MAAM,KAAM,KAInBC,GAFYJ,IAEG,CACnBK,KAAM,EACNC,KAAM,CACJC,IAAK,GACLC,IAAKR,KAEPS,QAAS,GACTD,IAAK,KAGDE,EAAU,CACdC,SAAU,SAACC,GAAD,OAAWA,EAAMzB,SAAS,CAACqB,IAAK,MAE1CK,QAAS,SAACD,EAAOP,GAAR,OAAiBO,EAAMzB,SAAS,CAACkB,UAE1CS,SAAU,SAACF,EAAOP,EAAMU,GAAd,OACRH,EAAMzB,SAAS,CAACqB,IAAK1F,IAAEkG,IAAIJ,EAAM9D,MAAM0D,IAAK,CAACH,GAAOU,MAEtDE,aAAc,SAACL,EAAOM,EAAYC,GAApB,OACZP,EAAMzB,SAAS,CAACmB,KAAqB,QAAfY,EAChBpG,IAAEkG,IAAIJ,EAAM9D,MAAMwD,KAAMY,EAAYpG,IAAEsG,QAAQD,GAAS,GAAGlG,IAAI,SAAAQ,GAAC,OAAI4F,SAAS5F,EAAG,OAC/EX,IAAEwG,MAAMV,EAAM9D,MAAMwD,KAApBiB,OAAAC,EAAA,EAAAD,CAAA,GAA4BL,EAAaC,OAEjDM,WAAY,SAACb,EAAOH,GAAR,OAAoBG,EAAMzB,SAAS,CAACsB,cAGnCiB,cAAWC,IAAOvB,EAAcM,GCyDhCkB,EAvFH,WAAM,IAAAC,EAESC,EACvB,SAAA/H,GAAA,MAAiC,CAACsG,KAAlCtG,EAAEsG,KAAsCC,KAAxCvG,EAAQuG,KAAsCG,QAA9C1G,EAAc0G,QAAyCD,IAAvDzG,EAAuByG,MACvB,SAAAE,GAAO,OAAIA,IAJGqB,EAAAR,OAAAS,EAAA,EAAAT,CAAAM,EAAA,GAET/E,EAFSiF,EAAA,GAEFrB,EAFEqB,EAAA,GAOhBE,oBAAU,WACR,IAAMxB,EAAU,CACdyB,KAAM3C,OAAO4C,SAASC,SACtBC,KAAM,QAEFC,EAAM,IAAIC,IAAI,CAClBC,OAAQ,IAAID,IAAIE,sBAAsBhC,KAExC6B,EAAII,OARU,IAaZ/B,EAKED,EALFC,SACAE,EAIEH,EAJFG,QACAC,EAGEJ,EAHFI,SACAG,EAEEP,EAFFO,cAIFQ,EAFIf,EADFe,YAGShB,GAEX6B,EAAIK,GAAG,iBAAkB,kBAAMhC,MAE/B2B,EAAIK,GAAG,gBAAiB,SAAAC,GAAA,IAASvC,EAATkB,OAAAS,EAAA,EAAAT,CAAAqB,EAAEC,KAAF,aAAoBhC,EAAQR,KAEpDiC,EAAIK,GAAG,UAAW,SAAAG,GAAkC,IAAhCC,EAAgCD,EAAhCC,QAAgCC,EAAAzB,OAAAS,EAAA,EAAAT,CAAAuB,EAAvBD,KAAuB,GAAhBI,EAAgBD,EAAA,GAAVE,EAAUF,EAAA,GAC5C9B,EAAapG,IAAEE,KAAK+H,EAAQI,MAAM,MACxClC,EAAaC,EAADK,OAAAC,EAAA,EAAAD,CAAA,GAAe0B,EAAOC,MAGpCZ,EAAIK,GAAG,kBAAmB,SAAAS,GAAqB,IAAnBL,EAAmBK,EAAnBL,QAASF,EAAUO,EAAVP,KAC7BxC,EAAOgB,SAASvG,IAAEuI,UAAUN,EAAQI,MAAM,KAAM,GAAG,GAAI,IAC7DrC,EAAST,EAAMvF,IAAE+H,GAAMS,MAAM,GAAGrI,IAAI,SAAAsI,GAAA,IAAAC,EAAAjC,OAAAS,EAAA,EAAAT,CAAAgC,EAAA,SAAkB,CAACN,KAAnBO,EAAA,GAAyBN,IAAzBM,EAAA,MAAgCnE,YAGrE,IAGH,IAAMoE,GAAO3G,EAAM0D,IAAI1D,EAAMuD,OAAS,IAAIpF,IAAI,SAAAyI,GAAA,OAAAA,EAAET,KAAiB,KA9CjDU,EAAApC,OAAAS,EAAA,EAAAT,CA+CUzE,EAAMwD,KAAKC,IA/CrB,GA+CTqD,EA/CSD,EAAA,GA+CAE,EA/CAF,EAAA,GAiDhB,OAAOrJ,EAAAC,EAAAC,cAAA,WACLF,EAAAC,EAAAC,cAAA,UAAKsC,EAAMuD,MAGX/F,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVyJ,gBAAiB,WACjBlJ,MAAO,QACPtB,OAAQ,OACRQ,SAAU,WACVP,MAAO,UAELuD,EAAM0D,IAAI1D,EAAMuD,OAAS,IAAIpF,IAAI,SAAA8I,EAAcC,GAAQ,IAApBf,EAAoBc,EAApBd,KACnC,OADuDc,EAAdb,IAClC5I,EAAAC,EAAAC,cAAC6B,EAAD,CAAId,IAAKyI,EAAKvI,EAAGwH,MAGxBnI,IAAEC,MAAM,IAAKE,IAAI,SAACmB,EAAI4H,GAEtB,IAAMC,EAAS7H,EAAK,GAAM8H,KAAKC,GAAK,EAEpC,OACE7J,EAAAC,EAAAC,cAAC6B,EAAD,CACEd,IAAKyI,EACLvI,EAAGW,EACH/B,MAAO,CACLO,MAAOE,IAAEK,SAASsI,EAAKrH,GAAM,OAAS,QACtC0D,WAAU,uBAAArF,OAAyB2B,IAAOwH,EAAU,GAAKC,EAAS,IAAM,EAA9D,KACVO,aAAc,MAEdjL,SAAU,QACVW,SAAU,WACVF,KAAI,GAAAa,OAAsC,KAAhC,IAAOyJ,KAAKG,IAAIJ,GAAS,IAA/B,KACJK,IAAG,GAAA7J,OAAuC,MAAhC,IAAOyJ,KAAKK,IAAIN,GAAS,IAAhC,+DCnEJ7D,EAAe,CAC1BoE,cAAe,IACfC,aAAc,IACdC,eAAgB,IAChBC,gBAAiB,GACjBC,SAAU,GACVC,SAAU,GACVC,WAAW,EACXC,eAAe,EACfC,SAAU,KACVC,MAAO,IACPC,KAAM,EACNC,SAAU,GACVC,iBAAkB,GAClBC,UAAU,EACVC,KAAM,EACNC,aAAc,IACdC,eAAgB,EAChBC,KAAM,KAsCJC,EAAW,IAAIC,aACfC,EAAO,GAELC,EAAaH,EAASI,aAC5BvG,OAAOsG,WAAaA,EACpBA,EAAWE,KAAK1G,MAAQ,EACxBwG,EAAWG,QAAQN,EAASO,aAGrB,IAAMC,EAAS,SAACC,GACrBA,EAAGrJ,MAAQsD,EAGX,IAyBMgG,EAAoB,SAAC3K,EAAG4K,EAAGC,EAAIC,GACnC,GAAW,IAAPA,EAAU,CACD,IAAPD,IACFD,EAAEzJ,EAAInB,EAAI,EAAI4K,EAAEzJ,EAChByJ,EAAE1J,EAAIlB,EAAI,EAAI4K,EAAE1J,GAIlB,IAAI6J,EAAOH,EAAEzJ,EACbyJ,EAAEzJ,EAAIyJ,EAAE1J,EACR0J,EAAE1J,EAAI6J,IA6DJC,EAAM,SAACC,EAAIC,GAAL,OAAY7L,IAAE8L,OAAOF,EAAI,SAACG,EAAKC,EAAK9C,GAAX,OAAmB6C,EAAMC,EAAMH,EAAG3C,IAAM,IAuCvE+C,EAAiC,SAACC,EAAIC,EAAIhC,EAAMC,EAAMO,EAAMyB,GAChE,IADkFC,EAlElD,SAACvK,EAAGD,GAAJ,MAAW,CAC3CC,EAAc,IAAJA,EAAN,IACJD,EAAY,EAAJA,EAAJ,GAmEWyK,CAFN,GAAMnC,GAAQ+B,EAAK,IAAOvB,EAC1B,GAAMP,GAAQ+B,EAAK,IAAOxB,GAC5B7I,EAH2EuK,EAG3EvK,EAAGD,EAHwEwK,EAGxExK,EACV,OAAOwJ,EAAGrJ,MAAMuI,SAlCO,SAACgC,EAAIC,EAAIJ,GAMhC,IALA,IAGItK,EAAGD,EAFD4K,EAAI,CAAC,EAAE,GACT9L,EAAI,EAGCU,EAAI,EAAGA,EAAI+K,IACjBtK,EAAQ2K,EAD6B,GAClC5K,EAAK4K,EAD6B,GAEtCA,EAAE,GAAK3K,EAAIA,EAAID,EAAIA,EAAI0K,EACvBE,EAAE,GAAK,EAAI3K,EAAID,EAAI2K,IACfb,EAAIc,EAAGA,GATD,QAKuBpL,IAKjCV,IAIF,OAAOA,GAAKyL,EACRA,EACAzL,EAAIyI,KAAKsD,KAAKtD,KAAKsD,KAAKf,EAAIc,EAAEA,KAAO,EAkBrCE,CAAiB7K,EAAGD,EAAGuK,GA1DV,SAACQ,EAASC,EAAST,GAIpC,IAHA,IAAItK,EAAI,EAAGD,EAAI,EACXiL,EAAO,EAEJhL,EAAIA,EAAID,EAAIA,EAAI,GAAKiL,EAAOV,GAAe,CAChD,IAAIW,EAAQjL,EAAIA,EAAID,EAAIA,EAAI+K,EAC5B/K,EAAI,EAAIC,EAAID,EAAIgL,EAChB/K,EAAIiL,EACJD,IAEF,OAAOA,EAiDHE,CAAWlL,EAAGD,EAAGuK,IAGjBa,EAAmBjN,IAAEkN,QAAQ,SAACpD,GAAD,OACjC9J,IAAEC,MAAM6J,EAAWA,GAChB3J,IAAI,SAAAgN,GAAC,OA3GmB,SAACrD,EAAUsD,GAWtC,IAPA,IAAM7B,EAAI,CAACzJ,EAAG,EAAGD,EAAG,GAOXwL,EAAI,EAAGA,EAAIvD,EAAUuD,GAAK,EAAG,CACpC,IAAI7B,EAAK,EAAK4B,EAAO,EACjB3B,EAAK,GAAK2B,EAAO5B,GACrBF,EAAkB+B,EAAG9B,EAAGC,EAAIC,GAC5BF,EAAEzJ,GAAKuL,EAAI7B,EACXD,EAAE1J,GAAKwL,EAAI5B,EACX2B,GAAQ,EAEV,OAAO7B,EAwFK+B,CAAqBxD,EAAUqD,OA2BvCI,EAAkB,SAACC,GACvB,IAAMC,EAAaD,EAAInC,EAAGrJ,MAAM8H,SAChC,OA7KyB,EA6KGV,KAAKsE,IAAI,GAAID,EAAa,KAGlDE,EAA0B3N,IAAEkN,QAAQ,SAAC9M,GAAD,OACxCJ,IAAE,KACCC,QACAE,IAAI,SAAAQ,GAAC,OAAIyI,KAAKwE,IAAI,EAAGjN,KACrBkN,UAAU,SAAAlN,GAAC,OAAIP,EAAIO,GAAK,IACxBmN,UAECC,EAA2B,SAAA/F,GAA8B,IAA5BgG,EAA4BhG,EAA5BgG,EAAGC,EAAyBjG,EAAzBiG,EAAIC,EAAqBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAAAG,EAIzDjD,EAAGrJ,MAFLkI,EAF2DoE,EAE3DpE,SACAI,EAH2DgE,EAG3DhE,iBAGIiE,EAASZ,EAAwBrD,GACjCkE,EAAMb,EAAwBM,GAM9BQ,EAAI,IAAMrF,KAAKsD,KAAKuB,EAAIO,GACxBnB,EAAIa,EAAW,EAAI,IAAkC,IAA5B9E,KAAKwE,IAAIY,EAAMD,EAAQ,GAChDG,EAAIV,IAAM9D,EAAW,EAAI,IAE/B,OAAOmB,EAAGvL,MAAM2O,EAAGpB,EAAGqB,EAAGR,EAzMN,GAyMgC,MAG/CS,EAA+B,SAACC,GAAoC,IAArBV,EAAqBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GACxE9C,EAAGjG,KAAK2I,EAAyBa,GAAgBV,IAG7CW,EAAmB,SAACrB,EAAGiB,EAAGK,EAAchF,GAC5C,IAAMiF,EAASvB,EAAI1D,EACbkF,EAASP,EAAI3E,EACnBuB,EAAG4D,KAAKH,EAAahN,EAAIiN,EAAQD,EAAajN,EAAImN,EAAQD,EAAQC,IAmC9DE,EAAgC,SAACC,EAAM3B,EAAGiB,GAK9C,IAJA,IAAMW,EAAO5B,EAAIiB,EACXY,EAAsBjG,KAAKkG,KAAKF,EAAOD,GAEzC9B,EAAI,EACChM,EAAI,EAAGA,EAAImM,EAAGnM,IAErB,MADAgM,EAAIG,EAAInM,GACAgO,GAAR,CAIA,IAAME,EAAW/B,EAAIH,EAIrB,GAHa8B,EAAOI,EAGTlC,GAFM8B,EAAOI,EAEG,EAAIlC,EAAI,IAAMoB,EACvC,MAGJ,OAAOpB,GAGHmC,EAAgC,SAAChC,EAAGH,EAAGF,GAC3C,IAAMsC,EAAajC,EAAIH,EAEnBvL,EAAIqL,EAAIsC,EACN5N,EAAIuH,KAAKsG,MAAMvC,EAAIsC,GAGrB5N,EAAI,IAAM,IACZC,EAAI2N,GAAc3N,EAAI,IAGxBuJ,EAAG4D,KAAKnN,EAAIuL,EAAGxL,EAAIwL,EAAGA,EAAGA,IAGrBsC,EAA8B,WAClCtE,EAAGrG,WAAW,IAGd8F,EAAK8E,QAAQ,SAAAtH,GAAY,IAAV2C,EAAU3C,EAAV2C,KACbA,EAAKA,KAAK4E,sBAAsBjF,EAASkF,aACzC7E,EAAKA,KAAK8E,wBAAwB,EAAGnF,EAASkF,YAAc,MAG1DhF,EAAKsD,SAAW9D,IA9RpBQ,EAAK8E,QAAQ,SAAA3Q,GACb,IADeuI,EACfvI,EADeuI,IACfvI,EADoBgM,KAElBzD,EAAIwI,SAGNlF,EAAO9K,IAAEC,MAAMoL,EAAGrJ,MAAMsI,kBAAkBnK,IAAI,WAC5C,IAAMqH,EAAMoD,EAASqF,mBACfhF,EAAOL,EAASI,aAKtB,OAJAC,EAAKA,KAAK1G,MAAQ,EAClBiD,EAAI0D,QAAQD,GACZA,EAAKC,QAAQH,GACbvD,EAAI0I,QACG,CAAC1I,MAAKyD,UAGfxG,OAAOqG,KAAOA,GAsQ0B,IAAAqF,EAgBpC9E,EAAGrJ,MAFL6H,EAdsCsG,EActCtG,gBACAS,EAfsC6F,EAetC7F,iBAGIP,EAxJqB,WAAM,IAAAqG,EAQ7B/E,EAAGrJ,MANL8H,EAF+BsG,EAE/BtG,SACAI,EAH+BkG,EAG/BlG,SACAC,EAJ+BiG,EAI/BjG,KACAC,EAL+BgG,EAK/BhG,KACAE,EAN+B8F,EAM/B9F,iBACAK,EAP+ByF,EAO/BzF,KAIF,OAAOsC,EAAiBnD,GAAU3J,IAAI,SAAA2H,GAAc,IAAXhG,EAAWgG,EAAXhG,EAAGD,EAAQiG,EAARjG,EACpCmM,EAAI/B,EAA+BnK,EAAIgI,EAAUjI,EAAIiI,EAAUK,EAAMC,EAAMO,EAAMT,GACvF,MAAO,CACLpI,IACAD,IACAmM,IACAC,EAAGD,IAAM9D,EACL,EACAd,KAAKsG,OAAQ1B,EAAI,GAAK1D,EAAoB,MAqIjC+F,GAEXhG,EAAWrK,IAAE+J,GAChB5J,IAAI,SAAAsI,GAAA,OAAAA,EAAEwF,IACNqC,OAAOtQ,IAAEuQ,UACTC,OACAC,OACAC,KAAKpG,GACLnK,IAAI,SAACwQ,EAAStP,GAAV,MAAgB,CAACsP,EAAS,CAACC,IAAK,EAAGC,OAAQxP,MAC/CyP,YACAvM,QAGHvE,IAAE+Q,KAAK1G,EAAU,SAAA3B,EAA0CiI,GAAY,IAApDK,EAAoDtI,EAApDsI,aAAcH,EAAsCnI,EAAtCmI,OAAQI,EAA8BvI,EAA9BuI,gBACvCC,aAAaF,GACbE,aAAaD,GACbnG,EAAK+F,GAAQrJ,IAAI2J,UAAUtB,sBAAsBjF,EAASkF,aAC1DhF,EAAK+F,GAAQrJ,IAAI2J,UAAUpB,wBAAwBY,EAAU9G,EAAiBe,EAASkF,YAAc,MAGvGzE,EAAGhH,SAAS,SAAA+M,GACV,IAAMC,EAAS5K,OAAA6K,EAAA,EAAA7K,CAAA,GACV2K,EADU,CAEbrH,WACAE,eAAe,EACfI,aAGF,OAjH0B,SAACmD,EAAGiB,EAAGzM,GAAU,IAE3C8H,EAEE9H,EAFF8H,SACAC,EACE/H,EADF+H,SAGIwH,EAAehE,EAAgBlC,EAAG5M,MAAQ,GAChD4M,EAAGkG,aAAaA,GAChBlG,EAAGmG,OA7NgB,GA+NnB,IAAMnE,EAAI6B,EAA8BnF,EAASqE,OAAQ/C,EAAG5M,MAAQ,EAAG4M,EAAG7M,QAE1EuL,EAAS6F,QAAQ,SAAC6B,EAActE,GAC9BwB,EAA6B8C,GAE7BpG,EAAGqG,OAEDrG,EAAGsG,UAAUtG,EAAG5M,MAAQ,EAAG,GAC3BoQ,EAAiBrB,EAAGiB,EAAGgD,EAAc3H,GAEvCuB,EAAGuG,MAEHvG,EAAGqG,OAEDrG,EAAGsG,UAAWtG,EAAG5M,MAAQ,EAAK,EAAG,GACjC+Q,EAA8BnE,EAAG5M,MAAQ,EAAG4O,EAAGF,GAEjD9B,EAAGuG,QAqFHC,CAAuBxG,EAAG5M,MAAQ,EAAG4M,EAAG7M,OAAQ6S,GACzCA,KA4BLS,EAAa,SAACC,GAAO,IAClBhI,EAAYsB,EAAGrJ,MAAf+H,SACDoD,EAAI9B,EAAGrJ,MAAMwI,KAAOT,EAASqE,OAC7B4D,EAAcjI,EAASoD,GACvBM,EAAayB,EAA8BnF,EAASqE,OAAQ/C,EAAG5M,MAAQ,EAAG4M,EAAG7M,QAC7E+S,EAAehE,EAAgBlC,EAAG5M,MAAQ,GAEhD4M,EAAGkG,aAAaA,GA9BM,SAACU,EAAM5E,EAAGF,GAChC,IAAM+E,GAASD,EAAO9E,EAAI,GAAK8E,EAEzBE,EADa9G,EAAGrJ,MAAf+H,SAC0BmI,GAEjCvD,EAA6BwD,GAC7B9G,EAAGmG,OAjVgB,GAmVnBnG,EAAGqG,OAEDrG,EAAGsG,UAAUtG,EAAG5M,MAAQ,EAAG,GAC3BoQ,EAAiBxD,EAAG5M,MAAQ,EAAG4M,EAAG7M,OAAQ2T,EAAiB9G,EAAGrJ,MAAM8H,UAEtEuB,EAAGuG,MAEHvG,EAAGqG,OAEDrG,EAAGsG,UAAWtG,EAAG5M,MAAQ,EAAK,EAAG,GACjC+Q,EAA8BnE,EAAG5M,MAAQ,EAAG4O,EAAG6E,GAEjD7G,EAAGuG,MAWHQ,CAAgBrI,EAASqE,OAAQX,EAAYN,GAC7C9B,EAAGmG,OA9WkC,GA8WOO,EAAM,IAAK,EAAG,KAC1DpD,EAA6BqD,GAAa,GAE1C3G,EAAGqG,OAEDrG,EAAGsG,UAAUtG,EAAG5M,MAAQ,EAAG,GAC3BoQ,EAAiBxD,EAAG5M,MAAQ,EAAG4M,EAAG7M,OAAQwT,EAAa3G,EAAGrJ,MAAM8H,UAElEuB,EAAGuG,MAEHvG,EAAGqG,OAEDrG,EAAGsG,UAAWtG,EAAG5M,MAAQ,EAAK,EAAG,GACjC4M,EAAGkG,aAAaA,GAChB/B,EAA8BnE,EAAG5M,MAAQ,EAAGgP,EAAYN,GAE1D9B,EAAGuG,OA2ELvG,EAAGgH,MAAQ,WACThH,EAAGiH,aAAajH,EAAGkH,OAAQlH,EAAGmH,SAC9BnH,EAAGoH,UAAUpH,EAAGqH,KAChB/C,KAGFtE,EAAGsH,KAAO,WAAM,IAAAC,EAMVvH,EAAGrJ,MAJLgI,EAFY4I,EAEZ5I,UACAC,EAHY2I,EAGZ3I,cACAQ,EAJYmI,EAIZnI,aACAC,EALYkI,EAKZlI,eAGET,GACF0F,IAGF,IAAMkD,EAAMxH,EAAGyH,SAEX9S,IAAE+S,MAAM,EACT9I,EACDD,EACA6I,EAAMnI,EAAiBD,MAEvBqH,EAAW,GAjGM,SAACC,GAAO,IAAAiB,EAQvB3H,EAAGrJ,MANL0H,EAFyBsJ,EAEzBtJ,cACAC,EAHyBqJ,EAGzBrJ,aACAC,EAJyBoJ,EAIzBpJ,eACAG,EALyBiJ,EAKzBjJ,SACAM,EANyB2I,EAMzB3I,SAKK4D,EAAKlE,EAXeiJ,EAOzBxI,KAGeT,EAASqE,QACnBH,EAEP,GAAIA,EAAI,EAAG,CACT,IAAM0C,EAAUtG,EAAS4D,GAEvB2C,EAIED,EAJFC,IACAI,EAGEL,EAHFK,aACAH,EAEEF,EAFFE,OACAI,EACEN,EADFM,gBAEKhG,EAAQH,EAAK+F,GAAb5F,KAGDgI,EADYjT,IAAEkT,SAASlC,GACAJ,EAAM3F,EAAKA,KAAK1G,MAIvC4O,EAAa,GAAM/J,KAAKsE,IAAI,EAAGuF,EAAWtJ,GAAgB,EAAIsJ,IACpEtC,EAAQC,IAAMuC,EAEdjC,aAAaF,GACbE,aAAaD,GACbhG,EAAKA,KAAK4E,sBAAsB,GAChC5E,EAAKA,KAAK8E,wBAAwBoD,EAAYvI,EAASkF,YAAclG,EAAiB,KAEtF+G,EAAQK,aAAeoC,WAAW,WAChCnI,EAAKA,KAAKoI,6BAA6B,KAASzI,EAASkF,YAAcpG,EAAgB,KACvFiH,EAAQK,aAAe,KAEvBL,EAAQM,gBAAkBmC,WAAW,WACnCzC,EAAQC,IAAM,GACblH,IACFE,IAuDH0J,GACAjI,EAAGrJ,MAAMwI,OACTa,EAAGrJ,MAAM0I,eAAiBmI,GArDT,WACnB,IAAMpE,EAAIpD,EAAG7M,OACPgP,EAAInC,EAAG5M,MAAQ,EAErB4M,EAAGkI,WAJsB,IAAAC,EAMcnI,EAAGrJ,MAAlCqI,EANiBmJ,EAMjBnJ,SAAUC,EANOkJ,EAMPlJ,iBAElBtK,IAAE+Q,KAAK1G,EAAU,SAAAzB,EAA6BqF,GAAM,IAA3BwF,EAA2B7K,EAAhCgI,IAAgBC,EAAgBjI,EAAhBiI,OAC5B6C,EAAOjF,EAAInE,EACXzI,EAAI4M,IAAMR,EAAI,GAAK3D,GACnBqJ,EAAO7I,EAAK+F,GAAQ5F,KAAKA,KAAK1G,MAAQiJ,EAEtCoG,EAAI7F,EAAyB,CAAEC,EAAG,EAAGC,MAC3C5C,EAAGjG,KAAKiG,EAAGvL,MAAMuL,EAAGwI,IAAID,GAAI,IAAK,IACjCvI,EAAG4D,KAAK,EAAGpN,EAAG2L,EAAGkG,GAEjBrI,EAAGjG,KAAKwO,GACRvI,EAAG4D,KAAK,EAAGpN,EAAG8R,EAAMD,GACpBrI,EAAGjG,KAAK,KACRiG,EAAG4D,KAAKwE,EAAYjG,EAAG3L,EAAG,EAAG6R,KAoC/BI,IAOFzI,EAAG0I,YAAc,SAAC/J,GACZA,GAAgC,YAAnBY,EAAS5I,OACxB4I,EAASoJ,SAGNhK,GAAgC,YAAnBY,EAAS5I,OACzB4I,EAASqJ,YCxkBTC,EAAQ,SAAC9I,GAAW,IAAA+I,EACcC,mBAAS9O,GADvB+O,EAAA5N,OAAAS,EAAA,EAAAT,CAAA0N,EAAA,GACjBG,EADiBD,EAAA,GACJE,EADIF,EAAA,GAAAG,EAEoBJ,mBAAS,MAF7BK,EAAAhO,OAAAS,EAAA,EAAAT,CAAA+N,EAAA,GAEjBE,EAFiBD,EAAA,GAEDE,EAFCF,EAAA,GAAAG,EAGoBR,mBAAS,MAH7BS,EAAApO,OAAAS,EAAA,EAAAT,CAAAmO,EAAA,GAGjBE,EAHiBD,EAAA,GAGDE,EAHCF,EAAA,GAKpBH,IACFA,EAAerQ,SAAWkQ,EAC1BG,EAAe1S,MAAQsS,GAGzB,IAAMU,EAAMC,sBAAY,SAACrW,GAEvB,GADAsW,QAAQC,IAAI,eACRvW,EAAI,CACN,IAAMwW,EAAW,IAAIC,IAAGjK,EAAQxM,GAChC+V,EAAkBS,GAElBA,EAAS5C,QAAU5T,EAAG0W,aACtBF,EAAS7C,OAAS3T,EAAG2W,YAErB,IAKMT,EAAiB,IAAIU,eAAe,SAAAvW,GAAsC,IAAAwW,EAAAhP,OAAAS,EAAA,EAAAT,CAAAxH,EAAA,MAAnCyW,YAAclX,EAAqBiX,EAArBjX,QAL5C,SAACC,EAAOD,GACrB4W,EAASO,aAAalX,EAAOD,GAC7B+V,EAAe,SAACnD,GAAD,OAAA3K,OAAA6K,EAAA,EAAA7K,CAAA,GAAoB2K,EAApB,CAA+BnH,eAAe,MAI7D2L,CAD8EH,EAAbhX,MACnDD,KAEhBuW,EAAkBD,GAClBA,EAAee,QAAQjX,QAEvBkW,EAAegB,cAEhB,IAEH,MAAO,CACLpB,iBACAJ,cACAC,iBACAS,QAyKEe,EAAS,SAAA/N,GAAA,IAAGsM,EAAHtM,EAAGsM,YAAaC,EAAhBvM,EAAgBuM,eAAgByB,EAAhChO,EAAgCgO,SAAaC,EAA7CxP,OAAAyP,EAAA,EAAAzP,CAAAuB,EAAA,oDACXxI,EAAAC,EAAAC,cAAA,WACGsW,EADH,KACe1B,EAAY0B,GACzBxW,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAAA,QAAA+G,OAAA0P,OAAA,CACEC,KAAK,QACL7W,MAAO,CAACd,MAAO,KACf8F,MAAO+P,EAAY0B,GACnBjR,SAAU,SAAAsR,GACR,IAAM9R,EAAQ+R,OAAOD,EAAG7R,OAAOD,OAC/BgQ,EAAe,SAAAvS,GAAK,OAAAyE,OAAA6K,EAAA,EAAA7K,CAAA,GACfzE,EADeyE,OAAAC,EAAA,EAAAD,CAAA,GAEjBuP,EAAWzR,QAGZ0R,MAKGM,EA3II,WAAM,IAAAC,EAMnBtC,EAAM9I,GAJR4J,EAFqBwB,EAErBxB,IACAN,EAHqB8B,EAGrB9B,eACAJ,EAJqBkC,EAIrBlC,YACAC,EALqBiC,EAKrBjC,eAiBF,OAdA9P,OAAOiQ,eAAiBA,EAExBvN,oBAAU,WACR,GAAIuN,EAAgB,CAClB,IAAM+B,EA1DU,SAAClC,EAAgBG,GAAjB,OAAoC,SAACvS,GACzD+S,QAAQC,IAAIhT,GADqD,IAE1D+B,EAAuB/B,EAAvB+B,KAAMwS,EAAiBvU,EAAjBuU,SAAUjW,EAAO0B,EAAP1B,IACnBT,IAAEK,SAAS,CAAC,UAAW,SAAUI,IAErC8T,EAAe,SAAAnD,GAAa,IACnBtH,EAAyCsH,EAAzCtH,SAAUE,EAA+BoH,EAA/BpH,UAAWG,EAAoBiH,EAApBjH,KAAMC,EAAcgH,EAAdhH,KAAMO,EAAQyG,EAARzG,KAClCgM,EAAW,GAAMhM,EAEvB,GAAa,UAATzG,EAEF,OADAwQ,EAAeX,aAAa/J,GACrBvD,OAAA6K,EAAA,EAAA7K,CAAA,GAAK2K,EAAZ,CAAuBpH,WAAYA,IAGrC,IAAMqH,EAAS5K,OAAA6K,EAAA,EAAA7K,CAAA,GACF,cAARhG,EACCiW,EACE,CAAC5M,SAAUV,KAAKwE,IAAI,EAAGxE,KAAKsD,KAAK5C,GAAY,IAC7C,CAACK,KAAMA,EAAOwM,GAChB,GACO,eAARlW,EACCiW,EACE,CAAC5M,SAAUV,KAAKsE,IAAI,IAAKtE,KAAKwE,IAAI,EAAGxE,KAAKsD,KAAK5C,GAAY,KAC3D,CAACK,KAAMA,EAAOwM,GAChB,GACO,YAARlW,EACCiW,EACE,CAAC/L,KAAMA,GAAQ,GAAK,IACpB,CAACP,KAAMA,EAAOuM,GAChB,GACO,cAARlW,EACCiW,EACE,CAAC/L,KAAU,GAAJA,GACP,CAACP,KAAMA,EAAOuM,GAChB,IAGN,OAAOlQ,OAAA6K,EAAA,EAAA7K,CAAA,GACF2K,EACAC,EAFL,CAGEpH,eAAgBjK,IAAE4W,QAAQvF,QAkBVwF,CAActC,EAAgBG,GAE9C,OADAjQ,OAAOC,iBAAiB,UAAW+R,GAC5B,WACLhS,OAAOG,oBAAoB,UAAW6R,MAGzC,CAAC/B,IAIIlV,EAAAC,EAAAC,cAAAF,EAAAC,EAAA2B,SAAA,KACN5B,EAAAC,EAAAC,cAAA,OACEsV,IAAKA,EACLzV,MAAO,CACLuX,UAAW,QACX9R,WAAY,4FACZxG,OAAQ,OACRC,MAAO,WAIXe,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVyF,WAAY,kBACZhG,SAAU,WACV+X,OAAQ,GACRrV,QAAS,GACT5C,KAAM,KAGHwV,EAAYtK,UAAY,eAAO,SAEhCxK,EAAAC,EAAAC,cAACsX,EAAD,CACEtJ,IAAK,GACLuJ,IAAK,IACLjB,SAAU,eACV1B,YAAaA,EACbC,eAAgBA,IAElB/U,EAAAC,EAAAC,cAACsX,EAAD,CACEtJ,IAAK,EACLuJ,IAAK,IACLjB,SAAU,iBACV1B,YAAaA,EACbC,eAAgBA,IAElB/U,EAAAC,EAAAC,cAACsX,EAAD,CACEtJ,IAAK,GACLuJ,IAAK,IACLjB,SAAU,gBACV1B,YAAaA,EACbC,eAAgBA,IAGlB/U,EAAAC,EAAAC,cAACsX,EAAD,CACEtJ,IAAK,IACLuJ,IAAK,EACLC,KAAM,IACNlB,SAAU,eACV1B,YAAaA,EACbC,eAAgBA,IAElB/U,EAAAC,EAAAC,cAACsX,EAAD,CACEtJ,IAAK,GACLuJ,IAAK,IACLE,UAAW,WACTjC,QAAQC,IAAI,aACZb,EAAYrK,eAAgB,GAE9BiN,KAAM,GACNlB,SAAU,kBACV1B,YAAaA,EACbC,eAAgBA,IAElB/U,EAAAC,EAAAC,cAACsX,EAAD,CACEtJ,IAAK,EACLuJ,IAAK,IACLjB,SAAU,mBACV1B,YAAaA,EACbC,eAAgBA,EAMhB4C,UAAW,WACTjC,QAAQC,IAAI,aACZb,EAAYrK,eAAgB,KAIhCzK,EAAAC,EAAAC,cAACsX,EAAD,CACEtJ,IAAK,GACLuJ,IAAK,IACLjB,SAAU,WACV1B,YAAaA,EACbC,eAAgBA,EAChB4C,UAAW,WACTjC,QAAQC,IAAI,aACZb,EAAYrK,eAAgB,QCvMlCmN,QAAKC,EAAIC,KAuFAC,EA3DD,WAAM,IAAAC,EA1BD,WAAM,IAAArD,EACOC,mBAAS,MADhBC,EAAA5N,OAAAS,EAAA,EAAAT,CAAA0N,EAAA,GAChBsD,EADgBpD,EAAA,GACPqD,EADOrD,EAAA,GAAAG,EAEqBJ,mBAAS,MAF9BK,EAAAhO,OAAAS,EAAA,EAAAT,CAAA+N,EAAA,GAEhBM,EAFgBL,EAAA,GAEAM,EAFAN,EAAA,GAoBvB,MAAO,CACLgD,UACAzC,IAlBUC,sBAAY,SAACrW,GACvB,GAAIA,EAAI,CACN,IAAM+Y,EAAW,IAAIP,EAAGQ,SAAShZ,EAAIwY,EAAGQ,SAASC,SAASC,KAC1DH,EAAS/B,OAAOhX,EAAG2W,YAAa3W,EAAG0W,cACnCoC,EAAWC,EAASI,cAEpB,IAAMjD,EAAiB,IAAIU,eAAe,SAAAvW,GAA0C,IAAAwW,EAAAhP,OAAAS,EAAA,EAAAT,CAAAxH,EAAA,MAAtCyW,YAAelX,EAAuBiX,EAAvBjX,OAAQC,EAAegX,EAAfhX,MACnEkZ,EAAS/B,OAAOnX,EAAOD,KAEzBuW,EAAkBD,GAClBA,EAAee,QAAQjX,QAEvBkW,EAAegB,cAEhB,KAYCkC,GAFFP,EAFgBD,EAEhBC,QACAzC,EAHgBwC,EAGhBxC,IAGF,GAAIyC,EAAS,CACXA,EAAQQ,eAAe,SACvBR,EAAQS,aAAa,SAErB,IAAMC,EAAS,IAAIf,EAAGgB,MAAM,GAAI,EAAG,KAChCC,QAAQ,UACRC,gBAAgB,MAChBC,iBAAiB,OACjBb,WAAWD,GACX9E,OAEHlO,OAAO2S,GAAIA,EACX3S,OAAOgT,QAAUA,EACjBhT,OAAO0T,OAASA,EAEhB,IAAMK,EAAO,IAAIpB,EAAGgB,MAAM,GAAI,GAAI,KAC/BC,QAAQ,QACRE,iBAAiB,OACjBD,gBAAgB,MAChBZ,WAAWD,GACX9E,OAEW,IAAIyE,EAAGqB,eAAeN,EAAQK,GACzCE,QAAQtB,EAAGqB,eAAerC,KAAKuC,OAC/BjB,WAAWD,GACX9E,OAGc,IAAIyE,EAAGqB,eAAeN,EAAQK,GAC5CE,QAAQtB,EAAGqB,eAAerC,KAAKwC,aAC/BlB,WAAWD,GACX9E,OAKL,OACEnT,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVhB,QAAS,QACTE,MAAO,SAEPe,EAAAC,EAAAC,cAAA,OACEsV,IAAKA,EACLzV,MAAO,CAEL6F,KAAM,QACN5G,OAAQ,IACRgT,OAAQ,aC1DHqH,EAvBC,kBACdrZ,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVhB,QAAS,QACTyC,WAAY,IAEXhB,IAAEC,MAAM,IACNE,IAAI,SAAA0B,GAAC,OACJrC,EAAAC,EAAAC,cAAAF,EAAAC,EAAA2B,SAAA,KACGpB,IAAEC,MAAM,IAAIE,IAAI,SAAA2B,GACf,IAAMnB,IAAMkB,EAAI,EAAI,GACdA,EAAI,GAAK,EAAK,GAAK,EACpBA,EAAI,EAAK,IAAU,EAAJC,GAAS,GAE7B,OACEtC,EAAAC,EAAAC,cAAC6B,EAAD,CAAId,IAAKqB,EAAGnB,EAAGA,EAAGrB,MAAOuC,EAAI,IAAM,MAGvCrC,EAAAC,EAAAC,cAAA,gBChBJK,EAAQ,CAAC,EAAE,EAAE,EAAE,GAAG,IAuBT+Y,EArBC,kBACdtZ,EAAAC,EAAAC,cAAA,OAAKH,MAAO,CACVhB,QAAS,QACTyC,WAAY,IAEZxB,EAAAC,EAAAC,cAACuB,EAAD,CAAalB,MAAOA,IACpBP,EAAAC,EAAAC,cAAA,WACC,CAAC,EAAG,EAAG,EAAG,GAAGS,IAAI,SAAAe,GAAG,OACnB1B,EAAAC,EAAAC,cAAAF,EAAAC,EAAA2B,SAAA,KACGpB,IAAEC,MAAM,IACNE,IAAI,SAAAkB,GAAC,OAAKA,EAAIH,GAAO,KACrBf,IAAI,SAACmB,EAAIf,GAAL,OACHf,EAAAC,EAAAC,cAAC6B,EAAD,CAAId,IAAKF,EAAII,EAAGW,MAEpB9B,EAAAC,EAAAC,cAAA,cAGJF,EAAAC,EAAAC,cAACuB,EAAD,CAAalB,MAAOA,gBCxBjB,SAASgZ,GAAStK,EAAGpB,EAAG9B,GAU7B,IAAIyN,EAAGC,EAAGvK,EAAGrN,EAAGjB,EAAG6N,EAAGiL,EAAGC,EAWzB,OAVyB,IAArBhL,UAAUC,SACZf,EAAIoB,EAAEpB,EACN9B,EAAIkD,EAAElD,EACNkD,EAAIA,EAAEA,GAIRR,EAAI1C,GAAK,EAAI8B,GACb6L,EAAI3N,GAAK,GAFTnL,EAAQ,EAAJqO,GADJpN,EAAI+H,KAAKsG,MAAU,EAAJjB,KAGEpB,GACjB8L,EAAI5N,GAAK,GAAK,EAAInL,GAAKiN,GACfhM,EAAI,GACV,KAAK,EACH2X,EAAIzN,EACJ0N,EAAIE,EACJzK,EAAIT,EACJ,MAEF,KAAK,EACH+K,EAAIE,EACJD,EAAI1N,EACJmD,EAAIT,EACJ,MAEF,KAAK,EACH+K,EAAI/K,EACJgL,EAAI1N,EACJmD,EAAIyK,EACJ,MAEF,KAAK,EACHH,EAAI/K,EACJgL,EAAIC,EACJxK,EAAInD,EACJ,MAEF,KAAK,EACHyN,EAAIG,EACJF,EAAIhL,EACJS,EAAInD,EACJ,MAEF,KAAK,EACHyN,EAAIzN,EACJ0N,EAAIhL,EACJS,EAAIwK,EAIR,OA1DA,SAAAja,GAA+B,IAAX+Z,EAAW/Z,EAAX+Z,EAAGC,EAAQha,EAARga,EAAGvK,EAAKzP,EAALyP,EACxB,SAAS0K,EAAexF,GACtB,IAAIyF,EAAMzF,EAAE0F,SAAS,IACrB,OAAqB,GAAdD,EAAIjL,OAAc,IAAMiL,EAAMA,EAGvC,MAAO,IAAMD,EAAeJ,GAAKI,EAAeH,GAAKG,EAAe1K,GAoD/D6K,CAAS,CACdP,EAAG5P,KAAKoQ,MAAU,IAAJR,GACdC,EAAG7P,KAAKoQ,MAAU,IAAJP,GACdvK,EAAGtF,KAAKoQ,MAAU,IAAJ9K,KCzDH,IAAA+K,GAAA,SAAAxa,GAAA,IAAG0B,EAAH1B,EAAG0B,EAAG+Y,EAANza,EAAMya,OAANC,EAAA1a,EAAcD,gBAAd,IAAA2a,EAAyB,QAAzBA,EAAAC,EAAA3a,EAAkC4a,aAAlC,IAAAD,EAA0C,QAA1CA,EAAA,OACbpa,EAAAC,EAAAC,cAAA,YACEI,MAAM,QACNga,QAAS,GACT9a,SAAUA,EACV+a,OAAQ,IACRF,MAAOA,GAEPra,EAAAC,EAAAC,cAAA,UACEsa,MAAM,SACNla,MAAOiZ,GAASpY,EAAI,GAAI,IAAM,GAC9BsZ,KAAK,uBACLC,OAAO,QACPC,UAAQ,UACRL,QAASJ,EAAS,EAAI,IACtBnV,MAAO7D,EAASC,OChBhB2E,GAAe,CACnB8U,WAAO/L,EACPgM,aAAc,GACdC,yBAAyB,EACzBZ,OAAQ1Z,IAAEmF,UACRnF,IAAEC,MAAM,KACRD,IAAEoF,KAAK,IAAIC,MAAM,KAAM,KAGrBO,GAAU,CACd2U,eAAgB,SAACzU,EAAO0U,GACtB,IAAMC,EAAkB3U,EAAM9D,MAAM0Y,QAAUF,EAC9C1U,EAAMzB,SAAS,CAACqW,QAASD,KAG3BE,gBAAiB,SAAC7U,EAAOuU,GAAR,OACfvU,EAAMzB,SAAS,CAACgW,kBAElBlU,aAAc,SAACL,EAAOO,GAAR,OACZP,EAAMzB,SAAS,CAACqV,OAAQ1Z,IAAEwG,MAAMV,EAAM9D,MAAM0X,OAAQrT,MAEtDuU,qBAAsB,SAAC9U,GAAD,OACpBA,EAAMzB,SAAS,CAACiW,yBAA0BxU,EAAM9D,MAAMsY,4BAG3C1T,eAAWC,IAAOvB,GAAcM,aCsFhCiV,GA7GQ,WAAM,IAAA1G,EACDC,oBAAS,GADRC,EAAA5N,OAAAS,EAAA,EAAAT,CAAA0N,EAAA,GACpB2G,EADoBzG,EAAA,GACb0G,EADa1G,EAAA,GAG3BlN,oBAAU,WACR,IAAM6T,EAAS,SAAA/b,GACD,MADYA,EAATwB,KACEsa,EAAS,SAAAD,GAAK,OAAKA,KAItC,OADArW,OAAOC,iBAAiB,QAASsW,GAC1B,kBAAMvW,OAAOG,oBAAoB,QAASoW,KAChD,IAVwB,IAAAC,EAYRC,KAAXxB,EAZmBjT,OAAAS,EAAA,EAAAT,CAAAwU,EAAA,MAYnBvB,OAEFyB,EAAqBnb,IAAE,IAC1BC,QACAE,IAAI,SAAAQ,GAAC,OAAIX,IAAE0Z,GACT0B,OAAO,SAAC7P,EAAGlK,GAAJ,OAAUA,EAAI,KAAOV,IAC5B0a,SACAC,QACF/W,QAEH,OACE/E,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CACEmO,UAAS,6BAAA5b,OAA+Bmb,EAAQ,IAAM,EAA7C,iBACT9b,SAAQ,UAEPgB,IAAE,IACAC,QACAqQ,OAAO,SAAA3P,GAAC,OAAIA,EAAI,GAAK,IACrBR,IAAI,SAAAQ,GAAC,MAAK,CACTA,IACAqY,EAAG,IACHlX,GAAIsH,KAAKG,IAAI5I,EAAIyI,KAAKC,GAAK,GAC3BxH,EAAGuH,KAAKK,IAAI9I,EAAIyI,KAAKC,GAAK,MAE3BlJ,IAAI,SAAA2H,GAAA,IAAEnH,EAAFmH,EAAEnH,EAAGqY,EAALlR,EAAKkR,EAAGlX,EAARgG,EAAQhG,EAAGD,EAAXiG,EAAWjG,EAAX,OACHrC,EAAAC,EAAAC,cAAC+Z,GAAD,CACEC,OAAQyB,EAAmBxa,GAC3BA,EAAGA,EACH3B,SAAQ,GAAAW,OAAKqZ,EAAIlX,EAAT,KAAAnC,OAAcqZ,EAAInX,EAAlB,UAEX0C,QAGFvE,IAAE,IACAC,QACAqQ,OAAO,SAAA3P,GAAC,OAAKX,IAAEK,SAAS,CAAC,EAAG,EAAG,EAAG,GAAIM,EAAI,KAC1CR,IAAI,SAACQ,EAAGU,GAAJ,MAAW,CACdA,IACAV,GAAc,GAATU,EAAI,GAA6B,EAApB+H,KAAKsG,MAAMrO,EAAI,IAAU,GAE3C2X,EAAG,IACHlX,EAAGsH,KAAKG,KAAK5I,EAAI,IAAOyI,KAAKC,GAAK,IAClCxH,EAAGuH,KAAKK,KAAK9I,EAAI,IAAOyI,KAAKC,GAAK,OAEnClJ,IAAI,SAAA6H,GAAA,IAAErH,EAAFqH,EAAErH,EAAGqY,EAALhR,EAAKgR,EAAGlX,EAARkG,EAAQlG,EAAGD,EAAXmG,EAAWnG,EAAX,OACHrC,EAAAC,EAAAC,cAAC+Z,GAAD,CACEC,OAAQyB,EAAmBxa,GAC3BA,EAAGA,EACH3B,SAAQ,GAAAW,OAAKqZ,EAAIlX,EAAT,KAAAnC,OAAcqZ,EAAInX,EAAlB,MACRgY,MAAM,kBAETtV,QAGFvE,IAAE,IACAC,QACAqQ,OAAO,SAAA3P,GAAC,OAAIA,EAAI,GAAK,IACrBR,IAAI,SAAAQ,GAAC,MAAK,CACTA,GAAIA,EAAI,GAAK,GACbqY,EAAG,IACHlX,GAAIsH,KAAKG,IAAI5I,EAAIyI,KAAKC,GAAK,GAC3BxH,EAAGuH,KAAKK,IAAI9I,EAAIyI,KAAKC,GAAK,MAE3BlJ,IAAI,SAAAmI,GAAA,IAAE3H,EAAF2H,EAAE3H,EAAGqY,EAAL1Q,EAAK0Q,EAAGlX,EAARwG,EAAQxG,EAAGD,EAAXyG,EAAWzG,EAAX,OACHrC,EAAAC,EAAAC,cAAC+Z,GAAD,CACEC,OAAQyB,EAAmBxa,GAC3BA,EAAGA,EACH3B,SAAQ,GAAAW,OAAKqZ,EAAIlX,EAAT,KAAAnC,OAAcqZ,EAAInX,EAAlB,UAEX0C,QAGFvE,IAAE,IACAC,QACAqQ,OAAO,SAAA3P,GAAC,OAAKX,IAAEK,SAAS,CAAC,EAAG,EAAG,EAAG,GAAIM,EAAI,KAC1CR,IAAI,SAACQ,EAAGU,GAAJ,MAAW,CACdA,IAEAV,GAAQ,EAAJU,EAAQ,EAAwB,EAApB+H,KAAKsG,MAAMrO,EAAI,IAAU,GAEzC2X,EAAG,IACHlX,EAAGsH,KAAKG,KAAK5I,EAAI,KAAOyI,KAAKC,GAAK,IAClCxH,EAAGuH,KAAKK,KAAK9I,EAAI,KAAOyI,KAAKC,GAAK,OAEnClJ,IAAI,SAAAsI,GAAA,IAAE9H,EAAF8H,EAAE9H,EAAGqY,EAALvQ,EAAKuQ,EAAGlX,EAAR2G,EAAQ3G,EAAGD,EAAX4G,EAAW5G,EAAX,OACHrC,EAAAC,EAAAC,cAAC+Z,GAAD,CACEC,OAAQyB,EAAmBxa,GAC3BA,EAAGA,EACH3B,SAAQ,GAAAW,OAAKqZ,EAAIlX,EAAT,KAAAnC,OAAcqZ,EAAInX,EAAlB,MACRgY,MAAM,kBAETtV,mBCxGHiX,GAAK,mBACLC,GAAK,kBAGLC,GAAQ,CACZ,CAAC,GAAOD,GAAMD,IACd,CAAC,EAAOC,IAAMD,IACd,CAAEC,IAAMD,GAAK,GACb,EAAEC,GAAMD,GAAK,GACb,CAAC,GAAOC,IAAMD,IACd,CAAC,EAAOC,GAAMD,IACd,EAAEC,IAAMD,GAAK,GACb,CAAEC,GAAMD,GAAK,GACb,EAAEA,GAAK,EAAOC,IACd,CAAED,GAAK,GAAOC,IACd,CAAED,GAAK,EAAOC,IACd,EAAED,GAAK,GAAOC,KA2BDE,GAxBH,SAANA,EAAM1c,GAAA,IAAA2c,EAAA3c,EAAG4c,WAAH,IAAAD,EAAS,EAATA,EAAYE,EAAZ7c,EAAY6c,IAAZC,EAAA9c,EAAiB+c,aAAjB,IAAAD,EAAyB,GAAzBA,EAAAE,EAAAhd,EAA6B0B,SAA7B,IAAAsb,EAAiC,EAAjCA,EAAA,OACVzc,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CAAQpO,SAAS,SACd0c,GAAMvb,IAAI,SAACoL,EAAGlK,GAAJ,OACT7B,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CACE3M,IAAKY,EACLvB,MAAOiZ,GAAS1X,GAAK,EAAI,IAAKya,GAAO,EAAG,GACxCI,OAAQ,CAAEC,MAAO,kBAAMjH,QAAQC,IAAI9T,KACnC+a,UAAU,WACVpd,SAAUuM,EAAE8Q,KAAK,KACjBxC,MAAO,CAAC,EAAG,EAAG,GAAG1Z,IAAI,SAAAQ,GAAC,MAAI,GAAMA,GAAIkb,EAAMA,KAAMQ,KAAK,SAGxDR,EAAM,GAAKH,GAAMvb,IAAI,SAACoL,EAAGlK,GAAJ,OACpB7B,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CACE3M,IAAKY,EACLrC,SAAUuM,EAAEpL,IAAI,SAAAQ,GAAC,OAAQ,EAAJA,IAAO0b,KAAK,KACjCpa,KAAI,UAAAtC,OAAYoZ,IAAUiD,EAAM5N,OAAS4N,EAAMA,EAAM5N,OAAS,GAAK/M,IAAM,EAAI,IAAK,EAAG,GAAjF,4BAAA1B,OAA8G,GAAAA,OAAA8G,OAAA6V,GAAA,EAAA7V,CAAIuV,GAAJ,CAAW3a,IAAGgb,KAAK,KAAjI,OAAA1c,QAA4IgB,EAAIU,GAAK,GAArJ,2BAEJ7B,EAAAC,EAAAC,cAACic,EAAD,CAAKE,IAAKA,EAAI,EAAGC,IAAK,GAAKE,MAAK,GAAArc,OAAA8G,OAAA6V,GAAA,EAAA7V,CAAMuV,GAAN,CAAa3a,IAAIV,GAAIA,EAAIU,GAAK,mBCyBvDkb,GA3DJ,SAAAtd,GAAA,IAAUud,EAAVvd,EAAEwd,MAAQD,KAAV,OACThd,EAAAC,EAAAC,cAAC0N,GAAA,MAAD,KACE5N,EAAAC,EAAAC,cAAA,gBACEF,EAAAC,EAAAC,cAAA,OAAKqS,GAAG,gBAAgB2K,IAAI,qDAC5Bld,EAAAC,EAAAC,cAAA,OAAKqS,GAAG,aAAa2K,IAAI,oDAG3Bld,EAAAC,EAAAC,cAACid,GAAA,EAAD,KACEnd,EAAAC,EAAAC,cAACid,GAAA,EAAD,CAAOH,KAAI,GAAA7c,OAAK6c,EAAL,aAAsBI,UAAW/B,KAC5Crb,EAAAC,EAAAC,cAACid,GAAA,EAAD,CAAOH,KAAI,GAAA7c,OAAK6c,EAAL,QAAiBI,UAAWjB,MAQzCnc,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CACE5O,OAAO,OACP4d,UAAU,QACVrC,OAAO,KACP8C,SAAS,SACTH,IAAI,cACJI,eAAa,KACbre,MAAM,SAERe,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CACE5O,OAAO,OACP4d,UAAU,QACVrC,OAAO,KACP8C,SAAS,WACTH,IAAI,cACJI,eAAa,KACbre,MAAM,SAGRe,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CAAQgP,UAAU,WAAWrK,GAAG,SAAS/S,SAAS,SAChDQ,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CAAQgP,UAAU,WAAWW,iBAAkB,CAC7CC,SAAU,QACVC,YAAa,QACbC,KAAM,cACNC,GAAI,QACJC,IAAK,QAIT5d,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CAEE2E,GAAG,WACHsL,wBAAsB,eAExB7d,EAAAC,EAAAC,cAAC0N,GAAA,OAAD,CACE2E,GAAG,YACHsL,wBAAsB,0GC/BtBC,GAAW,CACf,CAAC,8BAA+B,kBAAmB3b,GACnD,CAAC,oBAAqB,eAAgBI,GACtC,CAAC,cAAe,OAAQ0F,GAAK,GAC7B,CAAC,aAAc,WAAYoR,GAC3B,CAAC,YAAa,SAAU9X,GACxB,CAAC,aAAc,UAAWS,GAC1B,CAAC,cAAe,WAAYsX,GAC5B,CAAC,QAAS,SAAUvB,GACpB,CAAC,aAAc,cAAehB,IAsFhCgH,IAASC,OAAOhe,EAAAC,EAAAC,cAnFJ,WACV,IAAM+d,EAAkBC,aAAc,gCAEhCC,EAAQ9W,IAAM+W,QAClB,kBACEC,aAAe,CACbC,QAAS,CACPC,OAAQ,CACNC,OAAQ,WAEVC,QAAS,CACPC,KAAM,WAER9H,KAAMqH,EAAkB,OAAS,YAGvC,CAACA,IAhBaU,EAoBwBtX,IAAMuN,SAAS,MApBvCgK,EAAA3X,OAAAS,EAAA,EAAAT,CAAA0X,EAAA,GAoBTE,EApBSD,EAAA,GAoBKE,EApBLF,EAAA,GAsBVG,EAAkB,kBAAMD,EAAgB,OAE9C,OACE9e,EAAAC,EAAAC,cAAC8e,GAAA,EAAD,CAAeb,MAAOA,GACpBne,EAAAC,EAAAC,cAAC+e,EAAA,EAAD,MACAjf,EAAAC,EAAAC,cAACgf,GAAA,EAAD,CAAQC,SAAUC,sBAChBpf,EAAAC,EAAAC,cAACid,GAAA,EAAD,CAAOH,KAAK,IAAIqC,OAAK,EAACjC,UAAWkC,IAEjCtf,EAAAC,EAAAC,cAACid,GAAA,EAAD,CAAOH,KAAK,MAAMgB,OAAQ,SAACuB,GAAD,OAAiBvf,EAAAC,EAAAC,cAACsf,GAAOD,MAElDzB,GAASnd,IAAI,SAAA2H,EAA2BrH,GAA3B,IAAAuH,EAAAvB,OAAAS,EAAA,EAAAT,CAAAqB,EAAA,GAAS0U,GAATxU,EAAA,GAAAA,EAAA,IAAe4U,EAAf5U,EAAA,UACZxI,EAAAC,EAAAC,cAACid,GAAA,EAAU,CAAEC,YAAWnc,MAAK+b,WAG/Bhd,EAAAC,EAAAC,cAACuf,GAAA,EAAD,CACEjgB,SAAS,QACTO,MAAO,CACLiK,IAAK,OACLuN,OAAQ,IAGVvX,EAAAC,EAAAC,cAACwf,GAAA,EAAD,KACE1f,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CACEC,KAAK,QACLtf,MAAM,UACNuf,aAAW,cACXC,QA3BkB,SAAArgB,GAAA,IAAGsgB,EAAHtgB,EAAGsgB,cAAH,OAAuBjB,EAAgBiB,KA6BzD/f,EAAAC,EAAAC,cAAC8f,GAAA,EAAD,OAEFhgB,EAAAC,EAAAC,cAAC+f,GAAA,EAAD,CACEC,SAAUrB,EACVzW,OAAQyW,EACRsB,QAASpB,GAET/e,EAAAC,EAAAC,cAACkgB,GAAA,EAAD,KACEpgB,EAAAC,EAAAC,cAACgf,GAAA,EAAD,CAAMnf,MAAO,CAAEO,MAAO,aAAcwf,QAASf,EAAiBpB,GAAG,KAAjE,iBAEF3d,EAAAC,EAAAC,cAACkgB,GAAA,EAAD,CAAUC,UAAQ,EAACC,SAAO,GAA1B,MACCxC,GAASnd,IAAI,SAAAmI,EAAqCY,GAArC,IAAAT,EAAAhC,OAAAS,EAAA,EAAAT,CAAA6B,EAAA,GAAEyX,EAAFtX,EAAA,GAASuX,EAATvX,EAAA,UAAAA,EAAA,IAAAA,EAAA,IACZjJ,EAAAC,EAAAC,cAACkgB,GAAA,EAAD,CAAUnf,IAAKyI,GACb1J,EAAAC,EAAAC,cAACgf,GAAA,EAAD,CAAMnf,MAAO,CAAEO,MAAO,QAASwf,QAASf,EAAiBpB,GAAI6C,GAAMD,MAGvEvgB,EAAAC,EAAAC,cAACkgB,GAAA,EAAD,CAAUC,UAAQ,EAACC,SAAO,GAA1B,MACC,CACC,CAAC,kBAAmB,gBACpB,CAAC,MAAO,YACR3f,IAAI,SAAAuI,EAAeQ,GAAf,IAAAN,EAAAnC,OAAAS,EAAA,EAAAT,CAAAiC,EAAA,GAAEqX,EAAFnX,EAAA,GAASoX,EAATpX,EAAA,UACJpJ,EAAAC,EAAAC,cAACkgB,GAAA,EAAD,CAAUnf,IAAKyI,GACb1J,EAAAC,EAAAC,cAACgf,GAAA,EAAD,CAAMnf,MAAO,CAAEO,MAAO,QAASwf,QAASf,EAAiBpB,GAAI6C,GAAMD,YAWrE,MAAQE,SAASC,cAAc","file":"static/js/main.ac157cf9.chunk.js","sourcesContent":["import React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst cellSize = 30;\r\n\r\nconst Cell = withStyles({\r\n  root: {\r\n    fontSize: 20,\r\n    fontFamily: 'jetBrainsMono',\r\n    display: 'inline-flex',\r\n    height: cellSize,\r\n    width: cellSize,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    // border: '1px solid',\r\n  },\r\n  el: {\r\n    fontFamily: 'Segoe UI',\r\n  },\r\n  odd: {\r\n    left: cellSize / 2,\r\n    position: 'relative',\r\n  }\r\n})(({children, classes, className = '', isOdd, style}) => (\r\n  <div\r\n    className={`${classes.root} ${className} ${isOdd ? classes.odd : ''}`}\r\n    style={style\r\n    }>\r\n    {children}\r\n  </div>\r\n));\r\n\r\nexport default Cell;\r\n","import _ from 'lodash';\r\nimport Cell from \"./cell\";\r\nimport React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst FretMarkers = withStyles({\r\n  fretMarker: {color: 'purple'}\r\n})(\r\n  ({classes: {fretMarker}, frets}) => _.range(_.last(frets) + 1)\r\n    .map(f => _.includes(frets, f) ? f : '')\r\n    .map((fret, ix) => <Cell className={fretMarker} key={ix}>{fret}</Cell>));\r\n\r\nexport default FretMarkers;\r\n","export const toSymbol = n => ({\r\n  10: '૪',\r\n  11: 'Ɛ',\r\n})[n % 12] || n % 12;\r\n","import Cell from './cell';\r\nimport React from \"react\";\r\nimport {toSymbol} from \"./util\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst PC = withStyles({\r\n  el: {\r\n    fontFamily: 'Segoe UI',\r\n  },\r\n})(({classes, n, isOdd, style}) => (\r\n  <Cell\r\n    className={n % 12 === 11 ? classes.el : ''}\r\n    isOdd={isOdd}\r\n    style={style}\r\n  >\r\n    {toSymbol(n)}\r\n  </Cell>\r\n));\r\n\r\nexport default PC;\r\n","import _ from 'lodash';\r\nimport Cell from './cell';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [1,3,5,7,10,12,15,17,19];\r\n\r\nconst Banjo = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets} />\r\n    <br/>\r\n    {[0, 9, 5, 0, 0].map((pc0, pc0ix) => (\r\n      <>\r\n        {_.range(23)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) =>\r\n            pc0ix === 4 && ix < 5\r\n              ? <Cell key={ix}/>\r\n              : <PC key={ix} n={pc}/>\r\n          )}\r\n        <br/>\r\n      </>\r\n    ))}\r\n    <FretMarkers frets={frets} />\r\n  </div>\r\n);\r\n\r\nexport default Banjo;\r\n","import _ from 'lodash';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [0,5,7,12,15,17,19, 24];\r\n\r\nconst Guitar = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets}/>\r\n    <br/>\r\n    {[4, 11, 7, 2, 9, 4].map(pc0 => (\r\n      <>\r\n        {_.range(25)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) => (\r\n            <PC key={ix} n={pc}/>\r\n          ))}\r\n        <br/>\r\n      </>\r\n    ))}\r\n    <FretMarkers frets={frets}/>\r\n  </div>\r\n);\r\n\r\nexport default Guitar;\r\n","import _ from 'lodash';\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst Banjo = () => (\r\n  <div style={{height: '100%', overflowY: 'auto', padding: '20% 10%'}}>\r\n    <h1>What is this nonsense all about?</h1>\r\n\r\n    <p>\r\n      When I learned how to play an instrument, we started with \"Hot Cross Buns\", \"Mary Had a Little Lamb\", etc.\r\n      We started with the first 3 notes in the key of \"C\". Eventually, we'd build up to the other 4 notes. Then a new\r\n      key was introduced. This one has a \"Bb\" -- the key of \"F\". At some point we'd be introduced to an \"accidental\".\r\n    </p>\r\n\r\n    <p>\r\n      This left a lasting impression that the notes C, D, E, F, G, A, and B were the main notes. And these other things\r\n      were in another class. They were harder -- harder to think about, harder to play, harder to keep track of, harder\r\n      to say. C, D, E, F, G, A, and B are all single syllables. The other 5 notes were thought of as modifications of\r\n      these main notes. \"B flat\", \"C sharp\", \"D flat\", yada yada. Wait are there 5 or are there 10?\r\n    </p>\r\n\r\n    <p>\r\n      \"B sharp\" is one of the first little musical jokes you get to say when you're in the know, until you learn that\r\n      when you really get in deep, actually \"B sharp\" <i>is</i> a real note. There's even a \"B double sharp\"! How many\r\n      notes <i>are</i> there!? Answer: infinite, as there are infinite numbers between 0 and 1, there are infinite\r\n      pitches. Another answer, and this is the one we'll focus on in this website, is 12. There are 12 pitch-classes in\r\n      the musical system that westerners refer to as \"music theory\" and more formally 12-tone equal temperament. All the\r\n      fancy names like \"B flat\" and \"F sharp\" are just various spellings of the 12 pitch-classes in 12-TET.\r\n    </p>\r\n\r\n    <p>\r\n      This is all kind of interesting for a while and makes a young musician wonder about how deep this labyrinth gets.\r\n      But it's all a smoke screen. And it gets even worse when you start to learn about intervals. Honestly, what's the\r\n      use of a \"diminished second\" if not to sound pedantic and \"technically correct\"?\r\n    </p>\r\n\r\n    <p>\r\n      While I'll concede that it sort of makes sense when you're talking about notes <i>written on a staff</i>,\r\n      I'll maintain that it's a bullshit system to think in and it's needlessly convoluted, scares off all but the\r\n      masochistic academics and overachievers. It adds a layer of cognitive as well as verbal overhead to otherwise\r\n      simple concepts, and all so that we can pretend that music all fits into this diatonic model, with a few outliers\r\n      that we call \"accidentals\". It makes the white keys approachable and the black keys scary and hard to name. \"Is\r\n      it a C# or a Db\"? Why do we care, when we really just want to think about the one pitch we're trying to finger?\r\n    </p>\r\n\r\n    <p>\r\n      If we're going to commit to this arguably artificial model of 12 notes, which is but one of a panoply of more\r\n      naturally harmonious tunings, if we're going to compromise with this 12-TET model so that we end up with 12\r\n      equally spaced notes around the octave, let's go all in and treat it with the simple terms it asks for. Let's\r\n      treat these 12 notes equally instead of imagining this additional layer of complexity on top of them.\r\n    </p>\r\n\r\n    <br/>\r\n    <hr/>\r\n\r\n    <h2>Please consider:</h2>\r\n    <pre>{_.range(12).map(pc => <PC key={pc} n={pc}/>)}</pre>\r\n    <p> That's \"oh\" \"one\" \"two\" \"three\" \"four\" \"five\" \"six\" \"sev\" \"eight\" \"nine\" \"ten\" \"el\".</p>\r\n\r\n\r\n\r\n  </div>\r\n);\r\n\r\nexport default Banjo;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport { toSymbol } from \"./util\";\r\nimport PC from \"./pc\";\r\n\r\nconst MultTableMod12 = () => (\r\n  <>\r\n    {_.range(6).map(n => (\r\n      <div style={{\r\n        display: 'block',\r\n        flexShrink: 0,\r\n        margin: '1em',\r\n      }}>\r\n        {_.range(13).map(y => (\r\n          <>\r\n            {_.range(13).map(x => (\r\n              <PC key={x} n={n + x * y} />\r\n            ))}\r\n            <br />\r\n          </>\r\n        ))}\r\n\r\n      </div>\r\n    ))}\r\n  </>);\r\n\r\nexport default MultTableMod12;\r\n","import _ from 'lodash';\r\nimport React, { Component } from 'react';\r\nimport { toSymbol } from \"./util\";\r\n\r\nclass NumpadMod12 extends Component {\r\n  state = {\r\n    text: '',\r\n  };\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  handleKeyPress = (evt) => {\r\n    // console.log(evt.code)\r\n    const char = {\r\n      Backquote: '0',\r\n      Digit1: '1',\r\n      Digit2: '2',\r\n      Digit3: '3',\r\n      Digit4: '4',\r\n      Digit5: '5',\r\n      Digit6: '6',\r\n      Digit7: '7',\r\n      Digit8: '8',\r\n      Digit9: '9',\r\n      Digit0: '૪',\r\n      Minus: 'Ɛ',\r\n      Equal: '0',\r\n      Numpad0: '0',\r\n      Numpad1: '1',\r\n      Numpad2: '2',\r\n      Numpad3: '3',\r\n      Numpad4: '4',\r\n      Numpad5: '5',\r\n      Numpad6: '6',\r\n      Numpad7: '7',\r\n      Numpad8: '8',\r\n      Numpad9: '9',\r\n      NumpadDivide: '૪',\r\n      NumpadMultiply: 'Ɛ',\r\n      NumpadDecimal: ' ',\r\n      NumpadEnter: '\\n',\r\n      Enter: '\\n',\r\n      Space: ' ',\r\n    }[evt.code];\r\n\r\n    if (char) {\r\n      evt.preventDefault();\r\n      this.setState({ text: this.state.text + char });\r\n    }\r\n  };\r\n\r\n  handleChange = ({ target: { value }}) => this.setState({ text: value });\r\n\r\n  render() {\r\n    return <div>\r\n      <h3>Use the numpad to enter pitch classes</h3>\r\n      <textarea\r\n        cols={24}\r\n        rows={20}\r\n        onChange={this.handleChange}\r\n        style={{\r\n          background: 'black',\r\n          color: 'darkgray',\r\n          fontSize: 20,\r\n        }}\r\n        value={this.state.text}\r\n      />\r\n    </div>\r\n  }\r\n}\r\n\r\nexport default NumpadMod12;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport globalHook from 'use-global-hook';\r\n\r\nconst newEmptyMidi = () => _.zipObject(\r\n  _.range(128),\r\n  _.fill(new Array(128), 0));\r\n\r\nconst emptyMidi = newEmptyMidi();\r\n\r\nconst initialState = {\r\n  beat: 1,\r\n  midi: {\r\n    ewi: [], // {note: vel} monophonic\r\n    seq: newEmptyMidi(),\r\n  },\r\n  oscHost: '',\r\n  seq: {},\r\n};\r\n\r\nconst actions = {\r\n  clearSeq: (store) => store.setState({seq: {}}),\r\n\r\n  setBeat: (store, beat) => store.setState({beat}),\r\n\r\n  setInSeq: (store, beat, data) =>\r\n    store.setState({seq: _.set(store.state.seq, [beat], data)}),\r\n\r\n  setMidiEvent: (store, instrument, midiEvt) =>\r\n    store.setState({midi: instrument === 'ewi'\r\n        ? _.set(store.state.midi, instrument, _.toPairs(midiEvt)[0].map(n => parseInt(n, 10))) // monophonic\r\n        : _.merge(store.state.midi, {[instrument]: midiEvt})}),\r\n\r\n  setOscHost: (store, oscHost) => store.setState({oscHost}),\r\n};\r\n\r\nexport default globalHook(React, initialState, actions);\r\n","import _ from 'lodash';\r\nimport OSC from \"osc-js\";\r\nimport React, {useEffect} from 'react';\r\nimport useOsc from './useOsc';\r\nimport PC from \"./pc\";\r\n\r\nconst Osc = () => {\r\n\r\n  const [state, actions] = useOsc(\r\n    ({beat, midi, oscHost, seq}) => ({beat, midi, oscHost, seq}), // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    actions => actions,\r\n  );\r\n\r\n  useEffect(() => {\r\n    const oscHost = {\r\n      host: window.location.hostname,\r\n      port: '8080',\r\n    };\r\n    const osc = new OSC({\r\n      plugin: new OSC.WebsocketClientPlugin(oscHost),\r\n    });\r\n    osc.open();\r\n\r\n    // window.sendOsc = (address, ...args) => osc.send(new OSC.Message(address, ...args));\r\n\r\n    const {\r\n      clearSeq,\r\n      setBeat,\r\n      setInSeq,\r\n      setMidiEvent,\r\n      setOscHost,\r\n    } = actions;\r\n\r\n    setOscHost(oscHost);\r\n\r\n    osc.on('/midiSeq/clear', () => clearSeq());\r\n\r\n    osc.on('/midiSeq/beat', ({args: [beat]}) => setBeat(beat));\r\n\r\n    osc.on('/midi/*', ({address, args: [note, vel]}) => {\r\n      const instrument = _.last(address.split('/'));\r\n      setMidiEvent(instrument, {[note]: vel});\r\n    });\r\n\r\n    osc.on('/midiSeq/note/*', ({address, args}) => {\r\n      const beat = parseInt(_.takeRight(address.split('/'), 2)[0], 10);\r\n      setInSeq(beat, _(args).chunk(2).map(([note, vel]) => ({note, vel})).value()); // args is array of interleaved note, vel...\r\n    });\r\n\r\n  }, []);\r\n\r\n\r\n  const pcs = (state.seq[state.beat] || []).map(({note}) => note % 12);\r\n  const [ewiNote, ewiVel] = state.midi.ewi;\r\n\r\n  return <div>\r\n    <h1>{state.beat}</h1>\r\n    {/*<pre>{JSON.stringify((state.seq[state.beat] || []).map(({note}) => note), null, 2)}</pre>*/}\r\n    {/*<pre>{JSON.stringify(state.midi.ewi, null, 2)}</pre>*/}\r\n    <div style={{\r\n      backgroundColor: 'deeppink',\r\n      color: 'black',\r\n      height: '30vh',\r\n      position: 'relative',\r\n      width: '30vh',\r\n    }}>\r\n      {(state.seq[state.beat] || []).map(({note, vel}, idx) => {\r\n        return <PC key={idx} n={note}/>\r\n      })}\r\n\r\n      {(_.range(12)).map((pc, idx) => {\r\n\r\n        const theta = (pc / 12) * Math.PI * 2;\r\n\r\n        return (\r\n          <PC\r\n            key={idx}\r\n            n={pc}\r\n            style={{\r\n              color: _.includes(pcs, pc) ? 'cyan' : 'black',\r\n              background: `rgba(255, 255, 255, ${pc === ewiNote % 12 ? ewiVel / 127 : 0})`,\r\n              borderRadius: '50%',\r\n              // borderStyle: pc === ewiNote % 12 ? 'solid' : 'none',\r\n              fontSize: '1.5em',\r\n              position: 'absolute',\r\n              left: `${(0.25 * Math.sin(theta) + 0.5) * 100}%`,\r\n              top: `${(-0.25 * Math.cos(theta) + 0.5) * 100}%`,\r\n            }}/>)\r\n      })}\r\n    </div>\r\n  </div>;\r\n};\r\n\r\nexport default Osc;\r\n","import _ from 'lodash';\r\n\r\n\r\n/* TODO\r\n\r\n* params bound to urlParams\r\n* option to auto-choose fundamentalFreq\r\n  based on which partials are present\r\n  to center around 500 - 1000hz\r\n* option to add a second cursor for stereo effects\r\n* alternate space-filling curves\r\n* keep cursor in same location when switching resolutions\r\n* manual cursor\r\n* for hilbertN of 256 or 512, use the vals to fill an audio buffer and play the ~1 or ~5s of audio\r\n* utonal partials\r\n* */\r\n\r\n\r\n\r\nexport const initialState = {\r\n  decayDuration: 5000,\r\n  exciteEnergy: 0.05,\r\n  exciteDuration: 1000,\r\n  fundamentalFreq: 40,\r\n  hilbertN: 64, // hilbertN must be power of 2 in order to be square\r\n  hilbMand: [/*{ x, y, m }*/], // coordinates and associated mandelbrot val in hilbert traversal order\r\n  isPlaying: false,\r\n  isRegenNeeded: false,\r\n  maxIters: 4096, // max number of steps to recurse the mandelbrot fn\r\n  panX: -0.05,\r\n  panY: 0,\r\n  partials: {/* partial: { amp, oscIdx } */}, // the collection is updated in setState but values within are changed in drawLoop directly\r\n  partialsCountMax: 16,\r\n  isSmooth: false, // smooth technique https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n  tick: 0, // updated in draw() bypasses setState\r\n  tickDuration: 100,\r\n  tickLastMillis: 0, // updated in draw() bypasses setState\r\n  zoom: 1.2,\r\n\r\n  // zoom: 3603.7157567397, panX: 0.18580280974577668, panY: 0.00036930706052212803,\r\n\r\n  // floating point errors here\r\n  // zoom: 279919582741326.66, panX: -0.014853203736137617, panY: 0.13451319076043783,\r\n\r\n  // panX: 0.0011548427778035686,\r\n  // panY: 0.025033026937542575,\r\n  // zoom: 319852972190.0951,\r\n  //\r\n  // panX: -0.18498767183730766,\r\n  // panY: 0.4722205531430409,\r\n  // zoom: 419013953.31772846,\r\n  //\r\n  //\r\n  // decay: 0.000075,\r\n  // exciteEnergy: 0.006,\r\n  // fundamentalFreq: 10,\r\n  // hilbertN: 256,\r\n  // maxIters: 4096,\r\n  // panX: 0.0011503007796323155,\r\n  // panY: 0.025033026938902938,\r\n  // tickDuration: 10,\r\n  // zoom: 836635.9887997985,\r\n  //\r\n  //\r\n  //\r\n  // panX: 0.08871194014553094,\r\n  // panY: -0.12829271146701177,\r\n  // zoom: 19736096.460687958,\r\n\r\n  // ...{zoom: 39422433.84662852, panX: 0.04670942760989286, panY: 0.13656218122372943},\r\n\r\n  // demo for 10 partials\r\n  // ...{zoom: 12371177.464729108, panX: 0.04671008941233588, panY: 0.13656133340058238},\r\n};\r\n\r\nlet audioCtx = new AudioContext();\r\nlet oscs = [];\r\n\r\nconst masterGain = audioCtx.createGain();\r\nwindow.masterGain = masterGain;\r\nmasterGain.gain.value = 1;\r\nmasterGain.connect(audioCtx.destination);\r\n\r\n\r\nexport const sketch = (p5) => {\r\n  p5.state = initialState;\r\n\r\n  /* Border size and color */\r\n  const CURSOR_STROKE_COLOR_SEPARATION = 20;\r\n  const CURSOR_ALPHA = 0.7;\r\n  const STROKE_WEIGHT_COEF = 1;\r\n  const STROKE_COLOR = 0;\r\n\r\n  const setupOscillators = () => {\r\n    oscs.forEach(({osc, gain}) =>\r\n    {\r\n      osc.stop();\r\n    }); // TODO: gain.disconnect?\r\n\r\n    oscs = _.range(p5.state.partialsCountMax).map(() => {\r\n      const osc = audioCtx.createOscillator();\r\n      const gain = audioCtx.createGain();\r\n      gain.gain.value = 0;\r\n      osc.connect(gain);\r\n      gain.connect(masterGain);\r\n      osc.start();\r\n      return {osc, gain};\r\n    });\r\n\r\n    window.oscs = oscs;\r\n  }\r\n\r\n  //rotate/flip a quadrant appropriately\r\n  const hilbGetRotatedVec = (n, v, rx, ry) => {\r\n    if (ry === 0) {\r\n      if (rx === 1) {\r\n        v.x = n - 1 - v.x;\r\n        v.y = n - 1 - v.y;\r\n      }\r\n\r\n      //Swap x and y\r\n      let temp = v.x;\r\n      v.x = v.y;\r\n      v.y = temp;\r\n    }\r\n  }\r\n\r\n  const hilbDistanceToCoords = (hilbertN, dist) => {\r\n    //    TODO: get distanceToVector based on percentage of maxD so that the Hilbert cursor stays in the same place when changing Hilbert resolutions\r\n    //    TODO: also click the screen to set the cursor so need amp function to convert x,y to hilbert distance\r\n\r\n    const v = {x: 0, y: 0};\r\n    // _(size)\r\n    //   .range()\r\n    //   .map(v => Math.pow(2, v))\r\n    //   .takeWhile(v => v < size)\r\n    //   .value()\r\n\r\n    for (let s = 1; s < hilbertN; s *= 2) {\r\n      let rx = 1 & (dist / 2);\r\n      let ry = 1 & (dist ^ rx);\r\n      hilbGetRotatedVec(s, v, rx, ry);\r\n      v.x += s * rx;\r\n      v.y += s * ry;\r\n      dist /= 4;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  /**\r\n   * Returns amp {@code Vec} representing the Euclidian coordinates of the given normalized \"Mandelbrot coordinates\"\r\n   * <br>Mandelbrot X scale: -2.5 to 1\r\n   * <br>Mandelbrot Y scale: -1 to 1\r\n   * @param x normalized x coordinate 0 to 1.0\r\n   * @param y normalized y coordinate 0 to 1.0\r\n   * @return\r\n   */\r\n  const mandGetDenormalizedCoords = (x, y) => ({\r\n    x: -2.5 + x * 3.5,\r\n    y: -1 + y * 2,\r\n  })\r\n\r\n\r\n  /**\r\n   * Returns the number of iterations to escape the Mandelbrot set at the given coordinates\r\n   * @param scaledX\r\n   * @param scaledY\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetVal = (scaledX, scaledY, maxIterations) => {\r\n    let x = 0, y = 0;\r\n    let iter = 0;\r\n\r\n    while (x * x + y * y < 4 && iter < maxIterations) {\r\n      let xTemp = x * x - y * y + scaledX;\r\n      y = 2 * x * y + scaledY;\r\n      x = xTemp;\r\n      iter++;\r\n    }\r\n    return iter;\r\n  }\r\n\r\n\r\n  const dot = (v1, v2) => _.reduce(v1, (acc, val, idx) => acc + val * v2[idx], 0);\r\n\r\n  /**\r\n   * https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n   * @param cx\r\n   * @param cy\r\n   * @param maxIterations\r\n   * @returns {*|number}\r\n   */\r\n  const mandGetValSmooth = (cx, cy, maxIterations) => {\r\n    const Bsq = 256 * 256;\r\n    const z = [0,0];\r\n    let n = 0;\r\n    let x, y;\r\n\r\n    for (let i = 0; i < maxIterations; i++) {\r\n      [x, y] = z;\r\n      z[0] = x * x - y * y + cx;\r\n      z[1] = 2 * x * y + cy;\r\n      if (dot(z, z) > Bsq) break;\r\n      n++;\r\n    }\r\n\r\n    // return n - Math.log(Math.log(Math.sqrt(z[0] * z[0] + z[1] * z[1]) / Math.log(B) / Math.log(2)))\r\n    return n >= maxIterations\r\n      ? maxIterations\r\n      : n - Math.log2(Math.log2(dot(z,z))) + 4;\r\n  }\r\n\r\n  /**\r\n   * Returns the number of iterations required to escape the Mandelbrot set at the given coordinates\r\n   * @param xN normalized x coordinate 0 to 1.0\r\n   * @param yN normalized y coordinate 0 to 1.0\r\n   * @param panX < 0 pans left. > 0 pans right\r\n   * @param panY < 0 pans up. > 0 pans down\r\n   * @param zoom 1.0 is unzoomed\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetValFromNormalizedCoords = (xN, yN, panX, panY, zoom, maxIterations) => {\r\n    let x1 = 0.5 - panX + (xN - 0.5) / zoom;\r\n    let y1 = 0.5 - panY + (yN - 0.5) / zoom;\r\n    const {x, y} = mandGetDenormalizedCoords(x1, y1);\r\n    return p5.state.isSmooth\r\n      ? mandGetValSmooth(x, y, maxIterations)\r\n      : mandGetVal(x, y, maxIterations);\r\n  }\r\n\r\n  const genHilbertCoords = _.memoize((hilbertN) =>\r\n    _.range(hilbertN * hilbertN)\r\n      .map(d => hilbDistanceToCoords(hilbertN, d)));\r\n\r\n\r\n  const genHilbertMandelbrot = () => {\r\n    const {\r\n      hilbertN,\r\n      maxIters,\r\n      panX,\r\n      panY,\r\n      partialsCountMax,\r\n      zoom,\r\n    } = p5.state;\r\n\r\n\r\n    return genHilbertCoords(hilbertN).map(({ x, y }) => {\r\n      const m = mandGetValFromNormalizedCoords(x / hilbertN, y / hilbertN, panX, panY, zoom, maxIters);\r\n      return {\r\n        x,\r\n        y,\r\n        m,\r\n        p: m === maxIters\r\n          ? 0 // to be filtered out\r\n          : Math.floor(((m - 1) % partialsCountMax) + 1),\r\n      };\r\n    })\r\n  };\r\n\r\n  const getStrokeWeight = (w) => {\r\n    const sideLength = w / p5.state.hilbertN;\r\n    return STROKE_WEIGHT_COEF * Math.min(10, sideLength / 20);\r\n  };\r\n\r\n  const getPartialOfOctaveStart = _.memoize((f) =>\r\n    _(100)\r\n      .range()\r\n      .map(n => Math.pow(2, n))\r\n      .dropWhile(n => f / n >= 2)\r\n      .first());\r\n\r\n  const getColorForMandelbrotVal = ({m, p}, isCursor = false) => {\r\n    const {\r\n      maxIters,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    const octMax = getPartialOfOctaveStart(partialsCountMax);\r\n    const oct = getPartialOfOctaveStart(p);\r\n\r\n    // good looks with smooth but not relevant to partials\r\n    // const h = (m * 10) % 255;\r\n    // const s = isCursor ? 0 : 255 - (m / maxIters) * 225  //(p / partialsCountMax) * 225;\r\n\r\n    const h = 255 * Math.log2(p / oct);\r\n    const s = isCursor ? 0 : 255 - Math.pow(oct / octMax, 2) * 225  //(p / partialsCountMax) * 225;\r\n    const b = m === maxIters ? 0 : 255;\r\n\r\n    return p5.color(h, s, b, isCursor ? CURSOR_ALPHA : 255);\r\n  };\r\n\r\n  const setFillColorForMandelbrotVal = (coordsWithVal, isCursor = false) => {\r\n    p5.fill(getColorForMandelbrotVal(coordsWithVal), isCursor);\r\n  }\r\n\r\n  const drawHilbertCoord = (w, h, hilbertCoord, hilbertN) => {\r\n    const scaleX = w / hilbertN;\r\n    const scaleY = h / hilbertN;\r\n    p5.rect(hilbertCoord.x * scaleX, hilbertCoord.y * scaleY, scaleX, scaleY);\r\n    // p5.circle(hilbertCoord.x * scaleX + scaleX / 2, hilbertCoord.y * scaleY + scaleY / 2, scaleX);\r\n  }\r\n\r\n  const drawHilbertMandelbrot = (w, h, state) => {\r\n    const {\r\n      hilbertN,\r\n      hilbMand,\r\n    } = state;\r\n\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n    p5.strokeWeight(strokeWeight);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    const s = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n\r\n    hilbMand.forEach((coordWithVal, d) => {\r\n      setFillColorForMandelbrotVal(coordWithVal);\r\n\r\n      p5.push();\r\n      {\r\n        p5.translate(p5.width / 4, 0);\r\n        drawHilbertCoord(w, h, coordWithVal, hilbertN);\r\n      }\r\n      p5.pop();\r\n\r\n      p5.push(); // TODO: is it more expensive to push/pop 1000 times or iterate over hilbMand twice?\r\n      {\r\n        p5.translate((p5.width / 4) * 3, 0);\r\n        drawLinearizedMandelbrotCoord(p5.width / 4, s, d);\r\n      }\r\n      p5.pop();\r\n    })\r\n  };\r\n\r\n  const getSideLengthForLinearizedMap = (dMax, w, h) => {\r\n    const maxA = w * h;\r\n    const largestPossibleSide = Math.sqrt(maxA / dMax);\r\n\r\n    let s = 0;\r\n    for (let i = 1; i < w; i++) {\r\n      s = w / i;\r\n      if (s > largestPossibleSide) {\r\n        continue;\r\n      }\r\n\r\n      const sqPerRow = w / s;\r\n      const rows = dMax / sqPerRow;\r\n      const leftover = dMax % sqPerRow;\r\n\r\n      if (rows * s + (leftover > 0 ? s : 0) <= h) {\r\n        break;\r\n      }\r\n    }\r\n    return s;\r\n  }\r\n\r\n  const drawLinearizedMandelbrotCoord = (w, s, d) => {\r\n    const valsPerRow = w / s;\r\n\r\n    let x = d % valsPerRow;\r\n    const y = Math.floor(d / valsPerRow);\r\n\r\n    // snake around instead of starting from the left for each row\r\n    if (y % 2 === 1) {\r\n      x = valsPerRow - (x + 1);\r\n    }\r\n\r\n    p5.rect(x * s, y * s, s, s);\r\n  }\r\n\r\n  const genAndDrawHilbertMandelbrot = () => {\r\n    p5.background(32);\r\n\r\n    // fade out. this can probably move to partials _.each\r\n    oscs.forEach(({gain}) => {\r\n      gain.gain.cancelScheduledValues(audioCtx.currentTime);\r\n      gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);\r\n    })\r\n\r\n    if (oscs.length !== partialsCountMax) {\r\n      setupOscillators(); // TODO: fade out first\r\n    }\r\n\r\n    const {\r\n      fundamentalFreq,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    const hilbMand = genHilbertMandelbrot();\r\n\r\n    const partials = _(hilbMand)\r\n      .map(({p}) => p)\r\n      .filter(_.identity) // maxIters (black) are set as p: 0\r\n      .uniq()\r\n      .sort()\r\n      .take(partialsCountMax)\r\n      .map((partial, i) => [partial, {amp: 0, oscIdx: i}])\r\n      .fromPairs()\r\n      .value();\r\n\r\n    // slide to new freqs if partials change\r\n    _.each(partials, ({decayTimerId, oscIdx, zeroGainTimerId}, partial) => {\r\n      clearTimeout(decayTimerId);\r\n      clearTimeout(zeroGainTimerId);\r\n      oscs[oscIdx].osc.frequency.cancelScheduledValues(audioCtx.currentTime);\r\n      oscs[oscIdx].osc.frequency.linearRampToValueAtTime(partial * fundamentalFreq, audioCtx.currentTime + 0.5);\r\n    });\r\n\r\n    p5.setState(prevState => {\r\n      const nextState = {\r\n        ...prevState,\r\n        hilbMand,\r\n        isRegenNeeded: false,\r\n        partials,\r\n      };\r\n      drawHilbertMandelbrot( p5.width / 2, p5.height, nextState);\r\n      return nextState;\r\n    });\r\n  }\r\n\r\n\r\n  const cursorErasePrev = (maxD, s, d) => {\r\n    const prevD = (maxD + d - 1) % maxD;\r\n    const {hilbMand} = p5.state;\r\n    const prevCoordAndVal = hilbMand[prevD];\r\n\r\n    setFillColorForMandelbrotVal(prevCoordAndVal);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, prevCoordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, s, prevD);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  const cursorDraw = (id) => {\r\n    const {hilbMand} = p5.state;\r\n    const d = p5.state.tick % hilbMand.length;\r\n    const coordAndVal = hilbMand[d];\r\n    const sideLength = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n\r\n    p5.strokeWeight(strokeWeight);\r\n    cursorErasePrev(hilbMand.length, sideLength, d);\r\n    p5.stroke((CURSOR_STROKE_COLOR_SEPARATION * id) % 255, 0, 255);\r\n    setFillColorForMandelbrotVal(coordAndVal, true);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, coordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      p5.strokeWeight(strokeWeight);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, sideLength, d);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  const cursorExcite = (id) => {\r\n    const {\r\n      decayDuration,\r\n      exciteEnergy,\r\n      exciteDuration,\r\n      hilbMand,\r\n      partials,\r\n      tick,\r\n    } = p5.state;\r\n\r\n    const d = tick % hilbMand.length;\r\n    const {p} = hilbMand[d];\r\n\r\n    if (p > 0) {\r\n      const partial = partials[p];\r\n      const {\r\n        amp,\r\n        decayTimerId,\r\n        oscIdx,\r\n        zeroGainTimerId,\r\n      } = partial;\r\n      const {gain} = oscs[oscIdx];\r\n\r\n      const isExcited = _.isNumber(decayTimerId);\r\n      const currGain = isExcited ? amp : gain.gain.value;\r\n\r\n      // console.log(p, currGain);\r\n\r\n      const targetGain = 0.8 * Math.min(1, currGain + exciteEnergy * (1 - currGain));\r\n      partial.amp = targetGain;\r\n\r\n      clearTimeout(decayTimerId); // further delay the decay\r\n      clearTimeout(zeroGainTimerId); // don't reset amp to zero\r\n      gain.gain.cancelScheduledValues(0);\r\n      gain.gain.linearRampToValueAtTime(targetGain, audioCtx.currentTime + exciteDuration / 1000);\r\n\r\n      partial.decayTimerId = setTimeout(() => {\r\n        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + decayDuration / 1000);\r\n        partial.decayTimerId = null;\r\n\r\n        partial.zeroGainTimerId = setTimeout(() => {\r\n          partial.amp = 0;\r\n        }, decayDuration)\r\n      }, exciteDuration);\r\n    }\r\n  }\r\n\r\n  const partialsDraw = () => {\r\n    const h = p5.height;\r\n    const w = p5.width / 4;\r\n\r\n    p5.noStroke();\r\n\r\n    const { partials, partialsCountMax } = p5.state;\r\n\r\n    _.each(partials, ({ amp: targetAmp, oscIdx }, p) => {\r\n      const barH = h / partialsCountMax;\r\n      const y = h * ((p - 1) / partialsCountMax);\r\n      const barW = oscs[oscIdx].gain.gain.value * w;\r\n\r\n      const c = getColorForMandelbrotVal({ m: 1, p})\r\n      p5.fill(p5.color(p5.hue(c), 255, 8));\r\n      p5.rect(0, y, w, barH);\r\n\r\n      p5.fill(c);\r\n      p5.rect(0, y, barW, barH);\r\n      p5.fill(255);\r\n      p5.rect(targetAmp * w, y, 1, barH);\r\n    })\r\n\r\n  }\r\n\r\n  p5.setup = () => {\r\n    p5.createCanvas(p5._width, p5._height);\r\n    p5.colorMode(p5.HSB);\r\n    genAndDrawHilbertMandelbrot();\r\n  }\r\n\r\n  p5.draw = () => {\r\n    const {\r\n      isPlaying,\r\n      isRegenNeeded,\r\n      tickDuration,\r\n      tickLastMillis,\r\n    } = p5.state;\r\n\r\n    if (isRegenNeeded) {\r\n      genAndDrawHilbertMandelbrot();\r\n    }\r\n\r\n    const now = p5.millis();\r\n\r\n    if (_.every([\r\n      !isRegenNeeded,\r\n      isPlaying,\r\n      now > tickLastMillis + tickDuration\r\n    ])) {\r\n      cursorDraw(0);\r\n      cursorExcite(0);\r\n      p5.state.tick++;\r\n      p5.state.tickLastMillis = now;\r\n    }\r\n\r\n    partialsDraw();\r\n  }\r\n\r\n  /**\r\n   * This needs to be called by a user event handler.\r\n   * @param isPlaying\r\n   */\r\n  p5.toggleAudio = (isPlaying) => {\r\n    if (isPlaying && audioCtx.state !== 'running') {\r\n      audioCtx.resume();\r\n    }\r\n\r\n    if (!isPlaying && audioCtx.state === 'running') {\r\n      audioCtx.suspend();\r\n    }\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport P5 from 'p5';\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport { initialState, sketch } from \"./mandelbrotP5\";\r\n\r\nconst useP5 = (sketch) => {\r\n  const [sketchState, setSketchState] = useState(initialState);\r\n  const [sketchInstance, setSketchInstance] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  if (sketchInstance) {\r\n    sketchInstance.setState = setSketchState;\r\n    sketchInstance.state = sketchState;\r\n  }\r\n\r\n  const ref = useCallback((el) => {\r\n    console.log('useCallback')\r\n    if (el) {\r\n      const instance = new P5(sketch, el);\r\n      setSketchInstance(instance);\r\n\r\n      instance._height = el.clientHeight;\r\n      instance._width = el.clientWidth;\r\n\r\n      const resize = (width, height) => {\r\n        instance.resizeCanvas(width, height);\r\n        setSketchState((prevState) => ({...prevState, isRegenNeeded: true}))\r\n      }\r\n\r\n      const resizeObserver = new ResizeObserver(([{contentRect: {height, width}}]) => {\r\n        resize(width, height);\r\n      });\r\n      setResizeObserver(resizeObserver);\r\n      resizeObserver.observe(el);\r\n    } else {\r\n      resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n    ref,\r\n  };\r\n}\r\n\r\nconst handleKeyDown = (setSketchState, sketchInstance) => (evt) => {\r\n  console.log(evt);\r\n  const {code, shiftKey, key} = evt;\r\n  if (_.includes(['Control', 'Shift'], key)) return;\r\n\r\n  setSketchState(prevState => {\r\n    const {hilbertN, isPlaying, panX, panY, zoom} = prevState;\r\n    const panDelta = 0.1 / zoom;\r\n\r\n    if (code === 'Space') {\r\n      sketchInstance.toggleAudio(!isPlaying);\r\n      return { ...prevState, isPlaying: !isPlaying}\r\n    }\r\n\r\n    const nextState = {\r\n      ...key === 'ArrowLeft'\r\n        ? shiftKey\r\n          ? {hilbertN: Math.pow(2, Math.log2(hilbertN) - 1)}\r\n          : {panX: panX + panDelta}\r\n        : {},\r\n      ...key === 'ArrowRight'\r\n        ? shiftKey\r\n          ? {hilbertN: Math.min(256, Math.pow(2, Math.log2(hilbertN) + 1))}\r\n          : {panX: panX - panDelta}\r\n        : {},\r\n      ...key === 'ArrowUp'\r\n        ? shiftKey\r\n          ? {zoom: zoom * (10 / 9)}\r\n          : {panY: panY + panDelta}\r\n        : {},\r\n      ...key === 'ArrowDown'\r\n        ? shiftKey\r\n          ? {zoom: zoom * (9 / 10)}\r\n          : {panY: panY - panDelta}\r\n        : {},\r\n    };\r\n\r\n    return {\r\n      ...prevState,\r\n      ...nextState,\r\n      isRegenNeeded: !_.isEmpty(nextState),\r\n    };\r\n  })\r\n\r\n};\r\n\r\nconst Mandelbrot = () => {\r\n  const {\r\n    ref,\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n  } = useP5(sketch);\r\n\r\n  window.sketchInstance = sketchInstance;\r\n\r\n  useEffect(() => {\r\n    if (sketchInstance) {\r\n      const handler = handleKeyDown(setSketchState, sketchInstance);\r\n      window.addEventListener('keydown', handler)\r\n      return () => { // cleanup\r\n        window.removeEventListener('keydown', handler);\r\n      };\r\n    }\r\n  }, [sketchInstance]);\r\n\r\n  \r\n\r\n  return (<>\r\n    <div\r\n      ref={ref}\r\n      style={{\r\n        alignSelf: 'start',\r\n        background: 'radial-gradient(circle, rgba(74,153,117,1) 0%, rgba(188,148,233,0.6943726953672094) 100%)',\r\n        height: '50vw',\r\n        width: '100vw',\r\n      }}\r\n    />\r\n\r\n    <div style={{\r\n      background: \"rgba(0,0,0,0.5)\",\r\n      position: \"absolute\",\r\n      bottom: 66,\r\n      padding: 12,\r\n      left: 50,\r\n      // width: \"100%\"\r\n    }}>\r\n        {sketchState.isPlaying ? \"▶️\" : \"⏸\"}\r\n\r\n        <Slider\r\n          min={16}\r\n          max={1000}\r\n          stateKey={\"tickDuration\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n        <Slider\r\n          min={1}\r\n          max={4000}\r\n          stateKey={\"exciteDuration\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n        <Slider\r\n          min={10}\r\n          max={8000}\r\n          stateKey={\"decayDuration\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n\r\n        <Slider\r\n          min={0.01}\r\n          max={1}\r\n          step={0.01}\r\n          stateKey={\"exciteEnergy\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n        <Slider\r\n          min={0.1}\r\n          max={500}\r\n          onMouseUp={() => {\r\n            console.log('onMouseUp');\r\n            sketchState.isRegenNeeded = true // TODO: isFreqChanged instead of full regen\r\n          }}\r\n          step={0.1}\r\n          stateKey={\"fundamentalFreq\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n        <Slider\r\n          min={1}\r\n          max={1000}\r\n          stateKey={\"partialsCountMax\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n          // onInput={() => {\r\n          //   console.log('onInput');\r\n          //   sketchState.isRegenNeeded = true\r\n          // // console.log('sketchState.isRegenNeeded:', sketchState.isRegenNeeded)\r\n          // }}\r\n          onMouseUp={() => {\r\n            console.log('onMouseUp');\r\n            sketchState.isRegenNeeded = true\r\n          // console.log('sketchState.isRegenNeeded:', sketchState.isRegenNeeded)\r\n          }}\r\n        />\r\n        <Slider\r\n          min={64}\r\n          max={8000}\r\n          stateKey={\"maxIters\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n          onMouseUp={() => {\r\n            console.log('onMouseUp');\r\n            sketchState.isRegenNeeded = true\r\n          }}\r\n        />\r\n\r\n\r\n    </div>\r\n   </>);\r\n};\r\n\r\nconst Slider = ({ sketchState, setSketchState, stateKey, ...props }) => (\r\n    <div>\r\n      {stateKey}: {sketchState[stateKey]}\r\n      <br />\r\n      <input\r\n        type=\"range\"\r\n        style={{width: 400}}\r\n        value={sketchState[stateKey]}\r\n        onChange={ev => {\r\n          const value = Number(ev.target.value);\r\n          setSketchState(state => ({\r\n            ...state,\r\n            [stateKey]: value\r\n          }))\r\n        }}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n\r\nexport default Mandelbrot;\r\n","import _ from 'lodash';\r\nimport Vex from 'vexflow';\r\nimport React, {useCallback, useState} from 'react';\r\n\r\nconst VF = Vex.Flow;\r\n\r\nconst useVexFlow = () => {\r\n  const [context, setContext] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  const ref = useCallback((el) => {\r\n    if (el) {\r\n      const renderer = new VF.Renderer(el, VF.Renderer.Backends.SVG);\r\n      renderer.resize(el.clientWidth, el.clientHeight);\r\n      setContext(renderer.getContext());\r\n\r\n      const resizeObserver = new ResizeObserver(([{ contentRect: { height, width } }]) => {\r\n        renderer.resize(width, height);\r\n      });\r\n      setResizeObserver(resizeObserver);\r\n      resizeObserver.observe(el);\r\n    } else {\r\n      resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    context,\r\n    ref,\r\n  };\r\n}\r\n\r\nconst Staff = () => {\r\n  const {\r\n    context,\r\n    ref,\r\n  } = useVexFlow();\r\n\r\n  if (context) {\r\n    context.setStrokeStyle('white');\r\n    context.setFillStyle('white');\r\n\r\n    const treble = new VF.Stave(50, 0, 10000)\r\n      .addClef('treble')\r\n      .addKeySignature('Db')\r\n      .addTimeSignature('4/4')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    window.VF= VF;\r\n    window.context = context\r\n    window.treble = treble\r\n\r\n    const bass = new VF.Stave(50, 60, 10000)\r\n      .addClef('bass')\r\n      .addTimeSignature('4/4')\r\n      .addKeySignature('Db')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    const brace = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.BRACE)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n\r\n    const leftLine = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.SINGLE_LEFT)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n  }\r\n\r\n\r\n  return (\r\n    <div style={{\r\n      display: 'block',\r\n      width: '100%',\r\n    }}>\r\n      <div\r\n        ref={ref}\r\n        style={{\r\n          // background: 'darkcyan',\r\n          fill: 'white',\r\n          height: 500,\r\n          stroke: 'white',\r\n        }}/>\r\n    </div>\r\n  )\r\n};\r\n\r\nexport default Staff;\r\n","import _ from 'lodash';\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst Tonnetz = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    {_.range(30)\r\n      .map(y => (\r\n        <>\r\n          {_.range(50).map(x => {\r\n            const n = ((y % 2 > 0\r\n              ? ((y - 1) / 2) * 11 + 3\r\n              : (y / 2) * 11) + x * 7) % 12;\r\n\r\n            return (\r\n              <PC key={x} n={n} isOdd={y % 2 === 1}/>\r\n            )\r\n          })}\r\n          <br/>\r\n        </>\r\n      ))}\r\n  </div>\r\n);\r\n\r\nexport default Tonnetz;\r\n","import _ from 'lodash';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [0,5,7,10,12];\r\n\r\nconst Ukulele = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets}/>\r\n    <br/>\r\n    {[9, 4, 0, 7].map(pc0 => (\r\n      <>\r\n        {_.range(19)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) => (\r\n            <PC key={ix} n={pc}/>\r\n          ))}\r\n        <br/>\r\n      </>\r\n    ))}\r\n    <FretMarkers frets={frets}/>\r\n  </div>\r\n);\r\n\r\nexport default Ukulele;\r\n","export function HSVtoHex(h, s, v) {\r\n  function rgbToHex({ r, g, b }) {\r\n    function componentToHex(c) {\r\n      var hex = c.toString(16);\r\n      return hex.length == 1 ? \"0\" + hex : hex;\r\n    }\r\n\r\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\r\n  }\r\n\r\n  var r, g, b, i, f, p, q, t;\r\n  if (arguments.length === 1) {\r\n    s = h.s;\r\n    v = h.v;\r\n    h = h.h;\r\n  }\r\n  i = Math.floor(h * 6);\r\n  f = h * 6 - i;\r\n  p = v * (1 - s);\r\n  q = v * (1 - f * s);\r\n  t = v * (1 - (1 - f) * s);\r\n  switch (i % 6) {\r\n    case 0: {\r\n      r = v;\r\n      g = t;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 1: {\r\n      r = q;\r\n      g = v;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 2: {\r\n      r = p;\r\n      g = v;\r\n      b = t;\r\n      break;\r\n    }\r\n    case 3: {\r\n      r = p;\r\n      g = q;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 4: {\r\n      r = t;\r\n      g = p;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 5: {\r\n      r = v;\r\n      g = p;\r\n      b = q;\r\n      break;\r\n    }\r\n  }\r\n  return rgbToHex({\r\n    r: Math.round(r * 255),\r\n    g: Math.round(g * 255),\r\n    b: Math.round(b * 255)\r\n  });\r\n}","import React from 'react';\r\nimport { HSVtoHex } from './color';\r\nimport { toSymbol } from \"./util\";\r\n\r\n\r\nexport default ({ n, midiIn, position = \"0 0 0\", scale = \"1 1 1\" }) =>\r\n  <a-sphere\r\n    color=\"black\"\r\n    opacity={0.3}\r\n    position={position}\r\n    radius={0.15}\r\n    scale={scale}\r\n  >\r\n    <a-text\r\n      align=\"center\"\r\n      color={HSVtoHex(n / 12, 0.75, 1)}\r\n      font=\"../segoeui-msdf.json\"\r\n      negate=\"false\"\r\n      look-at=\"#camera\"\r\n      opacity={midiIn ? 1 : 0.25}\r\n      value={toSymbol(n)}\r\n    />\r\n  </a-sphere>\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport globalHook from 'use-global-hook';\r\n\r\nconst initialState = {\r\n  input: undefined,\r\n  inputDevices: [],\r\n  isDeviceSelectorVisible: false,\r\n  midiIn: _.zipObject(\r\n    _.range(128),\r\n    _.fill(new Array(128), 0)),\r\n};\r\n\r\nconst actions = {\r\n  setInputDevice: (store, amount) => {\r\n    const newCounterValue = store.state.counter + amount;\r\n    store.setState({counter: newCounterValue});\r\n  },\r\n\r\n  setInputDevices: (store, inputDevices) =>\r\n    store.setState({inputDevices}),\r\n\r\n  setMidiEvent: (store, midiEvt) =>\r\n    store.setState({midiIn: _.merge(store.state.midiIn, midiEvt)}),\r\n\r\n  toggleDeviceSelector: (store) =>\r\n    store.setState({isDeviceSelectorVisible: !store.state.isDeviceSelectorVisible}),\r\n};\r\n\r\nexport default globalHook(React, initialState, actions);\r\n","import _ from 'lodash';\r\nimport PitchClass from './pitchClass';\r\nimport React, {useEffect, useState} from 'react';\r\nimport useMidi from \"./useMidi\";\r\nimport {Entity} from 'aframe-react';\r\n\r\nconst ColtraneCircle = () => {\r\n  const [is180, setIs180] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const toggle = ({key}) => {\r\n      if (key === 'r') setIs180(is180 => !is180);\r\n    };\r\n\r\n    window.addEventListener('keyup', toggle);\r\n    return () => window.removeEventListener('keyup', toggle);\r\n  }, []);\r\n\r\n  const [{midiIn}] = useMidi();\r\n\r\n  const midiInPitchClasses = _(12)\r\n    .range()\r\n    .map(n => _(midiIn)\r\n      .pickBy((v, i) => i % 12 === n)\r\n      .values()\r\n      .sum())\r\n    .value();\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      animation={`property: rotation; to: 0 ${is180 ? 180 : 0} 0; dur: 500;`}\r\n      position={`0 0 -3`}\r\n    >\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 == 0)\r\n        .map(n => ({\r\n          n,\r\n          r: 1.5,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([6, 7, 0, 1], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          n: ((i + 1) * 2 + Math.floor(i / 4) * 2) % 12,\r\n          // n: (n * 2) % 12,\r\n          r: 1.5,\r\n          x: Math.sin((n + 0.5) * Math.PI / 24),\r\n          y: Math.cos((n + 0.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 != 0)\r\n        .map(n => ({\r\n          n: (n + 6) % 12,\r\n          r: 1.2,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([4, 5, 6, 7], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          // n: i,\r\n          n: (i * 2 + 9 + Math.floor(i / 4) * 2) % 12,\r\n          // n: i,\r\n          r: 1.2,\r\n          x: Math.sin((n - 1.5) * Math.PI / 24),\r\n          y: Math.cos((n - 1.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default ColtraneCircle;\r\n","import {Entity} from 'aframe-react';\r\nimport React from 'react';\r\nimport {HSVtoHex} from './color';\r\n\r\n// http://dmccooey.com/polyhedra/PentakisDodecahedron.txt\r\nconst c1 = 1.33058699733550141141687582919;\r\nconst c2 = 2.15293498667750705708437914596;\r\n\r\n// in ordered, opposite pairs\r\nconst verts = [\r\n  [0.0,  -c2,   c1],\r\n  [0.0,   c2,  -c1],\r\n  [ c2,  -c1,  0.0],\r\n  [-c2,   c1,  0.0],\r\n  [0.0,  -c2,  -c1],\r\n  [0.0,   c2,   c1],\r\n  [-c2,  -c1,  0.0],\r\n  [ c2,   c1,  0.0],\r\n  [-c1,  0.0,   c2],\r\n  [ c1,  0.0,  -c2],\r\n  [ c1,  0.0,   c2],\r\n  [-c1,  0.0,  -c2],\r\n];\r\n\r\nconst Dod = ({ rep = 1, sat, stack = [], n = 0 }) =>\r\n  <Entity position=\"0 0 0\">\r\n    {verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        color={HSVtoHex(i * (1 / 12), sat || 1, 1)}\r\n        events={{ click: () => console.log(i) }}\r\n        primitive=\"a-sphere\"\r\n        position={v.join(' ')}\r\n        scale={[1, 1, 1].map(n => 0.3 * n/ (rep * rep)).join(' ')}\r\n      />)}\r\n\r\n    {rep < 3 && verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        position={v.map(n => n * 2).join(' ')}\r\n        text={`color: ${HSVtoHex((stack.length ? stack[stack.length - 1] : i) * (1 / 12), 1, 1)}; align: center; value: ${[...stack, i].join(',')} - ${(n + i) % 12}; width: 5; zOffset: 0`}\r\n      >\r\n        <Dod rep={rep+1} sat={0.3} stack={[...stack, i]} n={(n + i) % 12} />\r\n      </Entity>)\r\n      // .filter((n, i) => i % 2)\r\n    }\r\n  </Entity>;\r\n\r\nexport default Dod;","import ColtraneCircle from \"./coltraneCircle\";\r\nimport Dod from './dod';\r\nimport React from 'react';\r\nimport {Entity, Scene} from 'aframe-react';\r\nimport {Route, Switch} from 'react-router-dom';\r\n\r\n// Note: needs https to enter VR\r\n\r\nconst VR = ({match: {path}}) => (\r\n  <Scene>\r\n    <a-assets>\r\n      <img id=\"groundTexture\" src=\"https://cdn.aframe.io/a-painter/images/floor.jpg\"/>\r\n      <img id=\"skyTexture\" src=\"https://cdn.aframe.io/a-painter/images/sky.jpg\"/>\r\n    </a-assets>\r\n\r\n    <Switch>\r\n      <Route path={`${path}/coltrane`} component={ColtraneCircle}/>\r\n      <Route path={`${path}/dod`} component={Dod}/>\r\n    </Switch>\r\n\r\n\r\n    {/*<Entity primitive=\"a-plane\" src=\"#groundTexture\" rotation=\"-90 0 0\" height=\"100\" width=\"100\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"ambient\" color=\"#445451\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"point\" intensity=\"2\" position=\"2 4 4\"/>*/}\r\n\r\n    <Entity\r\n      height=\"2048\"\r\n      primitive=\"a-sky\"\r\n      radius=\"30\"\r\n      rotation=\"90 0 0\"\r\n      src=\"#skyTexture\"\r\n      theta-length=\"90\"\r\n      width=\"2048\"\r\n    />\r\n    <Entity\r\n      height=\"2048\"\r\n      primitive=\"a-sky\"\r\n      radius=\"30\"\r\n      rotation=\"90 0 180\"\r\n      src=\"#skyTexture\"\r\n      theta-length=\"90\"\r\n      width=\"2048\"\r\n    />\r\n\r\n    <Entity primitive=\"a-camera\" id=\"camera\" position=\"0 0 0\">\r\n      <Entity primitive=\"a-cursor\" animation__click={{\r\n        property: 'scale',\r\n        startEvents: 'click',\r\n        from: '0.1 0.1 0.1',\r\n        to: '1 1 1',\r\n        dur: 150,\r\n      }}/>\r\n    </Entity>\r\n\r\n    <Entity\r\n      // events={{}}\r\n      id=\"leftHand\"\r\n      oculus-touch-controls=\"hand: left\"\r\n    />\r\n    <Entity\r\n      id=\"rightHand\"\r\n      oculus-touch-controls=\"hand: right\"\r\n    />\r\n\r\n  </Scene>\r\n);\r\n\r\nexport default VR;\r\n","// import 'aframe-animation-component';\r\nimport 'aframe';\r\nimport 'aframe-look-at-component';\r\nimport Banjo from './banjo';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Guitar from './guitar';\r\nimport Intro from './intro';\r\nimport MultTableMod12 from './multTableMod12';\r\nimport NumpadMod12 from './numpadMod12';\r\nimport OSC from './osc';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Mandelbrot from './mandelbrot';\r\nimport Staff from './staff';\r\nimport Tonnetz from './tonnetz';\r\nimport Ukulele from './ukulele';\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\nimport VR from './vr';\r\nimport {\r\n  AppBar,\r\n  IconButton,\r\n  Menu,\r\n  MenuItem,\r\n  Toolbar,\r\n} from '@material-ui/core';\r\nimport {BrowserRouter as Router, Route, Link} from 'react-router-dom';\r\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport {Menu as MenuIcon} from '@material-ui/icons';\r\n\r\n\r\nconst routes2d = [\r\n  ['Mod12 Multiplication Tables', '/multTableMod12', MultTableMod12],\r\n  ['PC-Number Notepad', '/numpadMod12', NumpadMod12],\r\n  ['OSC Dataviz', '/osc', OSC, true],\r\n  ['PC Tonnetz', '/tonnetz', Tonnetz],\r\n  ['Banjo PCs', '/banjo', Banjo],\r\n  ['Guitar PCs', '/guitar', Guitar],\r\n  ['Ukulele PCs', '/ukulele', Ukulele],\r\n  ['Staff', '/staff', Staff],\r\n  ['Mandelbrot', '/mandelbrot', Mandelbrot],\r\n];\r\n\r\nconst App = () => {\r\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\r\n\r\n  const theme = React.useMemo(\r\n    () =>\r\n      createMuiTheme({\r\n        palette: { // https://material-ui.com/customization/palette/\r\n          action: {\r\n            active: '#660000',\r\n          },\r\n          primary: {\r\n            main: '#440044'\r\n          },\r\n          type: prefersDarkMode ? 'dark' : 'light',\r\n        },\r\n      }),\r\n    [prefersDarkMode],\r\n  );\r\n\r\n  // Menu open/close\r\n  const [menuAnchorEl, setMenuAnchorEl] = React.useState(null);\r\n  const handleMenuButtonClick = ({ currentTarget }) => setMenuAnchorEl(currentTarget);\r\n  const handleMenuClose = () => setMenuAnchorEl(null);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline/>\r\n      <Router basename={process.env.PUBLIC_URL}>\r\n        <Route path=\"/\" exact component={Intro}/>\r\n\r\n        <Route path=\"/vr\" render={(routerProps) => <VR {...routerProps} />}/>\r\n\r\n        {routes2d.map(([title, path, component], key) => (\r\n          <Route {...{ component, key, path }} />\r\n        ))}\r\n\r\n        <AppBar\r\n          position=\"fixed\"\r\n          style={{\r\n            top: 'auto',\r\n            bottom: 0,\r\n          }}\r\n        >\r\n          <Toolbar>\r\n            <IconButton\r\n              edge=\"start\"\r\n              color=\"inherit\"\r\n              aria-label=\"open drawer\"\r\n              onClick={handleMenuButtonClick}\r\n            >\r\n              <MenuIcon/>\r\n            </IconButton>\r\n            <Menu\r\n              anchorEl={menuAnchorEl}\r\n              open={!!menuAnchorEl}\r\n              onClose={handleMenuClose}\r\n            >\r\n              <MenuItem >\r\n                <Link style={{ color: 'lightgrey'}} onClick={handleMenuClose} to=\"/\">Introduction</Link>\r\n              </MenuItem>\r\n              <MenuItem disabled divider >2D</MenuItem>\r\n              {routes2d.map(([title, url, component, isDevOnly], idx) => !isDevOnly && (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'pink'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n              <MenuItem disabled divider>VR</MenuItem>\r\n              {[\r\n                ['Coltrane Circle', '/vr/coltrane'],\r\n                ['Dod', '/vr/dod'],\r\n              ].map(([title, url], idx) => (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'cyan'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n            </Menu>\r\n          </Toolbar>\r\n        </AppBar>\r\n      </Router>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nReactDOM.render(<App/>, document.querySelector('#sceneContainer'));\r\n"],"sourceRoot":""}