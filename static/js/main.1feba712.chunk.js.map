{"version":3,"sources":["cell.js","fretMarkers.js","util.js","pc.js","banjo.js","guitar.js","intro.js","multTableMod12.js","numpadMod12.js","useMidi.js","mandelbrotP5.js","mandelbrot.js","midi.js","staff.js","tonnetz.js","ukulele.js","camera.js","color.js","pitchClass.js","coltraneCircle.js","dod.js","pitchClassSpiral.js","vr.js","index.js"],"names":["Cell","withStyles","root","fontSize","fontFamily","display","height","width","alignItems","justifyContent","el","odd","left","cellSize","position","_ref","children","classes","_ref$className","className","isOdd","style","react_default","a","createElement","concat","FretMarkers","fretMarker","color","frets","_","range","last","map","f","includes","fret","ix","cell","key","toSymbol","n","10","11","PC","Banjo","flexShrink","fretMarkers","pc0","pc0ix","Fragment","i","pc","src_pc","standardTuning","reverse","Guitar","overflowY","padding","MultTableMod12","margin","y","x","NumpadMod12","state","text","handleKeyPress","evt","char","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadDivide","NumpadMultiply","NumpadDecimal","NumpadEnter","Enter","Space","code","preventDefault","_this","setState","handleChange","value","target","window","addEventListener","this","removeEventListener","cols","rows","onChange","background","Component","initialState","input","undefined","inputDevices","isMidiClockInSelectorOpen","isMidiInSelectorOpen","midiClockInDevice","midiInDevice","midiIn","zipObject","fill","Array","actions","setInputDevices","store","setMidiEvent","midiEvt","merge","setMidiClockInDevice","setMidiInDevice","toggleMidiInSelector","toggleMidiClockInSelector","globalHook","React","decayDuration","exciteEnergy","exciteDuration","fundamentalFreq","hilbertN","hilbMand","isControlPanelOpen","isPlaying","isRegenNeeded","maxIters","midiClock","midiClocksPerTick","panX","panY","partials","partialsCountMax","isSmooth","tick","tickDuration","tickLastMillis","zoom","audioCtx","AudioContext","oscs","masterGain","createGain","gain","connect","destination","sketch","p5","font","hilbGetRotatedVec","v","rx","ry","temp","dot","v1","v2","reduce","acc","val","idx","mandGetValFromNormalizedCoords","xN","yN","maxIterations","_mandGetDenormalizedC","mandGetDenormalizedCoords","cx","cy","z","Math","log2","mandGetValSmooth","scaledX","scaledY","iter","xTemp","mandGetVal","genHilbertCoords","memoize","d","dist","s","hilbDistanceToCoords","getStrokeWeight","w","sideLength","min","getPartialOfOctaveStart","pow","dropWhile","first","getColorForMandelbrotVal","_ref3","m","p","isCursor","arguments","length","_p5$state2","octMax","oct","h","b","setFillColorForMandelbrotVal","coordsWithVal","drawHilbertCoord","hilbertCoord","scaleX","scaleY","rect","drawHilbertMandelbrot","strokeWeight","stroke","getSideLengthForLinearizedMap","forEach","coordWithVal","push","translate","pop","drawLinearizedMandelbrotCoord","dMax","maxA","largestPossibleSide","sqrt","sqPerRow","valsPerRow","floor","genAndDrawHilbertMandelbrot","_ref4","cancelScheduledValues","currentTime","linearRampToValueAtTime","osc","stop","createOscillator","start","_p5$state3","_p5$state","_ref2","genHilbertMandelbrot","_ref5","filter","identity","uniq","sort","take","partial","amp","oscIdx","fromPairs","each","_ref6","decayTimerId","zeroGainTimerId","clearTimeout","frequency","prevState","nextState","Object","objectSpread","prevD","cursorDraw","id","coordAndVal","maxD","prevCoordAndVal","cursorErasePrev","partialsDraw","noStroke","_p5$state5","_ref7","targetAmp","barH","barW","c","hue","wasPaused","preload","loadFont","setup","createCanvas","_width","_height","colorMode","HSB","textFont","incrementTick","isExternal","now","millis","_p5$state6","_p5$state4","currGain","isNumber","targetGain","setTimeout","exponentialRampToValueAtTime","cursorExcite","prevTick","draw","_p5$state7","every","noFill","textSize","textAlign","CENTER","toggleAudio","resume","suspend","useStyles","makeStyles","paper","paddingBottom","useP5","_useState","useState","_useState2","slicedToArray","sketchState","setSketchState","_useState3","_useState4","sketchInstance","setSketchInstance","_useState5","_useState6","resizeObserver","setResizeObserver","ref","useCallback","instance","P5","clientHeight","clientWidth","ResizeObserver","_ref2$0$contentRect","contentRect","resizeCanvas","resize","observe","disconnect","Slider","stateKey","props","objectWithoutProperties","assign","type","ev","Number","defineProperty","Mandelbrot","_useP","handleAction","action","panDelta","moveLeft","moveRight","moveUp","moveDown","resDec","resInc","toggleControlPanel","zoomIn","zoomOut","isEmpty","getHandleAction","useEffect","document","title","handler","shiftKey","getAction","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","handleKeyDown","_useMidi","useMidi","_useMidi2","handleMidiClock","addListener","removeListener","alignSelf","bottom","zIndex","Button","onClick","Tune_default","Drawer","anchor","open","onClose","variant","ButtonGroup","fullWidth","size","PauseCircleOutline_default","PlayCircleOutline_default","KeyboardArrowUpOutlined_default","KeyboardArrowLeftOutlined_default","KeyboardArrowRightOutlined_default","ZoomInOutlined_default","KeyboardArrowDownOutlined_default","ViewModuleOutlined_default","ViewComfyOutlined_default","ZoomOutOutlined_default","mandelbrot_Slider","max","step","onPointerUp","console","log","Midi","WebMidi","enable","err","error","inputs","handleMidi","note","number","rawVelocity","_React$useState","_React$useState2","midiMenuAnchorEl","setMidiMenuAnchorEl","handleMidiMenuButtonClick","isBeatClock","currentTarget","handleMidiInputSelect","deviceIdx","IconButton","edge","aria-label","src","WatchLater","Menu","anchorEl","handleMidiMenuClose","name","MenuItem","VF","Vex","Flow","Staff","_useVexFlow","context","setContext","renderer","Renderer","Backends","SVG","getContext","useVexFlow","setStrokeStyle","setFillStyle","treble","Stave","addClef","addKeySignature","addTimeSignature","bass","StaveConnector","setType","BRACE","SINGLE_LEFT","Tonnetz","Ukulele","Camera","primitive","look-controls","animation__click","property","startEvents","from","to","dur","HSVtoHex","r","g","q","t","componentToHex","hex","toString","rgbToHex","round","handleOsc","components","onOsc","instrument","vel","onTick","time","timeDelta","has","setAttribute","pitchClass","_ref2$position","_ref2$scale","scale","animation","material","blending","opacity","radius","look-at","align","negate","transparent","ColtraneCircle","is180","setIs180","toggle","midiInPitchClasses","pickBy","values","sum","sin","PI","cos","c1","c2","verts","Dod","_ref$rep","rep","sat","_ref$stack","stack","_ref$n","events","click","join","toConsumableArray","audioContext","PitchClassSpiral","_ref$depthMax","depthMax","_ref$isAlwaysCounterC","isAlwaysCounterClockwise","_ref$rMax","rMax","_ref$noteRange","rMin","noteRange","noteToDimensions","handleKeyup","detector","PitchDetector","interpolateFrequency","onDetect","stats","pitchDetector","onDebug","rms","detected","_noteToDimensions","ftomf","object3D","set","minCorrelation","minCorreationIncrease","normalize","stopAfterDetection","minNote","maxNote","minPeriod","maxPeriod","destroy","VR","path","match","react_router","component","rotation","theta-length","camera","oculus-touch-controls","doWhenAframeLoaded","AFRAME","oscHost","host","location","hostname","port","secure","OSC","plugin","WebsocketClientPlugin","registerComponent","init","_onOscId","on","address","_ref$args","args","split","remove","off","_this2","_ref2$args","routes2d","ReactDOM","render","prefersDarkMode","useMediaQuery","theme","useMemo","createMuiTheme","palette","active","primary","main","menuAnchorEl","setMenuAnchorEl","handleMenuClose","ThemeProvider","CssBaseline","react_router_dom","basename","process","exact","Intro","routerProps","vr","AppBar","top","Toolbar","esm_Menu","disabled","divider","url","_ref8","_ref9","midi","querySelector"],"mappings":"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","file":"static/js/main.1feba712.chunk.js","sourcesContent":["import React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst cellSize = 30;\r\n\r\nconst Cell = withStyles({\r\n  root: {\r\n    fontSize: 20,\r\n    fontFamily: 'jetBrainsMono',\r\n    display: 'inline-flex',\r\n    height: cellSize,\r\n    width: cellSize,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    // border: '1px solid',\r\n  },\r\n  el: {\r\n    fontFamily: 'Segoe UI',\r\n  },\r\n  odd: {\r\n    left: cellSize / 2,\r\n    position: 'relative',\r\n  }\r\n})(({children, classes, className = '', isOdd, style}) => (\r\n  <div\r\n    className={`${classes.root} ${className} ${isOdd ? classes.odd : ''}`}\r\n    style={style\r\n    }>\r\n    {children}\r\n  </div>\r\n));\r\n\r\nexport default Cell;\r\n","import _ from 'lodash';\r\nimport Cell from \"./cell\";\r\nimport React from \"react\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst FretMarkers = withStyles({\r\n  fretMarker: {color: 'purple'}\r\n})(\r\n  ({classes: {fretMarker}, frets}) => _.range(_.last(frets) + 1)\r\n    .map(f => _.includes(frets, f) ? f : '')\r\n    .map((fret, ix) => <Cell className={fretMarker} key={ix}>{fret}</Cell>));\r\n\r\nexport default FretMarkers;\r\n","export const toSymbol = n => ({\r\n  10: '૪',\r\n  11: 'Ɛ',\r\n})[n % 12] || n % 12;\r\n","import Cell from './cell';\r\nimport React from \"react\";\r\nimport {toSymbol} from \"./util\";\r\nimport {withStyles} from \"@material-ui/core/styles\";\r\n\r\nconst PC = withStyles({\r\n  el: {\r\n    fontFamily: 'Segoe UI',\r\n  },\r\n})(({classes, n, isOdd, style}) => (\r\n  <Cell\r\n    className={n % 12 === 11 ? classes.el : ''}\r\n    isOdd={isOdd}\r\n    style={style}\r\n  >\r\n    {toSymbol(n)}\r\n  </Cell>\r\n));\r\n\r\nexport default PC;\r\n","import _ from 'lodash';\r\nimport Cell from './cell';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [1,3,5,7,10,12,15,17,19];\r\n\r\nconst Banjo = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets} />\r\n    <br/>\r\n    {[0, 9, 5, 0, 0].map((pc0, pc0ix) => (\r\n      <>\r\n        {_.range(23)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) =>\r\n            pc0ix === 4 && ix < 5\r\n              ? <Cell key={ix}/>\r\n              : <PC key={ix} n={pc}/>\r\n          )}\r\n        <br/>\r\n      </>\r\n    ))}\r\n    <FretMarkers frets={frets} />\r\n  </div>\r\n);\r\n\r\nexport default Banjo;\r\n","import _ from 'lodash';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [0,5,7,12,15,17,19, 24];\r\n\r\nlet standardTuning = [4, 9, 2, 7, 11, 4].reverse();\r\nconst chelseaSessionsTuning = [0, 5, 0, 5, 9, 5].reverse();\r\nconst octoberSongTuning = [0, 7, 0, 4, 7, 0].reverse();\r\n\r\n\r\nconst Guitar = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets}/>\r\n    <br/>\r\n    {standardTuning.map(pc0 => (\r\n      <>\r\n        {_.range(25)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) => (\r\n            <PC key={ix} n={pc}/>\r\n          ))}\r\n        <br/>\r\n      </>\r\n    ))}\r\n    <FretMarkers frets={frets}/>\r\n  </div>\r\n);\r\n\r\nexport default Guitar;\r\n","import _ from 'lodash';\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst Banjo = () => (\r\n  <div style={{height: '100%', overflowY: 'auto', padding: '20% 10%'}}>\r\n    <h1>What is this nonsense all about?</h1>\r\n\r\n    <p>\r\n      When I learned how to play an instrument, we started with \"Hot Cross Buns\", \"Mary Had a Little Lamb\", etc.\r\n      We started with the first 3 notes in the key of \"C\". Eventually, we'd build up to the other 4 notes. Then a new\r\n      key was introduced. This one has a \"Bb\" -- the key of \"F\". At some point we'd be introduced to an \"accidental\".\r\n    </p>\r\n\r\n    <p>\r\n      This left a lasting impression that the notes C, D, E, F, G, A, and B were the main notes. And these other things\r\n      were in another class. They were harder -- harder to think about, harder to play, harder to keep track of, harder\r\n      to say. C, D, E, F, G, A, and B are all single syllables. The other 5 notes were thought of as modifications of\r\n      these main notes. \"B flat\", \"C sharp\", \"D flat\", yada yada. Wait are there 5 or are there 10?\r\n    </p>\r\n\r\n    <p>\r\n      \"B sharp\" is one of the first little musical jokes you get to say when you're in the know, until you learn that\r\n      when you really get in deep, actually \"B sharp\" <i>is</i> a real note. There's even a \"B double sharp\"! How many\r\n      notes <i>are</i> there!? Answer: infinite, as there are infinite numbers between 0 and 1, there are infinite\r\n      pitches. Another answer, and this is the one we'll focus on in this website, is 12. There are 12 pitch-classes in\r\n      the musical system that westerners refer to as \"music theory\" and more formally 12-tone equal temperament. All the\r\n      fancy names like \"B flat\" and \"F sharp\" are just various spellings of the 12 pitch-classes in 12-TET.\r\n    </p>\r\n\r\n    <p>\r\n      This is all kind of interesting for a while and makes a young musician wonder about how deep this labyrinth gets.\r\n      But it's all a smoke screen. And it gets even worse when you start to learn about intervals. Honestly, what's the\r\n      use of a \"diminished second\" if not to sound pedantic and \"technically correct\"?\r\n    </p>\r\n\r\n    <p>\r\n      While I'll concede that it sort of makes sense when you're talking about notes <i>written on a staff</i>,\r\n      I'll maintain that it's a bullshit system to think in and it's needlessly convoluted, scares off all but the\r\n      masochistic academics and overachievers. It adds a layer of cognitive as well as verbal overhead to otherwise\r\n      simple concepts, and all so that we can pretend that music all fits into this diatonic model, with a few outliers\r\n      that we call \"accidentals\". It makes the white keys approachable and the black keys scary and hard to name. \"Is\r\n      it a C# or a Db\"? Why do we care, when we really just want to think about the one pitch we're trying to finger?\r\n    </p>\r\n\r\n    <p>\r\n      If we're going to commit to this arguably artificial model of 12 notes, which is but one of a panoply of more\r\n      naturally harmonious tunings, if we're going to compromise with this 12-TET model so that we end up with 12\r\n      equally spaced notes around the octave, let's go all in and treat it with the simple terms it asks for. Let's\r\n      treat these 12 notes equally instead of imagining this additional layer of complexity on top of them.\r\n    </p>\r\n\r\n    <br/>\r\n    <hr/>\r\n\r\n    <h2>Please consider:</h2>\r\n    <pre>{_.range(12).map(pc => <PC key={pc} n={pc}/>)}</pre>\r\n    <p> That's \"oh\" \"one\" \"two\" \"three\" \"four\" \"five\" \"six\" \"sev\" \"eight\" \"nine\" \"ten\" \"el\".</p>\r\n\r\n\r\n\r\n  </div>\r\n);\r\n\r\nexport default Banjo;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport { toSymbol } from \"./util\";\r\nimport PC from \"./pc\";\r\n\r\nconst MultTableMod12 = () => (\r\n  <>\r\n    {_.range(6).map(n => (\r\n      <div style={{\r\n        display: 'block',\r\n        flexShrink: 0,\r\n        margin: '1em',\r\n      }}>\r\n        {_.range(13).map(y => (\r\n          <>\r\n            {_.range(13).map(x => (\r\n              <PC key={x} n={n + x * y} />\r\n            ))}\r\n            <br />\r\n          </>\r\n        ))}\r\n\r\n      </div>\r\n    ))}\r\n  </>);\r\n\r\nexport default MultTableMod12;\r\n","import _ from 'lodash';\r\nimport React, { Component } from 'react';\r\nimport { toSymbol } from \"./util\";\r\n\r\nclass NumpadMod12 extends Component {\r\n  state = {\r\n    text: '',\r\n  };\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('keypress', this.handleKeyPress);\r\n  }\r\n\r\n  handleKeyPress = (evt) => {\r\n    // console.log(evt.code)\r\n    const char = {\r\n      Backquote: '0',\r\n      Digit1: '1',\r\n      Digit2: '2',\r\n      Digit3: '3',\r\n      Digit4: '4',\r\n      Digit5: '5',\r\n      Digit6: '6',\r\n      Digit7: '7',\r\n      Digit8: '8',\r\n      Digit9: '9',\r\n      Digit0: '૪',\r\n      Minus: 'Ɛ',\r\n      Equal: '0',\r\n      Numpad0: '0',\r\n      Numpad1: '1',\r\n      Numpad2: '2',\r\n      Numpad3: '3',\r\n      Numpad4: '4',\r\n      Numpad5: '5',\r\n      Numpad6: '6',\r\n      Numpad7: '7',\r\n      Numpad8: '8',\r\n      Numpad9: '9',\r\n      NumpadDivide: '૪',\r\n      NumpadMultiply: 'Ɛ',\r\n      NumpadDecimal: ' ',\r\n      NumpadEnter: '\\n',\r\n      Enter: '\\n',\r\n      Space: ' ',\r\n    }[evt.code];\r\n\r\n    if (char) {\r\n      evt.preventDefault();\r\n      this.setState({ text: this.state.text + char });\r\n    }\r\n  };\r\n\r\n  handleChange = ({ target: { value }}) => this.setState({ text: value });\r\n\r\n  render() {\r\n    return <div>\r\n      <h3>Use the numpad to enter pitch classes</h3>\r\n      <textarea\r\n        cols={24}\r\n        rows={20}\r\n        onChange={this.handleChange}\r\n        style={{\r\n          background: 'black',\r\n          color: 'darkgray',\r\n          fontSize: 20,\r\n        }}\r\n        value={this.state.text}\r\n      />\r\n    </div>\r\n  }\r\n}\r\n\r\nexport default NumpadMod12;\r\n","import _ from 'lodash';\r\nimport React from 'react';\r\nimport globalHook from 'use-global-hook';\r\n\r\nconst initialState = {\r\n  input: undefined,\r\n  inputDevices: [],\r\n  isMidiClockInSelectorOpen: false,\r\n  isMidiInSelectorOpen: false,\r\n  midiClockInDevice: undefined,\r\n  midiInDevice: undefined,\r\n  midiIn: _.zipObject(\r\n    _.range(128),\r\n    _.fill(new Array(128), 0)),\r\n};\r\n\r\nconst actions = {\r\n  setInputDevices: (store, inputDevices) =>\r\n    store.setState({inputDevices}),\r\n\r\n  setMidiEvent: (store, midiEvt) =>\r\n    store.setState({midiIn: _.merge(store.state.midiIn, midiEvt)}),\r\n\r\n  setMidiClockInDevice: (store, midiClockInDevice) => store.setState({midiClockInDevice}),\r\n\r\n  setMidiInDevice: (store, midiInDevice) => store.setState({midiInDevice}),\r\n\r\n  toggleMidiInSelector: (store) =>\r\n    store.setState({isMidiInSelectorOpen: !store.state.isMidiInSelectorOpen}),\r\n\r\n  // todo: only 1 selector\r\n  toggleMidiClockInSelector: (store) =>\r\n    store.setState({isMidiClockInSelectorOpen: !store.state.isMidiClockInSelectorOpen}),\r\n\r\n\r\n};\r\n\r\nexport default globalHook(React, initialState, actions);\r\n","import _ from 'lodash';\r\n\r\n\r\n/* TODO\r\n* high prio\r\n  * fine-tune freq\r\n  * don't require redraw on freq change\r\n  * params bound to urlParams\r\n  * option to auto-choose fundamentalFreq\r\n    based on which partials are present\r\n    to center around 500 - 1000hz\r\n  * MIDI beat clock\r\n  * spiral of any length instead of hilbert\r\n\r\n* med prio\r\n  * for hilbertN of 256 or 512, use the vals to fill an audio buffer and play the ~1 or ~5s of audio\r\n  * utonal partials\r\n\r\n* low prio\r\n  * option to add a second cursor for stereo effects\r\n  * alternate space-filling curves\r\n  * keep cursor in same location when switching resolutions\r\n  * manual cursor\r\n* */\r\n\r\n\r\n\r\nexport const initialState = {\r\n  decayDuration: 5000,\r\n  exciteEnergy: 0.05,\r\n  exciteDuration: 1000,\r\n  fundamentalFreq: 200,\r\n  hilbertN: 64, // hilbertN must be power of 2 in order to be square\r\n  hilbMand: [/*{ x, y, m }*/], // coordinates and associated mandelbrot val in hilbert traversal order\r\n  isControlPanelOpen: true,\r\n  isPlaying: false,\r\n  isRegenNeeded: true,\r\n  maxIters: 4096, // max number of steps to recurse the mandelbrot fn\r\n  midiClock: 0,\r\n  midiClocksPerTick: 24,\r\n  panX: -0.05,\r\n  panY: 0,\r\n  partials: {/* partial: { amp, oscIdx } */}, // the collection is updated in setState but values within are changed in drawLoop directly\r\n  partialsCountMax: 16,\r\n  isSmooth: false, // smooth technique https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n  tick: 0, // updated in draw() bypasses setState\r\n  tickDuration: 100,\r\n  tickLastMillis: 0, // updated in draw() bypasses setState\r\n  zoom: 1.2,\r\n\r\n  // zoom: 3603.7157567397, panX: 0.18580280974577668, panY: 0.00036930706052212803,\r\n\r\n  // floating point errors here\r\n  // zoom: 279919582741326.66, panX: -0.014853203736137617, panY: 0.13451319076043783,\r\n\r\n  // panX: 0.0011548427778035686,\r\n  // panY: 0.025033026937542575,\r\n  // zoom: 319852972190.0951,\r\n  //\r\n  // panX: -0.18498767183730766,\r\n  // panY: 0.4722205531430409,\r\n  // zoom: 419013953.31772846,\r\n  //\r\n  //\r\n  // decay: 0.000075,\r\n  // exciteEnergy: 0.006,\r\n  // fundamentalFreq: 10,\r\n  // hilbertN: 256,\r\n  // maxIters: 4096,\r\n  // panX: 0.0011503007796323155,\r\n  // panY: 0.025033026938902938,\r\n  // tickDuration: 10,\r\n  // zoom: 836635.9887997985,\r\n  //\r\n  //\r\n  //\r\n  // panX: 0.08871194014553094,\r\n  // panY: -0.12829271146701177,\r\n  // zoom: 19736096.460687958,\r\n\r\n  // ...{zoom: 39422433.84662852, panX: 0.04670942760989286, panY: 0.13656218122372943},\r\n\r\n  // demo for 10 partials\r\n  // ...{zoom: 12371177.464729108, panX: 0.04671008941233588, panY: 0.13656133340058238},\r\n};\r\n\r\nlet audioCtx = new AudioContext();\r\nlet oscs = [];\r\n\r\nconst masterGain = audioCtx.createGain();\r\nwindow.masterGain = masterGain;\r\nmasterGain.gain.value = 1;\r\nmasterGain.connect(audioCtx.destination);\r\n\r\n\r\nexport const sketch = (p5) => {\r\n  p5.state = initialState;\r\n\r\n  /* Border size and color */\r\n  const CURSOR_STROKE_COLOR_SEPARATION = 20;\r\n  const CURSOR_ALPHA = 0.7;\r\n  const STROKE_WEIGHT_COEF = 1;\r\n  const STROKE_COLOR = 0;\r\n\r\n  const setupOscillators = () => {\r\n    oscs.forEach(({osc, gain}) =>\r\n    {\r\n      osc.stop();\r\n    }); // TODO: gain.disconnect?\r\n\r\n    oscs = _.range(p5.state.partialsCountMax).map(() => {\r\n      const osc = audioCtx.createOscillator();\r\n      const gain = audioCtx.createGain();\r\n      gain.gain.value = 0;\r\n      osc.connect(gain);\r\n      gain.connect(masterGain);\r\n      osc.start();\r\n      return {osc, gain};\r\n    });\r\n\r\n    window.oscs = oscs;\r\n  }\r\n\r\n  //rotate/flip a quadrant appropriately\r\n  const hilbGetRotatedVec = (n, v, rx, ry) => {\r\n    if (ry === 0) {\r\n      if (rx === 1) {\r\n        v.x = n - 1 - v.x;\r\n        v.y = n - 1 - v.y;\r\n      }\r\n\r\n      //Swap x and y\r\n      let temp = v.x;\r\n      v.x = v.y;\r\n      v.y = temp;\r\n    }\r\n  }\r\n\r\n  const hilbDistanceToCoords = (hilbertN, dist) => {\r\n    //    TODO: get distanceToVector based on percentage of maxD so that the Hilbert cursor stays in the same place when changing Hilbert resolutions\r\n    //    TODO: also click the screen to set the cursor so need amp function to convert x,y to hilbert distance\r\n\r\n    const v = {x: 0, y: 0};\r\n    // _(size)\r\n    //   .range()\r\n    //   .map(v => Math.pow(2, v))\r\n    //   .takeWhile(v => v < size)\r\n    //   .value()\r\n\r\n    for (let s = 1; s < hilbertN; s *= 2) {\r\n      let rx = 1 & (dist / 2);\r\n      let ry = 1 & (dist ^ rx);\r\n      hilbGetRotatedVec(s, v, rx, ry);\r\n      v.x += s * rx;\r\n      v.y += s * ry;\r\n      dist /= 4;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  /**\r\n   * Returns amp {@code Vec} representing the Euclidian coordinates of the given normalized \"Mandelbrot coordinates\"\r\n   * <br>Mandelbrot X scale: -2.5 to 1\r\n   * <br>Mandelbrot Y scale: -1 to 1\r\n   * @param x normalized x coordinate 0 to 1.0\r\n   * @param y normalized y coordinate 0 to 1.0\r\n   * @return\r\n   */\r\n  const mandGetDenormalizedCoords = (x, y) => ({\r\n    x: -2.5 + x * 3.5,\r\n    y: -1 + y * 2,\r\n  })\r\n\r\n\r\n  /**\r\n   * Returns the number of iterations to escape the Mandelbrot set at the given coordinates\r\n   * @param scaledX\r\n   * @param scaledY\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetVal = (scaledX, scaledY, maxIterations) => {\r\n    let x = 0, y = 0;\r\n    let iter = 0;\r\n\r\n    while (x * x + y * y < 4 && iter < maxIterations) {\r\n      let xTemp = x * x - y * y + scaledX;\r\n      y = 2 * x * y + scaledY;\r\n      x = xTemp;\r\n      iter++;\r\n    }\r\n    return iter;\r\n  }\r\n\r\n\r\n  const dot = (v1, v2) => _.reduce(v1, (acc, val, idx) => acc + val * v2[idx], 0);\r\n\r\n  /**\r\n   * https://iquilezles.org/www/articles/mset_smooth/mset_smooth.htm\r\n   * @param cx\r\n   * @param cy\r\n   * @param maxIterations\r\n   * @returns {*|number}\r\n   */\r\n  const mandGetValSmooth = (cx, cy, maxIterations) => {\r\n    const Bsq = 256 * 256;\r\n    const z = [0,0];\r\n    let n = 0;\r\n    let x, y;\r\n\r\n    for (let i = 0; i < maxIterations; i++) {\r\n      [x, y] = z;\r\n      z[0] = x * x - y * y + cx;\r\n      z[1] = 2 * x * y + cy;\r\n      if (dot(z, z) > Bsq) break;\r\n      n++;\r\n    }\r\n\r\n    // return n - Math.log(Math.log(Math.sqrt(z[0] * z[0] + z[1] * z[1]) / Math.log(B) / Math.log(2)))\r\n    return n >= maxIterations\r\n      ? maxIterations\r\n      : n - Math.log2(Math.log2(dot(z,z))) + 4;\r\n  }\r\n\r\n  /**\r\n   * Returns the number of iterations required to escape the Mandelbrot set at the given coordinates\r\n   * @param xN normalized x coordinate 0 to 1.0\r\n   * @param yN normalized y coordinate 0 to 1.0\r\n   * @param panX < 0 pans left. > 0 pans right\r\n   * @param panY < 0 pans up. > 0 pans down\r\n   * @param zoom 1.0 is unzoomed\r\n   * @param maxIterations\r\n   * @return\r\n   */\r\n  const mandGetValFromNormalizedCoords = (xN, yN, panX, panY, zoom, maxIterations) => {\r\n    let x1 = 0.5 - panX + (xN - 0.5) / zoom;\r\n    let y1 = 0.5 - panY + (yN - 0.5) / zoom;\r\n    const {x, y} = mandGetDenormalizedCoords(x1, y1);\r\n    return p5.state.isSmooth\r\n      ? mandGetValSmooth(x, y, maxIterations)\r\n      : mandGetVal(x, y, maxIterations);\r\n  }\r\n\r\n  const genHilbertCoords = _.memoize((hilbertN) =>\r\n    _.range(hilbertN * hilbertN)\r\n      .map(d => hilbDistanceToCoords(hilbertN, d)));\r\n\r\n\r\n  const genHilbertMandelbrot = () => {\r\n    const {\r\n      hilbertN,\r\n      maxIters,\r\n      panX,\r\n      panY,\r\n      partialsCountMax,\r\n      zoom,\r\n    } = p5.state;\r\n\r\n\r\n    return genHilbertCoords(hilbertN).map(({ x, y }) => {\r\n      const m = mandGetValFromNormalizedCoords(x / hilbertN, y / hilbertN, panX, panY, zoom, maxIters);\r\n      return {\r\n        x,\r\n        y,\r\n        m,\r\n        p: m === maxIters\r\n          ? 0 // to be filtered out\r\n          : Math.floor(((m - 1) % partialsCountMax) + 1),\r\n      };\r\n    })\r\n  };\r\n\r\n  const getStrokeWeight = (w) => {\r\n    const sideLength = w / p5.state.hilbertN;\r\n    return STROKE_WEIGHT_COEF * Math.min(10, sideLength / 20);\r\n  };\r\n\r\n  const getPartialOfOctaveStart = _.memoize((f) =>\r\n    _(100)\r\n      .range()\r\n      .map(n => Math.pow(2, n))\r\n      .dropWhile(n => f / n >= 2)\r\n      .first());\r\n\r\n  const getColorForMandelbrotVal = ({m, p}, isCursor = false) => {\r\n    const {\r\n      maxIters,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    const octMax = getPartialOfOctaveStart(partialsCountMax);\r\n    const oct = getPartialOfOctaveStart(p);\r\n\r\n    // good looks with smooth but not relevant to partials\r\n    // const h = (m * 10) % 255;\r\n    // const s = isCursor ? 0 : 255 - (m / maxIters) * 225  //(p / partialsCountMax) * 225;\r\n\r\n    const h = 255 * Math.log2(p / oct);\r\n    const s = isCursor ? 0 : 255 - Math.pow(oct / octMax, 2) * 225  //(p / partialsCountMax) * 225;\r\n    const b = isCursor\r\n      ? 255\r\n      : m === maxIters ? 0\r\n        : 30 + Math.pow(oct / octMax, 2) * 225;\r\n\r\n    return p5.color(h, s, b, isCursor ? CURSOR_ALPHA : 255);\r\n  };\r\n\r\n  const setFillColorForMandelbrotVal = (coordsWithVal, isCursor = false) => {\r\n    p5.fill(getColorForMandelbrotVal(coordsWithVal, isCursor));\r\n  }\r\n\r\n  const drawHilbertCoord = (w, h, hilbertCoord, hilbertN) => {\r\n    const scaleX = w / hilbertN;\r\n    const scaleY = h / hilbertN;\r\n    p5.rect(hilbertCoord.x * scaleX, hilbertCoord.y * scaleY, scaleX, scaleY);\r\n    // p5.circle(hilbertCoord.x * scaleX + scaleX / 2, hilbertCoord.y * scaleY + scaleY / 2, scaleX);\r\n  }\r\n\r\n  const drawHilbertMandelbrot = (w, h, state) => {\r\n    const {\r\n      hilbertN,\r\n      hilbMand,\r\n    } = state;\r\n\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n    p5.strokeWeight(strokeWeight);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    const s = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n\r\n    hilbMand.forEach((coordWithVal, d) => {\r\n      setFillColorForMandelbrotVal(coordWithVal);\r\n\r\n      p5.push();\r\n      {\r\n        p5.translate(p5.width / 4, 0);\r\n        drawHilbertCoord(w, h, coordWithVal, hilbertN);\r\n      }\r\n      p5.pop();\r\n\r\n      p5.push(); // TODO: is it more expensive to push/pop 1000 times or iterate over hilbMand twice?\r\n      {\r\n        p5.translate((p5.width / 4) * 3, 0);\r\n        drawLinearizedMandelbrotCoord(p5.width / 4, s, d);\r\n      }\r\n      p5.pop();\r\n    })\r\n  };\r\n\r\n  const getSideLengthForLinearizedMap = (dMax, w, h) => {\r\n    const maxA = w * h;\r\n    const largestPossibleSide = Math.sqrt(maxA / dMax);\r\n\r\n    let s = 0;\r\n    for (let i = 1; i < w; i++) {\r\n      s = w / i;\r\n      if (s > largestPossibleSide) {\r\n        continue;\r\n      }\r\n\r\n      const sqPerRow = w / s;\r\n      const rows = dMax / sqPerRow;\r\n      const leftover = dMax % sqPerRow;\r\n\r\n      if (rows * s + (leftover > 0 ? s : 0) <= h) {\r\n        break;\r\n      }\r\n    }\r\n    return s;\r\n  }\r\n\r\n  const drawLinearizedMandelbrotCoord = (w, s, d) => {\r\n    const valsPerRow = w / s;\r\n\r\n    let x = d % valsPerRow;\r\n    const y = Math.floor(d / valsPerRow);\r\n\r\n    // snake around instead of starting from the left for each row\r\n    if (y % 2 === 1) {\r\n      x = valsPerRow - (x + 1);\r\n    }\r\n\r\n    p5.rect(x * s, y * s, s, s);\r\n  }\r\n\r\n  const genAndDrawHilbertMandelbrot = () => {\r\n    p5.background(32);\r\n\r\n    // fade out. this can probably move to partials _.each\r\n    oscs.forEach(({gain}) => {\r\n      gain.gain.cancelScheduledValues(audioCtx.currentTime);\r\n      gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);\r\n    })\r\n\r\n    if (oscs.length !== partialsCountMax) {\r\n      setupOscillators(); // TODO: fade out first\r\n    }\r\n\r\n    const {\r\n      fundamentalFreq,\r\n      partialsCountMax,\r\n    } = p5.state;\r\n\r\n    const hilbMand = genHilbertMandelbrot();\r\n\r\n    const partials = _(hilbMand)\r\n      .map(({p}) => p)\r\n      .filter(_.identity) // maxIters (black) are set as p: 0\r\n      .uniq()\r\n      .sort()\r\n      .take(partialsCountMax)\r\n      .map((partial, i) => [partial, {amp: 0, oscIdx: i}])\r\n      .fromPairs()\r\n      .value();\r\n\r\n    // slide to new freqs if partials change\r\n    _.each(partials, ({decayTimerId, oscIdx, zeroGainTimerId}, partial) => {\r\n      clearTimeout(decayTimerId);\r\n      clearTimeout(zeroGainTimerId);\r\n      oscs[oscIdx].osc.frequency.cancelScheduledValues(audioCtx.currentTime);\r\n      oscs[oscIdx].osc.frequency.linearRampToValueAtTime(partial * fundamentalFreq, audioCtx.currentTime + 0.5);\r\n    });\r\n\r\n    p5.setState(prevState => {\r\n      const nextState = {\r\n        ...prevState,\r\n        hilbMand,\r\n        isRegenNeeded: false,\r\n        partials,\r\n      };\r\n      drawHilbertMandelbrot( p5.width / 2, p5.height, nextState);\r\n      return nextState;\r\n    });\r\n  }\r\n\r\n\r\n  const cursorErasePrev = (maxD, s, prevD) => {\r\n    const {hilbMand} = p5.state;\r\n    const prevCoordAndVal = hilbMand[prevD % maxD];\r\n\r\n    setFillColorForMandelbrotVal(prevCoordAndVal);\r\n    p5.stroke(STROKE_COLOR);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, prevCoordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, s, prevD);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  let prevD = 0;\r\n  const cursorDraw = (id) => {\r\n    const {hilbMand} = p5.state;\r\n    const d = p5.state.tick % hilbMand.length;\r\n    const coordAndVal = hilbMand[d];\r\n    const sideLength = getSideLengthForLinearizedMap(hilbMand.length, p5.width / 4, p5.height);\r\n    const strokeWeight = getStrokeWeight(p5.width / 2);\r\n\r\n    p5.strokeWeight(strokeWeight);\r\n    cursorErasePrev(hilbMand.length, sideLength, prevD);\r\n    prevD = d; // maybe multiple ticks per frame when external time sync\r\n    p5.stroke((CURSOR_STROKE_COLOR_SEPARATION * id) % 255, 0, 255);\r\n    setFillColorForMandelbrotVal(coordAndVal, true);\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate(p5.width / 4, 0);\r\n      drawHilbertCoord(p5.width / 2, p5.height, coordAndVal, p5.state.hilbertN);\r\n    }\r\n    p5.pop();\r\n\r\n    p5.push();\r\n    {\r\n      p5.translate((p5.width / 4) * 3, 0);\r\n      drawLinearizedMandelbrotCoord(p5.width / 4, sideLength, d);\r\n    }\r\n    p5.pop();\r\n  }\r\n\r\n  const cursorExcite = (id) => {\r\n    const {\r\n      decayDuration,\r\n      exciteEnergy,\r\n      exciteDuration,\r\n      hilbMand,\r\n      partials,\r\n      tick,\r\n    } = p5.state;\r\n\r\n    const d = tick % hilbMand.length;\r\n    const {p} = hilbMand[d];\r\n\r\n    if (p > 0) {\r\n      const partial = partials[p];\r\n      const {\r\n        amp,\r\n        decayTimerId,\r\n        oscIdx,\r\n        zeroGainTimerId,\r\n      } = partial;\r\n      const {gain} = oscs[oscIdx];\r\n\r\n      const isExcited = _.isNumber(decayTimerId);\r\n      const currGain = isExcited ? amp : gain.gain.value;\r\n\r\n      // console.log(p, currGain);\r\n\r\n      const targetGain = 0.8 * Math.min(1, currGain + exciteEnergy * (1 - currGain));\r\n      partial.amp = targetGain;\r\n\r\n      clearTimeout(decayTimerId); // further delay the decay\r\n      clearTimeout(zeroGainTimerId); // don't reset amp to zero\r\n      gain.gain.cancelScheduledValues(0);\r\n      gain.gain.linearRampToValueAtTime(targetGain, audioCtx.currentTime + exciteDuration / 1000);\r\n\r\n      partial.decayTimerId = setTimeout(() => {\r\n        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + decayDuration / 1000);\r\n        partial.decayTimerId = null;\r\n\r\n        partial.zeroGainTimerId = setTimeout(() => {\r\n          partial.amp = 0;\r\n        }, decayDuration)\r\n      }, exciteDuration);\r\n    }\r\n  }\r\n\r\n  const partialsDraw = () => {\r\n    const h = p5.height;\r\n    const w = p5.width / 4;\r\n\r\n    p5.noStroke();\r\n\r\n    const { partials, partialsCountMax } = p5.state;\r\n\r\n    _.each(partials, ({ amp: targetAmp, oscIdx }, p) => {\r\n      const barH = h / partialsCountMax;\r\n      const y = h * ((p - 1) / partialsCountMax);\r\n      const barW = oscs[oscIdx].gain.gain.value * w;\r\n\r\n      const c = getColorForMandelbrotVal({ m: 1, p})\r\n      p5.fill(p5.color(p5.hue(c), 255, 8));\r\n      p5.rect(0, y, w, barH);\r\n\r\n      p5.fill(c);\r\n      p5.rect(0, y, barW, barH);\r\n      p5.fill(255);\r\n      p5.rect(targetAmp * w, y, 1, barH);\r\n    })\r\n\r\n  }\r\n\r\n  let wasPaused = true;\r\n  const pauseScreenDraw = () => {\r\n    if (!p5.state.isPlaying && !p5.state.isControlPanelOpen) {\r\n      wasPaused = true;\r\n      p5.background(0, 0.1);\r\n      p5.noFill();\r\n      p5.stroke(192, 127, 90);\r\n      p5.textSize(10);\r\n      p5.text('arrow keys to move', 0, p5.height / 2 - 50, p5.width, p5.height);\r\n      p5.text('shift+arrow for zoom/resolution', 0, p5.height / 2 - 35, p5.width, p5.height);\r\n      p5.text('shift+spacebar toggle controls', 0, p5.height / 2 - 20, p5.width, p5.height);\r\n      p5.textSize(20);\r\n      p5.textAlign(p5.CENTER);\r\n      p5.text('spacebar to start', 0, p5.height / 2, p5.width, p5.height);\r\n    } else {\r\n      if (wasPaused) {\r\n        partialsDraw();\r\n        drawHilbertMandelbrot(p5.width / 2, p5.height, p5.state);\r\n        wasPaused = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  let font;\r\n  p5.preload = () => {\r\n    font = p5.loadFont('JetBrainsMono-Regular.ttf');\r\n  }\r\n\r\n  p5.setup = () => {\r\n    p5.createCanvas(p5._width, p5._height);\r\n    p5.colorMode(p5.HSB);\r\n    p5.textFont(font);\r\n  }\r\n\r\n  p5.incrementTick = (isExternal = false) => {\r\n    const now = p5.millis();\r\n    const {\r\n      isPlaying,\r\n      isRegenNeeded,\r\n      midiClocksPerTick,\r\n      tickDuration,\r\n      tickLastMillis,\r\n    } = p5.state;\r\n\r\n    if (isExternal) {\r\n      p5.state.midiClock++;\r\n    }\r\n\r\n    const isReady = isPlaying && !isRegenNeeded && (isExternal\r\n      ? p5.state.midiClock % midiClocksPerTick === 0\r\n      : now > tickLastMillis + tickDuration);\r\n\r\n    if (isReady) {\r\n      p5.state.tick++;\r\n      p5.state.tickLastMillis = now;\r\n      cursorExcite(0);\r\n    }\r\n  }\r\n\r\n  let prevTick = 0;\r\n  p5.draw = () => {\r\n    const {\r\n      isPlaying,\r\n      isRegenNeeded,\r\n      midiClock,\r\n    } = p5.state;\r\n\r\n    if (isRegenNeeded) {\r\n      genAndDrawHilbertMandelbrot();\r\n    }\r\n\r\n    if (midiClock === 0) p5.incrementTick();\r\n\r\n    if (_.every([\r\n      !isRegenNeeded,\r\n      p5.state.tick !== prevTick,\r\n    ])) {\r\n      cursorDraw(0);\r\n      prevTick = p5.state.tick;\r\n    }\r\n\r\n    if (isPlaying) partialsDraw();\r\n\r\n    pauseScreenDraw();\r\n  }\r\n\r\n  /**\r\n   * This needs to be called by a user event handler.\r\n   * @param isPlaying\r\n   */\r\n  p5.toggleAudio = () => {\r\n    p5.setState(prevState => {\r\n      const { isPlaying } = prevState;\r\n      if (!isPlaying && audioCtx.state !== 'running') {\r\n        audioCtx.resume();\r\n      }\r\n\r\n      if (isPlaying && audioCtx.state === 'running') {\r\n        audioCtx.suspend();\r\n      }\r\n\r\n      return { ...prevState, isPlaying: !prevState.isPlaying };\r\n    });\r\n\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport P5 from 'p5';\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport TuneIcon from '@material-ui/icons/Tune';\r\nimport useMidi from \"./useMidi\";\r\nimport { initialState, sketch } from \"./mandelbrotP5\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport {Button, ButtonGroup, Drawer} from '@material-ui/core';\r\n\r\nimport KeyboardArrowUpOutlinedIcon from '@material-ui/icons/KeyboardArrowUpOutlined';\r\nimport KeyboardArrowDownOutlinedIcon from '@material-ui/icons/KeyboardArrowDownOutlined';\r\nimport KeyboardArrowLeftOutlinedIcon from '@material-ui/icons/KeyboardArrowLeftOutlined';\r\nimport KeyboardArrowRightOutlinedIcon from '@material-ui/icons/KeyboardArrowRightOutlined';\r\nimport PlayCircleOutlineIcon from '@material-ui/icons/PlayCircleOutline';\r\nimport PauseCircleOutlineIcon from '@material-ui/icons/PauseCircleOutline';\r\nimport ViewComfyOutlinedIcon from '@material-ui/icons/ViewComfyOutlined';\r\nimport ViewModuleOutlinedIcon from '@material-ui/icons/ViewModuleOutlined';\r\nimport ZoomInOutlinedIcon from '@material-ui/icons/ZoomInOutlined';\r\nimport ZoomOutOutlinedIcon from '@material-ui/icons/ZoomOutOutlined';\r\n\r\nconst useStyles = makeStyles({\r\n  paper: {\r\n    background: \"rgba(0,0,0,0.7)\",\r\n    paddingBottom: 65,\r\n  }\r\n});\r\n\r\nconst useP5 = (sketch) => {\r\n  const [sketchState, setSketchState] = useState(initialState);\r\n  const [sketchInstance, setSketchInstance] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  if (sketchInstance) {\r\n    sketchInstance.setState = setSketchState;\r\n    sketchInstance.state = sketchState;\r\n  }\r\n\r\n  const ref = useCallback((el) => {\r\n    if (el) {\r\n      const instance = new P5(sketch, el);\r\n      setSketchInstance(instance);\r\n\r\n      instance._height = el.clientHeight;\r\n      instance._width = el.clientWidth;\r\n\r\n      const resize = (width, height) => {\r\n        instance.resizeCanvas(width, height);\r\n        setSketchState((prevState) => ({...prevState, isRegenNeeded: true}))\r\n      }\r\n\r\n      const resizeObserver = new ResizeObserver(([{contentRect: {height, width}}]) => {\r\n        resize(width, height);\r\n      });\r\n\r\n      setResizeObserver(resizeObserver);\r\n      resizeObserver.observe(el);\r\n    } else {\r\n      if (resizeObserver) resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n    ref,\r\n  };\r\n}\r\n\r\nconst getHandleAction = (sketchInstance) => (action) => () => {\r\n  if (action === 'toggleAudio') {\r\n    sketchInstance.toggleAudio();\r\n    return;\r\n  }\r\n\r\n  sketchInstance.setState(prevState => {\r\n    const {\r\n      hilbertN,\r\n      isControlPanelOpen,\r\n      isRegenNeeded,\r\n      panX,\r\n      panY,\r\n      zoom,\r\n    } = prevState;\r\n    const panDelta = 0.1 / zoom;\r\n\r\n    const nextState = {\r\n      moveLeft: {panX: panX + panDelta},\r\n      moveRight: {panX: panX - panDelta},\r\n      moveUp: {panY: panY + panDelta},\r\n      moveDown: {panY: panY - panDelta},\r\n      resDec: {hilbertN: Math.pow(2, Math.log2(hilbertN) - 1)},\r\n      resInc: {hilbertN: Math.min(256, Math.pow(2, Math.log2(hilbertN) + 1))},\r\n      toggleControlPanel: {isControlPanelOpen: !isControlPanelOpen, isRegenNeeded},\r\n      zoomIn: {zoom: zoom * (10 / 9)},\r\n      zoomOut: {zoom: zoom * (9 / 10)},\r\n    }[action];\r\n\r\n    return {\r\n      ...prevState,\r\n      isRegenNeeded: !_.isEmpty(nextState),\r\n      ...nextState,\r\n    };\r\n  })\r\n};\r\n\r\nconst handleKeyDown = (handleAction) => (evt) => {\r\n  // console.log(evt);\r\n  const {code, shiftKey, key} = evt;\r\n\r\n  if (code === 'Space') {\r\n    handleAction(shiftKey ? 'toggleControlPanel' : 'toggleAudio')();\r\n    return;\r\n  }\r\n\r\n  const getAction = {\r\n    'ArrowDown': () => shiftKey ? 'zoomOut' : 'moveDown',\r\n    'ArrowLeft': () => shiftKey ? 'resDec' : 'moveLeft',\r\n    'ArrowRight': () => shiftKey ? 'resInc' : 'moveRight',\r\n    'ArrowUp': () => shiftKey ? 'zoomIn' : 'moveUp',\r\n  }[key];\r\n\r\n  if (getAction) handleAction(getAction())();\r\n};\r\n\r\nconst Mandelbrot = () => {\r\n  const {\r\n    ref,\r\n    sketchInstance,\r\n    sketchState,\r\n    setSketchState,\r\n  } = useP5(sketch);\r\n\r\n  window.sketchInstance = sketchInstance;\r\n\r\n  const handleAction = getHandleAction(sketchInstance);\r\n\r\n  useEffect(() => {\r\n    document.title = 'Mandelbrot Muse';\r\n    if (sketchInstance) {\r\n      const handler = handleKeyDown(handleAction);\r\n      window.addEventListener('keydown', handler)\r\n      return () => { // cleanup\r\n        window.removeEventListener('keydown', handler);\r\n      };\r\n    }\r\n  }, [sketchInstance]);\r\n\r\n  const [{midiClockInDevice}, actions] = useMidi( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({midiClockInDevice}) => ({midiClockInDevice}),\r\n    actions => actions,\r\n  );\r\n\r\n  useEffect(() => {\r\n    const handleMidiClock = (evt) => {\r\n      if (sketchInstance) {\r\n        sketchInstance.incrementTick(true);\r\n      }\r\n    };\r\n\r\n    if (midiClockInDevice) {\r\n      midiClockInDevice.addListener('clock', 'all', handleMidiClock);\r\n    }\r\n\r\n    return () => {\r\n      if (midiClockInDevice) {\r\n        midiClockInDevice.removeListener('clock', 'all', handleMidiClock);\r\n      }\r\n    }\r\n  }, [midiClockInDevice]);\r\n\r\n  return (<>\r\n    <div\r\n      ref={ref}\r\n      style={{\r\n        alignSelf: 'start',\r\n        background: 'radial-gradient(circle, rgba(74,153,117,1) 0%, rgba(188,148,233,0.6943726953672094) 100%)',\r\n        height: '50vw',\r\n        width: '100vw',\r\n      }}\r\n    />\r\n\r\n    <div style={{\r\n      bottom: 0,\r\n      padding: 0,\r\n      position: 'absolute',\r\n      textAlign: 'center',\r\n      zIndex: 1000000,\r\n    }}>\r\n      {!sketchState.isControlPanelOpen && (\r\n        <Button onClick={handleAction('toggleControlPanel')}>\r\n          show\r\n          <TuneIcon/>\r\n          controls\r\n        </Button>\r\n      )}\r\n\r\n      <Drawer\r\n        anchor=\"top\"\r\n        classes={useStyles()}\r\n        color=\"transparent\"\r\n        open={sketchState.isControlPanelOpen}\r\n        onClose={handleAction('toggleControlPanel')}\r\n        variant=\"persistent\"\r\n\r\n        // onMouseEnter={ev => { ev.currentTarget.style.opacity = 1 }}\r\n        // onMouseLeave={ev => { ev.currentTarget.style.opacity = 0.5 }}\r\n      >\r\n\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n          <Button onClick={handleAction('toggleAudio')}>\r\n            {!sketchState.isPlaying ? <PlayCircleOutlineIcon /> : <PauseCircleOutlineIcon />}\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('toggleControlPanel')}>\r\n            hide controls\r\n          </Button>\r\n        </ButtonGroup>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n          <Button onClick={handleAction('moveUp')}>\r\n            <KeyboardArrowUpOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveLeft')}>\r\n            <KeyboardArrowLeftOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('moveRight')}>\r\n            <KeyboardArrowRightOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('zoomIn')}>\r\n            <ZoomInOutlinedIcon/>\r\n          </Button>\r\n\r\n        </ButtonGroup>\r\n\r\n        <ButtonGroup fullWidth size=\"large\">\r\n          <Button onClick={handleAction('moveDown')}>\r\n            <KeyboardArrowDownOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('resDec')}>\r\n            <ViewModuleOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('resInc')}>\r\n            <ViewComfyOutlinedIcon/>\r\n          </Button>\r\n\r\n          <Button onClick={handleAction('zoomOut')}>\r\n            <ZoomOutOutlinedIcon/>\r\n          </Button>\r\n\r\n        </ButtonGroup>\r\n\r\n        {midiClockInDevice ? (\r\n          <Slider\r\n            min={1}\r\n            max={1024}\r\n            stateKey={\"midiClocksPerTick\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n        ) : (\r\n          <Slider\r\n            min={16}\r\n            max={1000}\r\n            stateKey={\"tickDuration\"}\r\n            sketchState={sketchState}\r\n            setSketchState={setSketchState}\r\n          />\r\n        )}\r\n\r\n        <Slider\r\n          min={1}\r\n          max={4000}\r\n          stateKey={\"exciteDuration\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n        <Slider\r\n          min={10}\r\n          max={8000}\r\n          stateKey={\"decayDuration\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n\r\n        <Slider\r\n          min={0.01}\r\n          max={1}\r\n          step={0.01}\r\n          stateKey={\"exciteEnergy\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n        <Slider\r\n          min={0.1}\r\n          max={500}\r\n          onPointerUp={() => {\r\n            console.log('onPointerUp');\r\n            sketchState.isRegenNeeded = true // TODO: isFreqChanged instead of full regen\r\n          }}\r\n          step={0.1}\r\n          stateKey={\"fundamentalFreq\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n        />\r\n        <Slider\r\n          min={1}\r\n          max={1000}\r\n          stateKey={\"partialsCountMax\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n          // onInput={() => {\r\n          //   console.log('onInput');\r\n          //   sketchState.isRegenNeeded = true\r\n          // // console.log('sketchState.isRegenNeeded:', sketchState.isRegenNeeded)\r\n          // }}\r\n          onPointerUp={() => {\r\n            console.log('onPointerUp');\r\n            sketchState.isRegenNeeded = true\r\n            // console.log('sketchState.isRegenNeeded:', sketchState.isRegenNeeded)\r\n          }}\r\n        />\r\n        <Slider\r\n          min={64}\r\n          max={8000}\r\n          stateKey={\"maxIters\"}\r\n          sketchState={sketchState}\r\n          setSketchState={setSketchState}\r\n          onPointerUp={() => {\r\n            console.log('onPointerUp');\r\n            sketchState.isRegenNeeded = true\r\n          }}\r\n        />\r\n      </Drawer>\r\n\r\n\r\n    </div>\r\n   </>);\r\n};\r\n\r\nconst Slider = ({ sketchState, setSketchState, stateKey, ...props }) => (\r\n    <div>\r\n      {stateKey}: {sketchState[stateKey]}\r\n      <br />\r\n      <input\r\n        type=\"range\"\r\n        style={{width: 400}}\r\n        value={sketchState[stateKey]}\r\n        onChange={ev => {\r\n          const value = Number(ev.target.value);\r\n          setSketchState(state => ({\r\n            ...state,\r\n            [stateKey]: value\r\n          }))\r\n        }}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n\r\nexport default Mandelbrot;\r\n","import Menu from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport React, {useEffect} from 'react';\r\nimport useMidi from './useMidi';\r\nimport WebMidi from 'webmidi';\r\nimport {IconButton, Toolbar} from \"@material-ui/core\";\r\nimport {WatchLater as MidiClockIcon} from '@material-ui/icons';\r\n\r\nconst Midi = () => {\r\n\r\n  const [state, actions] = useMidi( // https://github.com/andregardi/use-global-hook#avoid-unnecessary-renders\r\n    ({\r\n      inputDevices,\r\n      isMidiClockInSelectorOpen,\r\n      isMidiInSelectorOpen,\r\n    }) => ({inputDevices, isMidiClockInSelectorOpen, isMidiInSelectorOpen}),\r\n    actions => actions,\r\n  );\r\n\r\n  const {\r\n    inputDevices,\r\n    isMidiClockInSelectorOpen,\r\n    isMidiInSelectorOpen,\r\n  } = state;\r\n\r\n  useEffect(() => {\r\n    WebMidi.enable((err) => {\r\n      if (err) console.error(err);\r\n      else {\r\n        console.log('WebMidi enabled.');\r\n        actions.setInputDevices(WebMidi.inputs);\r\n      }\r\n    }, true);\r\n  }, []);\r\n\r\n\r\n  const handleMidi = (evt) => {\r\n    const {note: {number: n}, rawVelocity: vel, type} = evt;\r\n\r\n    console.log(evt)\r\n    // actions.setMidiEvent({\r\n    //   [n]: type === 'noteon' ? vel : 0\r\n    // });\r\n  }\r\n\r\n  const handleMidiClock = (evt) => {\r\n\r\n    // console.log(evt)\r\n    // actions.setMidiEvent({\r\n    //   [n]: type === 'noteon' ? vel : 0\r\n    // });\r\n  }\r\n\r\n\r\n  const [midiMenuAnchorEl, setMidiMenuAnchorEl] = React.useState(null);\r\n\r\n  const handleMidiMenuButtonClick = (isBeatClock = false) => ({ currentTarget }) => {\r\n    setMidiMenuAnchorEl(currentTarget);\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n  }\r\n\r\n  const handleMidiMenuClose = (isBeatClock = false) => () => {\r\n    console.log('close', isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector')\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n    setMidiMenuAnchorEl(null);\r\n  }\r\n\r\n  const handleMidiInputSelect = (deviceIdx, isBeatClock = false) => ({ currentTarget }) => { // todo: remove prev listener\r\n    setMidiMenuAnchorEl(currentTarget);\r\n\r\n    const midiInDevice = inputDevices[deviceIdx];\r\n    actions[isBeatClock ? 'toggleMidiClockInSelector' : 'toggleMidiInSelector']();\r\n    if (isBeatClock) {\r\n      midiInDevice.addListener('clock', 'all', handleMidiClock);\r\n      actions.setMidiClockInDevice(midiInDevice);\r\n    } else {\r\n      actions.setMidiInDevice(midiInDevice);\r\n      midiInDevice.addListener('noteon', 'all', handleMidi);\r\n      midiInDevice.addListener('noteoff', 'all', handleMidi);\r\n    }\r\n\r\n  };\r\n\r\n  return ( // TODO: only show if MIDI devices present; use looser permission to query\r\n    <>\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        aria-label=\"open drawer\"\r\n        onClick={handleMidiMenuButtonClick(false)}\r\n      >\r\n        <img src=\"noun_MIDI_385872.svg\" style={{ width: '1.5em', height: '1.5em'}} />\r\n      </IconButton>\r\n\r\n      <IconButton\r\n        edge=\"start\"\r\n        color=\"inherit\"\r\n        aria-label=\"open drawer\"\r\n        onClick={handleMidiMenuButtonClick(true)}\r\n      >\r\n        <MidiClockIcon/>\r\n      </IconButton>\r\n\r\n      <Menu\r\n        id=\"simple-menu\"\r\n        anchorEl={midiMenuAnchorEl}\r\n        open={isMidiInSelectorOpen || isMidiClockInSelectorOpen}\r\n        onClose={handleMidiMenuClose(isMidiClockInSelectorOpen)}\r\n      >\r\n        {inputDevices.map(({name}, idx) => (\r\n          <MenuItem\r\n            key={name}\r\n            onClick={handleMidiInputSelect(idx, isMidiClockInSelectorOpen)}>\r\n            {name}\r\n          </MenuItem>\r\n        ))}\r\n      </Menu>\r\n    </>\r\n\r\n  );\r\n};\r\n\r\nexport default Midi;\r\n","import _ from 'lodash';\r\nimport Vex from 'vexflow';\r\nimport React, {useCallback, useState} from 'react';\r\n\r\nconst VF = Vex.Flow;\r\n\r\nconst useVexFlow = () => {\r\n  const [context, setContext] = useState(null);\r\n  const [resizeObserver, setResizeObserver] = useState(null);\r\n\r\n  const ref = useCallback((el) => {\r\n    if (el) {\r\n      const renderer = new VF.Renderer(el, VF.Renderer.Backends.SVG);\r\n      renderer.resize(el.clientWidth, el.clientHeight);\r\n      setContext(renderer.getContext());\r\n\r\n      const resizeObserver = new ResizeObserver(([{ contentRect: { height, width } }]) => {\r\n        renderer.resize(width, height);\r\n      });\r\n      setResizeObserver(resizeObserver);\r\n      resizeObserver.observe(el);\r\n    } else {\r\n      resizeObserver.disconnect();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    context,\r\n    ref,\r\n  };\r\n}\r\n\r\nconst Staff = () => {\r\n  const {\r\n    context,\r\n    ref,\r\n  } = useVexFlow();\r\n\r\n  if (context) {\r\n    context.setStrokeStyle('white');\r\n    context.setFillStyle('white');\r\n\r\n    const treble = new VF.Stave(50, 0, 10000)\r\n      .addClef('treble')\r\n      .addKeySignature('Db')\r\n      .addTimeSignature('4/4')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    window.VF= VF;\r\n    window.context = context\r\n    window.treble = treble\r\n\r\n    const bass = new VF.Stave(50, 60, 10000)\r\n      .addClef('bass')\r\n      .addTimeSignature('4/4')\r\n      .addKeySignature('Db')\r\n      .setContext(context)\r\n      .draw();\r\n\r\n    const brace = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.BRACE)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n\r\n    const leftLine = new VF.StaveConnector(treble, bass)\r\n      .setType(VF.StaveConnector.type.SINGLE_LEFT)\r\n      .setContext(context)\r\n      .draw();\r\n\r\n  }\r\n\r\n\r\n  return (\r\n    <div style={{\r\n      display: 'block',\r\n      width: '100%',\r\n    }}>\r\n      <div\r\n        ref={ref}\r\n        style={{\r\n          // background: 'darkcyan',\r\n          fill: 'white',\r\n          height: 500,\r\n          stroke: 'white',\r\n        }}/>\r\n    </div>\r\n  )\r\n};\r\n\r\nexport default Staff;\r\n","import _ from 'lodash';\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst Tonnetz = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    {_.range(30)\r\n      .map(y => (\r\n        <>\r\n          {_.range(50).map(x => {\r\n            const n = ((y % 2 > 0\r\n              ? ((y - 1) / 2) * 11 + 3\r\n              : (y / 2) * 11) + x * 7) % 12;\r\n\r\n            return (\r\n              <PC key={x} n={n} isOdd={y % 2 === 1}/>\r\n            )\r\n          })}\r\n          <br/>\r\n        </>\r\n      ))}\r\n  </div>\r\n);\r\n\r\nexport default Tonnetz;\r\n","import _ from 'lodash';\r\nimport FretMarkers from \"./fretMarkers\";\r\nimport PC from './pc';\r\nimport React from 'react';\r\n\r\nconst frets = [0,5,7,10,12];\r\n\r\nconst Ukulele = () => (\r\n  <div style={{\r\n    display: 'block',\r\n    flexShrink: 0,\r\n  }}>\r\n    <FretMarkers frets={frets}/>\r\n    <br/>\r\n    {[9, 4, 0, 7].map(pc0 => (\r\n      <>\r\n        {_.range(19)\r\n          .map(i => (i + pc0) % 12)\r\n          .map((pc, ix) => (\r\n            <PC key={ix} n={pc}/>\r\n          ))}\r\n        <br/>\r\n      </>\r\n    ))}\r\n    <FretMarkers frets={frets}/>\r\n  </div>\r\n);\r\n\r\nexport default Ukulele;\r\n","import {Entity} from \"aframe-react\";\r\nimport React from \"react\";\r\n\r\nconst Camera = () => (\r\n  <Entity\r\n    primitive=\"a-camera\"\r\n    id=\"camera\"\r\n    position={{ x: 0, y: 0, z: 0 }}\r\n    look-controls\r\n    // touch-look-controls={{\r\n    //   enabled: true,\r\n    // }}\r\n  >\r\n    <Entity\r\n      primitive=\"a-cursor\"\r\n      animation__click={{\r\n        property: 'scale',\r\n        startEvents: 'click',\r\n        from: '0.1 0.1 0.1',\r\n        to: '1 1 1',\r\n        dur: 150,\r\n      }}/>\r\n  </Entity>\r\n);\r\n\r\nexport default Camera;\r\n","export function HSVtoHex(h, s, v) {\r\n  function rgbToHex({ r, g, b }) {\r\n    function componentToHex(c) {\r\n      var hex = c.toString(16);\r\n      return hex.length == 1 ? \"0\" + hex : hex;\r\n    }\r\n\r\n    return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\r\n  }\r\n\r\n  var r, g, b, i, f, p, q, t;\r\n  if (arguments.length === 1) {\r\n    s = h.s;\r\n    v = h.v;\r\n    h = h.h;\r\n  }\r\n  i = Math.floor(h * 6);\r\n  f = h * 6 - i;\r\n  p = v * (1 - s);\r\n  q = v * (1 - f * s);\r\n  t = v * (1 - (1 - f) * s);\r\n  switch (i % 6) {\r\n    case 0: {\r\n      r = v;\r\n      g = t;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 1: {\r\n      r = q;\r\n      g = v;\r\n      b = p;\r\n      break;\r\n    }\r\n    case 2: {\r\n      r = p;\r\n      g = v;\r\n      b = t;\r\n      break;\r\n    }\r\n    case 3: {\r\n      r = p;\r\n      g = q;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 4: {\r\n      r = t;\r\n      g = p;\r\n      b = v;\r\n      break;\r\n    }\r\n    case 5: {\r\n      r = v;\r\n      g = p;\r\n      b = q;\r\n      break;\r\n    }\r\n  }\r\n  return rgbToHex({\r\n    r: Math.round(r * 255),\r\n    g: Math.round(g * 255),\r\n    b: Math.round(b * 255)\r\n  });\r\n}","import _ from 'lodash';\r\nimport React from 'react';\r\nimport {Entity} from 'aframe-react';\r\nimport {HSVtoHex} from './color';\r\nimport {toSymbol} from \"./util\";\r\n\r\nconst handleOsc = n => (el) => {\r\n  if (el) {\r\n    const { components: { osc } } = el;\r\n    osc.onOsc = ({ instrument, note, vel }) => {\r\n      if (note === n) {\r\n        osc.vel = vel;\r\n      }\r\n    }\r\n\r\n    osc.onTick = (time, timeDelta) => {\r\n      if (osc.vel === 0) {\r\n\r\n      }\r\n\r\n      if (_.has(osc, 'vel')) {\r\n        el.setAttribute('material', 'opacity', 0.05 + 0.75 * osc.vel / 128);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport default ({\r\n                  n,\r\n                  position = {x: 0, y: 0, z: 0},\r\n                  scale = {x: 1, y: 1, z: 1}\r\n                }) =>\r\n  <Entity\r\n    animation={{\r\n      dur: 500,\r\n      property: 'position',\r\n      to: position,\r\n    }}\r\n    // events={{\r\n    //   osc: handleOsc(n),\r\n    // }}\r\n    primitive='a-sphere'\r\n    material={{\r\n      blending: 'additive',\r\n      color: HSVtoHex(n / 12, 0.75, 1),\r\n      opacity: 0.05,\r\n    }}\r\n    osc={{\r\n\r\n    }}\r\n    _ref={handleOsc(n)}\r\n    // position={position}\r\n    radius={0.1}\r\n    scale={scale}\r\n  >\r\n    <Entity\r\n      look-at=\"#camera\"\r\n      position={{x: 0, y: 0, z: 0}}\r\n      scale={{x: 2, y: 2, z: 2}}\r\n      text={{\r\n        align: 'center',\r\n        color: HSVtoHex(n / 12, 0.75, 0.5),\r\n        font: `../${n % 12 > 9 ? 'segoeui' : 'JetBrainsMono-Medium'}-msdf.json`,\r\n        negate: false,\r\n        transparent: true,\r\n        value: toSymbol(n),\r\n      }}\r\n    />\r\n  </Entity>\r\n","import _ from 'lodash';\r\nimport PitchClass from './pitchClass';\r\nimport React, {useEffect, useState} from 'react';\r\nimport useMidi from \"./useMidi\";\r\nimport {Entity} from 'aframe-react';\r\n\r\nconst ColtraneCircle = () => {\r\n  const [is180, setIs180] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const toggle = ({key}) => {\r\n      if (key === 'r') setIs180(is180 => !is180);\r\n    };\r\n\r\n    window.addEventListener('keyup', toggle);\r\n    return () => window.removeEventListener('keyup', toggle);\r\n  }, []);\r\n\r\n  const [{midiIn}] = useMidi();\r\n\r\n  const midiInPitchClasses = _(12)\r\n    .range()\r\n    .map(n => _(midiIn)\r\n      .pickBy((v, i) => i % 12 === n)\r\n      .values()\r\n      .sum())\r\n    .value();\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      animation={`property: rotation; to: 0 ${is180 ? 180 : 0} 0; dur: 500;`}\r\n      position={`0 0 -3`}\r\n    >\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 == 0)\r\n        .map(n => ({\r\n          n,\r\n          r: 1.5,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([6, 7, 0, 1], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          n: ((i + 1) * 2 + Math.floor(i / 4) * 2) % 12,\r\n          // n: (n * 2) % 12,\r\n          r: 1.5,\r\n          x: Math.sin((n + 0.5) * Math.PI / 24),\r\n          y: Math.cos((n + 0.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(12)\r\n        .range()\r\n        .filter(n => n % 2 != 0)\r\n        .map(n => ({\r\n          n: (n + 6) % 12,\r\n          r: 1.2,\r\n          x: -Math.sin(n * Math.PI / 6),\r\n          y: Math.cos(n * Math.PI / 6),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n          />))\r\n        .value()\r\n      }\r\n\r\n      {_(48)\r\n        .range()\r\n        .filter(n => !_.includes([4, 5, 6, 7], n % 8))\r\n        .map((n, i) => ({\r\n          i,\r\n          // n: i,\r\n          n: (i * 2 + 9 + Math.floor(i / 4) * 2) % 12,\r\n          // n: i,\r\n          r: 1.2,\r\n          x: Math.sin((n - 1.5) * Math.PI / 24),\r\n          y: Math.cos((n - 1.5) * Math.PI / 24),\r\n        }))\r\n        .map(({n, r, x, y}) => (\r\n          <PitchClass\r\n            midiIn={midiInPitchClasses[n]}\r\n            n={n}\r\n            position={`${r * x} ${r * y} 0`}\r\n            scale=\"0.5 0.5 0.5\"\r\n          />))\r\n        .value()\r\n      }\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default ColtraneCircle;\r\n","import {Entity} from 'aframe-react';\r\nimport React from 'react';\r\nimport {HSVtoHex} from './color';\r\n\r\n// http://dmccooey.com/polyhedra/PentakisDodecahedron.txt\r\nconst c1 = 1.33058699733550141141687582919;\r\nconst c2 = 2.15293498667750705708437914596;\r\n\r\n// in ordered, opposite pairs\r\nconst verts = [\r\n  [0.0,  -c2,   c1],\r\n  [0.0,   c2,  -c1],\r\n  [ c2,  -c1,  0.0],\r\n  [-c2,   c1,  0.0],\r\n  [0.0,  -c2,  -c1],\r\n  [0.0,   c2,   c1],\r\n  [-c2,  -c1,  0.0],\r\n  [ c2,   c1,  0.0],\r\n  [-c1,  0.0,   c2],\r\n  [ c1,  0.0,  -c2],\r\n  [ c1,  0.0,   c2],\r\n  [-c1,  0.0,  -c2],\r\n];\r\n\r\nconst Dod = ({ rep = 1, sat, stack = [], n = 0 }) =>\r\n  <Entity position=\"0 0 0\">\r\n    {verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        color={HSVtoHex(i * (1 / 12), sat || 1, 1)}\r\n        events={{ click: () => console.log(i) }}\r\n        primitive=\"a-sphere\"\r\n        position={v.join(' ')}\r\n        scale={[1, 1, 1].map(n => 0.3 * n/ (rep * rep)).join(' ')}\r\n      />)}\r\n\r\n    {rep < 3 && verts.map((v, i) =>\r\n      <Entity\r\n        key={i}\r\n        position={v.map(n => n * 2).join(' ')}\r\n        text={`color: ${HSVtoHex((stack.length ? stack[stack.length - 1] : i) * (1 / 12), 1, 1)}; align: center; value: ${[...stack, i].join(',')} - ${(n + i) % 12}; width: 5; zOffset: 0`}\r\n      >\r\n        <Dod rep={rep+1} sat={0.3} stack={[...stack, i]} n={(n + i) % 12} />\r\n      </Entity>)\r\n      // .filter((n, i) => i % 2)\r\n    }\r\n  </Entity>;\r\n\r\nexport default Dod;","// import * as Tone from 'tone'\r\nimport _ from 'lodash';\r\nimport PitchClass from './pitchClass';\r\nimport PitchDetector from 'pitchdetect';\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport useMidi from \"./useMidi\";\r\nimport {Entity} from 'aframe-react';\r\nimport {HSVtoHex} from \"./color\";\r\n\r\n// window.Tone = Tone;\r\n\r\nconst audioContext = new AudioContext();\r\n\r\n// FIXME HACK\r\nwindow.audioContext = audioContext;\r\n\r\n// ripped from Tone/core/Conversions\r\nconst ftomf = (frequency) => {\r\n  return 69 + 12 * Math.log2(frequency / 440);\r\n}\r\n\r\nconst PitchClassSpiral = ({\r\n                            depthMax = 1,\r\n                            isAlwaysCounterClockwise = false,\r\n                            rMax = 1,\r\n                            rMin = 0.5,\r\n                            noteRange = [24, 96],\r\n                          }) => {\r\n  const [is180, setIs180] = useState(true);\r\n\r\n  const noteToDimensions = n => {\r\n    const step = n / 128;\r\n    const r = rMax - rMax * step;\r\n\r\n    return {\r\n      n,\r\n      s: 0.75 - n / 192,\r\n      x: r * (is180 && isAlwaysCounterClockwise ? -1 : 1) * Math.sin(n * Math.PI / 6 + 0.01), // +0.01 to fix floating point error in animation library\r\n      y: r * Math.cos(n * Math.PI / 6 + 0.01),\r\n      z: is180 ? depthMax - depthMax * step : depthMax * step,\r\n    };\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyup = ({code, key}) => {\r\n      if (key === 'r') setIs180(is180 => !is180);\r\n      if (code === 'Space') audioContext.resume();\r\n    };\r\n\r\n    window.addEventListener('keyup', handleKeyup);\r\n    return () => window.removeEventListener('keyup', handleKeyup);\r\n  }, []);\r\n\r\n\r\n  const ref = useCallback((el) => {\r\n    let detector;\r\n\r\n    if (el) {\r\n      detector = new PitchDetector({\r\n        // Audio Context (Required)\r\n        context: audioContext,\r\n\r\n        // Input AudioNode (Required)\r\n        // input: audioBufferNode, // default: Microphone input\r\n\r\n        // Output AudioNode (Optional)\r\n        // output: AudioNode, // default: no output\r\n\r\n        // interpolate frequency (Optional)\r\n        //\r\n        // Auto-correlation is calculated for different (discrete) signal periods\r\n        // The true frequency is often in-beween two periods.\r\n        //\r\n        // We can interpolate (very hacky) by looking at neighbours of the best\r\n        // auto-correlation period and shifting the frequency a bit towards the\r\n        // highest neighbour.\r\n        interpolateFrequency: true, // default: true\r\n\r\n        // Callback on pitch detection (Optional)\r\n        onDetect: function(stats, pitchDetector) {\r\n          // const { frequency, detected, rms } = stats;\r\n          //\r\n          // // https://math.stackexchange.com/q/57429/398343\r\n          // // const opacity = 1 - Math.exp(-2 * rms);\r\n          // const opacity = rms / (0.1 + rms);\r\n          //\r\n          // const { s, x, y, z } = noteToDimensions(ftomf(frequency));\r\n          // el.setAttribute('material', 'opacity', opacity);\r\n          // el.object3D.position.set(x, y, z + 0.01);\r\n          // el.object3D.scale.set(s * 1.5, s * 1.5, s * 1.5);\r\n\r\n          // console.log(Tone.FrequencyClass.ftom(frequency), detected, rms);\r\n          // stats.frequency // 440\r\n          // stats.detected // --> true\r\n          // stats.worst_correlation // 0.03 - local minimum, not global minimum!\r\n          // stats.best_correlation // 0.98\r\n          // stats.worst_period // 80\r\n          // stats.best_period // 100\r\n          // stats.time // 2.2332 - audioContext.currentTime\r\n          // stats.rms // 0.02\r\n        },\r\n\r\n        // Debug Callback for visualisation (Optional)\r\n        onDebug: function(stats, pitchDetector) {\r\n          const { frequency, detected, rms } = stats;\r\n\r\n          // https://math.stackexchange.com/q/57429/398343\r\n          // const opacity = 1 - Math.exp(-2 * rms);\r\n          const opacity = rms / (0.1 + rms);\r\n\r\n          const { s, x, y, z } = noteToDimensions(ftomf(frequency));\r\n          el.setAttribute('material', 'opacity', opacity);\r\n          el.object3D.position.set(x, y, z + 0.01);\r\n          el.object3D.scale.set(s * 1.5, s * 1.5, s * 1.5);\r\n\r\n          if (!stats.detected) {\r\n            el.setAttribute('material', 'opacity', 0);\r\n          }\r\n        },\r\n\r\n        // Minimal signal strength (RMS, Optional)\r\n        // minRms: 0.1,\r\n\r\n        // Detect pitch only with minimal correlation of: (Optional)\r\n        minCorrelation: 0.9,\r\n\r\n        // Detect pitch only if correlation increases with at least: (Optional)\r\n        minCorreationIncrease: 0.5,\r\n\r\n        // Note: you cannot use minCorrelation and minCorreationIncrease\r\n        // at the same time!\r\n\r\n        // Signal Normalization (Optional)\r\n        normalize: \"rms\", // or \"peak\". default: undefined\r\n\r\n        // Only detect pitch once: (Optional)\r\n        stopAfterDetection: false,\r\n\r\n        // Buffer length (Optional)\r\n        length: 256, // default 1024\r\n\r\n        // Limit range (Optional):\r\n        minNote: 32, // by MIDI note number\r\n        maxNote: 96,\r\n\r\n        // minFrequency: 440,    // by Frequency in Hz\r\n        // maxFrequency: 20000,\r\n\r\n        minPeriod: 2,  // by period (i.e. actual distance of calculation in audio buffer)\r\n        maxPeriod: 512, // --> convert to frequency: frequency = sampleRate / period\r\n\r\n        // Start right away\r\n        start: true, // default: false\r\n      });\r\n\r\n      window.detector = detector;\r\n    } else {\r\n      detector.stop();\r\n      detector.destroy();\r\n    }\r\n  }, []);\r\n\r\n  const [{midiIn}] = useMidi();\r\n\r\n  const midiInPitchClasses = _(12)\r\n    .range()\r\n    .map(n => _(midiIn)\r\n      .pickBy((v, i) => i % 12 === n)\r\n      .values()\r\n      .sum())\r\n    .value();\r\n\r\n  // TODO: position by freq, not 12TET pitch\r\n\r\n  return (// https://www.npmjs.com/package/aframe-animation-component\r\n    <Entity\r\n      events={{\r\n        click: () => {\r\n          audioContext.resume()\r\n        },\r\n      }}\r\n      position={{x: 0, y: 0, z: -6}}\r\n      scale={{x: 4, y: 4, z: 4}}\r\n    >\r\n      {_.range(noteRange[0], noteRange[1] + 1)\r\n        .map(noteToDimensions)\r\n        .map(({n, s, x, y, z}) => (\r\n          <PitchClass\r\n            key={n}\r\n            n={n}\r\n            position={{x, y, z}}\r\n            scale={{x: s, y: s, z: s}}\r\n          />))\r\n      }\r\n      <Entity\r\n        _ref={ref}\r\n        primitive='a-sphere'\r\n        material={{\r\n          blending: 'additive',\r\n          color: HSVtoHex(1, 0, 1),\r\n          opacity: 0,\r\n        }}\r\n        radius={0.1}\r\n      />\r\n    </Entity>\r\n  );\r\n};\r\n\r\nexport default PitchClassSpiral;\r\n","import 'aframe-touch-look-controls';\r\nimport Camera from './camera';\r\nimport ColtraneCircle from \"./coltraneCircle\";\r\nimport Dod from './dod';\r\nimport PitchClassSpiral from \"./pitchClassSpiral\";\r\nimport React from 'react';\r\nimport {Entity, Scene} from 'aframe-react';\r\nimport {Route, Switch} from 'react-router-dom';\r\n\r\n// Note: needs https to enter VR\r\n\r\nconst VR = ({match: {path}}) => (\r\n  <Scene\r\n    // fog={{type: 'linear', color: '#000', near: 1, far: 10}}\r\n  >\r\n    <a-assets>\r\n      <img id=\"groundTexture\" src=\"https://cdn.aframe.io/a-painter/images/floor.jpg\"/>\r\n      <img id=\"skyTexture\" src=\"https://cdn.aframe.io/a-painter/images/sky.jpg\"/>\r\n    </a-assets>\r\n\r\n    <Switch>\r\n      <Route path={`${path}/coltrane`} component={ColtraneCircle}/>\r\n      <Route path={`${path}/dod`} component={Dod}/>\r\n      <Route path={`${path}/pitchClassSpiral`} component={PitchClassSpiral}/>\r\n    </Switch>\r\n\r\n\r\n    {/*<Entity primitive=\"a-plane\" src=\"#groundTexture\" rotation=\"-90 0 0\" height=\"100\" width=\"100\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"ambient\" color=\"#445451\"/>*/}\r\n    {/*<Entity primitive=\"a-light\" type=\"point\" intensity=\"2\" position=\"2 4 4\"/>*/}\r\n\r\n    <Entity\r\n      height=\"2048\"\r\n      primitive=\"a-sky\"\r\n      radius=\"30\"\r\n      rotation=\"90 0 0\"\r\n      src=\"#skyTexture\"\r\n      theta-length=\"90\"\r\n      width=\"2048\"\r\n    />\r\n    <Entity\r\n      height=\"2048\"\r\n      primitive=\"a-sky\"\r\n      radius=\"30\"\r\n      rotation=\"90 0 180\"\r\n      src=\"#skyTexture\"\r\n      theta-length=\"90\"\r\n      width=\"2048\"\r\n    />\r\n\r\n    <Camera />\r\n\r\n    <Entity\r\n      // events={{}}\r\n      id=\"leftHand\"\r\n      oculus-touch-controls=\"hand: left\"\r\n    />\r\n    <Entity\r\n      id=\"rightHand\"\r\n      oculus-touch-controls=\"hand: right\"\r\n    />\r\n\r\n  </Scene>\r\n);\r\n\r\nexport default VR;\r\n","// import 'aframe-animation-component';\r\nimport 'aframe';\r\nimport 'aframe-look-at-component';\r\nimport Banjo from './banjo';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Guitar from './guitar';\r\nimport Intro from './intro';\r\nimport MultTableMod12 from './multTableMod12';\r\nimport NumpadMod12 from './numpadMod12';\r\nimport OSC from 'osc-js';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Mandelbrot from './mandelbrot';\r\nimport Midi from './midi';\r\nimport Staff from './staff';\r\nimport Tonnetz from './tonnetz';\r\nimport Ukulele from './ukulele';\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\nimport VR from './vr';\r\nimport {\r\n  AppBar,\r\n  IconButton,\r\n  Menu,\r\n  MenuItem,\r\n  Toolbar,\r\n} from '@material-ui/core';\r\nimport {BrowserRouter as Router, Route, Link} from 'react-router-dom';\r\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport {Menu as MenuIcon} from '@material-ui/icons';\r\nimport _ from 'lodash';\r\n\r\nconst doWhenAframeLoaded = () => {\r\n  if (typeof AFRAME === 'undefined') {\r\n    setTimeout(doWhenAframeLoaded, 100);\r\n    return;\r\n  }\r\n\r\n  const oscHost = {\r\n    host: window.location.hostname,\r\n    port: '8080',\r\n    secure: true,\r\n  };\r\n  const osc = new OSC({\r\n    plugin: new OSC.WebsocketClientPlugin(oscHost),\r\n  });\r\n  osc.open();\r\n  window.osc = osc;\r\n\r\n  // window.sendOsc = (address, ...args) => osc.send(new OSC.Message(address, ...args));\r\n\r\n  // osc.on('/midiSeq/clear', () => clearSeq());\r\n\r\n  // osc.on('/midiSeq/beat', ({args: [beat]}) => setBeat(beat));\r\n\r\n  // WIP\r\n  window.AFRAME.registerComponent('midi', {\r\n    init: function() {\r\n      // this.onOsc = (i, e) => {};\r\n\r\n      this._onOscId = osc.on('/midi/*', ({address, args: [note, vel]}) => {\r\n        const instrument = _.last(address.split('/'));\r\n        if (this.onOsc) this.onOsc({ instrument, note, vel });\r\n      });\r\n\r\n    },\r\n\r\n    tick: function (time, timeDelta) {\r\n      if (this.onTick) this.onTick(time, timeDelta);\r\n    },\r\n\r\n    remove: function() {\r\n      osc.off('/midi/*', this._onOscId);\r\n    },\r\n  });\r\n\r\n  window.AFRAME.registerComponent('osc', {\r\n    init: function() {\r\n      // this.onOsc = (i, e) => {};\r\n\r\n      this._onOscId = osc.on('/midi/*', ({address, args: [note, vel]}) => {\r\n        const instrument = _.last(address.split('/'));\r\n        if (this.onOsc) this.onOsc({ instrument, note, vel });\r\n      });\r\n\r\n    },\r\n\r\n    tick: function (time, timeDelta) {\r\n      if (this.onTick) this.onTick(time, timeDelta);\r\n    },\r\n\r\n    remove: function() {\r\n      osc.off('/midi/*', this._onOscId);\r\n    },\r\n  });\r\n}\r\ndoWhenAframeLoaded();\r\n\r\nconst routes2d = [\r\n  ['Mod12 Multiplication Tables', '/multTableMod12', MultTableMod12],\r\n  ['PC-Number Notepad', '/numpadMod12', NumpadMod12],\r\n  ['OSC Dataviz', '/osc', OSC, true],\r\n  ['PC Tonnetz', '/tonnetz', Tonnetz],\r\n  ['Banjo PCs', '/banjo', Banjo],\r\n  ['Guitar PCs', '/guitar', Guitar],\r\n  ['Ukulele PCs', '/ukulele', Ukulele],\r\n  ['Staff', '/staff', Staff],\r\n  ['Mandelbrot', '/mandelbrot', Mandelbrot],\r\n];\r\n\r\nconst App = () => {\r\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\r\n\r\n  const theme = React.useMemo(\r\n    () =>\r\n      createMuiTheme({\r\n        palette: { // https://material-ui.com/customization/palette/\r\n          action: {\r\n            active: '#660000',\r\n          },\r\n          primary: {\r\n            main: '#330033'\r\n          },\r\n          type: prefersDarkMode ? 'dark' : 'light',\r\n        },\r\n      }),\r\n    [prefersDarkMode],\r\n  );\r\n\r\n  // Menu open/close\r\n  const [menuAnchorEl, setMenuAnchorEl] = React.useState(null);\r\n  const handleMenuButtonClick = ({ currentTarget }) => setMenuAnchorEl(currentTarget);\r\n  const handleMenuClose = () => setMenuAnchorEl(null);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <CssBaseline/>\r\n      <Router basename={process.env.PUBLIC_URL}>\r\n        <Route path=\"/\" exact component={Intro}/>\r\n\r\n        <Route path=\"/vr\" render={(routerProps) => <VR {...routerProps} />}/>\r\n\r\n        {routes2d.map(([title, path, component], key) => (\r\n          <Route {...{ component, key, path }} />\r\n        ))}\r\n\r\n        <AppBar\r\n          color=\"transparent\"\r\n          onClick={() => {\r\n            // if (window.audioContext) { // FIXME HACK\r\n            //   window.audioContext.resume();\r\n            //   window.detector.start();\r\n            // }\r\n          }}\r\n          position=\"fixed\"\r\n          style={{\r\n            top: 'auto',\r\n            bottom: 0,\r\n          }}\r\n        >\r\n          <Toolbar>\r\n            <IconButton\r\n              edge=\"start\"\r\n              color=\"inherit\"\r\n              aria-label=\"open drawer\"\r\n              onClick={handleMenuButtonClick}\r\n            >\r\n              <MenuIcon/>\r\n            </IconButton>\r\n\r\n            <Menu\r\n              anchorEl={menuAnchorEl}\r\n              open={!!menuAnchorEl}\r\n              onClose={handleMenuClose}\r\n            >\r\n              <MenuItem>\r\n                <Link style={{ color: 'lightgrey'}} onClick={handleMenuClose} to=\"/\">Introduction</Link>\r\n              </MenuItem>\r\n              <MenuItem disabled divider >2D</MenuItem>\r\n              {routes2d.map(([title, url, component, isDevOnly], idx) => !isDevOnly && (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'pink'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n              <MenuItem disabled divider>VR</MenuItem>\r\n              {[\r\n                ['Coltrane Circle', '/vr/coltrane'],\r\n                ['Dod', '/vr/dod'],\r\n                ['PitchClassSpiral', '/vr/pitchClassSpiral'],\r\n              ].map(([title, url], idx) => (\r\n                <MenuItem key={idx}>\r\n                  <Link style={{ color: 'cyan'}} onClick={handleMenuClose} to={url}>{title}</Link>\r\n                </MenuItem>\r\n              ))}\r\n            </Menu>\r\n\r\n            <Midi />\r\n          </Toolbar>\r\n        </AppBar>\r\n      </Router>\r\n    </ThemeProvider>\r\n  );\r\n}\r\n\r\nReactDOM.render(<App/>, document.querySelector('#sceneContainer'));\r\n"],"sourceRoot":""}